Thu Mar 27 18:11:30 2025
-------------------------
CAS V2.15.1-rc1 - (C) Copyright 2000-2012 CHIPMAST TECHNOLOGY CO. LTD.
Main file   : main.asm
Current file: main.asm

     1                        ;********************************************************************************
     2                        ; PROJECT	: Calendar(MC830B)							*
     3                        ; AUTHOR	: WBN										*
     4                        ; REVISION	: 13/9/2024  V1.0	First issue				*
     5                        ; High OSC CLK  : Internal RC 4.4MHz	Fcpu = Fosc/2				*
     6                        ; Function	: 								*
     7                        ;********************************************************************************
     8                        	.CHIP	W65C02S      ;cpu的选型
     9                        	;.INCLIST	ON       ;宏定义和文件
    10                        	.MACLIST	ON
    11                        ;***************************************
    12                        CODE_BEG	EQU		C000H ;C000H(4K*4次)        ;起始地址
    13                        ;***************************************
    14                        
    15                        PROG	SECTION	OFFSET	CODE_BEG                ;定义代码段的偏移量从CODE_BEG开始，用于组织程序代码。
    16                        
    17                        ;***************************************
    18                        ;*	header include                               ;头文件
    19                        ;***************************************
    20                        	.include	50P016.h
     1                        .page0
     2                        .org 	00H
     3                        PA		EQU	01H
     4                        P_PA		EQU	PA
     5                        PAWAKE	EQU	02H
     6                        P_PA_WAKE	EQU	PAWAKE
     7                        PADIR	EQU	04H
     8                        P_PA_DIR	EQU	PADIR
     9                        P_PA_IO		EQU	PADIR
    10                        PB		EQU	05H
    11                        P_PB		EQU	PB
    12                        PBTYPE	EQU	06H
    13                        P_PB_TYPE	EQU	PBTYPE
    14                        PC		EQU	07H
    15                        P_PC 		EQU PC
    16                        PCDIR	EQU	08H
    17                        P_PC_IO 	EQU	PCDIR
    18                        P_PC_DIR	EQU	PCDIR
    19                        PCSEG	EQU	09H	;
    20                        P_PCSEG		EQU	PCSEG
    21                        PD		EQU	0AH
    22                        PDDIR	EQU 0BH
    23                        PADF0	EQU	0CH	;
    24                        P_PADF0		EQU	PADF0
    25                        PADF1	EQU	0DH	;
    26                        IER		EQU	0EH
    27                        P_IER 	EQU IER
    28                        IFR		EQU	0FH
    29                        P_IFR 		EQU IFR
    30                        TMR0	EQU	10H	;
    31                        P_TMR0		EQU	TMR0
    32                        TMR1	EQU	12H	;
    33                        P_TMR1  	EQU	TMR1
    34                        TMR2	EQU	14H	;
    35                        TMRC	EQU	16H	;
    36                        P_TMRCTRL 	EQU TMRC
    37                        P_TMRC		EQU	TMRC
    38                        bTMR0ON    EQU	   0
    39                        bTMR1ON    EQU	   1
    40                        bLCDON	   EQU	   4
    41                        bAUDON	   EQU	   7
    42                        
    43                        TMCLK	EQU	17H	;
    44                        P_TMRCLK 	EQU TMCLK
    45                        P_TMCLK 	EQU TMCLK
    46                        DIVC	EQU	18H	;
    47                        P_DIVC		EQU	DIVC
    48                        LCDCTRL	EQU	19H	;
    49                        LCDCOM	EQU	1AH	;
    50                        P_LCD_COM	EQU	LCDCOM
    51                        WDTC	EQU	1CH	;
    52                        SYSCLK	EQU	1DH
    53                        P_SYSCLK	EQU	SYSCLK
    54                        sysclk		equ SYSCLK
    55                        HALT	EQU	1EH	;
    56                        P_HALT		EQU	HALT
    57                        AUD0	EQU	1FH	;
    58                        P_AUD		EQU	AUD0
    59                        
    60                        AUDCR	EQU	20H	;
    61                        P_AUD_CTL	EQU	AUDCR
    62                        FRAME	EQU	21H	;
    63                        ;BANK	EQU	23H	;
    64                        MF		EQU	2FH
    65                        
    66                        SPCR	EQU	32H
    67                        SPSR	EQU	33H
    68                        SPDR	EQU	34H
    69                        PAK		EQU	3AH
    70                        PBK		EQU	3BH
    71                        PCK		EQU	3CH
    72                        LVC		EQU	3DH
    73                        FUSE	EQU	3EH
    74                        
    75                        PDSEG	EQU	5CH
    76                        RFCC0	EQU	5DH
    77                        RFCC1	EQU	5EH
    78                        
    79                        .ends
    79                        
    21                        	.INCLUDE	RAM.INC
     1                        .Kdata
     2                        ;***************************************
     3                        ; RAM Address
     4                        ;***************************************
     5                        RamStarAddr			EQU		1800H   ;RAM的开始地址
     6                        LCD_RamAddr			EQU		RamStarAddr     ;LCD RAM的地址
     7                        Time_Addr			EQU		RamStarAddr+Time_Str_Addr-Page0RamStarAddr
     8                        Cal_Addr			EQU		RamStarAddr+Calculator_Str_Addr-Page0RamStarAddr
     9                        RAM					EQU		80H
    10                        ;***************************************
    11                        ;Time_Addr		EUQ		B0H
    12                        ;***************************************
    13                        .PAGE0     ;page 0的内存布局
    14                        ;***************************************
    15                        ;	ORG	0098H
    16                        ;---------------------------------------------------------------------
    17                        	ORG	0080H
    18                        
    19                        Page0RamStarAddr	EQU		$
    20 00:0080: xx xx xx xx   LCDRAM					DS	6*5
    20 00:0080: xx xx xx xx   
    20 00:0080: xx xx xx xx   
    21                        D_LCD_RAM				EQU	6*5
    22                        
    23 00:009E: xx            R_Int_Backup			DS	1
    24                        
    25 00:009F: xx            Sys_Flag_A				DS	1		;0	系统状态
    26                        ; bit0 	=132hz标志
    27                        ; bit1	=1按键首次扫描标志
    28                        ; bit2 	=0按键循环扫描标志
    29                        ; bit3	=0设置模式
    30                        ; bit4 	=0快加设置
    31                        ; bit5 	=0无效键设置
    32                        ; bit6	=01,全显
    33                        ; bit7	=0
    34 00:00A0: xx            Sys_Flag_B				DS	1	;时钟模式的系统状态
    35                        ; bit0 	=半秒标志
    36                        ; bit1	=一秒标志
    37                        ; bit2	=12小时/24小时制度
    38                        ; bit3	=1是润年标志
    39                        ; bit4 	=
    40                        ; bit5 	=
    41                        ; bit6	=
    42                        ; bit7	=
    43 00:00A1: xx            Sys_Flag_C				DS	1	;闹钟模式的系统状态
    44                        ; bit0 	=0闹铃界面/1 整点报时
    45                        ; bit1	=0关闭整点报时，开启整点报时
    46                        ; bit2 	=
    47                        ; bit3	=
    48                        ; bit4 	=闹钟闹铃
    49                        ; bit5 	=
    50                        ; bit6	=
    51                        ; bit7	=1贪睡标志
    52 00:00A2: xx            Sys_Flag_D				DS	1	;计时器模式的系统状态
    53                        ; bit0 	=1正计时开启计时
    54                        ; bit1	=1是倒计时开启计时
    55                        ; bit2	=1第一次倒计时
    56                        ; bit3	=
    57                        ; bit4 	=定时器闹铃
    58                        ; bit5 	=0无中途测量，1中途测量
    59                        ; bit6	=
    60                        ; bit7	=
    61                        
    62                        
    63                        ; Sys_Flag_E					DS	1;
    64                        ; Sys_Flag_F					DS	1;
    65                        ; Sys_Flag_G					DS	1;
    66                        ; Sys_Flag_H					DS	1;
    67                        
    68                        
    69                        ; P_PA_IO_Backup      		DS	1	;B
    70                        ; P_PA_Backup         		DS	1	;C
    71                        ; P_PA_WAKE_Backup			DS	1	;D
    72                        ; P_PC_IO_Backup      		DS	1	;E
    73                        ; P_PC_Backup         		DS	1	;F
    74                        
    75                        
    76                        
    77 00:00A3: xx            R_Reset_Time				DS	1;全显时间,一般为2s
    78                        
    79 00:00A4: xx            R_Scankey_Time					DS	1;按键按下的时间
    80                        D_Rscankey_Half_Sec				EQU	16;按键时间
    81                        D_Rscankey_Sec					EQU	32
    82                        D_Rscankey_TWO_Sec				EQU	64
    83                        
    84                        
    85 00:00A5: xx            P_Scankey_value_T_1			DS	1
    86 00:00A6: xx            P_Scankey_value				DS	1;按键存储值
    87 00:00A7: xx            P_Scankey_value_Temporary	DS	1;按键临时储存
    88                        
    89                        D_PA_Press						EQU		01111100B
    90                        D_PA2_Press						EQU		01111000B
    91                        D_PA3_Press						EQU		01110100B
    92                        D_PA4_Press						EQU		01101100B
    93                        D_PA5_Press						EQU		01011100B
    94                        D_PA6_Press						EQU		00111100B
    95                        
    96                        D_PC_Press						EQU		00001111B
    97                        D_PC0_Press						EQU		00000001B
    98                        D_PC1_Press						EQU		00000010B
    99                        D_PC2_Press						EQU		00000100B
   100                        D_PC3_Press						EQU		00001000B
   101                        
   102                        ; P_Beep_Frequency				DS	1	;声音大小
   103                        ; D_Beep_Frequency_1_2_Duty		EQU	0
   104                        ; D_Beep_Frequency_3/4_Duty		EQU 80H
   105                        D_Mode_Press					EQU		1 ;
   106                        D_ST_SP_Press					EQU		2 ;
   107                        D_Reset_Press					EQU		3 ;
   108                        D_Light_Press					EQU		4 ;
   109                        D_NUM1_Press					EQU		6 ;1
   110                        D_NUM2_Press					EQU		7 ;2
   111                        D_NUM3_Press					EQU		8 ;3
   112                        D_NUM4_Press					EQU		9 ;4
   113                        D_NUM5_Press					EQU		11;5
   114                        D_NUM6_Press					EQU		12;6
   115                        D_NUM7_Press					EQU		13;7
   116                        D_NUM8_Press					EQU		14;8
   117                        D_NUM9_Press					EQU		16;9
   118                        D_NUM0_Press					EQU		17;0
   119                        D_NUM_Point_Press				EQU		18;.
   120                        D_NUM_Equal_Press				EQU		19;=
   121                        D_NUM_Add_Press					EQU		21;+
   122                        D_NUM1_Minus_Press				EQU		22;-
   123                        D_NUM1_Multiply_Press			EQU		23;*
   124                        D_NUM1_Divid_Press				EQU		24;/
   125                        
   126                        
   127                        
   128                        ;---------------------------------------
   129                        Time_Str_Addr	EQU		$
   130 00:00A8: xx            R_Time_Sec						DS	1;时钟的秒数;
   131 00:00A9: xx            R_Time_Min						DS	1;时钟的分钟数;
   132 00:00AA: xx            R_Time_Hr 						DS	1;时钟的小时数;
   133 00:00AB: xx            R_Time_Day 						DS	1;日
   134 00:00AC: xx            R_Time_Month 					DS	1;月
   135 00:00AD: xx            R_Time_Year						DS	1;年
   136 00:00AE: xx            R_Time_Week						DS	1;0是星期天，1是星期一---
   137                        
   138 00:00AF: xx            R_Time_Min_Another				DS	1;第二时间的分钟
   139 00:00B0: xx            R_Time_Hr_Another				DS	1;第二时间的小时
   140                        
   141 00:00B1: xx            R_Timer_Ms						DS	1;定时器10ms次数
   142 00:00B2: xx            R_Timer_Sec						DS	1;定时器显示时间/正计时时间秒数
   143 00:00B3: xx            R_Timer_Min						DS	1;定时器显示时间/正计时时间分钟
   144 00:00B4: xx            R_Timer_Hr						DS	1;定时器显示时间/正计时时间小时
   145                        
   146                        
   147                        
   148 00:00B5: xx            R_Timer_Sec_Countdown			DS	1;/倒计时剩余时间秒数;
   149 00:00B6: xx            R_Timer_Min_Countdown			DS	1;/倒计时剩余时间分钟;
   150 00:00B7: xx            R_Timer_Hr_Countdown			DS	1;/倒计时剩余时间小时;
   151 00:00B8: xx            R_Timer_Sec_Backup				DS	1;定时器倒计时储存时间时间;9
   152 00:00B9: xx            R_Timer_Min_Backup				DS	1;定时器倒计时储存时间时间;10
   153 00:00BA: xx            R_Timer_Hr_Backup				DS	1;定时器倒计时储存时间时间;11
   154                        D_Beep_Open_Last_Time_Timer		EQU	16
   155                        
   156                        
   157                        D_Beep_Open_Last_Time_Alarm		EQU	11
   158                        
   159 00:00BB: xx            R_Alarm_Clock_Min				DS	1;闹钟的分钟;	10
   160 00:00BC: xx            R_Alarm_Clock_Hr 				DS	1;闹钟的小时;	11
   161                        ; R_Alarm_Clock_Day 				DS	1;闹钟的天;	11
   162                        ; R_Alarm_Clock_Month				DS	1;闹铃的月份
   163 00:00BD: xx            R_Alarm_Mode					DS	1;闹钟的模式，0是闹钟关闭，1是闹钟开启，2是循环闹铃
   164                        ; R_Alarm_Clock_Mode				DS	1;0每日闹钟，1定日闹铃，2定月闹铃，3月次闹铃
   165 00:00BE: xx            R_Alarm_Ms						DS	1;1/4s的设置
   166                        
   167                        
   168                        
   169 00:00BF: xx            R_Snz_Time						DS	1;贪睡闹钟的分钟;
   170                        D_Snz_Time						EQU	5
   171 00:00C0: xx            R_Snz_Frequency					DS	1;贪睡闹钟的小时;
   172                        D_Snz_Frequency					EQU	6
   173                        
   174                        
   175                        ; R_Mode							DS	1;0是手表部分，1是计算器部分
   176                        
   177 00:00C1: xx            R_Mode_Time						DS	1;0是时钟模式，1是闹钟，2是正计时，3是第二时钟，4是倒计时
   178 00:00C2: xx            R_Mode_Time_Set					DS	1;设置模式
   179                        
   180                        ; R_Time_Hr_am_pm					DS	1;判断AM和PM内存临时储存
   181                        
   182                        
   183                        
   184 00:00C3: xx            R_Set_Mode_Exit_Time			DS	1;自动设置退出时间
   185                        D_Set_Mode_Exit_Time			EQU	81
   186                        
   187 00:00C4: xx            R_Fast_Plus_Time				DS	1;长按LCD快加
   188                        
   189                        
   190 00:00C5: xx            R_Close_All_Dis					DS	1;控制关闭全显
   191                        D_Close_All_Dis					EQU	2
   192                        
   193                        
   194 00:00C6: xx            R_Close_Light_Time				DS	1;关闭light的时间
   195                        D_Close_Light_Time				EQU	2
   196                        
   197                        
   198 00:00C7: xx            R_Alarm_Clock_Open_Beep_Time	DS	1;32Hz转化为16hz
   199 00:00C8: xx            R_Close_Beep_Time				DS	1;闹铃关闭时间，闹铃响多久
   200 00:00C9: xx            R_Voice_Unit					DS	1;闹铃响的次数，一秒响几次
   201                        
   202                        ;==================================================
   203                        ;==================================================
   204                        ;===================================================
   205                        Calculator_Str_Addr	EQU		$
   206                        ; Sys_Flag_Cala		DS		1
   207                        MAX_DIG		.EQU	8
   208                        Dig			.EQU	MAX_DIG
   209                        MAX_BYTE	.EQU	MAX_DIG / 2
   210                        
   211                        FD			.EQU	MAX_DIG
   212 00:00CA: xx xx xx xx   BUF1		.DS		MAX_DIG+1
   212 00:00CA: xx xx xx xx   
   212 00:00CA: xx            
   213 00:00D3: xx xx xx xx   BUF2		.DS		MAX_DIG+1
   213 00:00D3: xx xx xx xx   
   213 00:00D3: xx            
   214 00:00DC: xx xx xx xx   BUF3		.DS		MAX_DIG
   214 00:00DC: xx xx xx xx   
   215 00:00E4: xx xx xx xx   BUF4		.DS		MAX_DIG
   215 00:00E4: xx xx xx xx   
   216 00:00EC: xx xx xx xx   BUF5		.DS		MAX_DIG
   216 00:00EC: xx xx xx xx   
   217 00:00F4: xx xx xx xx   BUF6		.DS		4
   218                        Calc_Temp1	.EQU		BUF1
   219                        Calc_Temp2	.EQU		BUF2
   220                        Calc_Temp3	.EQU		BUF3
   221                        ;---------------------------------------
   222 00:00F8: xx xx xx xx   P_Temp			ds	6
   222 00:00F8: xx xx         
   223                        ;显示从写P_Temp+4
   224                        ;---------------------------------------
   225                        ;---------------------------------------
   226                        ;***************************************
   227                        .ENDS
   228                        ;***************************************
   229                        .Udata
   230                        ;---------------------------------------
   231                        	ORG    1880H
   232                        ;---------------------------------------
   233                        ;---------------------------------------
   234                        .ENDS
   235                        
   235                        
    22                        	.include	50P016.mac
     1                        ;------------------------------------
     2                        PB2_PB2_COMS MACRO
     3                                RMB0    PADF0
     4                                SMB2    PBTYPE ;COMS
     5                                ENDM
     6                        PB2_PB2_NOMS MACRO
     7                                RMB0    PADF0
     8                                RMB2    PBTYPE ;NOMS
     9                                ENDM
    10                        PB2_PWM MACRO
    11                                SMB0    PADF0
    12                                SMB2    PBTYPE ;COMS
    13                                ENDM
    14                        PB3_PB3_COMS MACRO
    15                                RMB1    PADF0
    16                                SMB3    PBTYPE ;NMOS
    17                                ENDM
    18                        PB3_PB3_NOMS MACRO
    19                                RMB1    PADF0
    20                                RMB3    PBTYPE ;CMOS
    21                                ENDM
    22                        PB3_PWM MACRO
    23                                SMB1    PADF0
    24                                SMB3    PBTYPE ;CMOS
    25                                ENDM
    26                        
    27                        PA4_PA4 MACRO
    28                                RMB3    PADF0
    29                                RMB4    PADF0
    30                                ENDM
    31                        PA4_IR_FSUB     MACRO
    32                                SMB3    PADF0
    33                                RMB4    PADF0
    34                                ENDM
    35                        PA4_IR_TMR0_D2  MACRO
    36                                RMB3    PADF0
    37                                SMB4    PADF0
    38                                ENDM
    39                        PA4_IR_TMR0_D3  MACRO
    40                                SMB3    PADF0
    41                                SMB4    PADF0
    42                                ENDM
    43                        
    44                        PA7_PA7 MACRO
    45                                RMB2    PADF0
    46                                ENDM
    47                        
    48                        PA7_EXT MACRO
    49                                SMB2    PADF0 ;falling edge trigger
    50                                ENDM
    51                        
    52                        PC45_PC45       MACRO
    53                                RMB4    PCSEG
    54                                ENDM
    55                        
    56                        PC67_PC67       MACRO
    57                                RMB5    PCSEG
    58                                RMB4    DIVC
    59                                ENDM
    60                        
    61                        PC67_EL01       MACRO
    62                                RMB5    PCSEG
    63                                SMB4    DIVC
    64                                ENDM
    65                        
    66                        PC03_SEG       MACRO
    67                                SMB0    PCSEG
    68                                SMB1    PCSEG
    69                                SMB2    PCSEG
    70                                SMB3    PCSEG
    71                                ENDM
    72                        
    73                        PC45_SEG       MACRO
    74                                SMB4    PCSEG
    75                                ENDM
    76                        PC67_SEG	MACRO
    77                                SMB5    PCSEG
    78                                ENDM
    79                        
    80                        PD03_SEG	MACRO
    81                        		SMB6	PCSEG
    82                                ENDM
    83                        PD03_RFC	MACRO
    84                        		RMB6	PCSEG
    85                        ;		RMB0	PDSEG
    86                        ;		RMB1	PDSEG
    87                        ;		RMB2	PDSEG
    88                        ;		RMB3	PDSEG
    89                        		SMB0	RFCC0
    90                        		SMB1	RFCC0
    91                        		SMB2	RFCC0
    92                        		SMB3	RFCC0
    93                                ENDM
    94                        PD03_PD03	MACRO
    95                        		RMB6	PCSEG
    96                        ;		RMB0	PDSEG
    97                        ;		RMB1	PDSEG
    98                        ;		RMB2	PDSEG
    99                        ;		RMB3	PDSEG
   100                        		RMB0	RFCC0
   101                        		RMB1	RFCC0
   102                        		RMB2	RFCC0
   103                        		RMB3	RFCC0
   104                                ENDM
   105                        PD0_SEG	MACRO
   106                        ;		RMB6	PCSEG
   107                        		SMB0	PDSEG
   108                                ENDM
   109                        PD1_SEG	MACRO
   110                        ;		RMB6	PCSEG
   111                        		SMB1	PDSEG
   112                                ENDM
   113                        PD2_SEG	MACRO
   114                        ;		RMB6	PCSEG
   115                        		SMB2	PDSEG
   116                                ENDM
   117                        PD3_SEG	MACRO
   118                        		RMB6	PCSEG
   119                        		SMB3	PDSEG
   120                                ENDM
   121                        
   122                        PD47_SEG	MACRO
   123                        		SMB7	PCSEG
   124                                ENDM
   125                        PD47_RFC	MACRO
   126                        		RMB7	PCSEG
   127                        ;		RMB4	PDSEG
   128                        ;		RMB5	PDSEG
   129                        ;		RMB6	PDSEG
   130                        ;		RMB7	PDSEG
   131                        		SMB4	RFCC0
   132                        		SMB5	RFCC0
   133                        		SMB6	RFCC0
   134                        		SMB7	RFCC0
   135                                ENDM
   136                        PD47_PD47	MACRO
   137                        		RMB7	PCSEG
   138                        ;		RMB4	PDSEG
   139                        ;		RMB5	PDSEG
   140                        ;		RMB6	PDSEG
   141                        ;		RMB7	PDSEG
   142                        		RMB4	RFCC0
   143                        		RMB5	RFCC0
   144                        		RMB6	RFCC0
   145                        		RMB7	RFCC0
   146                                ENDM
   147                        PD4_SEG	MACRO
   148                        ;		RMB7	PCSEG
   149                        		SMB4	PDSEG
   150                                ENDM
   151                        PD5_SEG	MACRO
   152                        ;		RMB7	PCSEG
   153                        		SMB5	PDSEG
   154                                ENDM
   155                        PD6_SEG	MACRO
   156                        ;		RMB7	PCSEG
   157                        		SMB6	PDSEG
   158                                ENDM
   159                        PD7_SEG	MACRO
   160                        		RMB7	PCSEG
   161                        		SMB7	PDSEG
   162                                ENDM
   163                        
   164                        PC_PD_SEG	MACRO
   165                        		lda		#$FF
   166                        		STA		PCSEG	;S1~S7,S8~S15
   167                                ENDM
   168                        
   169                        LCD_2COM	MACRO
   170                        		SMB0	LCDCOM
   171                        		RMB1	LCDCOM
   172                        		RMB2	LCDCOM
   173                                ENDM
   174                        LCD_3COM	MACRO
   175                        		RMB0	LCDCOM
   176                        		SMB1	LCDCOM
   177                        		RMB2	LCDCOM
   178                                ENDM
   179                        LCD_4COM	MACRO
   180                        		SMB0	LCDCOM
   181                        		SMB1	LCDCOM
   182                        		RMB2	LCDCOM
   183                                ENDM
   184                        LCD_5COM	MACRO
   185                        		RMB0	LCDCOM
   186                        		RMB1	LCDCOM
   187                        		SMB2	LCDCOM
   188                                ENDM
   189                        LCD_6COM	MACRO
   190                        		SMB0	LCDCOM
   191                        		RMB1	LCDCOM
   192                        		SMB2	LCDCOM
   193                                ENDM
   194                        LCD_7COM	MACRO
   195                        		RMB0	LCDCOM
   196                        		SMB1	LCDCOM
   197                        		SMB2	LCDCOM
   198                                ENDM
   199                        LCD_8COM	MACRO
   200                        		SMB0	LCDCOM
   201                        		SMB1	LCDCOM
   202                        		SMB2	LCDCOM
   203                                ENDM
   204                        
   205                        LCD_ENCH_EN		MACRO
   206                        		SMB6	LCDCOM
   207                                ENDM
   208                        LCD_ENCH_DIS	MACRO
   209                        		RMB6	LCDCOM
   210                                ENDM
   211                        
   212                        LCD_C_TYPE	MACRO
   213                        		SMB7	LCDCOM
   214                        		SMB0	PCSEG
   215                        		SMB1	PCSEG
   216                        		SMB2	PCSEG
   217                        		SMB3	PCSEG
   218                                ENDM
   219                        LCD_DRIVE_2	MACRO
   220                        		SMB0	LCDCTRL
   221                        		RMB1	LCDCTRL
   222                                ENDM
   223                        LCD_DRIVE_4	MACRO
   224                        		RMB0	LCDCTRL
   225                        		SMB1	LCDCTRL
   226                                ENDM
   227                        LCD_DRIVE_8	MACRO
   228                        		SMB0	LCDCTRL
   229                        		SMB1	LCDCTRL
   230                                ENDM
   231                        LCD_DRIVE_FULL	MACRO
   232                        		RMB0	LCDCTRL
   233                        		RMB1	LCDCTRL
   234                                ENDM
   235                        LCD_C_1_2_BAIS_3V	MACRO
   236                        		RMB2	LCDCTRL
   237                        		RMB3	LCDCTRL
   238                                ENDM
   239                        LCD_C_1_3_BAIS_3V	MACRO
   240                        		SMB2	LCDCTRL
   241                        		RMB3	LCDCTRL
   242                                ENDM
   243                        LCD_C_1_3_BAIS_4V	MACRO
   244                        		SMB2	LCDCTRL
   245                        		SMB3	LCDCTRL
   246                                ENDM
   247                        
   248                        LCD_R_TYPE	MACRO
   249                        		RMB7	LCDCOM
   250                                ENDM
   251                        LCD_R_1_2_BAIS	MACRO
   252                        		SMB2	LCDCTRL
   253                        		SMB3	LCDCTRL
   254                                ENDM
   255                        LCD_R_1_3_BAIS	MACRO
   256                        		RMB2	LCDCTRL
   257                        		RMB3	LCDCTRL
   258                                ENDM
   259                        LCD_R_1_4_BAIS	MACRO
   260                        		SMB2	LCDCTRL
   261                        		RMB3	LCDCTRL
   262                                ENDM
   263                        ;------------------------------------
   264                        Fext_WEAK       MACRO
   265                                RMB0    SYSCLK
   266                                ENDM
   267                        Fext_STRONG     MACRO
   268                                SMB0    SYSCLK
   269                                ENDM
   270                        
   271                        Fext_OFF        MACRO
   272                                RMB1    SYSCLK
   273                                ENDM
   274                        Fext_ON         MACRO
   275                                SMB1    SYSCLK
   276                                ENDM
   277                        
   278                        Fosc_OFF        MACRO
   279                                RMB2    SYSCLK
   280                                ENDM
   281                        Fosc_ON         MACRO
   282                                SMB2    SYSCLK
   283                                ENDM
   284                        
   285                        Fext_Xtal       MACRO
   286                                RMB3    SYSCLK
   287                                ENDM
   288                        Fext_RC         MACRO
   289                                SMB3    SYSCLK
   290                                ENDM
   291                        
   292                        Fsys_4MHZ MACRO
   293                                RMB4    SYSCLK
   294                                RMB5    SYSCLK
   295                                ENDM
   296                        Fsys_2MHZ MACRO
   297                                SMB4    SYSCLK
   298                                RMB5    SYSCLK
   299                                ENDM
   300                        Fsys_1MHZ MACRO
   301                                RMB4    SYSCLK
   302                                SMB5    SYSCLK
   303                                ENDM
   304                        Fsys_500K MACRO
   305                                SMB4    SYSCLK
   306                                SMB5    SYSCLK
   307                                ENDM
   308                        
   309                        Fsub_Fext MACRO
   310                                SMB6    SYSCLK
   311                                ENDM
   312                        Fsub_32KCLK     MACRO
   313                                RMB6    SYSCLK
   314                                ENDM
   315                        
   316                        Fcpu_Fext  MACRO
   317                                SMB7    SYSCLK
   318                                ENDM
   319                        Fcpu_Fsys  MACRO
   320                                RMB7    SYSCLK
   321                                ENDM
   322                        
   323                        ;------------------------------------
   324                        DIV_8KHZ  MACRO
   325                                RMB0    DIVC
   326                                RMB1    DIVC
   327                        		RMB5	DIVC
   328                                ENDM
   329                        DIV_16KHZ  MACRO
   330                                SMB0    DIVC
   331                                RMB1    DIVC
   332                        		RMB5	DIVC
   333                                ENDM
   334                        DIV_512HZ  MACRO
   335                                RMB0    DIVC
   336                                SMB1    DIVC
   337                        		RMB5	DIVC
   338                                ENDM
   339                        DIV_1KHZ  MACRO
   340                                SMB0    DIVC
   341                                SMB1    DIVC
   342                        		RMB5	DIVC
   343                                ENDM
   344                        DIV_256HZ  MACRO
   345                        		SMB5	DIVC
   346                                ENDM
   347                        ;------------------------------------
   348                        WDTC_CLK_256HZ   MACRO
   349                                RMB0    WDTC
   350                                RMB1    WDTC
   351                                ENDM
   352                        WDTC_CLK_DIV     MACRO
   353                                SMB0    WDTC
   354                                RMB1    WDTC
   355                                ENDM
   356                        WDTC_CLK_TMR1   MACRO
   357                                RMB0    WDTC
   358                                SMB1    WDTC
   359                                ENDM
   360                        WDTC_CLK_LCDS    MACRO
   361                                SMB0    WDTC
   362                                SMB1    WDTC
   363                                ENDM
   364                        
   365                        WDTC_CLR MACRO
   366                                RMB2    WDTC
   367                                ENDM
   368                        
   369                        WDTC_ON  MACRO
   370                                SMB3    WDTC
   371                                ENDM
   372                        WDTC_OFF MACRO
   373                                RMB3    WDTC
   374                                ENDM
   375                        
   376                        IF_WDTC MACRO   LAB
   377                                BBS4    WDTC,LAB
   378                                ENDM
   379                        
   380                        ;------------------------------------
   381                        TMR0_ON MACRO
   382                                SMB0    TMRC
   383                                ENDM
   384                        TMR0_OFF MACRO
   385                                RMB0    TMRC
   386                                ENDM
   387                        TMR0_CLK_FOSC   MACRO
   388                                SMB0    TMCLK
   389                                RMB1    TMCLK
   390                                ENDM
   391                        TMR0_CLK_FSUB    MACRO
   392                                RMB0    TMCLK
   393                                RMB1    TMCLK
   394                                RMB0	PADF1
   395                                ENDM
   396                        TMR0_CLK_128K	macro
   397                        		RMB0    TMCLK
   398                                SMB1    TMCLK
   399                                ENDM
   400                        TMR0_CLK_32K	macro
   401                        		RMB0    TMCLK
   402                                RMB1    TMCLK
   403                                SMB0	PADF1
   404                                ENDM
   405                        TMR0_CLK_1M   MACRO
   406                                SMB0    TMCLK
   407                                SMB1    TMCLK
   408                                RMB6	TMRC
   409                                ENDM
   410                        
   411                        TMR1_ON MACRO
   412                                SMB1    TMRC
   413                                ENDM
   414                        TMR1_OFF MACRO
   415                                RMB1    TMRC
   416                                ENDM
   417                        TMR1_CLK_TMR0   MACRO
   418                                RMB2    TMCLK
   419                                RMB3    TMCLK
   420                                ENDM
   421                        TMR1_CLK_512Hz    MACRO
   422                                SMB2    TMCLK
   423                                RMB3    TMCLK
   424                                ENDM
   425                        TMR1_CLK_128K	macro
   426                        		RMB2    TMCLK
   427                                SMB3    TMCLK
   428                                ENDM
   429                        TMR1_CLK_1M		macro
   430                        		SMB2    TMCLK
   431                                SMB3    TMCLK
   432                                ENDM
   433                        
   434                        TMR2_ON MACRO
   435                                SMB2    TMRC
   436                                ENDM
   437                        TMR2_OFF MACRO
   438                                RMB2    TMRC
   439                                ENDM
   440                        ;TMR2_CLK_1KDIV2    MACRO
   441                        ;       RMB4    TMCLK
   442                        ;        RMB5    TMCLK
   443                        ;        ENDM
   444                        ;TMR2_CLK_1KDIV3    MACRO
   445                        ;        SMB4    TMCLK
   446                        ;        RMB5    TMCLK
   447                        ;        ENDM
   448                        ;TMR2_CLK_FOSCDIV8  MACRO
   449                        ;        RMB4    TMCLK
   450                        ;        SMB5    TMCLK
   451                        ;        ENDM
   452                        ;TMR2_CLK_FSUB      MACRO
   453                        ;        SMB4    TMCLK
   454                        ;        SMB5    TMCLK
   455                        ;        ENDM
   456                        
   457                        
   458                        TONE_2KHZ       MACRO
   459                                RMB2    DIVC
   460                                RMB3    DIVC
   461                                ENDM
   462                        TONE_TMR0_2     MACRO
   463                                SMB2    DIVC
   464                                RMB3    DIVC
   465                                ENDM
   466                        TONE_L       MACRO
   467                                RMB2    DIVC
   468                                SMB3    DIVC
   469                                ENDM
   470                        TONE_H       MACRO
   471                                SMB2    DIVC
   472                                SMB3    DIVC
   473                                ENDM
   474                        ;------------------------------------
   475                        EN_DIV_IRQ     MACRO
   476                                SMB0    IER
   477                                ENDM
   478                        EN_TMR0_IRQ     MACRO
   479                                SMB1    IER
   480                                ENDM
   481                        EN_TMR1_IRQ     MACRO
   482                                SMB2    IER
   483                                ENDM
   484                        EN_TMR2_IRQ     MACRO
   485                                SMB3    IER
   486                                ENDM
   487                        EN_KEY_IRQ      MACRO
   488                                SMB4    IER
   489                                ENDM
   490                        EN_PA_IRQ      MACRO
   491                                SMB4    IER
   492                                ENDM
   493                        EN_EXT_IRQ      MACRO
   494                                SMB5    IER
   495                                ENDM
   496                        EN_LCD_IRQ      MACRO
   497                                SMB6    IER
   498                                ENDM
   499                        
   500                        DIS_DIV_IRQ     MACRO
   501                                RMB0    IER
   502                                ENDM
   503                        DIS_TMR0_IRQ     MACRO
   504                                RMB1    IER
   505                                ENDM
   506                        DIS_TMR1_IRQ     MACRO
   507                                RMB2    IER
   508                                ENDM
   509                        DIS_TMR2_IRQ     MACRO
   510                                RMB3    IER
   511                                ENDM
   512                        DIS_KEY_IRQ      MACRO
   513                                RMB4    IER
   514                                ENDM
   515                        DIS_PA_IRQ		 MACRO
   516                                RMB4    IER
   517                                ENDM
   518                        DIS_EXT_IRQ      MACRO
   519                                RMB5    IER
   520                                ENDM
   521                        DIS_LCD_IRQ      MACRO
   522                                RMB6    IER
   523                                ENDM
   524                        
   525                        CLR_DIV_IRQ_FLAG MACRO
   526                                RMB0    IFR
   527                                ENDM
   528                        CLR_TMR0_IRQ_FLAG      MACRO
   529                                RMB1    IFR
   530                                ENDM
   531                        CLR_TMR1_IRQ_FLAG      MACRO
   532                                RMB2    IFR
   533                                ENDM
   534                        CLR_TMR2_IRQ_FLAG      MACRO
   535                                RMB3    IFR
   536                                ENDM
   537                        CLR_KEY_IRQ_FLAG      MACRO
   538                                RMB4    IFR
   539                                ENDM
   540                        CLR_PA_IRQ_FLAG      MACRO
   541                                RMB4    IFR
   542                                ENDM
   543                        CLR_PA_IRQF      MACRO
   544                                RMB4    IFR
   545                                ENDM
   546                        CLR_EXT_IRQ_FLAG       MACRO
   547                                RMB5    IFR
   548                                ENDM
   549                        CLR_LCD_IRQ_FLAG       MACRO
   550                                RMB6    IFR
   551                                ENDM
   552                        
   553                        IF_DIV_IRQ_FLAG MACRO   LAB1
   554                                BBS0    IFR,LAB1
   555                                ENDM
   556                        IF_TMR0_IRQ_FLAG MACRO   LAB1
   557                                BBS1    IFR,LAB1
   558                                ENDM
   559                        IF_TMR1_IRQ_FLAG MACRO   LAB1
   560                                BBS2    IFR,LAB1
   561                                ENDM
   562                        IF_TMR2_IRQ_FLAG MACRO   LAB1
   563                                BBS3    IFR,LAB1
   564                                ENDM
   565                        IF_KEY_IRQ_FLAG MACRO   LAB1
   566                                BBS4    IFR,LAB1
   567                                ENDM
   568                        IF_EXT_IRQ_FLAG MACRO   LAB1
   569                                BBS5    IFR,LAB1
   570                                ENDM
   571                        IF_LCD_IRQ_FLAG MACRO   LAB1
   572                                BBS6    IFR,LAB1
   573                                ENDM
   574                        ;------------------------------------
   575                        LCD_ON           MACRO
   576                                SMB4    TMRC
   577                                ENDM
   578                        LCD_OFF          MACRO
   579                                RMB4    TMRC
   580                                ENDM
   581                        
   582                        PWM_ON  MACRO
   583                        		SMB0	SYSCLK	;Strong Mode
   584                                SMB7    TMRC
   585                                ENDM
   586                        PWM_OFF MACRO
   587                                RMB7    TMRC
   588                        ;		lda		R_Strong_2S
   589                        ;		bne		?Skip
   590                        		RMB0	SYSCLK	;WeakMode
   591                        ?Skip:
   592                                ENDM
   593                        ;DAC_ON		MACRO
   594                        ;	SMB7	P_TMRCTRL
   595                        ;	ENDM
   596                        ;DAC_OFF		MACRO
   597                        ;	RMB7	P_TMRCTRL
   598                        ;	ENDM
   599                        
   600                        IF_PWM_ON       MACRO   LAB
   601                                BBS7    TMRC,LAB
   602                                ENDM
   603                        IF_PWM_OFF      MACRO   LAB
   604                                BBR7    TMRC,LAB
   605                                ENDM
   606                        
   607                        SEL_PWM MACRO
   608                                SMB1    AUDCR
   609                                ENDM
   610                        DAC_LATCH_TMR0	MACRO
   611                        		SMB5	AUDCR
   612                        		ENDM
   613                        SEL_TONE MACRO
   614                                RMB2    AUDCR
   615                                RMB4    AUDCR
   616                                RMB5    AUDCR
   617                                ENDM
   618                        
   619                        SEL_MELODY  MACRO
   620                                RMB2    AUDCR
   621                                SMB4    AUDCR
   622                        ;        SMB5    AUDCR
   623                                RMB5    AUDCR
   624                                ENDM
   625                        SEL_VOICE   MACRO
   626                                SMB2    AUDCR
   627                                RMB4    AUDCR
   628                                SMB5    AUDCR
   629                                ENDM
   630                        ;------------------------------------
   631                        ClrAllRam MACRO
   632                            LDA		#$00
   633                        	LDX		#$FF
   634                        	STA		$1800
   635                        ?ClrAllRamLoop:
   636                        	STA		$1800,X
   637                        	DEX
   638                        	BNE		?ClrAllRamLoop
   639                            ENDM
   640                        ;------------------------------------
   641                        CHECK_LCD	MACRO
   642                        	LDA		#11111110B
   643                        	STA		P_PC_DIR		;PC0 is Output
   644                        	LDA		#11111110B
   645                        	STA		P_PC			;PC0 Output "0"
   646                        	NOP
   647                        	NOP
   648                        	NOP
   649                        	LDA		P_PC
   650                        	AND		#00000010B
   651                        ?_Loop
   652                        	STA		P_Temp+1
   653                        	LDA		#$0F
   654                        ?_LoopPort
   655                        	DEC
   656                        	BNE		?_LoopPort
   657                        	LDA		P_PC
   658                        	AND		#00000010B
   659                        	STA		P_Temp
   660                        	CMP		P_Temp+1
   661                        	BNE		?_Loop
   662                        	BBS1	P_Temp,?LCD_R_Type
   663                        ?LCD_C_Type:
   664                        	LCD_C_TYPE
   665                        	LCD_ENCH_EN
   666                        	LCD_4COM
   667                        	LCD_DRIVE_8
   668                        	LCD_C_1_3_BAIS_3V
   669                        	JMP		?Exit
   670                        ?LCD_R_Type:
   671                        	LCD_R_TYPE
   672                        ;	LCD_ENCH_EN
   673                        	LCD_4COM
   674                        ;	LCD_DRIVE_8
   675                        	LCD_R_1_3_BAIS
   676                        
   677                        ?Exit:
   678                        	LDA		#$00
   679                        	STA		P_PC_IO
   680                        	STA		P_PC
   681                        ;	STA		P_PC_IO_Backup
   682                        ;	STA		P_PC_Backup
   683                        	ENDM
   684                        ;------------------------------------
   685                        ;------------------------------------
   685                        
    23                        	.INCLUDE	MACRO.MAC
     1                        ;***********************************************************************
     2                        BRA_IDX MACRO	MEM
     3                        	if	MEM<$100
     4                        	BRA	($80+MEM)
     5                        	else
     6                        	BRA	(MEM)
     7                        	endif
     8                        	ENDM
     9                        
    10                        LDLN	MACRO	mem
    11                        	if	mem<$100
    12                        	LDA	$780+mem
    13                        	else
    14                        	LDA	$700+mem
    15                        	endif
    16                        	ENDM
    17                        
    18                        LDHN	MACRO	mem
    19                        	if	mem<$100
    20                        	LDA	$F80+mem
    21                        	else
    22                        	LDA	$F00+mem
    23                        	endif
    24                        	ENDM
    25                        
    26                        STLN	MACRO	mem
    27                        	if	mem<$100
    28                        	STA	$780+mem
    29                        	else
    30                        	STA	$700+mem
    31                        	endif
    32                        	ENDM
    33                        
    34                        STHN	MACRO	mem
    35                        	if	mem<$100
    36                        	STA	$F80+mem
    37                        	else
    38                        	STA	$F00+mem
    39                        	endif
    40                        	ENDM
    41                        
    42                        LXLN	MACRO	mem
    43                        	if	mem<$100
    44                        	LDX	$780+mem
    45                        	else
    46                        	LDX	$700+mem
    47                        	endif
    48                        	ENDM
    49                        
    50                        LXHN	MACRO	mem
    51                        	if	mem<$100
    52                        	LDX	$F80+mem
    53                        	else
    54                        	LDX	$F00+mem
    55                        	endif
    56                        	ENDM
    57                        
    58                        SXLN	MACRO	mem
    59                        	if	mem<$100
    60                        	STX	$780+mem
    61                        	else
    62                        	STX	$700+mem
    63                        	endif
    64                        	ENDM
    65                        
    66                        SXHN	MACRO	mem
    67                        	if	mem<$100
    68                        	STX	$F80+mem
    69                        	else
    70                        	STX	$F00+mem
    71                        	endif
    72                        	ENDM
    73                        
    74                        LDLN_X	MACRO	mem
    75                        	if	mem<$100
    76                        	LDA	$780+mem,X
    77                        	else
    78                        	LDA	$700+mem,X
    79                        	endif
    80                        	ENDM
    81                        
    82                        STLN_X	MACRO	mem
    83                        	if	mem<$100
    84                        	STA	$780+mem,X
    85                        	else
    86                        	STA	$700+mem,X
    87                        	endif
    88                        	ENDM
    89                        
    90                        LDHN_X	MACRO	mem
    91                        	if	mem<$100
    92                        	LDA	$F80+mem,X
    93                        	else
    94                        	LDA	$F00+mem,X
    95                        	endif
    96                        	ENDM
    97                        
    98                        STHN_X	MACRO	mem
    99                        	if	mem<$100
   100                        	STA	$F80+mem,X
   101                        	else
   102                        	STA	$F00+mem,X
   103                        	endif
   104                        	ENDM
   105                        
   106                        INCHN_X	MACRO	mem
   107                        	if	mem<$100
   108                        	INC	$F80+mem,X
   109                        	else
   110                        	INC	$F00+mem,X
   111                        	endif
   112                        	ENDM
   113                        
   114                        DECHN_X	MACRO	mem
   115                        	if	mem<$100
   116                        	DEC	$F80+mem,X
   117                        	else
   118                        	DEC	$F00+mem,X
   119                        	endif
   120                        	ENDM
   121                        
   122                        ADCLN	MACRO	mem
   123                        	if	mem<$100
   124                        	ADC	$780+mem
   125                        	else
   126                        	ADC	$700+mem
   127                        	endif
   128                        	ENDM
   129                        
   130                        ADCHN	MACRO	mem
   131                        	if	mem<$100
   132                        	ADC	$F80+mem
   133                        	else
   134                        	ADC	$F00+mem
   135                        	endif
   136                        	ENDM
   137                        
   138                        CMPLN	MACRO	mem
   139                        	if	mem<$100
   140                        	CMP	$780+mem
   141                        	else
   142                        	CMP	$700+mem
   143                        	endif
   144                        	ENDM
   145                        
   146                        CMPHN	MACRO	mem
   147                        	if	mem<$100
   148                        	CMP	$F80+mem
   149                        	else
   150                        	CMP	$F00+mem
   151                        	endif
   152                        	ENDM
   153                        
   154                        INCLN	MACRO	mem
   155                        	if	mem<$100
   156                        	INC	$780+mem
   157                        	else
   158                        	INC	$700+mem
   159                        	endif
   160                        	ENDM
   161                        
   162                        INCHN	MACRO	mem
   163                        	if	mem<$100
   164                        	INC	$F80+mem
   165                        	else
   166                        	INC	$F00+mem
   167                        	endif
   168                        	ENDM
   169                        
   170                        DECLN	MACRO	mem
   171                        	if	mem<$100
   172                        	DEC	$780+mem
   173                        	else
   174                        	DEC	$700+mem
   175                        	endif
   176                        	ENDM
   177                        
   178                        DECHN	MACRO	mem
   179                        	if	mem<$100
   180                        	DEC	$F80+mem
   181                        	else
   182                        	DEC	$F00+mem
   183                        	endif
   184                        	ENDM
   185                        
   186                        LDA_X	MACRO	mem
   187                        	if	mem<$100
   188                        	LDA	$80+mem,X
   189                        	else
   190                        	LDA	mem,X
   191                        	endif
   192                        	ENDM
   193                        
   194                        STA_X	MACRO	mem
   195                        	if	mem<$100
   196                        	STA	$80+mem,X
   197                        	else
   198                        	STA	mem,X
   199                        	endif
   200                        	ENDM
   201                        
   202                        STZ_X	MACRO	mem
   203                        	if	mem<$100
   204                        	STZ	$80+mem,X
   205                        	else
   206                        	STZ	mem,X
   207                        	endif
   208                        	ENDM
   209                        
   210                        INC_X	MACRO	mem
   211                        	if	mem<$100
   212                        	INC	$80+mem,X
   213                        	else
   214                        	INC	mem,X
   215                        	endif
   216                        	ENDM
   217                        
   218                        ADC_X	MACRO	mem
   219                        	if	mem<$100
   220                        	ADC	$80+mem,X
   221                        	else
   222                        	ADC	mem,X
   223                        	endif
   224                        	ENDM
   225                        
   226                        SBC_X	MACRO	mem
   227                        	if	mem<$100
   228                        	SBC	$80+mem,X
   229                        	else
   230                        	SBC	mem,X
   231                        	endif
   232                        	ENDM
   233                        
   234                        CMP_X	MACRO	mem
   235                        	if	mem<$100
   236                        	CMP	$80+mem,X
   237                        	else
   238                        	CMP	mem,X
   239                        	endif
   240                        	ENDM
   241                        
   242                        ASLLN	MACRO	mem
   243                        	if	mem<$100
   244                        	ASL	$780+mem
   245                        	else
   246                        	ASL	$700+mem
   247                        	endif
   248                        	ENDM
   249                        
   250                        LSRLN	MACRO	mem
   251                        	if	mem<$100
   252                        	LSR	$780+mem
   253                        	else
   254                        	LSR	$700+mem
   255                        	endif
   256                        	ENDM
   257                        
   258                        ROLLN	MACRO	mem
   259                        	if	mem<$100
   260                        	ROL	$780+mem
   261                        	else
   262                        	ROL	$700+mem
   263                        	endif
   264                        	ENDM
   265                        
   266                        RORLN	MACRO	mem
   267                        	if	mem<$100
   268                        	ROR	$780+mem
   269                        	else
   270                        	ROR	$700+mem
   271                        	endif
   272                        	ENDM
   273                        
   274                        ASLHN	MACRO	mem
   275                        	if	mem<$100
   276                        	ASL	$F80+mem
   277                        	else
   278                        	ASL	$F00+mem
   279                        	endif
   280                        	ENDM
   281                        
   282                        LSRHN	MACRO	mem
   283                        	if	mem<$100
   284                        	LSR	$F80+mem
   285                        	else
   286                        	LSR	$F00+mem
   287                        	endif
   288                        	ENDM
   289                        
   290                        ROLHN	MACRO	mem
   291                        	if	mem<$100
   292                        	ROL	$F80+mem
   293                        	else
   294                        	ROL	$F00+mem
   295                        	endif
   296                        	ENDM
   297                        
   298                        RORHN	MACRO	mem
   299                        	if	mem<$100
   300                        	ROR	$F80+mem
   301                        	else
   302                        	ROR	$F00+mem
   303                        	endif
   304                        	ENDM
   305                        
   306                        
   307                        BR0	MACRO	PARA,VAR,LABLE
   308                        	BBR@<VAR.mod.8> PARA,LABLE
   309                        	ENDM
   310                        
   311                        BR1	MACRO	PARA,VAR,LABLE
   312                        	BBS@<VAR.mod.8>	PARA,LABLE
   313                        	ENDM
   314                        
   315                        xSETB	MACRO	flag,bit
   316                        	SMB@<bit>  flag
   317                        	ENDM
   318                        
   319                        xCLRB	MACRO	flag,bit
   320                        	RMB@<bit>  flag
   321                        	ENDM
   321                        
    24                        
    25                        
    26                        	; .INCLUDE	Calc\DataRam.inc
    27                        	; .Include	Calc\WorkRam.inc
    28                        	.INCLUDE	Calculator\Calculator_Base_Mac.asm
     1                        Move_Right_One_Number   .MACRO    ;数据向右移一位
     2                            LDA     #4
     3                            STA     P_Temp+10
     4                        Move_Right_One_Number_Loop:
     5                            CLC
     6                            .IF Dig=8
     7                            ROR     P_Temp+3
     8                            ROR     P_Temp+2
     9                            ROR     P_Temp+1
    10                            ROR     P_Temp
    11                            .ENDIF
    12                            .IF      Dig=10
    13                            ROR     P_Temp+4
    14                            ROR     P_Temp+3
    15                            ROR     P_Temp+2
    16                            ROR     P_Temp+1
    17                            ROR     P_Temp
    18                            .ENDIF
    19                            .IF      Dig=12
    20                            ROR     P_Temp+5
    21                            ROR     P_Temp+4
    22                            ROR     P_Temp+3
    23                            ROR     P_Temp+2
    24                            ROR     P_Temp+1
    25                            ROR     P_Temp
    26                            .ENDIF
    27                            .IF      Dig=14
    28                            ROR     P_Temp+6
    29                            ROR     P_Temp+5
    30                            ROR     P_Temp+4
    31                            ROR     P_Temp+3
    32                            ROR     P_Temp+2
    33                            ROR     P_Temp+1
    34                            ROR     P_Temp
    35                            .ENDIF
    36                            .IF      Dig=16
    37                            ROR     P_Temp+7
    38                            ROR     P_Temp+6
    39                            ROR     P_Temp+5
    40                            ROR     P_Temp+4
    41                            ROR     P_Temp+3
    42                            ROR     P_Temp+2
    43                            ROR     P_Temp+1
    44                            ROR     P_Temp
    45                            .ENDIF
    46                            DEC     P_Temp+10
    47                            LDA     P_Temp+10
    48                            BNE     Move_Right_One_Number_Loop
    49                            .ENDM
    50                        ;==========================================
    51                        Move_Left_One_Number   .MACRO    ;;数据向右移一位
    52                            LDA     #4
    53                            STA     P_Temp+10
    54                        Move_Left_One_Number_Loop:
    55                            CLC
    56                            IF      Dig=8
    57                            ROL     P_Temp
    58                            ROL     P_Temp+1
    59                            ROL     P_Temp+2
    60                            ROL     P_Temp+3
    61                            .ENDIF
    62                            IF      Dig=10
    63                            ROL     P_Temp
    64                            ROL     P_Temp+1
    65                            ROL     P_Temp+2
    66                            ROL     P_Temp+3
    67                            ROL     P_Temp+4
    68                            .ENDIF
    69                            IF      Dig=12
    70                            ROL     P_Temp
    71                            ROL     P_Temp+1
    72                            ROL     P_Temp+2
    73                            ROL     P_Temp+3
    74                            ROL     P_Temp+4
    75                            ROL     P_Temp+5
    76                            .ENDIF
    77                            IF      Dig=14
    78                            ROL     P_Temp
    79                            ROL     P_Temp+1
    80                            ROL     P_Temp+2
    81                            ROL     P_Temp+3
    82                            ROL     P_Temp+4
    83                            ROL     P_Temp+5
    84                            ROL     P_Temp+6
    85                            .ENDIF
    86                            IF      Dig=16
    87                            ROL     P_Temp
    88                            ROL     P_Temp+1
    89                            ROL     P_Temp+2
    90                            ROL     P_Temp+3
    91                            ROL     P_Temp+4
    92                            ROL     P_Temp+5
    93                            ROL     P_Temp+6
    94                            ROL     P_Temp+7
    95                            .ENDIF
    96                            DEC     P_Temp+10
    97                            LDA     P_Temp+10
    98                            BNE     Move_Left_One_Number_Loop
    99                            .ENDM
   100                        
   101                        Move_CalcTemp1_To_P_Temp     .MACRO
   102                            IF      Dig=16
   103                            LDA     Calc_Temp1
   104                            STA     P_Temp
   105                            LDA     Calc_Temp1+1
   106                            STA     P_Temp+1
   107                            LDA     Calc_Temp1+2
   108                            STA     P_Temp+2
   109                            LDA     Calc_Temp1+3
   110                            STA     P_Temp+3
   111                            LDA     Calc_Temp1+4
   112                            STA     P_Temp+4
   113                            LDA     Calc_Temp1+5
   114                            STA     P_Temp+5
   115                            LDA     Calc_Temp1+6
   116                            STA     P_Temp+6
   117                            LDA     Calc_Temp1+7
   118                            STA     P_Temp+7
   119                            .ENDIF
   120                            IF      Dig=14
   121                            LDA     Calc_Temp1
   122                            STA     P_Temp
   123                            LDA     Calc_Temp1+1
   124                            STA     P_Temp+1
   125                            LDA     Calc_Temp1+2
   126                            STA     P_Temp+2
   127                            LDA     Calc_Temp1+3
   128                            STA     P_Temp+3
   129                            LDA     Calc_Temp1+4
   130                            STA     P_Temp+4
   131                            LDA     Calc_Temp1+5
   132                            STA     P_Temp+5
   133                            LDA     Calc_Temp1+6
   134                            STA     P_Temp+6
   135                            .ENDIF
   136                            IF      Dig=12
   137                            LDA     Calc_Temp1
   138                            STA     P_Temp
   139                            LDA     Calc_Temp1+1
   140                            STA     P_Temp+1
   141                            LDA     Calc_Temp1+2
   142                            STA     P_Temp+2
   143                            LDA     Calc_Temp1+3
   144                            STA     P_Temp+3
   145                            LDA     Calc_Temp1+4
   146                            STA     P_Temp+4
   147                            LDA     Calc_Temp1+5
   148                            STA     P_Temp+5
   149                            .ENDIF
   150                            IF      Dig=10
   151                            LDA     Calc_Temp1
   152                            STA     P_Temp
   153                            LDA     Calc_Temp1+1
   154                            STA     P_Temp+1
   155                            LDA     Calc_Temp1+2
   156                            STA     P_Temp+2
   157                            LDA     Calc_Temp1+3
   158                            STA     P_Temp+3
   159                            LDA     Calc_Temp1+4
   160                            STA     P_Temp+4
   161                            .ENDIF
   162                            IF      Dig=8
   163                            LDA     Calc_Temp1
   164                            STA     P_Temp
   165                            LDA     Calc_Temp1+1
   166                            STA     P_Temp+1
   167                            LDA     Calc_Temp1+2
   168                            STA     P_Temp+2
   169                            LDA     Calc_Temp1+3
   170                            STA     P_Temp+3
   171                            .ENDIF
   172                            .ENDM
   173                        
   174                        Move_CalcTemp2_To_P_Temp     .MACRO
   175                            IF      Dig=16
   176                            LDA     Calc_Temp2
   177                            STA     P_Temp
   178                            LDA     Calc_Temp2+1
   179                            STA     P_Temp+1
   180                            LDA     Calc_Temp2+2
   181                            STA     P_Temp+2
   182                            LDA     Calc_Temp2+3
   183                            STA     P_Temp+3
   184                            LDA     Calc_Temp2+4
   185                            STA     P_Temp+4
   186                            LDA     Calc_Temp2+5
   187                            STA     P_Temp+5
   188                            LDA     Calc_Temp2+6
   189                            STA     P_Temp+6
   190                            LDA     Calc_Temp2+7
   191                            STA     P_Temp+7
   192                            .ENDIF
   193                            IF      Dig=14
   194                            LDA     Calc_Temp2
   195                            STA     P_Temp
   196                            LDA     Calc_Temp2+1
   197                            STA     P_Temp+1
   198                            LDA     Calc_Temp2+2
   199                            STA     P_Temp+2
   200                            LDA     Calc_Temp2+3
   201                            STA     P_Temp+3
   202                            LDA     Calc_Temp2+4
   203                            STA     P_Temp+4
   204                            LDA     Calc_Temp2+5
   205                            STA     P_Temp+5
   206                            LDA     Calc_Temp2+6
   207                            STA     P_Temp+6
   208                            .ENDIF
   209                            IF      Dig=12
   210                            LDA     Calc_Temp2
   211                            STA     P_Temp
   212                            LDA     Calc_Temp2+1
   213                            STA     P_Temp+1
   214                            LDA     Calc_Temp2+2
   215                            STA     P_Temp+2
   216                            LDA     Calc_Temp2+3
   217                            STA     P_Temp+3
   218                            LDA     Calc_Temp2+4
   219                            STA     P_Temp+4
   220                            LDA     Calc_Temp2+5
   221                            STA     P_Temp+5
   222                            .ENDIF
   223                            IF      Dig=10
   224                            LDA     Calc_Temp2
   225                            STA     P_Temp
   226                            LDA     Calc_Temp2+1
   227                            STA     P_Temp+1
   228                            LDA     Calc_Temp2+2
   229                            STA     P_Temp+2
   230                            LDA     Calc_Temp2+3
   231                            STA     P_Temp+3
   232                            LDA     Calc_Temp2+4
   233                            STA     P_Temp+4
   234                            .ENDIF
   235                            IF      Dig=8
   236                            LDA     Calc_Temp2
   237                            STA     P_Temp
   238                            LDA     Calc_Temp2+1
   239                            STA     P_Temp+1
   240                            LDA     Calc_Temp2+2
   241                            STA     P_Temp+2
   242                            LDA     Calc_Temp2+3
   243                            STA     P_Temp+3
   244                            .ENDIF
   245                            .ENDM
   246                        
   247                        Move_P_Temp_To_CalcTemp2    .MACRO
   248                            IF      Dig=16
   249                            LDA     P_Temp
   250                            STA     Calc_Temp2
   251                            LDA     P_Temp+1
   252                            STA     Calc_Temp2+1
   253                            LDA     P_Temp+2
   254                            STA     Calc_Temp2+2
   255                            LDA     P_Temp+3
   256                            STA     Calc_Temp2+3
   257                            LDA     P_Temp+4
   258                            STA     Calc_Temp2+4
   259                            LDA     P_Temp+5
   260                            STA     Calc_Temp2+5
   261                            LDA     P_Temp+6
   262                            STA     Calc_Temp2+6
   263                            LDA     P_Temp+7
   264                            STA     Calc_Temp2+7
   265                            .ENDIF
   266                            IF      Dig=14
   267                            LDA     P_Temp
   268                            STA     Calc_Temp2
   269                            LDA     P_Temp+1
   270                            STA     Calc_Temp2+1
   271                            LDA     P_Temp+2
   272                            STA     Calc_Temp2+2
   273                            LDA     P_Temp+3
   274                            STA     Calc_Temp2+3
   275                            LDA     P_Temp+4
   276                            STA     Calc_Temp2+4
   277                            LDA     P_Temp+5
   278                            STA     Calc_Temp2+5
   279                            LDA     P_Temp+6
   280                            STA     Calc_Temp2+6
   281                            .ENDIF
   282                            IF      Dig=12
   283                            LDA     P_Temp
   284                            STA     Calc_Temp2
   285                            LDA     P_Temp+1
   286                            STA     Calc_Temp2+1
   287                            LDA     P_Temp+2
   288                            STA     Calc_Temp2+2
   289                            LDA     P_Temp+3
   290                            STA     Calc_Temp2+3
   291                            LDA     P_Temp+4
   292                            STA     Calc_Temp2+4
   293                            LDA     P_Temp+5
   294                            STA     Calc_Temp2+5
   295                            .ENDIF
   296                            IF      Dig=10
   297                            LDA     P_Temp
   298                            STA     Calc_Temp2
   299                            LDA     P_Temp+1
   300                            STA     Calc_Temp2+1
   301                            LDA     P_Temp+2
   302                            STA     Calc_Temp2+2
   303                            LDA     P_Temp+3
   304                            STA     Calc_Temp2+3
   305                            LDA     P_Temp+4
   306                            STA     Calc_Temp2+4
   307                            .ENDIF
   308                            IF      Dig=8
   309                            LDA     P_Temp
   310                            STA     Calc_Temp2
   311                            LDA     P_Temp+1
   312                            STA     Calc_Temp2+1
   313                            LDA     P_Temp+2
   314                            STA     Calc_Temp2+2
   315                            LDA     P_Temp+3
   316                            STA     Calc_Temp2+3
   317                            .ENDIF
   318                            .ENDM
   319                        
   320                        Move_P_Temp_To_CalcTemp1    .MACRO
   321                            IF      Dig=16
   322                            LDA     P_Temp
   323                            STA     Calc_Temp1
   324                            LDA     P_Temp+1
   325                            STA     Calc_Temp1+1
   326                            LDA     P_Temp+2
   327                            STA     Calc_Temp1+2
   328                            LDA     P_Temp+3
   329                            STA     Calc_Temp1+3
   330                            LDA     P_Temp+4
   331                            STA     Calc_Temp1+4
   332                            LDA     P_Temp+5
   333                            STA     Calc_Temp1+5
   334                            LDA     P_Temp+6
   335                            STA     Calc_Temp1+6
   336                            LDA     P_Temp+7
   337                            STA     Calc_Temp1+7
   338                            .ENDIF
   339                            IF      Dig=14
   340                            LDA     P_Temp
   341                            STA     Calc_Temp1
   342                            LDA     P_Temp+1
   343                            STA     Calc_Temp1+1
   344                            LDA     P_Temp+2
   345                            STA     Calc_Temp1+2
   346                            LDA     P_Temp+3
   347                            STA     Calc_Temp1+3
   348                            LDA     P_Temp+4
   349                            STA     Calc_Temp1+4
   350                            LDA     P_Temp+5
   351                            STA     Calc_Temp1+5
   352                            LDA     P_Temp+6
   353                            STA     Calc_Temp1+6
   354                            .ENDIF
   355                            IF      Dig=12
   356                            LDA     P_Temp
   357                            STA     Calc_Temp1
   358                            LDA     P_Temp+1
   359                            STA     Calc_Temp1+1
   360                            LDA     P_Temp+2
   361                            STA     Calc_Temp1+2
   362                            LDA     P_Temp+3
   363                            STA     Calc_Temp1+3
   364                            LDA     P_Temp+4
   365                            STA     Calc_Temp1+4
   366                            LDA     P_Temp+5
   367                            STA     Calc_Temp1+5
   368                            .ENDIF
   369                            IF      Dig=10
   370                            LDA     P_Temp
   371                            STA     Calc_Temp1
   372                            LDA     P_Temp+1
   373                            STA     Calc_Temp1+1
   374                            LDA     P_Temp+2
   375                            STA     Calc_Temp1+2
   376                            LDA     P_Temp+3
   377                            STA     Calc_Temp1+3
   378                            LDA     P_Temp+4
   379                            STA     Calc_Temp1+4
   380                            .ENDIF
   381                            IF      Dig=8
   382                            LDA     P_Temp
   383                            STA     Calc_Temp1
   384                            LDA     P_Temp+1
   385                            STA     Calc_Temp1+1
   386                            LDA     P_Temp+2
   387                            STA     Calc_Temp1+2
   388                            LDA     P_Temp+3
   389                            STA     Calc_Temp1+3
   390                            .ENDIF
   391                            .ENDM
   391                        
    29                        	.INCLUDE	Calculator\Calculator_MAC.asm
     0                        
    30                        ;***************************************
    31                        STACK_BOT		EQU		FFH                     ;堆栈底部
    32                        ;***************************************
    33                        	.PROG										;程序开始
    34                        V_RESET:
    35 00:C000: 1A            	NOP
    36 00:C001: 1A            	NOP
    37 00:C002: 1A            	NOP
    38 00:C003: 5E FF         	LDX		#STACK_BOT
    39 00:C005: 1E            	TXS	      ;使用这个值初始化堆栈指针，这通常是为了设置堆栈的底部地址，确保程序运行中堆栈的正确使用。
    40 00:C006: 53 B7         	LDA		#$B7	;#$07
    41 00:C008: 7F 1D         	STA		SYSCLK	;设置系统时钟
    42 00:C00A: 73 3E         	LDA		FUSE
    43 00:C00C: 7F 2F         	STA		MF	;精准主频3.64M
    44                        ;***************************************
    45                        	ClrAllRam	;清空ram
+   45 00:C00E: 53 00          LDA #$0000
+   45 00:C010: 5E FF          LDX #$00FF
+   45 00:C012: 4F 00 18       STA $1800
+   45                        ?ClrAllRamLoop:
+   45 00:C015: 6F 00 18       STA $1800,X
+   45 00:C018: 0F             DEX
+   45 00:C019: 12 FA          BNE ?ClrAllRamLoop
    46                        	WDTC_CLR
+   46 00:C01B: 22 1C          RMB2 WDTC
    47                        	;CHECK_LCD   ;初始化LCD
    48                        ;***************************************定时器初始化，特殊功能寄存器初始化
    49 00:C01D: 53 00         	LDA		#0
    50 00:C01F: 7F 0D         	STA		PADF1  ;定时器0的时钟源选择
    51 00:C021: 7F 10         	STA		TMR0   ;128HZ
    52 00:C023: 7F 12         	STA		TMR1   ;512
    53 00:C025: 7F 14         	STA		TMR2	;定时器的开始数
    54 00:C027: 7F 18         	STA		DIVC    ;分频控制器，定时器与DICV异步   2048
    55 00:C029: 7F 0E         	STA		IER     ;不允许中断
    56 00:C02B: 7F 0F         	STA		IFR     ;中断请求标志
    57 00:C02D: 7F 1F         	STA		AUD0    ;pwm输出值设置
    58 00:C02F: 7F 20         	STA		AUDCR   ;
    59 00:C031: 7F 05         	STA		PB
    60                        ;***************************************LCD初始化
    61                        	LCD_C_TYPE
+   61 00:C033: 2F 1A          SMB7 LCDCOM
+   61 00:C035: 28 09          SMB0 PCSEG
+   61 00:C037: 29 09          SMB1 PCSEG
+   61 00:C039: 2A 09          SMB2 PCSEG
+   61 00:C03B: 2B 09          SMB3 PCSEG
    62                        	LCD_ENCH_EN
+   62 00:C03D: 2E 1A          SMB6 LCDCOM
    63                        	;LCD_4COM
    64                        	LCD_DRIVE_8
+   64 00:C03F: 28 19          SMB0 LCDCTRL
+   64 00:C041: 29 19          SMB1 LCDCTRL
    65 00:C043: 22 19         	RMB2	LCDCTRL
    66 00:C045: 2B 19         	SMB3	LCDCTRL
    67 00:C047: 28 1A         	SMB0	P_LCD_COM
    68 00:C049: 21 1A         	RMB1	P_LCD_COM;设置为5com
    69 00:C04B: 25 1A         	RMB5	P_LCD_COM;设置LCD中断频率为32Hz
    70                        ;***************************************端口配置（等待图纸）
    71 00:C04D: 15 E4 C0      	JSR		L_Scankey_INIT
    72 00:C050: 28 1D         	SMB0	P_SYSCLK
    73                        	PB2_PB2_NOMS
+   73 00:C052: 20 0C          RMB0 PADF0
+   73 00:C054: 22 06          RMB2 PBTYPE
    74                        	PB3_PB3_NOMS
+   74 00:C056: 21 0C          RMB1 PADF0
+   74 00:C058: 23 06          RMB3 PBTYPE
    75 00:C05A: 53 00         	LDA		#0
    76 00:C05C: 7F 09         	STA		PCSEG
    77                        	PC45_SEG
+   77 00:C05E: 2C 09          SMB4 PCSEG
    78                        	PC67_SEG
+   78 00:C060: 2D 09          SMB5 PCSEG
    79                        	PD03_SEG
+   79 00:C062: 2E 09          SMB6 PCSEG
    80                        	PD47_SEG;
+   80 00:C064: 2F 09          SMB7 PCSEG
    81 00:C066: 15 C4 C0      	JSR		L_Init_SystemRam_Prog   ;初始化系统RAM并禁用所有断电保留的RAM
    82 00:C069: 15 D3 C0      	JSR		L_Dis_All_DisRam_Prog	;初始化系统RAM并禁用所有断电保留的RAM
    83                        ;***************************************开启中断
    84                        	; SMB0	DIVC
    85                        	; SMB1	DIVC
    86                        	; RMB2	DIVC
    87                        	TMR1_CLK_512Hz;初始化定时器1为256hz,定时器2为512hz
+   87 00:C06C: 2A 17          SMB2 TMCLK
+   87 00:C06E: 23 17          RMB3 TMCLK
    88 00:C070: 53 AE         	LDA		#174
    89 00:C072: 7F 14         	STA		TMR2
    90                        	LCD_ON
+   90 00:C074: 2C 16          SMB4 TMRC
    91                        	TMR1_ON;半秒计时
+   91 00:C076: 29 16          SMB1 TMRC
    92                        	EN_TMR1_IRQ              ;定时器和LCD使能
+   92 00:C078: 2A 0E          SMB2 IER
    93                        	EN_PA_IRQ;下降沿触发
+   93 00:C07A: 2C 0E          SMB4 IER
    94 00:C07C: 53 07         	LDA		#$07		;#$07    系统时钟和中断使能
    95 00:C07E: 7F 1D         	STA		SYSCLK		;Strong
    96 00:C080: 05            	CLI
    97                        ;***********************************************************************
    98                        ;***********************************************************************
    99                        MainLoop:
   100                        	; JSR		L_LCD_IRQ_WorkProg
   101                        	; JSR		L_Half_Second_Prog
   102                        	; LDA		R_Reset_Time
   103                        	; ORA		R_Voice_Unit
   104                        	; BNE		MainLoop
   105                        
   106                        	; SMB4	SYSCLK;280k
   107                        	; STA		P_HALT
   108                        	; RMB4	SYSCLK;560k
   109 00:C081: 17 FE         	BRA		MainLoop
   110                        
   111                        ;***********************************************************************
   112                        ;***********************************************************************
   113                        V_IRQ:
   114 00:C083: 0A            	PHA
   115 00:C084: 73 0E         	LDA		P_IER
   116 00:C086: 71 0F         	AND		P_IFR
   117 00:C088: 7F 9E         	STA		R_Int_Backup
   118                        
   119 00:C08A: 3E 9E 31      	BBS6	R_Int_Backup,L_LcdIrq
   120 00:C08D: 3B 9E 12      	BBS3	R_Int_Backup,L_Timer2Irq
   121 00:C090: 3C 9E 21      	BBS4	R_Int_Backup,L_PaIrp
   122 00:C093: 38 9E 08      	BBS0	R_Int_Backup,L_DivIrq
   123 00:C096: 3A 9E 13      	BBS2	R_Int_Backup,L_Timer1Irq
   124 00:C099: 39 9E 0C      	BBS1	R_Int_Backup,L_Timer0Irq
   125 00:C09C: 17 24         	BRA		L_EndIrq
   126                        
   127                        L_DivIrq:
   128                        	CLR_DIV_IRQ_FLAG
+  128 00:C09E: 20 0F          RMB0 IFR
   129 00:C0A0: 17 20         	BRA		L_EndIrq
   130                        
   131                        L_Timer2Irq:
   132                        	CLR_TMR2_IRQ_FLAG
+  132 00:C0A2: 23 0F          RMB3 IFR
   133                        	WDTC_CLR
+  133 00:C0A4: 22 1C          RMB2 WDTC
   134 00:C0A6: 17 1A         	BRA		L_EndIrq
   135                        
   136                        L_Timer0Irq:
   137                        	CLR_TMR0_IRQ_FLAG
+  137 00:C0A8: 21 0F          RMB1 IFR
   138 00:C0AA: 17 16         	BRA		L_EndIrq
   139                        
   140                        L_Timer1Irq:
   141                        	CLR_TMR1_IRQ_FLAG
+  141 00:C0AC: 22 0F          RMB2 IFR
   142                        	WDTC_CLR
+  142 00:C0AE: 22 1C          RMB2 WDTC
   143 00:C0B0: 28 A0         	SMB0	Sys_Flag_B	;设置Half Second Flag
   144 00:C0B2: 17 0E         	BRA		L_EndIrq
   145                        
   146                        L_PaIrp:
   147                        	CLR_KEY_IRQ_FLAG
+  147 00:C0B4: 24 0F          RMB4 IFR
   148                        	EN_LCD_IRQ
+  148 00:C0B6: 2E 0E          SMB6 IER
   149                        	DIS_PA_IRQ
+  149 00:C0B8: 24 0E          RMB4 IER
   150 00:C0BA: 29 9F         	SMB1	Sys_Flag_A
   151 00:C0BC: 17 04         	BRA		L_EndIrq
   152                        L_LcdIrq:
   153                        	CLR_LCD_IRQ_FLAG
+  153 00:C0BE: 26 0F          RMB6 IFR
   154 00:C0C0: 28 9F         	SMB0	Sys_Flag_A	;设置LCD中断标志，32Hz扫描
   155                        L_EndIrq:
   156                        ;	BBS3	IFR,L_Timer2Irq
   157 00:C0C2: 0C            	PLA
   158 00:C0C3: 08            	RTI
   159                        ;***********************************************************************
   160                        .INCLUDE	Init.asm
     1                        ;------------------------------------------------------
     2                        L_Init_SystemRam_Prog:     ;初始化系统RAM的程序数据
     3 00:C0C4: 53 04         	LDA		#4
     4 00:C0C6: 7F A3         	STA		R_Reset_Time
     5 00:C0C8: 53 19         	LDA		#25
     6 00:C0CA: 7F AD         	STA		R_Time_Year
     7 00:C0CC: 53 01         	LDA		#1
     8 00:C0CE: 7F AB         	STA		R_Time_Day
     9 00:C0D0: 7F AC         	STA		R_Time_Month
    10                        	; JSR		L_Auto_Counter_Week
    11 00:C0D2: 09            	RTS
    12                        ;======================================================
    13                        L_Dis_All_DisRam_Prog:
    14 00:C0D3: 53 FF         	LDA		#$FF
    15                        L_All_DisRam:
    16 00:C0D5: 5E 00         	LDX		#0
    17                        L_Loop_DisplayRam:
    18 00:C0D7: 6F 00 18      	STA		LCD_RamAddr,X
    19 00:C0DA: 0B            	INX
    20 00:C0DB: 57 1E         	CPX		#D_LCD_RAM
    21 00:C0DD: 10 F8         	BCC		L_Loop_DisplayRam    ;C=0是跳转
    22 00:C0DF: 09            	RTS
    23                        ;----------------------------------------------------
    24                        L_Clr_All_DisRam_Prog:
    25 00:C0E0: 53 00         	LDA		#0
    26 00:C0E2: 17 F1         	BRA		L_All_DisRam
    27                        
    28                        L_Scankey_INIT:
    29 00:C0E4: 53 FD         	LDA		#11111101B;
    30 00:C0E6: 7F 04         	STA		P_PA_IO;PA0输出,其余输入
    31 00:C0E8: 53 81         	LDA		#10000001B
    32 00:C0EA: 7F 01         	STA		P_PA	;其他全部下拉
    33 00:C0EC: 53 7C         	LDA		#01111100B
    34 00:C0EE: 7F 02         	STA		P_PA_WAKE;	将PA做唤醒
    35 00:C0F0: 53 00         	LDA		#0
    36 00:C0F2: 7F 08         	STA		P_PC_IO
    37 00:C0F4: 7F 07         	STA		P_PC
    38 00:C0F6: 09            	RTS
    39                        
    40                        L_Judgement_Scankey_Prog:
    41 00:C0F7: 53 FD         	LDA		#11111101B;
    42 00:C0F9: 7F 04         	STA		P_PA_IO;PA0输出,其余输入
    43 00:C0FB: 53 81         	LDA		#10000001B
    44 00:C0FD: 7F 01         	STA		P_PA	;其他全部下拉
    45 00:C0FF: 53 7C         	LDA		#01111100B
    46 00:C101: 53 00         	LDA		#0
    47 00:C103: 7F 08         	STA		P_PC_IO
    48 00:C105: 7F 07         	STA		P_PC
    49 00:C107: 09            	RTS
    50                        L_PA_Intput_Low_Prog:
    51 00:C108: 53 FD         	LDA		#11111101B
    52 00:C10A: 7F 01         	STA		P_PA
    53 00:C10C: 09            	RTS
    54                        L_PC0_Output_High_Prog:
    55 00:C10D: 53 01         	LDA		#01H
    56 00:C10F: 7F 07         	STA		P_PC
    57 00:C111: 09            	RTS
    58                        L_PC1_Output_High_Prog:
    59 00:C112: 53 02         	LDA		#02H
    60 00:C114: 7F 07         	STA		P_PC
    61 00:C116: 09            	RTS
    62                        L_PC2_Output_High_Prog:
    63 00:C117: 53 04         	LDA		#04H
    64 00:C119: 7F 07         	STA		P_PC
    65 00:C11B: 09            	RTS
    66                        L_PC3_Output_High_Prog:
    67 00:C11C: 53 08         	LDA		#08H
    68 00:C11E: 7F 07         	STA		P_PC
    69 00:C120: 09            	RTS
    70                        ; L_PA257_Input_Low:
    71                        ; 	LDA		#10101101B
    72                        ; 	STA		P_PA	;其他全部下拉
    73                        ; 	RTS
    74                        ; L_PA257_Input_High:
    75                        ; 	LDA		#00000001B
    76                        ; 	STA		P_PA
    77                        ; 	RTS
    78                        L_Scankey_Effictive_Init:
    79 00:C121: 53 FD         	LDA		#11111101B;
    80 00:C123: 7F 04         	STA		P_PA_IO;PA0输出,其余输入
    81 00:C125: 7F 01         	STA		P_PA
    82 00:C127: 53 00         	LDA		#0
    83 00:C129: 7F 08         	STA		P_PC_IO
    84 00:C12B: 7F 07         	STA		P_PC
    85 00:C12D: 09            	RTS
    85                        
   161                        
   162                        ; .INCLUDE	Key\ScanKey.ASM
   163                        ; .INCLUDE	Key\Scankey_First_Press.asm
   164                        ; .INCLUDE	Key\Scankey_First_Set_Mode.asm
   165                        ; .INCLUDE	Key\Plus.asm
   166                        ; .INCLUDE	Key\Scankey_First_Press_Judgment.asm
   167                        ; .INCLUDE	Key\Scankey_Normal.asm
   168                        
   169                        ; .INCLUDE	Display\Disp.asm
   170                        ; .INCLUDE	Display\Lcdtab.asm
   171                        ; .INCLUDE	Display\Display.asm
   172                        ; .INCLUDE	Display\Display_Time.asm
   173                        ; .INCLUDE	Display\Display_Alarm.asm
   174                        ; .INCLUDE	Display\Display_Timer.asm
   175                        ; .INCLUDE	Display\Display_Symbol.asm
   176                        ; .INCLUDE	Display\Display_Normal.asm
   177                        ; .INCLUDE	Display\Tool.asm
   178                        
   179                        
   180                        .Include	Calculator\Calculator_Base.asm
     1                        ;=====================================
     2                        ;计算器基础库2025/3/25（易码）
     3                        ;=====================================
     4                        ;8位计算器只用+3，具体加几根据MAX_DIG决定，可用去判断除数是否为0
     5                        ;，平方根运算中被开方数是否为0,以及加减法中需不需要操作数
     6                        L_Judge_Buf1_Prog:
     7 00:C12E: 53 04             LDA     #MAX_BYTE
     8 00:C130: 7F F8             STA     P_Temp
     9 00:C132: 73 CA             LDA		BUF1
    10 00:C134: 70 CB         	ORA		BUF1+1
    11 00:C136: 70 CC         	ORA		BUF1+2
    12 00:C138: 70 CD         	ORA		BUF1+3
    13                        	; ORA		BUF1+4
    14                        	; ORA		BUF1+5
    15 00:C13A: 09            	RTS
    16                        ;=====================================
    17                        L_Judge_Buf2_Prog:
    18 00:C13B: 73 D3         	LDA		BUF2
    19 00:C13D: 70 D4         	ORA		BUF2+1
    20 00:C13F: 70 D5         	ORA		BUF2+2
    21 00:C141: 70 D6         	ORA		BUF2+3
    22                        	; ORA		BUF2+4
    23                        	; ORA		BUF2+5
    24 00:C143: 09            	RTS
    25                        ;=====================================
    26                        L_Adjust_FD_DEC_Prog:
    27 00:C144: 63 80 00      	LDA		RAM,X
    28 00:C147: 51 7F         	AND		#07FH
    29 00:C149: 13 0A         	BEQ		L_Adjust_FD_DEC_Prog_RTS
    30 00:C14B: 06            	CLD
    31 00:C14C: 00            	SEC
    32 00:C14D: 63 80 00      	LDA		RAM,X
    33 00:C150: 55 01         	SBC		#1
    34 00:C152: 6F 80 00      	STA		RAM,X
    35                        L_Adjust_FD_DEC_Prog_RTS:
    36 00:C155: 09            	RTS
    37                        ;=====================================
    38                        L_Adjust_FD_INC_Prog:
    39 00:C156: 63 80 00      	LDA		RAM,X
    40 00:C159: 51 7F         	AND		#07FH
    41 00:C15B: 13 0A         	BEQ		L_Adjust_FD_INC_Prog_RTS
    42 00:C15D: 06            	CLD
    43 00:C15E: 04            	CLC
    44 00:C15F: 63 80 00      	LDA		RAM,X
    45 00:C162: 54 01         	ADC		#1
    46 00:C164: 6F 80 00      	STA		RAM,X
    47                        L_Adjust_FD_INC_Prog_RTS:
    48 00:C167: 09            	RTS
    49                        ;=====================================
    50                        ;=====================================
    51                        ;具体加几根据MAX_DIG决定,
    52                        ;
    53                        L_Move_Left_One_Bit_Prog:
    54 00:C168: 04                CLC
    55                        L_Move_Left_One_Bit_Prog_C:
    56 00:C169: 6A 80 00      	ROL		RAM, X
    57 00:C16C: 6A 81 00      	ROL		RAM+1, X
    58 00:C16F: 6A 82 00      	ROL		RAM+2, X
    59 00:C172: 6A 83 00      	ROL		RAM+3, X
    60 00:C175: 6A 84 00      	ROL		RAM+4, X
    61 00:C178: 6A 85 00      	ROL		RAM+5, X
    62 00:C17B: 6A 86 00      	ROL		RAM+6, X
    63 00:C17E: 6A 87 00      	ROL		RAM+7, X
    64 00:C181: 09                RTS
    65                        ;=====================================
    66                        L_Move_Left_One_DIG_Prog:;；向左平移了1个DIG位数
    67 00:C182: 15 68 C1          JSR     L_Move_Left_One_Bit_Prog
    68 00:C185: 15 68 C1          JSR     L_Move_Left_One_Bit_Prog
    69 00:C188: 15 68 C1          JSR     L_Move_Left_One_Bit_Prog
    70 00:C18B: 15 68 C1          JSR     L_Move_Left_One_Bit_Prog
    71 00:C18E: 09                RTS
    72                        ;=====================================
    73                        L_Move_Left_Two_DIG_Prog:;向左平移了2个DIG位数
    74 00:C18F: 63 86 00      	LDA		RAM+6,X
    75 00:C192: 6F 87 00      	STA		RAM+7,X
    76 00:C195: 63 85 00      	LDA		RAM+5,X
    77 00:C198: 6F 86 00      	STA		RAM+6,X
    78 00:C19B: 63 84 00      	LDA		RAM+4,X
    79 00:C19E: 6F 85 00      	STA		RAM+5,X
    80 00:C1A1: 63 83 00      	LDA		RAM+3,X
    81 00:C1A4: 6F 84 00      	STA		RAM+4,X
    82 00:C1A7: 63 82 00      	LDA		RAM+2,X
    83 00:C1AA: 6F 83 00      	STA		RAM+3,X
    84 00:C1AD: 63 81 00      	LDA		RAM+1,X
    85 00:C1B0: 6F 82 00      	STA		RAM+2,X
    86 00:C1B3: 63 80 00      	LDA		RAM,X
    87 00:C1B6: 6F 81 00      	STA		RAM+1,X
    88 00:C1B9: 53 00         	LDA		#0
    89 00:C1BB: 6F 80 00      	STA		RAM,X
    90 00:C1BE: 09            	RTS
    91                        
    92                        ;=====================================
    93                        L_Move_Max_DIG_Prog:;可能用于数值转换
    94 00:C1BF: 15 8F C1          JSR     L_Move_Left_Two_DIG_Prog
    95 00:C1C2: 15 8F C1          JSR     L_Move_Left_Two_DIG_Prog
    96 00:C1C5: 15 8F C1          JSR     L_Move_Left_Two_DIG_Prog
    97 00:C1C8: 15 8F C1          JSR     L_Move_Left_Two_DIG_Prog
    98 00:C1CB: 09                RTS
    99                        ;=====================================
   100                        ;具体加几根据MAX_DIG决定,
   101                        ;
   102                        L_Move_Right_One_Bit_Prog:
   103 00:C1CC: 04                CLC
   104                        L_Move_Right_One_Bit_Prog_C:
   105 00:C1CD: 6B 87 00          ROR		RAM+7,X
   106 00:C1D0: 6B 86 00      	ROR		RAM+6,X
   107 00:C1D3: 6B 85 00      	ROR		RAM+5,X
   108 00:C1D6: 6B 84 00      	ROR		RAM+4,X
   109 00:C1D9: 6B 83 00      	ROR		RAM+3,X
   110 00:C1DC: 6B 82 00      	ROR		RAM+2,X
   111 00:C1DF: 6B 81 00      	ROR		RAM+1,X
   112 00:C1E2: 6B 80 00      	ROR		RAM,X
   113 00:C1E5: 09                RTS
   114                        ;=====================================
   115                        L_Move_Right_One_DIG_Prog:;；向右平移了1个DIG位数
   116 00:C1E6: 15 CC C1          JSR     L_Move_Right_One_Bit_Prog
   117 00:C1E9: 15 CC C1          JSR     L_Move_Right_One_Bit_Prog
   118 00:C1EC: 15 CC C1          JSR     L_Move_Right_One_Bit_Prog
   119 00:C1EF: 15 CC C1          JSR     L_Move_Right_One_Bit_Prog
   120 00:C1F2: 09                RTS
   121                        ;=====================================
   122                        L_Clear_BUF_Prog:
   123 00:C1F3: 53 00             LDA		#0
   124 00:C1F5: 6F 80 00      	STA		RAM, X
   125 00:C1F8: 6F 81 00      	STA		RAM+1, X
   126 00:C1FB: 6F 82 00      	STA		RAM+2, X
   127 00:C1FE: 6F 83 00      	STA		RAM+3, X
   128 00:C201: 6F 84 00      	STA		RAM+4, X
   129 00:C204: 6F 85 00      	STA		RAM+5, X
   130 00:C207: 6F 86 00      	STA		RAM+6, X
   131 00:C20A: 6F 87 00      	STA		RAM+7, X
   132 00:C20D: 09                RTS
   133                        ;=====================================
   134                        ;buf2 = bufx + buf2
   135                        ;具体加几根据MAX_DIG决定,
   136                        L_BUFX_Add_BUF2_TO_BUF2_Prog:
   137 00:C20E: 04            	CLC
   138 00:C20F: 63 80 00      	LDA		RAM,X
   139 00:C212: 74 D3         	ADC		BUF2
   140 00:C214: 7F D3         	STA		BUF2
   141 00:C216: 63 81 00      	LDA		RAM+1, X
   142 00:C219: 74 D4         	ADC		BUF2+1
   143 00:C21B: 7F D4         	STA		BUF2+1
   144 00:C21D: 63 82 00      	LDA		RAM+2, X
   145 00:C220: 74 D5         	ADC		BUF2+2
   146 00:C222: 7F D5         	STA		BUF2+2
   147 00:C224: 63 83 00      	LDA		RAM+3, X
   148 00:C227: 74 D6         	ADC		BUF2+3
   149 00:C229: 7F D6         	STA		BUF2+3
   150 00:C22B: 63 84 00      	LDA		RAM+4, X
   151 00:C22E: 74 D7         	ADC		BUF2+4
   152 00:C230: 7F D7         	STA		BUF2+4
   153 00:C232: 63 85 00      	LDA		RAM+5, X
   154 00:C235: 74 D8         	ADC		BUF2+5
   155 00:C237: 7F D8         	STA		BUF2+5
   156 00:C239: 63 86 00      	LDA		RAM+6, X
   157 00:C23C: 74 D9         	ADC		BUF2+6
   158 00:C23E: 7F D9         	STA		BUF2+6
   159 00:C240: 63 87 00      	LDA		RAM+7, X
   160 00:C243: 74 DA         	ADC		BUF2+7
   161 00:C245: 7F DA         	STA		BUF2+7
   162 00:C247: 09            	RTS
   163                        ;=====================================
   164                        ;---------------------------------------
   165                        ;buf3 = bufx + buf3
   166                        ;具体加几根据MAX_DIG决定,
   167                        L_BUFX_Add_BUF3_TO_BUF3_Prog:
   168 00:C248: 04            	CLC
   169 00:C249: 63 80 00      	LDA		RAM, X
   170 00:C24C: 74 DC         	ADC		BUF3
   171 00:C24E: 7F DC         	STA		BUF3
   172 00:C250: 63 81 00      	LDA		RAM+1, X
   173 00:C253: 74 DD         	ADC		BUF3+1
   174 00:C255: 7F DD         	STA		BUF3+1
   175 00:C257: 63 82 00      	LDA		RAM+2, X
   176 00:C25A: 74 DE         	ADC		BUF3+2
   177 00:C25C: 7F DE         	STA		BUF3+2
   178 00:C25E: 63 83 00      	LDA		RAM+3, X
   179 00:C261: 74 DF         	ADC		BUF3+3
   180 00:C263: 7F DF         	STA		BUF3+3
   181 00:C265: 63 84 00      	LDA		RAM+4, X
   182 00:C268: 74 E0         	ADC		BUF3+4
   183 00:C26A: 7F E0         	STA		BUF3+4
   184 00:C26C: 63 85 00      	LDA		RAM+5, X
   185 00:C26F: 74 E1         	ADC		BUF3+5
   186 00:C271: 7F E1         	STA		BUF3+5
   187 00:C273: 63 86 00      	LDA		RAM+6, X
   188 00:C276: 74 E2         	ADC		BUF3+6
   189 00:C278: 7F E2         	STA		BUF3+6
   190 00:C27A: 63 87 00      	LDA		RAM+7, X
   191 00:C27D: 74 E3         	ADC		BUF3+7
   192 00:C27F: 7F E3         	STA		BUF3+7
   193 00:C281: 09            	RTS
   194                        ;=====================================
   195                        ;将内存存储到对应BUF1上
   196                        L_Copy_To_BUF1:
   197 00:C282: 63 80 00      	LDA		RAM, X
   198 00:C285: 7F CA         	STA		BUF1
   199 00:C287: 63 81 00      	LDA		RAM+1, X
   200 00:C28A: 7F CB         	STA		BUF1+1
   201 00:C28C: 63 82 00      	LDA		RAM+2, X
   202 00:C28F: 7F CC         	STA		BUF1+2
   203 00:C291: 63 83 00      	LDA		RAM+3, X
   204 00:C294: 7F CD         	STA		BUF1+3
   205 00:C296: 63 84 00      	LDA		RAM+4, X
   206 00:C299: 7F CE         	STA		BUF1+4
   207 00:C29B: 63 85 00      	LDA		RAM+5, X
   208 00:C29E: 7F CF         	STA		BUF1+5
   209 00:C2A0: 63 86 00      	LDA		RAM+6, X
   210 00:C2A3: 7F D0         	STA		BUF1+6
   211 00:C2A5: 63 87 00      	LDA		RAM+7, X
   212 00:C2A8: 7F D1         	STA		BUF1+7
   213 00:C2AA: 09            	RTS
   214                        ;=====================================
   215                        ;将内存存储到对应BUF2上
   216                        L_Copy_To_BUF2:
   217 00:C2AB: 63 80 00      	LDA		RAM, X
   218 00:C2AE: 7F D3         	STA		BUF2
   219 00:C2B0: 63 81 00      	LDA		RAM+1, X
   220 00:C2B3: 7F D4         	STA		BUF2+1
   221 00:C2B5: 63 82 00      	LDA		RAM+2, X
   222 00:C2B8: 7F D5         	STA		BUF2+2
   223 00:C2BA: 63 83 00      	LDA		RAM+3, X
   224 00:C2BD: 7F D6         	STA		BUF2+3
   225 00:C2BF: 63 84 00      	LDA		RAM+4, X
   226 00:C2C2: 7F D7         	STA		BUF2+4
   227 00:C2C4: 63 85 00      	LDA		RAM+5, X
   228 00:C2C7: 7F D8         	STA		BUF2+5
   229 00:C2C9: 63 86 00      	LDA		RAM+6, X
   230 00:C2CC: 7F D9         	STA		BUF2+6
   231 00:C2CE: 63 87 00      	LDA		RAM+7, X
   232 00:C2D1: 7F DA         	STA		BUF2+7
   233 00:C2D3: 09            	RTS
   234                        ;=====================================
   235                        ;将内存存储到对应BUF3上
   236                        L_Copy_To_BUF3:
   237 00:C2D4: 63 80 00      	LDA		RAM, X
   238 00:C2D7: 7F DC         	STA		BUF3
   239 00:C2D9: 63 81 00      	LDA		RAM+1, X
   240 00:C2DC: 7F DD         	STA		BUF3+1
   241 00:C2DE: 63 82 00      	LDA		RAM+2, X
   242 00:C2E1: 7F DE         	STA		BUF3+2
   243 00:C2E3: 63 83 00      	LDA		RAM+3, X
   244 00:C2E6: 7F DF         	STA		BUF3+3
   245 00:C2E8: 63 84 00      	LDA		RAM+4, X
   246 00:C2EB: 7F E0         	STA		BUF3+4
   247 00:C2ED: 63 85 00      	LDA		RAM+5, X
   248 00:C2F0: 7F E1         	STA		BUF3+5
   249 00:C2F2: 63 86 00      	LDA		RAM+6, X
   250 00:C2F5: 7F E2         	STA		BUF3+6
   251 00:C2F7: 63 87 00      	LDA		RAM+7, X
   252 00:C2FA: 7F E3         	STA		BUF3+7
   253 00:C2FC: 09            	RTS
   254                        ;=====================================
   255                        ;将内存存储到对应BUF4上
   256                        L_Copy_To_BUF4:
   257 00:C2FD: 63 80 00      	LDA		RAM, X
   258 00:C300: 7F E4         	STA		BUF4
   259 00:C302: 63 81 00      	LDA		RAM+1, X
   260 00:C305: 7F E5         	STA		BUF4+1
   261 00:C307: 63 82 00      	LDA		RAM+2, X
   262 00:C30A: 7F E6         	STA		BUF4+2
   263 00:C30C: 63 83 00      	LDA		RAM+3, X
   264 00:C30F: 7F E7         	STA		BUF4+3
   265 00:C311: 63 84 00      	LDA		RAM+4, X
   266 00:C314: 7F E8         	STA		BUF4+4
   267 00:C316: 63 85 00      	LDA		RAM+5, X
   268 00:C319: 7F E9         	STA		BUF4+5
   269 00:C31B: 63 86 00      	LDA		RAM+6, X
   270 00:C31E: 7F EA         	STA		BUF4+6
   271 00:C320: 63 87 00      	LDA		RAM+7, X
   272 00:C323: 7F EB         	STA		BUF4+7
   273 00:C325: 09            	RTS
   274                        ;=====================================
   275                        ;将内存存储到对应BUF1上
   276                        L_Copy_To_BUF5:
   277 00:C326: 63 80 00      	LDA		RAM, X
   278 00:C329: 7F EC         	STA		BUF5
   279 00:C32B: 63 81 00      	LDA		RAM+1, X
   280 00:C32E: 7F ED         	STA		BUF5+1
   281 00:C330: 63 82 00      	LDA		RAM+2, X
   282 00:C333: 7F EE         	STA		BUF5+2
   283 00:C335: 63 83 00      	LDA		RAM+3, X
   284 00:C338: 7F EF         	STA		BUF5+3
   285 00:C33A: 63 84 00      	LDA		RAM+4, X
   286 00:C33D: 7F F0         	STA		BUF5+4
   287 00:C33F: 63 85 00      	LDA		RAM+5, X
   288 00:C342: 7F F1         	STA		BUF5+5
   289 00:C344: 63 86 00      	LDA		RAM+6, X
   290 00:C347: 7F F2         	STA		BUF5+6
   291 00:C349: 63 87 00      	LDA		RAM+7, X
   292 00:C34C: 7F F3         	STA		BUF5+7
   293 00:C34E: 09            	RTS
   294                        
   295                        ;=====================================
   296                        ;=====================================
   297                        ;=====================================
   298                        ;	最大十进制999999999999999999999999
   299                        ;	最大十六进制d3c21bcecceda0ffffff
   300                        ;	buf1.16 -> buf2.10 buf3,buf6
   301                        ;将BUF1的16进制数，转换为10进制数存储到BUF2中，BUF3存储每个1对应的权重
   302                        L_Hex_To_Dec_Prog:
   303 00:C34F: 5E 53         	LDX		#(BUF2-RAM)
   304 00:C351: 15 F3 C1      	JSR		L_Clear_BUF_Prog
   305 00:C354: 5E 4A         	LDX		#(BUF1-RAM)
   306 00:C356: 15 F3 C1      	JSR		L_Clear_BUF_Prog
   307 00:C359: 53 01         	LDA		#1
   308 00:C35B: 7F DC         	STA		BUF3;给权重计数器初始值
   309 00:C35D: 02            	SED
   310 00:C35E: 53 21         	LDA		#(MAX_BYTE*8+1)
   311 00:C360: 7F F4         	STA		BUF6;计算循环次数
   312                        
   313                        L_Hex_To_Dec_Prog_Loop:
   314 00:C362: 79 F4         	DEC		BUF6
   315 00:C364: 13 13         	BEQ		L_Hex_To_Dec_Prog_RTS
   316 00:C366: 5E 4A         	LDX		#(BUF1-RAM)
   317 00:C368: 15 CC C1      	JSR		L_Move_Right_One_Bit_Prog
   318 00:C36B: 10 05         	BCC		L_Hex_To_Dec_Prog_Loop_1;右移出C标志位，如果为1则说明此时需要在BUF2中加上权重，
   319                        ;否则跳转改变权重
   320 00:C36D: 5E 5C         	LDX		#(BUF3-RAM)
   321 00:C36F: 15 0E C2      	JSR		L_BUFX_Add_BUF2_TO_BUF2_Prog
   322                        L_Hex_To_Dec_Prog_Loop_1:
   323 00:C372: 5E 5C         	LDX		#(BUF3-RAM)
   324 00:C374: 15 48 C2      	JSR		L_BUFX_Add_BUF3_TO_BUF3_Prog
   325 00:C377: 17 E9         	BRA		L_Hex_To_Dec_Prog_Loop
   326                        L_Hex_To_Dec_Prog_RTS:
   327 00:C379: 09            	RTS
   328                        
   329                        
   330                        ;=====================================
   331                        ;10进制转16进制
   332                        L_Dec_To_Hex_Prog:
   333 00:C37A: 5E 53         	LDX		#(BUF2-RAM)
   334 00:C37C: 15 F3 C1      	JSR		L_Clear_BUF_Prog
   335 00:C37F: 5E 5C         	LDX		#(BUF3-RAM)
   336 00:C381: 15 F3 C1      	JSR		L_Clear_BUF_Prog
   337 00:C384: 5E 64         	LDX		#(BUF4-RAM)
   338 00:C386: 15 F3 C1      	JSR		L_Clear_BUF_Prog
   339 00:C389: 53 01         	LDA		#1
   340 00:C38B: 7F DC         	STA		BUF3
   341 00:C38D: 06            	CLD
   342 00:C38E: 53 00         	LDA		#0
   343 00:C390: 7F F5         	STA		BUF6+1
   344 00:C392: 53 41         	LDA		#(MAX_DIG*8+1)
   345 00:C394: 7F F4         	STA		BUF6
   346                        L_Dec_To_Hex_Prog_Loop:
   347 00:C396: 79 F4         	DEC		BUF6
   348 00:C398: 13 35         	BEQ		L_Dec_To_Hex_Prog_RTS
   349 00:C39A: 5E 4A         	LDX		#(BUF1-RAM)
   350 00:C39C: 15 CC C1      	JSR		L_Move_Right_One_Bit_Prog
   351 00:C39F: 10 05         	BCC		L_Dec_To_Hex_Prog_Loop_Add
   352 00:C3A1: 5E 5C         	LDX		#(BUF3-RAM)
   353 00:C3A3: 15 0E C2      	JSR		L_BUFX_Add_BUF2_TO_BUF2_Prog
   354                        L_Dec_To_Hex_Prog_Loop_Add:
   355 00:C3A6: 78 F5         	INC		BUF6+1
   356 00:C3A8: 73 F5         	LDA		BUF6+1
   357 00:C3AA: 56 04         	CMP		#4
   358 00:C3AC: 12 04         	BNE		L_Dec_To_Hex_Prog_Loop_1
   359 00:C3AE: 53 00         	LDA		#0
   360 00:C3B0: 7F F5         	STA		BUF6+1
   361                        L_Dec_To_Hex_Prog_Loop_1:
   362 00:C3B2: 73 F5         	LDA		BUF6+1
   363 00:C3B4: 13 06         	BEQ		L_Dec_To_Hex_Prog_BUFX_Add_BUF4_To_BUF3
   364 00:C3B6: 56 02         	CMP		#2
   365 00:C3B8: 13 09         	BEQ		L_Dec_To_Hex_Prog_SAVE
   366 00:C3BA: 17 0C         	BRA		L_Dec_To_HEX_Prog_BUF3_To_BUF3_Prog
   367                        L_Dec_To_Hex_Prog_BUFX_Add_BUF4_To_BUF3:
   368 00:C3BC: 5E 64         	LDX		#(BUF4-RAM)
   369 00:C3BE: 15 48 C2      	JSR		L_BUFX_Add_BUF3_TO_BUF3_Prog
   370 00:C3C1: 17 D3         	BRA		L_Dec_To_Hex_Prog_Loop
   371                        L_Dec_To_Hex_Prog_SAVE:
   372 00:C3C3: 5E 5C         	LDX		#(BUF3-RAM)
   373 00:C3C5: 15 FD C2      	JSR		L_Copy_To_BUF4
   374                        L_Dec_To_HEX_Prog_BUF3_To_BUF3_Prog:
   375 00:C3C8: 5E 5C         	LDX		#(BUF3-RAM)
   376 00:C3CA: 15 48 C2      	JSR		L_BUFX_Add_BUF3_TO_BUF3_Prog
   377 00:C3CD: 17 C7         	BRA		L_Dec_To_Hex_Prog_Loop
   378                        L_Dec_To_Hex_Prog_RTS:
   379 00:C3CF: 09            	RTS
   380                        
   381                        ;=====================================
   382                        ;=====================================
   383                        ;=====================================
   384                        ;=====================================
   385                        ;=====================================
   386                        ;=====================================
   387                        ;=====================================
   388                        ;=====================================
   389                        ;=====================================
   390                        ;=====================================
   391                        ;=====================================
   392                        ;=====================================
   393                        ;=====================================
   394                        ;=====================================
   395                        ;=====================================
   396                        ;=====================================
   397                        ;=====================================
   398                        ;=====================================
   399                        ;=====================================
   400                        ;=====================================
   401                        ;=====================================
   402                        ;=====================================
   403                        ;=====================================
   404                        ;=====================================
   405                        ;=====================================
   406                        ;=====================================
   407                        ;=====================================
   408                        ;=====================================
   409                        ;=====================================
   410                        ;=====================================
   411                        ;=====================================
   412                        ;=====================================
   413                        ;=====================================
   414                        ;=====================================
   415                        ;=====================================
   416                        ;=====================================
   417                        ;=====================================
   418                        ;=====================================
   419                        ;=====================================
   420                        ;=====================================
   421                        ;=====================================
   422                        ;=====================================
   423                        ;=====================================
   424                        ;=====================================
   425                        ;=====================================
   426                        ;=====================================
   427                        ;=====================================
   428                        ;=====================================
   429                        ;=====================================
   430                        ;=====================================
   431                        
   432                        
   432                        
   181                        .Include	Calculator\Calculator_Base_Math.asm
     1                        L_Mul_Prog:
     2 00:C3D0: 06                CLD
     3 00:C3D1: 5E 5C             LDX     #(BUF3-RAM)
     4 00:C3D3: 15 F3 C1          JSR     L_Clear_BUF_Prog
     5 00:C3D6: 53 21             LDA     #(MAX_DIG*4+1)
     6 00:C3D8: 7F F4             STA     BUF6
     7                        L_Mul_Prog_Loop:
     8 00:C3DA: 79 F4             DEC     BUF6
     9 00:C3DC: 13 13             BEQ     L_Mul_Prog_RTS
    10 00:C3DE: 5E 4A             LDX     #(BUF1-RAM)
    11 00:C3E0: 15 CC C1          JSR     L_Move_Right_One_Bit_Prog
    12 00:C3E3: 10 05             BCC     L_Mul_Prog_Loop_1
    13 00:C3E5: 5E 53             LDX     #(BUF2-RAM)
    14 00:C3E7: 15 48 C2          JSR     L_BUFX_Add_BUF3_TO_BUF3_Prog
    15                        L_Mul_Prog_Loop_1:
    16 00:C3EA: 5E 53             LDX     #(BUF2-RAM)
    17 00:C3EC: 15 68 C1          JSR     L_Move_Left_One_Bit_Prog
    18 00:C3EF: 17 E9             BRA     L_Mul_Prog_Loop
    19                        
    20                        L_Mul_Prog_RTS:
    21 00:C3F1: 09                RTS
    22                        
    23                        L_Control_Mul_Prog:
    24 00:C3F2: 5E 53             LDX     #(BUF2-RAM)
    25 00:C3F4: 15 26 C3          JSR     L_Copy_To_BUF5
    26 00:C3F7: 15 7A C3          JSR     L_Dec_To_Hex_Prog
    27                        
    28 00:C3FA: 5E 6C             LDX     #(BUF5-RAM)
    29 00:C3FC: 15 82 C2          JSR     L_Copy_To_BUF1
    30                        
    31 00:C3FF: 5E 53             LDX     #(BUF2-RAM)
    32 00:C401: 15 26 C3          JSR     L_Copy_To_BUF5
    33 00:C404: 15 7A C3          JSR     L_Dec_To_Hex_Prog
    34                        
    35 00:C407: 5E 6C             LDX     #(BUF5-RAM)
    36 00:C409: 15 82 C2          JSR     L_Copy_To_BUF1
    37                        
    38 00:C40C: 15 D0 C3          JSR     L_Mul_Prog
    39                        
    40 00:C40F: 5E 5C             LDX     #(BUF3-RAM)
    41 00:C411: 15 82 C2          JSR     L_Copy_To_BUF1
    42 00:C414: 15 4F C3          JSR     L_Hex_To_Dec_Prog
    43                        
    44 00:C417: 5E 52             LDX     #(BUF1+FD-RAM)
    45 00:C419: 15 44 C1          JSR     L_Adjust_FD_DEC_Prog
    46                        
    47 00:C41C: 5E 5B             LDX     #(BUF2+FD-RAM)
    48 00:C41E: 15 44 C1          JSR     L_Adjust_FD_DEC_Prog
    49                        
    50 00:C421: 06                CLD
    51 00:C422: 04                CLC
    52                        
    52                        
   182                        ; .Include	Calc\calm.asm
   183                        
   184                        ; .INCLUDE	Half_s\Half.asm
   185                        ; .INCLUDE	Half_s\Clock.asm
   186                        ; .INCLUDE	Half_s\Alarm_Clock.asm
   187                        ; .INCLUDE	Half_s\Timer.asm
   188                        ; .INCLUDE	Half_s\Common.asm
   189                        ; .INCLUDE	Half_s\Flash.asm
   190                        
   191                        ; .INCLUDE	Sound\Beep.asm
   192                        
   193                        ; .INCLUDE	Delay.asm
   194                        
   195                        ;--------------------------------------------------------
   196                        ;***********************************************************************
   197 00:C423: FF FF FF FF   	.BLKB	$FFFF-$,$FF
   197 00:C423: FF FF FF FF   
   197 00:C423: FF FF FF FF   
   198                        
   199                        	.ORG	0FFF8H
   200                        
   201 00:FFF8: D5            	DB		11010101B	;
   202                        ; bit0 	=0
   203                        ; bit1	=0
   204                        ; bit2 	=0当PA7做复位时，只能写1低电平有效，高电平有效烧录会报错
   205                        ; bit3	=0PA口做输入下拉和输入上拉，1PA口做输入下拉和三态
   206                        ; bit4 	=0
   207                        ; bit5 	=0
   208                        ; bit6	=0VDD=1.5V,1 VDD=3V
   209                        ; bit7	=0做复位，1做PA7口
   210 00:FFF9: FF            	DB		11111111B	;
   211                        
   212                        ;***********************************************************************
   213                        	.ORG	0FFFCH
   214 00:FFFC: 00 C0         	DW		V_RESET
   215 00:FFFE: 83 C0         	DW		V_IRQ
   216                        
   217                        	.ENDS
   218                        	.END

 --------------------
      Warnings:0
      Errors  :0
