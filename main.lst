Fri May 16 09:39:03 2025
-------------------------
CAS V2.15.1-rc1 - (C) Copyright 2000-2012 CHIPMAST TECHNOLOGY CO. LTD.
Main file   : main.asm
Current file: main.asm

     1                        ;********************************************************************************
     2                        ; PROJECT	: Calendar(MC830B)							*
     3                        ; AUTHOR	: WBN										*
     4                        ; REVISION	: 13/9/2024  V1.0	First issue				*
     5                        ; High OSC CLK  : Internal RC 4.4MHz	Fcpu = Fosc/2				*
     6                        ; Function	: 								*
     7                        ;********************************************************************************
     8                        	.CHIP	W65C02S      ;cpu的选型
     9                        	;.INCLIST	ON       ;宏定义和文件
    10                        	.MACLIST	ON
    11                        ;***************************************
    12                        CODE_BEG	EQU		C000H ;C000H(4K*4次)        ;起始地址
    13                        ;***************************************
    14                        
    15                        PROG	SECTION	OFFSET	CODE_BEG                ;定义代码段的偏移量从CODE_BEG开始，用于组织程序代码。
    16                        
    17                        ;***************************************
    18                        ;*	header include                               ;头文件
    19                        ;***************************************
    20                        	.include	50P016.h
     1                        .page0
     2                        .org 	00H
     3                        PA		EQU	01H
     4                        P_PA		EQU	PA
     5                        PAWAKE	EQU	02H
     6                        P_PA_WAKE	EQU	PAWAKE
     7                        PADIR	EQU	04H
     8                        P_PA_DIR	EQU	PADIR
     9                        P_PA_IO		EQU	PADIR
    10                        PB		EQU	05H
    11                        P_PB		EQU	PB
    12                        PBTYPE	EQU	06H
    13                        P_PB_TYPE	EQU	PBTYPE
    14                        PC		EQU	07H
    15                        P_PC 		EQU PC
    16                        PCDIR	EQU	08H
    17                        P_PC_IO 	EQU	PCDIR
    18                        P_PC_DIR	EQU	PCDIR
    19                        PCSEG	EQU	09H	;
    20                        P_PCSEG		EQU	PCSEG
    21                        PD		EQU	0AH
    22                        PDDIR	EQU 0BH
    23                        PADF0	EQU	0CH	;
    24                        P_PADF0		EQU	PADF0
    25                        PADF1	EQU	0DH	;
    26                        IER		EQU	0EH
    27                        P_IER 	EQU IER
    28                        IFR		EQU	0FH
    29                        P_IFR 		EQU IFR
    30                        TMR0	EQU	10H	;
    31                        P_TMR0		EQU	TMR0
    32                        TMR1	EQU	12H	;
    33                        P_TMR1  	EQU	TMR1
    34                        TMR2	EQU	14H	;
    35                        TMRC	EQU	16H	;
    36                        P_TMRCTRL 	EQU TMRC
    37                        P_TMRC		EQU	TMRC
    38                        bTMR0ON    EQU	   0
    39                        bTMR1ON    EQU	   1
    40                        bLCDON	   EQU	   4
    41                        bAUDON	   EQU	   7
    42                        
    43                        TMCLK	EQU	17H	;
    44                        P_TMRCLK 	EQU TMCLK
    45                        P_TMCLK 	EQU TMCLK
    46                        DIVC	EQU	18H	;
    47                        P_DIVC		EQU	DIVC
    48                        LCDCTRL	EQU	19H	;
    49                        LCDCOM	EQU	1AH	;
    50                        P_LCD_COM	EQU	LCDCOM
    51                        WDTC	EQU	1CH	;
    52                        SYSCLK	EQU	1DH
    53                        P_SYSCLK	EQU	SYSCLK
    54                        sysclk		equ SYSCLK
    55                        HALT	EQU	1EH	;
    56                        P_HALT		EQU	HALT
    57                        AUD0	EQU	1FH	;
    58                        P_AUD		EQU	AUD0
    59                        
    60                        AUDCR	EQU	20H	;
    61                        P_AUD_CTL	EQU	AUDCR
    62                        FRAME	EQU	21H	;
    63                        ;BANK	EQU	23H	;
    64                        MF		EQU	2FH
    65                        
    66                        SPCR	EQU	32H
    67                        SPSR	EQU	33H
    68                        SPDR	EQU	34H
    69                        PAK		EQU	3AH
    70                        PBK		EQU	3BH
    71                        PCK		EQU	3CH
    72                        LVC		EQU	3DH
    73                        FUSE	EQU	3EH
    74                        
    75                        PDSEG	EQU	5CH
    76                        RFCC0	EQU	5DH
    77                        RFCC1	EQU	5EH
    78                        
    79                        .ends
    79                        
    21                        	.INCLUDE	RAM.INC
     1                        .Kdata
     2                        ;***************************************
     3                        ; RAM Address
     4                        ;***************************************
     5                        RamStarAddr			EQU		1800H   ;RAM的开始地址
     6                        LCD_RamAddr			EQU		RamStarAddr     ;LCD RAM的地址
     7                        Time_Addr			EQU		RamStarAddr+Time_Str_Addr-Page0RamStarAddr
     8                        Cal_Addr			EQU		RamStarAddr+Calculator_Str_Addr-Page0RamStarAddr
     9                        RAM					EQU		80H
    10                        ;***************************************
    11                        ;Time_Addr		EUQ		B0H
    12                        ;***************************************
    13                        .PAGE0     ;page 0的内存布局
    14                        ;***************************************
    15                        ;	ORG	0098H
    16                        ;---------------------------------------------------------------------
    17                        	ORG	0080H
    18                        
    19                        Page0RamStarAddr	EQU		$
    20 00:0080: xx xx xx xx   LCDRAM					DS	6*5
    20 00:0080: xx xx xx xx   
    20 00:0080: xx xx xx xx   
    21                        D_LCD_RAM				EQU	6*5
    22                        
    23 00:009E: xx            R_Int_Backup			DS	1
    24                        
    25 00:009F: xx            Sys_Flag_A				DS	1		;0	系统状态
    26                        ; bit0 	=132hz标志
    27                        ; bit1	=1按键首次扫描标志
    28                        ; bit2 	=0按键循环扫描标志
    29                        ; bit3	=0设置模式
    30                        ; bit4 	=0快加设置(此工程无用)
    31                        ; bit5 	=0无效键设置
    32                        ; bit6	=01按键长按
    33                        ; bit7	=0按键按下返回时间模式的标志
    34 00:00A0: xx            Sys_Flag_B				DS	1	;时钟模式的系统状态
    35                        ; bit0 	=半秒标志
    36                        ; bit1	=一秒标志
    37                        ; bit2	=12小时/24小时制度
    38                        ; bit3	=1是润年标志
    39                        ; bit4 	=
    40                        ; bit5 	=
    41                        ; bit6	=
    42                        ; bit7	=
    43 00:00A1: xx            Sys_Flag_C				DS	1	;闹钟模式的系统状态
    44                        ; bit0 	=0闹铃界面/1 整点报时
    45                        ; bit1	=0关闭整点报时，开启整点报时
    46                        ; bit2 	=1设置输入的按键无效
    47                        ; bit3	=
    48                        ; bit4 	=闹钟闹铃
    49                        ; bit5 	=1按键音开启
    50                        ; bit6	=
    51                        ; bit7	=1贪睡标志
    52 00:00A2: xx            Sys_Flag_D				DS	1	;计时器模式的系统状态
    53                        ; bit0 	=1正计时开启计时
    54                        ; bit1	=1是倒计时开启计时
    55                        ; bit2	=1第一次倒计时
    56                        ; bit3	=
    57                        ; bit4 	=定时器闹铃
    58                        ; bit5 	=0无中途测量，1中途测量
    59                        ; bit6	=
    60                        ; bit7	=
    61 00:00A3: xx            R_Reset_Time					DS	1;全显时间,一般为2s
    62                        
    63 00:00A4: xx            R_Scankey_Time					DS	1;按键按下的时间
    64                        D_Rscankey_Half_Sec				EQU	16;按键时间
    65                        D_Rscankey_Sec					EQU	32
    66                        D_Rscankey_TWO_Sec				EQU	64
    67                        
    68                        
    69 00:00A5: xx            P_Scankey_value_T_1			DS	1
    70 00:00A6: xx            P_Scankey_value				DS	1;按键存储值
    71 00:00A7: xx            P_Scankey_value_Temporary	DS	1;按键临时储存
    72                        
    73                        D_PA_Value						EQU		01110000B
    74                        D_PA_Press						EQU		01111100B
    75                        D_PA2_Press						EQU		01110100B
    76                        D_PA3_Press						EQU		01111000B
    77                        D_PA4_Press						EQU		01100000B
    78                        D_PA5_Press						EQU		01010000B
    79                        D_PA6_Press						EQU		00110000B
    80                        D_PA5_PA6_Press					EQU		00010000B
    81                        
    82                        D_PC_Press						EQU		00001111B
    83                        D_PC0_Press						EQU		00000001B
    84                        D_PC1_Press						EQU		00000010B
    85                        D_PC2_Press						EQU		00000100B
    86                        D_PC3_Press						EQU		00001000B
    87                        
    88                        ; P_Beep_Frequency				DS	1	;声音大小
    89                        ; D_Beep_Frequency_1_2_Duty		EQU	0
    90                        ; D_Beep_Frequency_3/4_Duty		EQU 80H
    91                        ; D_Mode_Press					EQU		1 ;
    92                        ; D_ST_SP_Press					EQU		2 ;
    93                        ; D_Reset_Press					EQU		3 ;
    94                        ; D_Light_Press					EQU		4 ;
    95                        D_NUM1_Press					EQU		1;1
    96                        D_NUM2_Press					EQU		2;2
    97                        D_NUM3_Press					EQU		3;3
    98                        D_NUM4_Press					EQU		4;4
    99                        D_NUM5_Press					EQU		5;5
   100                        D_NUM6_Press					EQU		8;6
   101                        D_NUM7_Press					EQU		9;7
   102                        D_NUM8_Press					EQU		10;8
   103                        D_NUM9_Press					EQU		11;9
   104                        D_NUM0_Press					EQU		12;0
   105                        D_NUM_Point_Press				EQU		15;.
   106                        D_NUM_Equal_Press				EQU		20;=
   107                        D_NUM_Add_Press					EQU		16;+
   108                        D_NUM_Minus_Press				EQU		17;-
   109                        D_NUM_Multiply_Press			EQU		18;*
   110                        D_NUM_Divid_Press				EQU		19;/
   111                        D_B_Press						EQU		21;mode
   112                        D_C_Press						EQU		22;set
   113                        D_Beep_Test_Press				EQU		23;声音测试
   114                        
   115                        D_Date_Press					EQU		D_NUM_Divid_Press
   116                        D_Alm_Press						EQU		D_NUM4_Press
   117                        D_Sig_Press						EQU		D_NUM_Multiply_Press
   118                        D_ST_SP_Press					EQU		D_NUM_Add_Press
   119                        D_ST_Hour_Press					EQU		D_NUM_Divid_Press
   120                        D_Reset_Press					EQU		D_NUM0_Press
   121                        D_Mode_Press					EQU		D_C_Press
   122                        D_Set_Press						EQU		D_B_Press
   123                        
   124                        ;---------------------------------------
   125                        Time_Str_Addr	EQU		$
   126 00:00A8: xx            R_Time_Sec						DS	1;时钟的秒数;
   127 00:00A9: xx            R_Time_Min						DS	1;时钟的分钟数;
   128 00:00AA: xx            R_Time_Hr 						DS	1;时钟的小时数;
   129 00:00AB: xx            R_Time_Day 						DS	1;日
   130 00:00AC: xx            R_Time_Month 					DS	1;月
   131 00:00AD: xx            R_Time_Year						DS	1;年
   132 00:00AE: xx            R_Time_Week						DS	1;0是星期天，1是星期一---
   133                        
   134 00:00AF: xx            R_Time_Min_Another				DS	1;第二时间的分钟
   135 00:00B0: xx            R_Time_Hr_Another				DS	1;第二时间的小时
   136                        
   137 00:00B1: xx            R_Timer_Ms						DS	1;定时器10ms次数
   138 00:00B2: xx            R_Timer_Sec						DS	1;定时器显示时间/正计时时间秒数
   139 00:00B3: xx            R_Timer_Min						DS	1;定时器显示时间/正计时时间分钟
   140 00:00B4: xx            R_Timer_Hr						DS	1;定时器显示时间/正计时时间小时
   141 00:00B5: xx            R_Timer_X						DS	1
   142 00:00B6: xx            R_Timer_X_1						DS	1
   143                        
   144                        R_Timer_Hr_Measurement			EQU	BUF4
   145                        R_Timer_Min_Measurement			EQU	BUF4+1
   146                        R_Timer_Sec_Measurement			EQU	BUF4+2
   147                        R_Timer_Ms_Measurement			EQU	BUF4+3
   148                        
   149                        
   150                        D_Beep_Open_Last_Time_Alarm		EQU	21
   151                        
   152 00:00B7: xx            R_Alarm_Clock_Min				DS	1;闹钟的分钟;	10
   153 00:00B8: xx            R_Alarm_Clock_Hr 				DS	1;闹钟的小时;	11
   154 00:00B9: xx            R_Alarm_Mode					DS	1;闹钟的模式，0是闹钟关闭，1是闹钟开启，2是循环闹铃
   155                        
   156                        
   157                        D_Snz_Time						EQU	5
   158                        D_Snz_Frequency					EQU	6
   159                        
   160                        
   161 00:00BA: xx            R_Mode_Set					DS	1;设置模式
   162                        
   163                        
   164                        
   165                        ;==================================================
   166                        ;==================================================
   167                        ;===================================================
   168                        Calculator_Str_Addr	EQU		$
   169                        ;这个加1是存储小数点位置的，bit7是存储数据的正负，其余是存储有效移位次数
   170                        MAX_DIG		.EQU	8
   171                        MAX_BYTE	.EQU	MAX_DIG / 2
   172                        
   173                        FD			.EQU	MAX_DIG
   174 00:00BB: xx xx xx xx   BUF1		.DS		MAX_DIG+1
   174 00:00BB: xx xx xx xx   
   174 00:00BB: xx            
   175 00:00C4: xx xx xx xx   BUF2		.DS		MAX_DIG+1
   175 00:00C4: xx xx xx xx   
   175 00:00C4: xx            
   176 00:00CD: xx xx xx xx   BUF3		.DS		MAX_DIG
   176 00:00CD: xx xx xx xx   
   177 00:00D5: xx xx xx xx   BUF4		.DS		MAX_DIG
   177 00:00D5: xx xx xx xx   
   178 00:00DD: xx xx xx xx   BUF5		.DS		MAX_DIG
   178 00:00DD: xx xx xx xx   
   179 00:00E5: xx xx xx xx   BUF6		.DS		4
   180                        
   181                        
   182                        ;==========================================
   183 00:00E9: xx xx xx xx   IBUF		 DS		MAX_BYTE+1
   183 00:00E9: xx            
   184                        ACC			.EQU	P_Temp
   185                        IFD			.EQU	MAX_BYTE
   186                        ;=======================================
   187                        ; ERR_NULL	.EQU	0
   188                        ERR_DIV0	.EQU	1
   189                        Err_FUll	.EQU	2
   190                        ; ERR_SQRT	.EQU	3
   191                        ; ERR_M		.EQU	4
   192                        ; ERR_GT		.EQU	5
   193                        ; ERR_MU		.EQU	6
   194                        ; ERR_PCT		.EQU	7
   195                        ; ERR_IN		.EQU	8
   196                        ;=======================================
   197                        
   198                        
   199                        DINX		.EQU	P_Temp+6
   200                        
   201                        
   202                        D1FD		.EQU	MAX_BYTE
   203                        DFD			.EQU	MAX_BYTE
   204                        BFD			.EQU	MAX_BYTE
   205                        
   206                        
   207                        ; Calculator_State		DS	1
   208                        Calculator_State_Init				.EQU	0;计算器第一次输入状态
   209                        Calculator_State_Symbol_First_Press	.EQU	1;计算器第一次按下加减乘除后的状态
   210                        Calculator_State_Input				.EQU	2;计算器按下加减乘除后按下数字的状态
   211                        Calculator_State_Equal_Press		.EQU	3;计算器按下等于号的状态
   212                        Calculator_State_Involution			.EQU	4;计算器乘方模式
   213                        Calculator_State_Involution_Input	.EQU	5;计算器乘方模式按键输入
   214                        Calculator_State_Involution_Input_Symbol	.EQU	6
   215                        ; Calculator_State_Symbol_Press_Again	.EQU	5;计算器非第一次按下加减乘除符号键
   216                        ; Calculator_Symbol_State	DS	1
   217                        ;=========================================
   218                        State_Null			.EQU	0
   219                        State_Add			.EQU	1
   220                        State_SUB			.EQU	2
   221                        State_Mul			.EQU	3
   222                        State_DIV			.EQU	4
   223                        State_Involution	.EQU	5
   224                        
   225                        
   226                        State_Equal			.EQU	6
   227                        
   228                        
   229                        Calc_Init				.EQU	0	;初始化，无意义
   230                        Calc_First_Output		.EQU	1	;按键第一次按下加减乘除符号键
   231                        Calc_First_Output_		.EQU	2	;第一次运算没有数字输入
   232                        Calc_First_Output_In	.EQU	3	;第一次按键按下有数字输入
   233                        Calc_First_Output_Involution	.EQU	4
   234                        Calc_First_Output_Involution_IN	.EQU	5
   235                        MAX_Number_Input		.EQU	16
   236                        
   237 00:00EE: xx            Time_To_Clock_Mode	DS	1
   238                        D_Time_To_Clock_Mode	.EQU	6
   239                        ;---------------------------------------
   240 00:00EF: xx xx xx xx   P_Temp			ds	10
   240 00:00EF: xx xx xx xx   
   240 00:00EF: xx xx         
   241                        ;显示从写P_Temp+4
   242                        ;---------------------------------------
   243                        ;---------------------------------------
   244                        ;***************************************
   245                        .ENDS
   246                        ;***************************************
   247                        .Udata
   248                        ;---------------------------------------
   249                        	ORG    1880H
   250                        ;---------------------------------------
   251                        ;---------------------------------------
   252                        
   253                        ; IBUF		DS		MAX_DIG+1
   254                        
   255 00:1880: xx xx xx xx   DBUF		DS		MAX_BYTE+1
   255 00:1880: xx            
   256 00:1885: xx xx xx xx   D1BUF		DS		MAX_BYTE+1
   256 00:1885: xx            
   257 00:188A: xx xx xx xx   BBUF		DS		MAX_BYTE+1
   257 00:188A: xx            
   258                        
   259 00:188F: xx            Calculator_Symbol_State_1	DS	1
   260                        ; Time_To_Clock_Mode	DS	1
   261                        
   262                        
   263                        
   264 00:1890: xx            ERR			DS		1
   265 00:1891: xx            R_Mode						DS	1;0是时钟模式，1是闹钟，2是正计时，3是第二时钟，4是倒计时
   266                        
   267 00:1892: xx            R_Set_Mode_Exit_Time			DS	1;自动设置退出时间
   268                        D_Set_Mode_Exit_Time			EQU	6
   269 00:1893: xx            R_Alarm_Clock_Open_Beep_Time	DS	1;32Hz转化为16hz
   270 00:1894: xx            R_Close_Beep_Time				DS	1;闹铃关闭时间，闹铃响多久
   271 00:1895: xx            R_Voice_Unit					DS	1;闹铃响的次数，一秒响几次
   272                        
   273 00:1896: xx            R_Snz_Time						DS	1;贪睡闹钟的分钟;
   274 00:1897: xx            R_Snz_Frequency					DS	1;贪睡闹钟的小时;
   275                        
   276 00:1898: xx            Calculator_State				DS	1
   277 00:1899: xx            Calculator_Symbol_State			DS	1
   278 00:189A: xx            Calculator_State_Mechine		DS	1
   279                        ; Calculator_Symbol_State_Equal	DS	1
   280                        ; Loop_Count						DS	1
   281 00:189B: xx            OP								DS	1;运算
   282                        
   283 00:189C: xx            R_Involution					DS	1
   284                        .ENDS
   284                        
    22                        	.include	50P016.mac
     1                        ;------------------------------------
     2                        PB2_PB2_COMS MACRO
     3                                RMB0    PADF0
     4                                SMB2    PBTYPE ;COMS
     5                                ENDM
     6                        PB2_PB2_NOMS MACRO
     7                                RMB0    PADF0
     8                                RMB2    PBTYPE ;NOMS
     9                                ENDM
    10                        PB2_PWM MACRO
    11                                SMB0    PADF0
    12                                SMB2    PBTYPE ;COMS
    13                                ENDM
    14                        PB3_PB3_COMS MACRO
    15                                RMB1    PADF0
    16                                SMB3    PBTYPE ;NMOS
    17                                ENDM
    18                        PB3_PB3_NOMS MACRO
    19                                RMB1    PADF0
    20                                RMB3    PBTYPE ;CMOS
    21                                ENDM
    22                        PB3_PWM MACRO
    23                                SMB1    PADF0
    24                                SMB3    PBTYPE ;CMOS
    25                                ENDM
    26                        
    27                        PA4_PA4 MACRO
    28                                RMB3    PADF0
    29                                RMB4    PADF0
    30                                ENDM
    31                        PA4_IR_FSUB     MACRO
    32                                SMB3    PADF0
    33                                RMB4    PADF0
    34                                ENDM
    35                        PA4_IR_TMR0_D2  MACRO
    36                                RMB3    PADF0
    37                                SMB4    PADF0
    38                                ENDM
    39                        PA4_IR_TMR0_D3  MACRO
    40                                SMB3    PADF0
    41                                SMB4    PADF0
    42                                ENDM
    43                        
    44                        PA7_PA7 MACRO
    45                                RMB2    PADF0
    46                                ENDM
    47                        
    48                        PA7_EXT MACRO
    49                                SMB2    PADF0 ;falling edge trigger
    50                                ENDM
    51                        
    52                        PC45_PC45       MACRO
    53                                RMB4    PCSEG
    54                                ENDM
    55                        
    56                        PC67_PC67       MACRO
    57                                RMB5    PCSEG
    58                                RMB4    DIVC
    59                                ENDM
    60                        
    61                        PC67_EL01       MACRO
    62                                RMB5    PCSEG
    63                                SMB4    DIVC
    64                                ENDM
    65                        
    66                        PC03_SEG       MACRO
    67                                SMB0    PCSEG
    68                                SMB1    PCSEG
    69                                SMB2    PCSEG
    70                                SMB3    PCSEG
    71                                ENDM
    72                        
    73                        PC45_SEG       MACRO
    74                                SMB4    PCSEG
    75                                ENDM
    76                        PC67_SEG	MACRO
    77                                SMB5    PCSEG
    78                                ENDM
    79                        
    80                        PD03_SEG	MACRO
    81                        		SMB6	PCSEG
    82                                ENDM
    83                        PD03_RFC	MACRO
    84                        		RMB6	PCSEG
    85                        ;		RMB0	PDSEG
    86                        ;		RMB1	PDSEG
    87                        ;		RMB2	PDSEG
    88                        ;		RMB3	PDSEG
    89                        		SMB0	RFCC0
    90                        		SMB1	RFCC0
    91                        		SMB2	RFCC0
    92                        		SMB3	RFCC0
    93                                ENDM
    94                        PD03_PD03	MACRO
    95                        		RMB6	PCSEG
    96                        ;		RMB0	PDSEG
    97                        ;		RMB1	PDSEG
    98                        ;		RMB2	PDSEG
    99                        ;		RMB3	PDSEG
   100                        		RMB0	RFCC0
   101                        		RMB1	RFCC0
   102                        		RMB2	RFCC0
   103                        		RMB3	RFCC0
   104                                ENDM
   105                        PD0_SEG	MACRO
   106                        ;		RMB6	PCSEG
   107                        		SMB0	PDSEG
   108                                ENDM
   109                        PD1_SEG	MACRO
   110                        ;		RMB6	PCSEG
   111                        		SMB1	PDSEG
   112                                ENDM
   113                        PD2_SEG	MACRO
   114                        ;		RMB6	PCSEG
   115                        		SMB2	PDSEG
   116                                ENDM
   117                        PD3_SEG	MACRO
   118                        		RMB6	PCSEG
   119                        		SMB3	PDSEG
   120                                ENDM
   121                        
   122                        PD47_SEG	MACRO
   123                        		SMB7	PCSEG
   124                                ENDM
   125                        PD47_RFC	MACRO
   126                        		RMB7	PCSEG
   127                        ;		RMB4	PDSEG
   128                        ;		RMB5	PDSEG
   129                        ;		RMB6	PDSEG
   130                        ;		RMB7	PDSEG
   131                        		SMB4	RFCC0
   132                        		SMB5	RFCC0
   133                        		SMB6	RFCC0
   134                        		SMB7	RFCC0
   135                                ENDM
   136                        PD47_PD47	MACRO
   137                        		RMB7	PCSEG
   138                        ;		RMB4	PDSEG
   139                        ;		RMB5	PDSEG
   140                        ;		RMB6	PDSEG
   141                        ;		RMB7	PDSEG
   142                        		RMB4	RFCC0
   143                        		RMB5	RFCC0
   144                        		RMB6	RFCC0
   145                        		RMB7	RFCC0
   146                                ENDM
   147                        PD4_SEG	MACRO
   148                        ;		RMB7	PCSEG
   149                        		SMB4	PDSEG
   150                                ENDM
   151                        PD5_SEG	MACRO
   152                        ;		RMB7	PCSEG
   153                        		SMB5	PDSEG
   154                                ENDM
   155                        PD6_SEG	MACRO
   156                        ;		RMB7	PCSEG
   157                        		SMB6	PDSEG
   158                                ENDM
   159                        PD7_SEG	MACRO
   160                        		RMB7	PCSEG
   161                        		SMB7	PDSEG
   162                                ENDM
   163                        
   164                        PC_PD_SEG	MACRO
   165                        		lda		#$FF
   166                        		STA		PCSEG	;S1~S7,S8~S15
   167                                ENDM
   168                        
   169                        LCD_2COM	MACRO
   170                        		SMB0	LCDCOM
   171                        		RMB1	LCDCOM
   172                        		RMB2	LCDCOM
   173                                ENDM
   174                        LCD_3COM	MACRO
   175                        		RMB0	LCDCOM
   176                        		SMB1	LCDCOM
   177                        		RMB2	LCDCOM
   178                                ENDM
   179                        LCD_4COM	MACRO
   180                        		SMB0	LCDCOM
   181                        		SMB1	LCDCOM
   182                        		RMB2	LCDCOM
   183                                ENDM
   184                        LCD_5COM	MACRO
   185                        		RMB0	LCDCOM
   186                        		RMB1	LCDCOM
   187                        		SMB2	LCDCOM
   188                                ENDM
   189                        LCD_6COM	MACRO
   190                        		SMB0	LCDCOM
   191                        		RMB1	LCDCOM
   192                        		SMB2	LCDCOM
   193                                ENDM
   194                        LCD_7COM	MACRO
   195                        		RMB0	LCDCOM
   196                        		SMB1	LCDCOM
   197                        		SMB2	LCDCOM
   198                                ENDM
   199                        LCD_8COM	MACRO
   200                        		SMB0	LCDCOM
   201                        		SMB1	LCDCOM
   202                        		SMB2	LCDCOM
   203                                ENDM
   204                        
   205                        LCD_ENCH_EN		MACRO
   206                        		SMB6	LCDCOM
   207                                ENDM
   208                        LCD_ENCH_DIS	MACRO
   209                        		RMB6	LCDCOM
   210                                ENDM
   211                        
   212                        LCD_C_TYPE	MACRO
   213                        		SMB7	LCDCOM
   214                        		SMB0	PCSEG
   215                        		SMB1	PCSEG
   216                        		SMB2	PCSEG
   217                        		SMB3	PCSEG
   218                                ENDM
   219                        LCD_DRIVE_2	MACRO
   220                        		SMB0	LCDCTRL
   221                        		RMB1	LCDCTRL
   222                                ENDM
   223                        LCD_DRIVE_4	MACRO
   224                        		RMB0	LCDCTRL
   225                        		SMB1	LCDCTRL
   226                                ENDM
   227                        LCD_DRIVE_8	MACRO
   228                        		SMB0	LCDCTRL
   229                        		SMB1	LCDCTRL
   230                                ENDM
   231                        LCD_DRIVE_FULL	MACRO
   232                        		RMB0	LCDCTRL
   233                        		RMB1	LCDCTRL
   234                                ENDM
   235                        LCD_C_1_2_BAIS_3V	MACRO
   236                        		RMB2	LCDCTRL
   237                        		RMB3	LCDCTRL
   238                                ENDM
   239                        LCD_C_1_3_BAIS_3V	MACRO
   240                        		SMB2	LCDCTRL
   241                        		RMB3	LCDCTRL
   242                                ENDM
   243                        LCD_C_1_3_BAIS_4V	MACRO
   244                        		SMB2	LCDCTRL
   245                        		SMB3	LCDCTRL
   246                                ENDM
   247                        
   248                        LCD_R_TYPE	MACRO
   249                        		RMB7	LCDCOM
   250                                ENDM
   251                        LCD_R_1_2_BAIS	MACRO
   252                        		SMB2	LCDCTRL
   253                        		SMB3	LCDCTRL
   254                                ENDM
   255                        LCD_R_1_3_BAIS	MACRO
   256                        		RMB2	LCDCTRL
   257                        		RMB3	LCDCTRL
   258                                ENDM
   259                        LCD_R_1_4_BAIS	MACRO
   260                        		SMB2	LCDCTRL
   261                        		RMB3	LCDCTRL
   262                                ENDM
   263                        ;------------------------------------
   264                        Fext_WEAK       MACRO
   265                                RMB0    SYSCLK
   266                                ENDM
   267                        Fext_STRONG     MACRO
   268                                SMB0    SYSCLK
   269                                ENDM
   270                        
   271                        Fext_OFF        MACRO
   272                                RMB1    SYSCLK
   273                                ENDM
   274                        Fext_ON         MACRO
   275                                SMB1    SYSCLK
   276                                ENDM
   277                        
   278                        Fosc_OFF        MACRO
   279                                RMB2    SYSCLK
   280                                ENDM
   281                        Fosc_ON         MACRO
   282                                SMB2    SYSCLK
   283                                ENDM
   284                        
   285                        Fext_Xtal       MACRO
   286                                RMB3    SYSCLK
   287                                ENDM
   288                        Fext_RC         MACRO
   289                                SMB3    SYSCLK
   290                                ENDM
   291                        
   292                        Fsys_4MHZ MACRO
   293                                RMB4    SYSCLK
   294                                RMB5    SYSCLK
   295                                ENDM
   296                        Fsys_2MHZ MACRO
   297                                SMB4    SYSCLK
   298                                RMB5    SYSCLK
   299                                ENDM
   300                        Fsys_1MHZ MACRO
   301                                RMB4    SYSCLK
   302                                SMB5    SYSCLK
   303                                ENDM
   304                        Fsys_500K MACRO
   305                                SMB4    SYSCLK
   306                                SMB5    SYSCLK
   307                                ENDM
   308                        
   309                        Fsub_Fext MACRO
   310                                SMB6    SYSCLK
   311                                ENDM
   312                        Fsub_32KCLK     MACRO
   313                                RMB6    SYSCLK
   314                                ENDM
   315                        
   316                        Fcpu_Fext  MACRO
   317                                SMB7    SYSCLK
   318                                ENDM
   319                        Fcpu_Fsys  MACRO
   320                                RMB7    SYSCLK
   321                                ENDM
   322                        
   323                        ;------------------------------------
   324                        DIV_8KHZ  MACRO
   325                                RMB0    DIVC
   326                                RMB1    DIVC
   327                        		RMB5	DIVC
   328                                ENDM
   329                        DIV_16KHZ  MACRO
   330                                SMB0    DIVC
   331                                RMB1    DIVC
   332                        		RMB5	DIVC
   333                                ENDM
   334                        DIV_512HZ  MACRO
   335                                RMB0    DIVC
   336                                SMB1    DIVC
   337                        		RMB5	DIVC
   338                                ENDM
   339                        DIV_1KHZ  MACRO
   340                                SMB0    DIVC
   341                                SMB1    DIVC
   342                        		RMB5	DIVC
   343                                ENDM
   344                        DIV_256HZ  MACRO
   345                        		SMB5	DIVC
   346                                ENDM
   347                        ;------------------------------------
   348                        WDTC_CLK_256HZ   MACRO
   349                                RMB0    WDTC
   350                                RMB1    WDTC
   351                                ENDM
   352                        WDTC_CLK_DIV     MACRO
   353                                SMB0    WDTC
   354                                RMB1    WDTC
   355                                ENDM
   356                        WDTC_CLK_TMR1   MACRO
   357                                RMB0    WDTC
   358                                SMB1    WDTC
   359                                ENDM
   360                        WDTC_CLK_LCDS    MACRO
   361                                SMB0    WDTC
   362                                SMB1    WDTC
   363                                ENDM
   364                        
   365                        WDTC_CLR MACRO
   366                                RMB2    WDTC
   367                                ENDM
   368                        
   369                        WDTC_ON  MACRO
   370                                SMB3    WDTC
   371                                ENDM
   372                        WDTC_OFF MACRO
   373                                RMB3    WDTC
   374                                ENDM
   375                        
   376                        IF_WDTC MACRO   LAB
   377                                BBS4    WDTC,LAB
   378                                ENDM
   379                        
   380                        ;------------------------------------
   381                        TMR0_ON MACRO
   382                                SMB0    TMRC
   383                                ENDM
   384                        TMR0_OFF MACRO
   385                                RMB0    TMRC
   386                                ENDM
   387                        TMR0_CLK_FOSC   MACRO
   388                                SMB0    TMCLK
   389                                RMB1    TMCLK
   390                                ENDM
   391                        TMR0_CLK_FSUB    MACRO
   392                                RMB0    TMCLK
   393                                RMB1    TMCLK
   394                                RMB0	PADF1
   395                                ENDM
   396                        TMR0_CLK_128K	macro
   397                        		RMB0    TMCLK
   398                                SMB1    TMCLK
   399                                ENDM
   400                        TMR0_CLK_32K	macro
   401                        		RMB0    TMCLK
   402                                RMB1    TMCLK
   403                                SMB0	PADF1
   404                                ENDM
   405                        TMR0_CLK_1M   MACRO
   406                                SMB0    TMCLK
   407                                SMB1    TMCLK
   408                                RMB6	TMRC
   409                                ENDM
   410                        
   411                        TMR1_ON MACRO
   412                                SMB1    TMRC
   413                                ENDM
   414                        TMR1_OFF MACRO
   415                                RMB1    TMRC
   416                                ENDM
   417                        TMR1_CLK_TMR0   MACRO
   418                                RMB2    TMCLK
   419                                RMB3    TMCLK
   420                                ENDM
   421                        TMR1_CLK_512Hz    MACRO
   422                                SMB2    TMCLK
   423                                RMB3    TMCLK
   424                                ENDM
   425                        TMR1_CLK_128K	macro
   426                        		RMB2    TMCLK
   427                                SMB3    TMCLK
   428                                ENDM
   429                        TMR1_CLK_1M		macro
   430                        		SMB2    TMCLK
   431                                SMB3    TMCLK
   432                                ENDM
   433                        
   434                        TMR2_ON MACRO
   435                                SMB2    TMRC
   436                                ENDM
   437                        TMR2_OFF MACRO
   438                                RMB2    TMRC
   439                                ENDM
   440                        ;TMR2_CLK_1KDIV2    MACRO
   441                        ;       RMB4    TMCLK
   442                        ;        RMB5    TMCLK
   443                        ;        ENDM
   444                        ;TMR2_CLK_1KDIV3    MACRO
   445                        ;        SMB4    TMCLK
   446                        ;        RMB5    TMCLK
   447                        ;        ENDM
   448                        ;TMR2_CLK_FOSCDIV8  MACRO
   449                        ;        RMB4    TMCLK
   450                        ;        SMB5    TMCLK
   451                        ;        ENDM
   452                        ;TMR2_CLK_FSUB      MACRO
   453                        ;        SMB4    TMCLK
   454                        ;        SMB5    TMCLK
   455                        ;        ENDM
   456                        
   457                        
   458                        TONE_2KHZ       MACRO
   459                                RMB2    DIVC
   460                                RMB3    DIVC
   461                                ENDM
   462                        TONE_TMR0_2     MACRO
   463                                SMB2    DIVC
   464                                RMB3    DIVC
   465                                ENDM
   466                        TONE_L       MACRO
   467                                RMB2    DIVC
   468                                SMB3    DIVC
   469                                ENDM
   470                        TONE_H       MACRO
   471                                SMB2    DIVC
   472                                SMB3    DIVC
   473                                ENDM
   474                        ;------------------------------------
   475                        EN_DIV_IRQ     MACRO
   476                                SMB0    IER
   477                                ENDM
   478                        EN_TMR0_IRQ     MACRO
   479                                SMB1    IER
   480                                ENDM
   481                        EN_TMR1_IRQ     MACRO
   482                                SMB2    IER
   483                                ENDM
   484                        EN_TMR2_IRQ     MACRO
   485                                SMB3    IER
   486                                ENDM
   487                        EN_KEY_IRQ      MACRO
   488                                SMB4    IER
   489                                ENDM
   490                        EN_PA_IRQ      MACRO
   491                                SMB4    IER
   492                                ENDM
   493                        EN_EXT_IRQ      MACRO
   494                                SMB5    IER
   495                                ENDM
   496                        EN_LCD_IRQ      MACRO
   497                                SMB6    IER
   498                                ENDM
   499                        
   500                        DIS_DIV_IRQ     MACRO
   501                                RMB0    IER
   502                                ENDM
   503                        DIS_TMR0_IRQ     MACRO
   504                                RMB1    IER
   505                                ENDM
   506                        DIS_TMR1_IRQ     MACRO
   507                                RMB2    IER
   508                                ENDM
   509                        DIS_TMR2_IRQ     MACRO
   510                                RMB3    IER
   511                                ENDM
   512                        DIS_KEY_IRQ      MACRO
   513                                RMB4    IER
   514                                ENDM
   515                        DIS_PA_IRQ		 MACRO
   516                                RMB4    IER
   517                                ENDM
   518                        DIS_EXT_IRQ      MACRO
   519                                RMB5    IER
   520                                ENDM
   521                        DIS_LCD_IRQ      MACRO
   522                                RMB6    IER
   523                                ENDM
   524                        
   525                        CLR_DIV_IRQ_FLAG MACRO
   526                                RMB0    IFR
   527                                ENDM
   528                        CLR_TMR0_IRQ_FLAG      MACRO
   529                                RMB1    IFR
   530                                ENDM
   531                        CLR_TMR1_IRQ_FLAG      MACRO
   532                                RMB2    IFR
   533                                ENDM
   534                        CLR_TMR2_IRQ_FLAG      MACRO
   535                                RMB3    IFR
   536                                ENDM
   537                        CLR_KEY_IRQ_FLAG      MACRO
   538                                RMB4    IFR
   539                                ENDM
   540                        CLR_PA_IRQ_FLAG      MACRO
   541                                RMB4    IFR
   542                                ENDM
   543                        CLR_PA_IRQF      MACRO
   544                                RMB4    IFR
   545                                ENDM
   546                        CLR_EXT_IRQ_FLAG       MACRO
   547                                RMB5    IFR
   548                                ENDM
   549                        CLR_LCD_IRQ_FLAG       MACRO
   550                                RMB6    IFR
   551                                ENDM
   552                        
   553                        IF_DIV_IRQ_FLAG MACRO   LAB1
   554                                BBS0    IFR,LAB1
   555                                ENDM
   556                        IF_TMR0_IRQ_FLAG MACRO   LAB1
   557                                BBS1    IFR,LAB1
   558                                ENDM
   559                        IF_TMR1_IRQ_FLAG MACRO   LAB1
   560                                BBS2    IFR,LAB1
   561                                ENDM
   562                        IF_TMR2_IRQ_FLAG MACRO   LAB1
   563                                BBS3    IFR,LAB1
   564                                ENDM
   565                        IF_KEY_IRQ_FLAG MACRO   LAB1
   566                                BBS4    IFR,LAB1
   567                                ENDM
   568                        IF_EXT_IRQ_FLAG MACRO   LAB1
   569                                BBS5    IFR,LAB1
   570                                ENDM
   571                        IF_LCD_IRQ_FLAG MACRO   LAB1
   572                                BBS6    IFR,LAB1
   573                                ENDM
   574                        ;------------------------------------
   575                        LCD_ON           MACRO
   576                                SMB4    TMRC
   577                                ENDM
   578                        LCD_OFF          MACRO
   579                                RMB4    TMRC
   580                                ENDM
   581                        
   582                        PWM_ON  MACRO
   583                        		SMB0	SYSCLK	;Strong Mode
   584                                SMB7    TMRC
   585                                ENDM
   586                        PWM_OFF MACRO
   587                                RMB7    TMRC
   588                        ;		lda		R_Strong_2S
   589                        ;		bne		?Skip
   590                        		RMB0	SYSCLK	;WeakMode
   591                        ?Skip:
   592                                ENDM
   593                        ;DAC_ON		MACRO
   594                        ;	SMB7	P_TMRCTRL
   595                        ;	ENDM
   596                        ;DAC_OFF		MACRO
   597                        ;	RMB7	P_TMRCTRL
   598                        ;	ENDM
   599                        
   600                        IF_PWM_ON       MACRO   LAB
   601                                BBS7    TMRC,LAB
   602                                ENDM
   603                        IF_PWM_OFF      MACRO   LAB
   604                                BBR7    TMRC,LAB
   605                                ENDM
   606                        
   607                        SEL_PWM MACRO
   608                                SMB1    AUDCR
   609                                ENDM
   610                        DAC_LATCH_TMR0	MACRO
   611                        		SMB5	AUDCR
   612                        		ENDM
   613                        SEL_TONE MACRO
   614                                RMB2    AUDCR
   615                                RMB4    AUDCR
   616                                RMB5    AUDCR
   617                                ENDM
   618                        
   619                        SEL_MELODY  MACRO
   620                                RMB2    AUDCR
   621                                SMB4    AUDCR
   622                        ;        SMB5    AUDCR
   623                                RMB5    AUDCR
   624                                ENDM
   625                        SEL_VOICE   MACRO
   626                                SMB2    AUDCR
   627                                RMB4    AUDCR
   628                                SMB5    AUDCR
   629                                ENDM
   630                        ;------------------------------------
   631                        ClrAllRam MACRO
   632                            LDA		#$00
   633                        	LDX		#$FF
   634                        	STA		$1800
   635                        ?ClrAllRamLoop:
   636                        	STA		$1800,X
   637                        	DEX
   638                        	BNE		?ClrAllRamLoop
   639                            ENDM
   640                        ;------------------------------------
   641                        CHECK_LCD	MACRO
   642                        	LDA		#11111110B
   643                        	STA		P_PC_DIR		;PC0 is Output
   644                        	LDA		#11111110B
   645                        	STA		P_PC			;PC0 Output "0"
   646                        	NOP
   647                        	NOP
   648                        	NOP
   649                        	LDA		P_PC
   650                        	AND		#00000010B
   651                        ?_Loop
   652                        	STA		P_Temp+1
   653                        	LDA		#$0F
   654                        ?_LoopPort
   655                        	DEC
   656                        	BNE		?_LoopPort
   657                        	LDA		P_PC
   658                        	AND		#00000010B
   659                        	STA		P_Temp
   660                        	CMP		P_Temp+1
   661                        	BNE		?_Loop
   662                        	BBS1	P_Temp,?LCD_R_Type
   663                        ?LCD_C_Type:
   664                        	LCD_C_TYPE
   665                        	LCD_ENCH_EN
   666                        	LCD_4COM
   667                        	LCD_DRIVE_8
   668                        	LCD_C_1_3_BAIS_3V
   669                        	JMP		?Exit
   670                        ?LCD_R_Type:
   671                        	LCD_R_TYPE
   672                        ;	LCD_ENCH_EN
   673                        	LCD_4COM
   674                        ;	LCD_DRIVE_8
   675                        	LCD_R_1_3_BAIS
   676                        
   677                        ?Exit:
   678                        	LDA		#$00
   679                        	STA		P_PC_IO
   680                        	STA		P_PC
   681                        ;	STA		P_PC_IO_Backup
   682                        ;	STA		P_PC_Backup
   683                        	ENDM
   684                        ;------------------------------------
   685                        ;------------------------------------
   685                        
    23                        	.INCLUDE	MACRO.MAC
     1                        ;***********************************************************************
     2                        BRA_IDX MACRO	MEM
     3                        	if	MEM<$100
     4                        	BRA	($80+MEM)
     5                        	else
     6                        	BRA	(MEM)
     7                        	endif
     8                        	ENDM
     9                        
    10                        LDLN	MACRO	mem
    11                        	if	mem<$100
    12                        	LDA	$780+mem
    13                        	else
    14                        	LDA	$700+mem
    15                        	endif
    16                        	ENDM
    17                        
    18                        LDHN	MACRO	mem
    19                        	if	mem<$100
    20                        	LDA	$F80+mem
    21                        	else
    22                        	LDA	$F00+mem
    23                        	endif
    24                        	ENDM
    25                        
    26                        STLN	MACRO	mem
    27                        	if	mem<$100
    28                        	STA	$780+mem
    29                        	else
    30                        	STA	$700+mem
    31                        	endif
    32                        	ENDM
    33                        
    34                        STHN	MACRO	mem
    35                        	if	mem<$100
    36                        	STA	$F80+mem
    37                        	else
    38                        	STA	$F00+mem
    39                        	endif
    40                        	ENDM
    41                        
    42                        LXLN	MACRO	mem
    43                        	if	mem<$100
    44                        	LDX	$780+mem
    45                        	else
    46                        	LDX	$700+mem
    47                        	endif
    48                        	ENDM
    49                        
    50                        LXHN	MACRO	mem
    51                        	if	mem<$100
    52                        	LDX	$F80+mem
    53                        	else
    54                        	LDX	$F00+mem
    55                        	endif
    56                        	ENDM
    57                        
    58                        SXLN	MACRO	mem
    59                        	if	mem<$100
    60                        	STX	$780+mem
    61                        	else
    62                        	STX	$700+mem
    63                        	endif
    64                        	ENDM
    65                        
    66                        SXHN	MACRO	mem
    67                        	if	mem<$100
    68                        	STX	$F80+mem
    69                        	else
    70                        	STX	$F00+mem
    71                        	endif
    72                        	ENDM
    73                        
    74                        LDLN_X	MACRO	mem
    75                        	if	mem<$100
    76                        	LDA	$780+mem,X
    77                        	else
    78                        	LDA	$700+mem,X
    79                        	endif
    80                        	ENDM
    81                        
    82                        STLN_X	MACRO	mem
    83                        	if	mem<$100
    84                        	STA	$780+mem,X
    85                        	else
    86                        	STA	$700+mem,X
    87                        	endif
    88                        	ENDM
    89                        
    90                        LDHN_X	MACRO	mem
    91                        	if	mem<$100
    92                        	LDA	$F80+mem,X
    93                        	else
    94                        	LDA	$F00+mem,X
    95                        	endif
    96                        	ENDM
    97                        
    98                        STHN_X	MACRO	mem
    99                        	if	mem<$100
   100                        	STA	$F80+mem,X
   101                        	else
   102                        	STA	$F00+mem,X
   103                        	endif
   104                        	ENDM
   105                        
   106                        INCHN_X	MACRO	mem
   107                        	if	mem<$100
   108                        	INC	$F80+mem,X
   109                        	else
   110                        	INC	$F00+mem,X
   111                        	endif
   112                        	ENDM
   113                        
   114                        DECHN_X	MACRO	mem
   115                        	if	mem<$100
   116                        	DEC	$F80+mem,X
   117                        	else
   118                        	DEC	$F00+mem,X
   119                        	endif
   120                        	ENDM
   121                        
   122                        ADCLN	MACRO	mem
   123                        	if	mem<$100
   124                        	ADC	$780+mem
   125                        	else
   126                        	ADC	$700+mem
   127                        	endif
   128                        	ENDM
   129                        
   130                        ADCHN	MACRO	mem
   131                        	if	mem<$100
   132                        	ADC	$F80+mem
   133                        	else
   134                        	ADC	$F00+mem
   135                        	endif
   136                        	ENDM
   137                        
   138                        CMPLN	MACRO	mem
   139                        	if	mem<$100
   140                        	CMP	$780+mem
   141                        	else
   142                        	CMP	$700+mem
   143                        	endif
   144                        	ENDM
   145                        
   146                        CMPHN	MACRO	mem
   147                        	if	mem<$100
   148                        	CMP	$F80+mem
   149                        	else
   150                        	CMP	$F00+mem
   151                        	endif
   152                        	ENDM
   153                        
   154                        INCLN	MACRO	mem
   155                        	if	mem<$100
   156                        	INC	$780+mem
   157                        	else
   158                        	INC	$700+mem
   159                        	endif
   160                        	ENDM
   161                        
   162                        INCHN	MACRO	mem
   163                        	if	mem<$100
   164                        	INC	$F80+mem
   165                        	else
   166                        	INC	$F00+mem
   167                        	endif
   168                        	ENDM
   169                        
   170                        DECLN	MACRO	mem
   171                        	if	mem<$100
   172                        	DEC	$780+mem
   173                        	else
   174                        	DEC	$700+mem
   175                        	endif
   176                        	ENDM
   177                        
   178                        DECHN	MACRO	mem
   179                        	if	mem<$100
   180                        	DEC	$F80+mem
   181                        	else
   182                        	DEC	$F00+mem
   183                        	endif
   184                        	ENDM
   185                        
   186                        LDA_X	MACRO	mem
   187                        	if	mem<$100
   188                        	LDA	$80+mem,X
   189                        	else
   190                        	LDA	mem,X
   191                        	endif
   192                        	ENDM
   193                        
   194                        STA_X	MACRO	mem
   195                        	if	mem<$100
   196                        	STA	$80+mem,X
   197                        	else
   198                        	STA	mem,X
   199                        	endif
   200                        	ENDM
   201                        
   202                        STZ_X	MACRO	mem
   203                        	if	mem<$100
   204                        	STZ	$80+mem,X
   205                        	else
   206                        	STZ	mem,X
   207                        	endif
   208                        	ENDM
   209                        
   210                        INC_X	MACRO	mem
   211                        	if	mem<$100
   212                        	INC	$80+mem,X
   213                        	else
   214                        	INC	mem,X
   215                        	endif
   216                        	ENDM
   217                        
   218                        ADC_X	MACRO	mem
   219                        	if	mem<$100
   220                        	ADC	$80+mem,X
   221                        	else
   222                        	ADC	mem,X
   223                        	endif
   224                        	ENDM
   225                        
   226                        SBC_X	MACRO	mem
   227                        	if	mem<$100
   228                        	SBC	$80+mem,X
   229                        	else
   230                        	SBC	mem,X
   231                        	endif
   232                        	ENDM
   233                        
   234                        CMP_X	MACRO	mem
   235                        	if	mem<$100
   236                        	CMP	$80+mem,X
   237                        	else
   238                        	CMP	mem,X
   239                        	endif
   240                        	ENDM
   241                        
   242                        ASLLN	MACRO	mem
   243                        	if	mem<$100
   244                        	ASL	$780+mem
   245                        	else
   246                        	ASL	$700+mem
   247                        	endif
   248                        	ENDM
   249                        
   250                        LSRLN	MACRO	mem
   251                        	if	mem<$100
   252                        	LSR	$780+mem
   253                        	else
   254                        	LSR	$700+mem
   255                        	endif
   256                        	ENDM
   257                        
   258                        ROLLN	MACRO	mem
   259                        	if	mem<$100
   260                        	ROL	$780+mem
   261                        	else
   262                        	ROL	$700+mem
   263                        	endif
   264                        	ENDM
   265                        
   266                        RORLN	MACRO	mem
   267                        	if	mem<$100
   268                        	ROR	$780+mem
   269                        	else
   270                        	ROR	$700+mem
   271                        	endif
   272                        	ENDM
   273                        
   274                        ASLHN	MACRO	mem
   275                        	if	mem<$100
   276                        	ASL	$F80+mem
   277                        	else
   278                        	ASL	$F00+mem
   279                        	endif
   280                        	ENDM
   281                        
   282                        LSRHN	MACRO	mem
   283                        	if	mem<$100
   284                        	LSR	$F80+mem
   285                        	else
   286                        	LSR	$F00+mem
   287                        	endif
   288                        	ENDM
   289                        
   290                        ROLHN	MACRO	mem
   291                        	if	mem<$100
   292                        	ROL	$F80+mem
   293                        	else
   294                        	ROL	$F00+mem
   295                        	endif
   296                        	ENDM
   297                        
   298                        RORHN	MACRO	mem
   299                        	if	mem<$100
   300                        	ROR	$F80+mem
   301                        	else
   302                        	ROR	$F00+mem
   303                        	endif
   304                        	ENDM
   305                        
   306                        
   307                        BR0	MACRO	PARA,VAR,LABLE
   308                        	BBR@<VAR.mod.8> PARA,LABLE
   309                        	ENDM
   310                        
   311                        BR1	MACRO	PARA,VAR,LABLE
   312                        	BBS@<VAR.mod.8>	PARA,LABLE
   313                        	ENDM
   314                        
   315                        xSETB	MACRO	flag,bit
   316                        	SMB@<bit>  flag
   317                        	ENDM
   318                        
   319                        xCLRB	MACRO	flag,bit
   320                        	RMB@<bit>  flag
   321                        	ENDM
   321                        
    24                        	.INCLUDE	Calculator\Calculator_MAC.asm
     1                        .MACRO	LJNZ Addr
     2                        	.local _add
     3                        	BEQ		_add
     4                        	JMP		Addr
     5                        	_add:
     6                        .ENDMACRO
     7                        ;===============================================================.
     8                        .MACRO	JNZ Addr									;ZΪ0��ת
     9                        	BNE		Addr
    10                        .ENDMACRO
    11                        ;================================================================
    12                        .MACRO	LJZ	Addr
    13                        	.local _add
    14                        	BNE		_add
    15                        	JMP		Addr
    16                        	_add:
    17                        .ENDMACRO
    18                        ;=================================================================
    19                        .MACRO	JE	Ram,Val,Addr,R
    20                        	.if(.blank(R))
    21                        	LDA		Ram
    22                        	CMP		#Val
    23                        	BEQ		Addr
    24                        	.else
    25                        	LDA		Ram
    26                        	CMP		Val
    27                        	BEQ		Addr
    28                        	.endif
    29                        .ENDMACRO
    30                        .MACRO	LJE	Ram,Val,Addr,R
    31                        	.local	_add
    32                        	.if(.blank(R))
    33                        	LDA		Ram
    34                        	CMP		#Val
    35                        	BNE		_add
    36                        	JMP		Addr
    37                        	.else
    38                        	LDA		Ram
    39                        	CMP		Val
    40                        	BNE		_add
    41                        	JMP		Addr
    42                        	.endif
    43                        	_add:
    44                        .ENDMACRO
    45                        ;=========================================================
    46                        .MACRO	JNC	Addr									;CΪ0��ת
    47                        	BCC		Addr
    48                        .ENDMACRO
    48                        
    25                        ;***************************************
    26                        STACK_BOT		EQU		FFH                     ;堆栈底部
    27                        ;***************************************
    28                        	.PROG										;程序开始
    29                        V_RESET:
    30 00:C000: 1A            	NOP
    31 00:C001: 1A            	NOP
    32 00:C002: 1A            	NOP
    33 00:C003: 5E FF         	LDX		#STACK_BOT
    34 00:C005: 1E            	TXS	      ;使用这个值初始化堆栈指针，这通常是为了设置堆栈的底部地址，确保程序运行中堆栈的正确使用。
    35 00:C006: 53 B7         	LDA		#$B7	;#$07
    36 00:C008: 7F 1D         	STA		SYSCLK	;设置系统时钟
    37 00:C00A: 73 3E         	LDA		FUSE
    38 00:C00C: 7F 2F         	STA		MF	;精准主频3.64M
    39                        ;***************************************
    40                        	ClrAllRam	;清空ram
+   40 00:C00E: 53 00          LDA #$0000
+   40 00:C010: 5E FF          LDX #$00FF
+   40 00:C012: 4F 00 18       STA $1800
+   40                        ?ClrAllRamLoop:
+   40 00:C015: 6F 00 18       STA $1800,X
+   40 00:C018: 0F             DEX
+   40 00:C019: 12 FA          BNE ?ClrAllRamLoop
    41                        	WDTC_CLR
+   41 00:C01B: 22 1C          RMB2 WDTC
    42                        	;CHECK_LCD   ;初始化LCD
    43                        ;***************************************定时器初始化，特殊功能寄存器初始化
    44 00:C01D: 53 00         	LDA		#0
    45 00:C01F: 7F 0D         	STA		PADF1  ;定时器0的时钟源选择
    46 00:C021: 7F 10         	STA		TMR0   ;128HZ
    47 00:C023: 7F 12         	STA		TMR1   ;512
    48 00:C025: 7F 14         	STA		TMR2	;定时器的开始数
    49 00:C027: 7F 18         	STA		DIVC    ;分频控制器，定时器与DICV异步   2048
    50 00:C029: 7F 0E         	STA		IER     ;不允许中断
    51 00:C02B: 7F 0F         	STA		IFR     ;中断请求标志
    52 00:C02D: 7F 1F         	STA		AUD0    ;pwm输出值设置
    53 00:C02F: 7F 20         	STA		AUDCR   ;
    54 00:C031: 7F 05         	STA		PB
    55                        ;***************************************LCD初始化
    56                        	LCD_C_TYPE
+   56 00:C033: 2F 1A          SMB7 LCDCOM
+   56 00:C035: 28 09          SMB0 PCSEG
+   56 00:C037: 29 09          SMB1 PCSEG
+   56 00:C039: 2A 09          SMB2 PCSEG
+   56 00:C03B: 2B 09          SMB3 PCSEG
    57                        	LCD_ENCH_EN
+   57 00:C03D: 2E 1A          SMB6 LCDCOM
    58                        	;LCD_4COM
    59                        	LCD_DRIVE_8
+   59 00:C03F: 28 19          SMB0 LCDCTRL
+   59 00:C041: 29 19          SMB1 LCDCTRL
    60 00:C043: 22 19         	RMB2	LCDCTRL
    61 00:C045: 2B 19         	SMB3	LCDCTRL
    62 00:C047: 20 1A         	RMB0	P_LCD_COM
    63 00:C049: 29 1A         	SMB1	P_LCD_COM;设置为5com
    64 00:C04B: 25 1A         	RMB5	P_LCD_COM;设置LCD中断频率为32Hz
    65                        ;***************************************端口配置（等待图纸）
    66 00:C04D: 15 F9 C0      	JSR		L_Scankey_INIT
    67 00:C050: 28 1D         	SMB0	P_SYSCLK
    68                        	PB2_PB2_NOMS
+   68 00:C052: 20 0C          RMB0 PADF0
+   68 00:C054: 22 06          RMB2 PBTYPE
    69                        	PB3_PB3_NOMS
+   69 00:C056: 21 0C          RMB1 PADF0
+   69 00:C058: 23 06          RMB3 PBTYPE
    70 00:C05A: 53 00         	LDA		#0
    71 00:C05C: 7F 09         	STA		PCSEG
    72                        	PD03_SEG
+   72 00:C05E: 2E 09          SMB6 PCSEG
    73                        	PD47_SEG;
+   73 00:C060: 2F 09          SMB7 PCSEG
    74 00:C062: 15 D1 C0      	JSR		L_Init_SystemRam_Prog   ;初始化系统RAM并禁用所有断电保留的RAM
    75 00:C065: 15 E8 C0      	JSR		L_Dis_All_DisRam_Prog	;初始化系统RAM并禁用所有断电保留的RAM
    76                        ;***************************************开启中断
    77                        	; SMB0	DIVC
    78                        	; SMB1	DIVC
    79                        	; RMB2	DIVC
    80                        	TMR1_CLK_512Hz;初始化定时器1为256hz,定时器2为512hz
+   80 00:C068: 2A 17          SMB2 TMCLK
+   80 00:C06A: 23 17          RMB3 TMCLK
    81 00:C06C: 53 AE         	LDA		#174
    82 00:C06E: 7F 14         	STA		TMR2
    83                        	LCD_ON
+   83 00:C070: 2C 16          SMB4 TMRC
    84                        	TMR1_ON;半秒计时
+   84 00:C072: 29 16          SMB1 TMRC
    85                        	EN_TMR1_IRQ              ;定时器和LCD使能
+   85 00:C074: 2A 0E          SMB2 IER
    86                        	EN_PA_IRQ;下降沿触发
+   86 00:C076: 2C 0E          SMB4 IER
    87 00:C078: 53 07         	LDA		#$07		;#$07    系统时钟和中断使能
    88 00:C07A: 7F 1D         	STA		SYSCLK		;Strong
    89 00:C07C: 05            	CLI
    90                        
    91                        ;***********************************************************************
    92                        ;***********************************************************************
    93                        MainLoop:
    94 00:C07D: 15 41 C1      	JSR		L_LCD_IRQ_WorkProg
    95 00:C080: 15 80 DB      	JSR		L_Half_Second_Prog
    96 00:C083: 43 95 18      	LDA		R_Voice_Unit
    97 00:C086: 12 F5         	BNE		MainLoop
    98                        
    99 00:C088: 2C 1D         	SMB4	SYSCLK;280k
   100 00:C08A: 7F 1E         	STA		P_HALT
   101 00:C08C: 24 1D         	RMB4	SYSCLK;560k
   102 00:C08E: 17 ED         	BRA		MainLoop
   103                        
   104                        ;***********************************************************************
   105                        ;***********************************************************************
   106                        V_IRQ:
   107 00:C090: 0A            	PHA
   108 00:C091: 73 0E         	LDA		P_IER
   109 00:C093: 71 0F         	AND		P_IFR
   110 00:C095: 7F 9E         	STA		R_Int_Backup
   111                        
   112 00:C097: 3E 9E 31      	BBS6	R_Int_Backup,L_LcdIrq
   113 00:C09A: 3B 9E 12      	BBS3	R_Int_Backup,L_Timer2Irq
   114 00:C09D: 3C 9E 21      	BBS4	R_Int_Backup,L_PaIrp
   115 00:C0A0: 38 9E 08      	BBS0	R_Int_Backup,L_DivIrq
   116 00:C0A3: 3A 9E 13      	BBS2	R_Int_Backup,L_Timer1Irq
   117 00:C0A6: 39 9E 0C      	BBS1	R_Int_Backup,L_Timer0Irq
   118 00:C0A9: 17 24         	BRA		L_EndIrq
   119                        
   120                        L_DivIrq:
   121                        	CLR_DIV_IRQ_FLAG
+  121 00:C0AB: 20 0F          RMB0 IFR
   122 00:C0AD: 17 20         	BRA		L_EndIrq
   123                        
   124                        L_Timer2Irq:
   125                        	CLR_TMR2_IRQ_FLAG
+  125 00:C0AF: 23 0F          RMB3 IFR
   126                        	WDTC_CLR
+  126 00:C0B1: 22 1C          RMB2 WDTC
   127 00:C0B3: 17 1A         	BRA		L_EndIrq
   128                        
   129                        L_Timer0Irq:
   130                        	CLR_TMR0_IRQ_FLAG
+  130 00:C0B5: 21 0F          RMB1 IFR
   131 00:C0B7: 17 16         	BRA		L_EndIrq
   132                        
   133                        L_Timer1Irq:
   134                        	CLR_TMR1_IRQ_FLAG
+  134 00:C0B9: 22 0F          RMB2 IFR
   135                        	WDTC_CLR
+  135 00:C0BB: 22 1C          RMB2 WDTC
   136 00:C0BD: 28 A0         	SMB0	Sys_Flag_B	;设置Half Second Flag
   137 00:C0BF: 17 0E         	BRA		L_EndIrq
   138                        
   139                        L_PaIrp:
   140                        	CLR_KEY_IRQ_FLAG
+  140 00:C0C1: 24 0F          RMB4 IFR
   141                        	EN_LCD_IRQ
+  141 00:C0C3: 2E 0E          SMB6 IER
   142                        	DIS_PA_IRQ
+  142 00:C0C5: 24 0E          RMB4 IER
   143 00:C0C7: 29 9F         	SMB1	Sys_Flag_A
   144 00:C0C9: 17 04         	BRA		L_EndIrq
   145                        L_LcdIrq:
   146                        	CLR_LCD_IRQ_FLAG
+  146 00:C0CB: 26 0F          RMB6 IFR
   147 00:C0CD: 28 9F         	SMB0	Sys_Flag_A	;设置LCD中断标志，32Hz扫描
   148                        L_EndIrq:
   149                        ;	BBS3	IFR,L_Timer2Irq
   150 00:C0CF: 0C            	PLA
   151 00:C0D0: 08            	RTI
   152                        ;***********************************************************************
   153                        .INCLUDE	Init.asm
     1                        ;------------------------------------------------------
     2                        L_Init_SystemRam_Prog:     ;初始化系统RAM的程序数据
     3 00:C0D1: 53 04         	LDA		#4
     4 00:C0D3: 7F A3         	STA		R_Reset_Time
     5 00:C0D5: 53 19         	LDA		#25
     6 00:C0D7: 7F AD         	STA		R_Time_Year
     7 00:C0D9: 53 01         	LDA		#1
     8 00:C0DB: 7F AB         	STA		R_Time_Day
     9 00:C0DD: 7F AC         	STA		R_Time_Month
    10 00:C0DF: 53 04         	LDA		#4
    11 00:C0E1: 4F 91 18      	STA		R_Mode
    12 00:C0E4: 15 F2 DC      	JSR		L_Auto_Counter_Week
    13                        
    14 00:C0E7: 09            	RTS
    15                        ;======================================================
    16                        L_Dis_All_DisRam_Prog:
    17 00:C0E8: 53 FF         	LDA		#$FF
    18                        L_All_DisRam:
    19 00:C0EA: 5E 00         	LDX		#0
    20                        L_Loop_DisplayRam:
    21 00:C0EC: 6F 00 18      	STA		LCD_RamAddr,X
    22 00:C0EF: 0B            	INX
    23 00:C0F0: 57 1E         	CPX		#D_LCD_RAM
    24 00:C0F2: 10 F8         	BCC		L_Loop_DisplayRam    ;C=0是跳转
    25 00:C0F4: 09            	RTS
    26                        ;----------------------------------------------------
    27                        L_Clr_All_DisRam_Prog:
    28 00:C0F5: 53 00         	LDA		#0
    29 00:C0F7: 17 F1         	BRA		L_All_DisRam
    30                        
    31                        L_Scankey_INIT:
    32 00:C0F9: 53 FD         	LDA		#11111101B;
    33 00:C0FB: 7F 04         	STA		P_PA_IO;PA0输出,其余输入
    34 00:C0FD: 53 8D         	LDA		#10001101B
    35 00:C0FF: 7F 01         	STA		P_PA	;其他全部下拉
    36 00:C101: 53 7C         	LDA		#01111100B
    37 00:C103: 7F 02         	STA		P_PA_WAKE;	将PA做唤醒
    38 00:C105: 53 00         	LDA		#0
    39 00:C107: 7F 08         	STA		P_PC_IO
    40 00:C109: 7F 07         	STA		P_PC
    41 00:C10B: 09            	RTS
    42                        
    43                        L_Judgement_Scankey_Prog:
    44                        	; LDA		#11111101B;
    45                        	; STA		P_PA_IO;PA0输出,其余输入
    46 00:C10C: 53 8D         	LDA		#10001101B
    47 00:C10E: 7F 01         	STA		P_PA	;其他全部下拉
    48 00:C110: 53 00         	LDA		#0
    49 00:C112: 7F 07         	STA		P_PC;PC口输出0
    50 00:C114: 09            	RTS
    51                        L_PA_Intput_Low_Prog:
    52 00:C115: 53 FD         	LDA		#11111101B
    53 00:C117: 7F 01         	STA		P_PA
    54 00:C119: 09            	RTS
    55                        L_PC0_Output_High_Prog:
    56 00:C11A: 53 01         	LDA		#01H
    57 00:C11C: 7F 07         	STA		P_PC
    58 00:C11E: 09            	RTS
    59                        L_PC1_Output_High_Prog:
    60 00:C11F: 53 02         	LDA		#02H
    61 00:C121: 7F 07         	STA		P_PC
    62 00:C123: 09            	RTS
    63                        L_PC2_Output_High_Prog:
    64 00:C124: 53 04         	LDA		#04H
    65 00:C126: 7F 07         	STA		P_PC
    66 00:C128: 09            	RTS
    67                        L_PC3_Output_High_Prog:
    68 00:C129: 53 08         	LDA		#08H
    69 00:C12B: 7F 07         	STA		P_PC
    70 00:C12D: 09            	RTS
    71                        
    72                        L_PC4_Output_High_Prog:
    73 00:C12E: 53 10         	LDA		#10H
    74 00:C130: 7F 07         	STA		P_PC
    75 00:C132: 09            	RTS
    76                        
    77                        L_PC5_Output_High_Prog:
    78 00:C133: 53 20         	LDA		#20H
    79 00:C135: 7F 07         	STA		P_PC
    80 00:C137: 09            	RTS
    81                        
    82                        ; L_PA257_Input_Low:
    83                        ; 	LDA		#10101101B
    84                        ; 	STA		P_PA	;其他全部下拉
    85                        ; 	RTS
    86                        ; L_PA257_Input_High:
    87                        ; 	LDA		#00000001B
    88                        ; 	STA		P_PA
    89                        ; 	RTS
    90                        L_Scankey_Effictive_Init:
    91 00:C138: 53 F1         	LDA		#11110001B;
    92 00:C13A: 7F 01         	STA		P_PA
    93 00:C13C: 53 00         	LDA		#0
    94 00:C13E: 7F 07         	STA		P_PC
    95 00:C140: 09            	RTS
    95                        
   154                        
   155                        .INCLUDE	Key\ScanKey.ASM
     1                        ;==================================================
     2                        L_LCD_IRQ_WorkProg:;
     3 00:C141: 30 9F 0F      	BBR0	Sys_Flag_A,L_END_LCD_IRQ_WorkProg;32hz扫键
     4 00:C144: 20 9F         	RMB0	Sys_Flag_A
     5 00:C146: 15 71 DF      	JSR		L_control_Beep_prog
     6 00:C149: 15 0A DE      	JSR		L_Update_Timer_Ms_Prog
     7 00:C14C: 73 A3         	LDA		R_Reset_Time
     8 00:C14E: 12 03         	BNE		L_END_LCD_IRQ_WorkProg
     9 00:C150: 15 7A C1      	JSR		L_Scankey_Prog
    10                        L_END_LCD_IRQ_WorkProg:
    11 00:C153: 09                RTS
    12                        ; ==============================================
    13                        L_ScanKey_Null_Prog:;如果编码器没有开启退出并且扫描到空键，停止按键扫描
    14 00:C154: 43 95 18      	LDA		R_Voice_Unit
    15 00:C157: 12 FA         	BNE		L_END_LCD_IRQ_WorkProg
    16 00:C159: 38 A2 F7      	BBS0	Sys_Flag_D,L_END_LCD_IRQ_WorkProg
    17                        	DIS_LCD_IRQ
+   17 00:C15C: 26 0E          RMB6 IER
    18 00:C15E: 15 0C C1      	JSR		L_Judgement_Scankey_Prog
    19 00:C161: 09            	RTS
    20                        L_Scankey_Prog_Ineffective:
    21                        
    22 00:C162: 15 F5 C4      	JSR		L_Scankey_usually_Prog
    23 00:C165: 73 A7         	LDA		P_Scankey_value_Temporary
    24 00:C167: 12 EA         	BNE		L_END_LCD_IRQ_WorkProg;如果为0则执行空键程序
    25 00:C169: 15 0C C1      	JSR		L_Judgement_Scankey_Prog
    26 00:C16C: 15 F2 DF      	JSR		L_ScanKey_Delay_Prog
    27                        
    28 00:C16F: 25 9F         	RMB5	Sys_Flag_A;清空无效标志位
    29 00:C171: 53 8B         	LDA		#10001011B
    30 00:C173: 71 9F         	AND		Sys_Flag_A
    31 00:C175: 7F 9F         	STA		Sys_Flag_A
    32                        
    33                        	EN_PA_IRQ
+   33 00:C177: 2C 0E          SMB4 IER
    34 00:C179: 09            	RTS
    35                        
    36                        ;====================================================
    37                        L_Scankey_Prog:
    38 00:C17A: 3D 9F E5      	BBS5	Sys_Flag_A,L_Scankey_Prog_Ineffective
    39 00:C17D: 39 9F 07      	BBS1	Sys_Flag_A,L_Scankey_Prog_First_TO;首次扫描判断
    40                        
    41 00:C180: 3E 9F 07      	BBS6	Sys_Flag_A,L_Scankey_Prog_Long_Press;快加情况
    42                        
    43 00:C183: 32 9F CE      	BBR2	Sys_Flag_A,L_ScanKey_Null_Prog;没有按键扫描标志
    44                        
    45 00:C186: 09            	RTS
    46                        
    47                        
    48                        
    49                        L_Scankey_Prog_First_TO:
    50 00:C187: 16 44 C4      	JMP		L_Scankey_Prog_First
    51                        
    52                        L_Scankey_Prog_Long_Press:
    53 00:C18A: 15 F5 C4      	JSR		L_Scankey_usually_Prog
    54 00:C18D: 43 91 18      	LDA		R_Mode
    55 00:C190: 12 11         	BNE		L_Scankey_Prog_Long_Press_Clock_Beep
    56                        L_Scankey_Prog_Long_Press_1:
    57 00:C192: 73 A7         	LDA		P_Scankey_value_Temporary
    58 00:C194: 76 A6         	CMP		P_Scankey_value
    59 00:C196: 13 0A         	BEQ		L_Scankey_Prog_Long_Press_RTS
    60 00:C198: 26 9F         	RMB6	Sys_Flag_A
    61 00:C19A: 2D 9F         	SMB5	Sys_Flag_A
    62 00:C19C: 15 19 CE      	JSR		L_Clr_All_8Bit_Prog
    63 00:C19F: 15 BD CA      	JSR		L_Display_Prog
    64                        L_Scankey_Prog_Long_Press_RTS:
    65 00:C1A2: 09            	RTS
    66                        L_Scankey_Prog_Long_Press_Clock_Beep:
    67 00:C1A3: 56 04         	CMP		#4
    68 00:C1A5: 13 EB         	BEQ		L_Scankey_Prog_Long_Press_1
    69 00:C1A7: 56 02         	CMP		#2
    70 00:C1A9: 12 0E         	BNE		L_Scankey_Prog_Long_Press_Clock_Beep_1
    71 00:C1AB: 73 A7         	LDA		P_Scankey_value_Temporary
    72 00:C1AD: 76 A6         	CMP		P_Scankey_value
    73 00:C1AF: 13 0C         	BEQ		L_Scankey_Prog_Long_Press_Clock_Beep_RTS
    74 00:C1B1: 15 95 DF      	JSR		L_Close_Beep_Prog
    75 00:C1B4: 53 00         	LDA		#0
    76 00:C1B6: 4F 95 18      	STA		R_Voice_Unit
    77                        
    78                        L_Scankey_Prog_Long_Press_Clock_Beep_1:
    79 00:C1B9: 2D 9F         	SMB5	Sys_Flag_A
    80 00:C1BB: 26 9F         	RMB6	Sys_Flag_A
    81                        L_Scankey_Prog_Long_Press_Clock_Beep_RTS:
    82 00:C1BD: 09            	RTS
    83                        L_Control_Beep_Test_Prog:
    84 00:C1BE: 36 9F FC      	BBR6	Sys_Flag_A,L_Scankey_Prog_Long_Press_Clock_Beep_RTS
    85 00:C1C1: 43 91 18      	LDA		R_Mode
    86 00:C1C4: 56 02         	CMP		#2
    87 00:C1C6: 12 F5         	BNE		L_Scankey_Prog_Long_Press_Clock_Beep_RTS
    88 00:C1C8: 53 02         	LDA		#2
    89 00:C1CA: 4F 95 18      	STA		R_Voice_Unit
    90                        	EN_LCD_IRQ
+   90 00:C1CD: 2E 0E          SMB6 IER
    91 00:C1CF: 09            	RTS
    91                        
   156                        .INCLUDE	Key\Scankey_First_Press.asm
     1                        ;======================================================================
     2                        ;非设置模式下吗,任何模式Mode键按下触发，更改显示模式,计算器模式下，非0情况下清零
     3                        ;如果按键则跳转回时间模式
     4                        ;======================================================================
     5                        L_Scankey_Mode_Press_Prog:
     6 00:C1D0: 15 FD DF      	JSR		L_Beep_1s
     7 00:C1D3: 3F 9F 28      	BBS7	Sys_Flag_A,L_Scankey_Mode_Press_Prog_TO_Clock_Mode
     8 00:C1D6: 15 F5 C0      	JSR		L_Clr_All_DisRam_Prog
     9 00:C1D9: 43 91 18      	LDA		R_Mode
    10 00:C1DC: 56 04         	CMP		#4
    11 00:C1DE: 11 12         	BCS		L_Scankey_Mode_Press_Prog_Clr
    12 00:C1E0: 43 91 18      	LDA		R_Mode
    13 00:C1E3: 54 01         	ADC		#1
    14 00:C1E5: 4F 91 18      	STA		R_Mode
    15 00:C1E8: 56 01         	CMP		#1
    16 00:C1EA: 12 03         	BNE		L_Scankey_Mode_Press_Prog_1
    17 00:C1EC: 15 C9 DA      	JSR		L_Clear_Calculator_Prog
    18                        L_Scankey_Mode_Press_Prog_1:
    19 00:C1EF: 16 BD CA      	JMP		L_Display_Prog
    20                        L_Scankey_Mode_Press_Prog_Clr:
    21 00:C1F2: 53 00         	LDA		#0
    22 00:C1F4: 4F 91 18      	STA		R_Mode
    23 00:C1F7: 15 C9 DA      	JSR		L_Clear_Calculator_Prog
    24 00:C1FA: 25 A2         	RMB5	Sys_Flag_D
    25 00:C1FC: 17 F1         	BRA		L_Scankey_Mode_Press_Prog_1
    26                        ;===========================================
    27                        L_Scankey_Mode_Press_Prog_TO_Clock_Mode:;当按下按键后回到时间界面
    28 00:C1FE: 27 9F         	RMB7	Sys_Flag_A
    29 00:C200: 43 91 18      	LDA		R_Mode
    30 00:C203: 13 CB         	BEQ		L_Scankey_Mode_Press_Prog
    31 00:C205: 56 01         	CMP		#1
    32 00:C207: 13 11         	BEQ		L_Scankey_Mode_Press_Prog_Calculator
    33                        L_Scankey_Mode_Press_Prog_TO_Clock_Mode_1:
    34 00:C209: 53 00         	LDA		#0
    35 00:C20B: 4F 91 18      	STA		R_Mode
    36 00:C20E: 15 C9 DA      	JSR		L_Clear_Calculator_Prog
    37 00:C211: 25 A2         	RMB5	Sys_Flag_D
    38 00:C213: 15 F5 C0      	JSR		L_Clr_All_DisRam_Prog
    39 00:C216: 15 BD CA      	JSR		L_Display_Prog
    40 00:C219: 09            	RTS
    41                        L_Scankey_Mode_Press_Prog_Calculator:
    42                        
    43 00:C21A: 43 90 18      	LDA		ERR
    44 00:C21D: 12 0E         	BNE		L_Scankey_Mode_Press_Prog_Calculator_Err
    45 00:C21F: 15 34 CF      	JSR		L_Judge_BUF1_BUF2_IBUF_Prog
    46 00:C222: 13 E5         	BEQ		L_Scankey_Mode_Press_Prog_TO_Clock_Mode_1
    47 00:C224: 2F 9F         	SMB7	Sys_Flag_A
    48 00:C226: 15 C9 DA      	JSR		L_Clear_Calculator_Prog
    49 00:C229: 15 ED D5      	JSR		L_Display_Number_IBUF_Prog
    50 00:C22C: 09            	RTS
    51                        L_Scankey_Mode_Press_Prog_Calculator_Err:
    52 00:C22D: 2F 9F         	SMB7	Sys_Flag_A
    53 00:C22F: 15 CC DA      	JSR		L_Clear_Calculator_Prog_ERR
    54 00:C232: 53 00         	LDA		#0
    55 00:C234: 4F 90 18      	STA		ERR
    56 00:C237: 15 F3 D5      	JSR		L_Display_Number_BUF1_Prog
    57                        
    58 00:C23A: 09            	RTS
    59                        
    59                        
   157                        .INCLUDE	Key\Scankey_First_Set_Mode.asm
     1                        L_Scankey_Set_Mode_First_Press_Prog:
     2 00:C23B: 2D 9F             SMB5    Sys_Flag_A
     3 00:C23D: 73 A6             LDA     P_Scankey_value
     4 00:C23F: 56 16             CMP     #D_Mode_Press
     5 00:C241: 13 25             BEQ     L_Scankey_Set_Mode_Mode_First_Press_Prog
     6 00:C243: 56 15             CMP     #D_Set_Press
     7 00:C245: 13 5C             BEQ     L_Scankey_Set_Mode_Set_Press_First_Press_Prog
     8 00:C247: 15 4E C2          JSR     L_Scankey_Set_Mode_First_Press_Prog_1
     9 00:C24A: 15 99 CA          JSR     L_Display_Set_Mode_Prog
    10 00:C24D: 09                RTS
    11                        
    12                        L_Scankey_Set_Mode_First_Press_Prog_1:
    13 00:C24E: 06                CLD
    14 00:C24F: 04                CLC
    15 00:C250: 43 91 18          LDA     R_Mode
    16 00:C253: 18                ROL
    17 00:C254: 1B                TAX
    18 00:C255: 63 5F C2          LDA     Table_Set_Mode_1+1,X
    19 00:C258: 0A                PHA
    20 00:C259: 63 5E C2          LDA     Table_Set_Mode_1,X
    21 00:C25C: 0A                PHA
    22                        L_Scankey_Set_Mode_First_Press_Prog_RTS:
    23 00:C25D: 09                RTS
    24                        Table_Set_Mode_1:
    25 00:C25E: 30 C6             DW      L_Scankey_Set_Mode_Prog_Clock-1
    26 00:C260: 5C C2             DW      L_Scankey_Set_Mode_First_Press_Prog_RTS-1
    27 00:C262: DE C7             DW      L_Scankey_Set_Mode_Prog_Alarm_Clock-1
    28 00:C264: 4A C7             DW      L_Scankey_Set_Mode_Prog_Another_Time-1
    29 00:C266: 5C C2             DW      L_Scankey_Set_Mode_First_Press_Prog_RTS-1
    30                        ;==========================================
    31                        ;设置模式下，按下mode键更换设置的情况
    32                        L_Scankey_Set_Mode_Mode_First_Press_Prog:
    33 00:C268: 2D 9F             SMB5    Sys_Flag_A
    34 00:C26A: 43 91 18          LDA     R_Mode
    35 00:C26D: 56 01             CMP     #1
    36 00:C26F: 13 24             BEQ     L_Control_Key_Voice_Prog
    37 00:C271: 56 04             CMP     #4
    38 00:C273: 13 15             BEQ     L_Scankey_Set_Mode_Mode_First_Press_Prog_OUT
    39 00:C275: 1B                TAX
    40 00:C276: 63 9E C2          LDA     Table_Set_Mode,X
    41 00:C279: 7F EF             STA     P_Temp
    42 00:C27B: 73 BA             LDA     R_Mode_Set
    43 00:C27D: 76 EF             CMP     P_Temp
    44 00:C27F: 11 0A             BCS     L_Scankey_Set_Mode_Mode_First_Press_Prog_1
    45 00:C281: 73 BA             LDA     R_Mode_Set
    46 00:C283: 54 01             ADC     #1
    47 00:C285: 7F BA             STA     R_Mode_Set
    48 00:C287: 15 99 CA          JSR     L_Display_Set_Mode_Prog
    49                        L_Scankey_Set_Mode_Mode_First_Press_Prog_OUT:
    50 00:C28A: 09                RTS
    51                        
    52                        L_Scankey_Set_Mode_Mode_First_Press_Prog_1:
    53 00:C28B: 53 00             LDA     #0
    54 00:C28D: 7F BA             STA     R_Mode_Set
    55 00:C28F: 15 F5 C0          JSR     L_Clr_All_DisRam_Prog
    56 00:C292: 16 BD CA          JMP     L_Display_Prog
    57                        
    58                        L_Control_Key_Voice_Prog:
    59 00:C295: 3D A1 03          BBS5    Sys_Flag_C,L_Control_Key_Voice_Prog_Close
    60 00:C298: 2D A1             SMB5    Sys_Flag_C
    61 00:C29A: 09                RTS
    62                        L_Control_Key_Voice_Prog_Close:
    63 00:C29B: 25 A1             RMB5    Sys_Flag_C
    64 00:C29D: 09                RTS
    65                        
    66                        Table_Set_Mode:
    67 00:C29E: 0A                DB      10
    68 00:C29F: 00                DB      0
    69 00:C2A0: 03                DB      3
    70 00:C2A1: 03                DB      3
    71 00:C2A2: 00                DB      0
    72                        
    73                        ;============================================
    74                        ;设置模式下按下Set键，退出设置
    75                        ;=============================================
    76                        L_Scankey_Set_Mode_Set_Press_First_Press_Prog:
    77 00:C2A3: 23 9F             RMB3    Sys_Flag_A
    78 00:C2A5: 53 00             LDA     #0
    79 00:C2A7: 7F BA             STA     R_Mode_Set
    80 00:C2A9: 43 91 18          LDA     R_Mode
    81 00:C2AC: 13 0F             BEQ     L_Scankey_Set_Mode_Set_Press_First_Press_Prog_Time
    82 00:C2AE: 56 02             CMP     #2
    83 00:C2B0: 12 04             BNE     L_Scankey_Set_Mode_Set_Press_First_Press_Prog_1
    84 00:C2B2: 53 01             LDA     #1
    85 00:C2B4: 7F B9             STA     R_Alarm_Mode
    86                        L_Scankey_Set_Mode_Set_Press_First_Press_Prog_1
    87 00:C2B6: 15 F5 C0          JSR     L_Clr_All_DisRam_Prog
    88 00:C2B9: 15 BD CA          JSR     L_Display_Prog
    89                        
    90 00:C2BC: 09                RTS
    91                        L_Scankey_Set_Mode_Set_Press_First_Press_Prog_Time:
    92 00:C2BD: 15 CA DC          JSR     L_Check_LeapYear_Prog
    93 00:C2C0: 15 AD DC          JSR     L_Check_MaxDay_Prog
    94 00:C2C3: 76 AB             CMP     R_Time_Day
    95 00:C2C5: 11 07             BCS     L_Scankey_Set_Mode_Set_Press_First_Press_Prog_Time_1
    96 00:C2C7: 15 28 DC          JSR     L_Update_Time_Month_Prog
    97 00:C2CA: 53 01             LDA     #1
    98 00:C2CC: 7F AB             STA     R_Time_Day
    99                        L_Scankey_Set_Mode_Set_Press_First_Press_Prog_Time_1:
   100 00:C2CE: 15 F2 DC          JSR     L_Auto_Counter_Week
   101 00:C2D1: 15 F5 C0          JSR     L_Clr_All_DisRam_Prog
   102 00:C2D4: 15 BD CA          JSR     L_Display_Prog
   103 00:C2D7: 09                RTS
   104                        
   105                        
   106                        
   107                        ;设置模式下的通用函数;(闹钟和第二时间可以使用)
   108                        ;======================================
   109                        ;入口A寄存器存储最大值（16进制），X寄存器存储偏移值
   110                        ;适用于时间的分钟，24小时制是的小时，分钟
   111                        ;P_Temp+4存储最大值,P_Temp+5存储按键读到的值，P_Temp+3读到的被改变的值
   112                        ;P_Temp+6存储读到的被改变的值的高四位
   113                        ;=======================================
   114                        L_Scankey_Input_Set_Mode_Usally:
   115 00:C2D8: 7F F3             STA     P_Temp+4
   116 00:C2DA: 63 28 18          LDA     Time_Addr,X
   117 00:C2DD: 15 7F CE          JSR     L_A_HexToHexD
   118 00:C2E0: 7F F2             STA     P_Temp+3
   119 00:C2E2: 15 F7 C3          JSR     L_Scankey_Input_Press
   120 00:C2E5: 3A A1 28          BBS2    Sys_Flag_C,L_Scankey_Input_Set_Mode_Usally_Low_Bit_RTS;判断按键是否无效，如果是退出，不是继续
   121 00:C2E8: 7F F4             STA     P_Temp+5                                              ;将读取到的按键输入值存储到P_Temp+5中
   122 00:C2EA: 30 BA 32          BBR0    R_Mode_Set,L_Scankey_Input_Set_Mode_Usally_High_Bit   ;根据R_Mode_Set的最后一位是否为1判断是否为高位
   123                        L_Scankey_Input_Set_Mode_Usally_Low_Bit:
   124 00:C2ED: 73 F2             LDA     P_Temp+3
   125 00:C2EF: 51 F0             AND     #F0H
   126 00:C2F1: 7F F5             STA     P_Temp+6
   127 00:C2F3: 73 F3             LDA     P_Temp+4
   128 00:C2F5: 51 F0             AND     #F0H
   129 00:C2F7: 76 F5             CMP     P_Temp+6;比较储存的值的高四位和最大值得高四位
   130 00:C2F9: 10 16             BCC     L_Scankey_Input_Set_Mode_Usally_Low_Bit_Conutine
   131 00:C2FB: 73 F3             LDA     P_Temp+4
   132 00:C2FD: 51 0F             AND     #0FH
   133 00:C2FF: 76 F4             CMP     P_Temp+5;判断当前内存的低四位和最大值的低四位，当小于时，直接将输入的值给到低四位
   134 00:C301: 10 0D             BCC     L_Scankey_Input_Set_Mode_Usally_Low_Bit_RTS
   135 00:C303: 73 F5             LDA     P_Temp+6
   136 00:C305: 70 F4             ORA     P_Temp+5
   137 00:C307: 15 A5 CE          JSR     L_A_HexDToHex
   138 00:C30A: 6F 28 18          STA		Time_Addr,X
   139 00:C30D: 15 68 C2          JSR     L_Scankey_Set_Mode_Mode_First_Press_Prog
   140                        L_Scankey_Input_Set_Mode_Usally_Low_Bit_RTS:
   141 00:C310: 09                RTS
   142                        L_Scankey_Input_Set_Mode_Usally_Low_Bit_Conutine:
   143 00:C311: 73 F5             LDA     P_Temp+6
   144 00:C313: 70 F4             ORA     P_Temp+5
   145 00:C315: 15 A5 CE          JSR     L_A_HexDToHex
   146 00:C318: 6F 28 18          STA		Time_Addr,X
   147 00:C31B: 15 68 C2          JSR     L_Scankey_Set_Mode_Mode_First_Press_Prog
   148 00:C31E: 09                RTS
   149                        ;======================================================
   150                        
   151                        L_Scankey_Input_Set_Mode_Usally_High_Bit:
   152 00:C31F: 15 43 C9          JSR     L_ROL_4Bit_Prog;高4bit将读取到的按键值向左平移4个Bit
   153 00:C322: 7F F4             STA     P_Temp+5
   154 00:C324: 73 F3             LDA     P_Temp+4
   155 00:C326: 51 F0             AND     #F0H
   156 00:C328: 76 F4             CMP     P_Temp+5;将最大值和读取到的数比较，当大于时退出
   157 00:C32A: 13 03             BEQ     L_Scankey_Input_Set_Mode_Usally_High_Bit_Countine_Special
   158 00:C32C: 11 1B             BCS     L_Scankey_Input_Set_Mode_Usally_High_Bit_Countine;当按键输入值的前四位大于最大值时推出
   159                        
   160                        L_Scankey_Input_Set_Mode_Usally_High_Bit_RTS:
   161 00:C32E: 09                RTS
   162                        L_Scankey_Input_Set_Mode_Usally_High_Bit_Countine_Special:
   163 00:C32F: 73 F2             LDA     P_Temp+3
   164 00:C331: 51 0F             AND     #0FH
   165 00:C333: 7F F5             STA     P_Temp+6
   166 00:C335: 73 F3             LDA     P_Temp+4
   167 00:C337: 51 0F             AND     #0FH
   168 00:C339: 76 F5             CMP     P_Temp+6;将最大值的低四位和对应内存的低四位相比较，小于或等于跳转，否则清零低四位
   169 00:C33B: 11 0C             BCS     L_Scankey_Input_Set_Mode_Usally_High_Bit_Countine
   170 00:C33D: 73 F4             LDA     P_Temp+5
   171 00:C33F: 15 A5 CE          JSR     L_A_HexDToHex
   172 00:C342: 6F 28 18          STA		Time_Addr,X
   173 00:C345: 15 68 C2          JSR     L_Scankey_Set_Mode_Mode_First_Press_Prog
   174 00:C348: 09                RTS
   175                        L_Scankey_Input_Set_Mode_Usally_High_Bit_Countine:
   176 00:C349: 73 F2             LDA     P_Temp+3;当小于时，直接将按键读取的值给到对应的内存
   177 00:C34B: 51 0F             AND     #0FH
   178 00:C34D: 70 F4             ORA     P_Temp+5
   179 00:C34F: 15 A5 CE          JSR     L_A_HexDToHex
   180 00:C352: 6F 28 18          STA		Time_Addr,X
   181 00:C355: 15 68 C2          JSR     L_Scankey_Set_Mode_Mode_First_Press_Prog
   182 00:C358: 09                RTS
   183                        ;================================================
   184                        ;12小时制度的问题.
   185                        ;P_Temp+4存储最大值,P_Temp+5存储按键读到的值，P_Temp+3读到的被改变的值
   186                        ;P_Temp+6存储读到的被改变的值的高四位
   187                        ;================================================
   188                        L_Scankey_Input_Set_Mode_Hr_usually:
   189 00:C359: 7C F6             STX     P_Temp+7
   190 00:C35B: 7F F3             STA     P_Temp+4
   191 00:C35D: 15 F7 C3          JSR     L_Scankey_Input_Press
   192 00:C360: 3A A1 5D          BBS2    Sys_Flag_C,L_Scankey_Input_Set_Mode_Usally_High_Bit_RTS_12_Hour
   193 00:C363: 7F F4             STA     P_Temp+5
   194 00:C365: 63 28 18          LDA     Time_Addr,X
   195 00:C368: 15 39 C8          JSR     L_24_Hour_12_Hour_Prog
   196 00:C36B: 15 7F CE          JSR     L_A_HexToHexD
   197 00:C36E: 7F F2             STA     P_Temp+3
   198 00:C370: 30 BA 3C          BBR0    R_Mode_Set,L_Scankey_Input_Set_Mode_High_Bit_12_Hour
   199                        L_Scankey_Input_Set_Mode_Low_Bit_12_Hour:
   200 00:C373: 73 F2             LDA     P_Temp+3
   201 00:C375: 51 F0             AND     #F0H        ;保存当前时间的高四位
   202 00:C377: 7F F5             STA     P_Temp+6
   203 00:C379: 73 F3             LDA     P_Temp+4
   204 00:C37B: 51 F0             AND     #F0H
   205 00:C37D: 76 F5             CMP     P_Temp+6;比当前时间高四位和最大允许高四位,此时为0
   206 00:C37F: 11 19             BCS     L_Scankey_Input_Set_Mode_Usally_Low_Bit_Conutine_12_Hour
   207 00:C381: 73 F3             LDA     P_Temp+4
   208 00:C383: 51 0F             AND     #0FH
   209 00:C385: 76 F4             CMP     P_Temp+5;判断当前内存的低四位和最大值的低四位，当小于时，直接将输入的值给到低四位
   210 00:C387: 10 10             BCC     L_Scankey_Input_Set_Mode_Usally_Low_Bit_RTS_12_Hour
   211 00:C389: 73 F5             LDA     P_Temp+6
   212 00:C38B: 70 F4             ORA     P_Temp+5
   213 00:C38D: 15 A5 CE          JSR     L_A_HexDToHex
   214 00:C390: 15 4A C8          JSR     L_12_Hour_24_Hour_Prog
   215 00:C393: 6F 28 18          STA		Time_Addr,X
   216 00:C396: 15 68 C2          JSR     L_Scankey_Set_Mode_Mode_First_Press_Prog
   217                        L_Scankey_Input_Set_Mode_Usally_Low_Bit_RTS_12_Hour:
   218 00:C399: 09                RTS
   219                        L_Scankey_Input_Set_Mode_Usally_Low_Bit_Conutine_12_Hour:
   220 00:C39A: 73 F5             LDA     P_Temp+6
   221 00:C39C: 70 F4             ORA     P_Temp+5
   222 00:C39E: 12 02             BNE     L_Scankey_Input_Set_Mode_Usally_Low_Bit_Conutine_12_Hour_1
   223 00:C3A0: 53 01             LDA     #1
   224                        L_Scankey_Input_Set_Mode_Usally_Low_Bit_Conutine_12_Hour_1:
   225 00:C3A2: 15 A5 CE          JSR     L_A_HexDToHex
   226 00:C3A5: 15 4A C8          JSR     L_12_Hour_24_Hour_Prog
   227 00:C3A8: 6F 28 18          STA		Time_Addr,X
   228 00:C3AB: 15 68 C2          JSR     L_Scankey_Set_Mode_Mode_First_Press_Prog
   229 00:C3AE: 09                RTS
   230                        ;-----------------------------------------------------------------
   231                        L_Scankey_Input_Set_Mode_High_Bit_12_Hour:
   232 00:C3AF: 73 F4             LDA     P_Temp+5
   233 00:C3B1: 15 43 C9          JSR     L_ROL_4Bit_Prog;高4bit将读取到的按键值向左平移4个Bit
   234 00:C3B4: 7F F4             STA     P_Temp+5
   235 00:C3B6: 73 F3             LDA     P_Temp+4
   236 00:C3B8: 51 F0             AND     #F0H
   237 00:C3BA: 76 F4             CMP     P_Temp+5;将最大值和读取到的数比较，当大于时退出
   238 00:C3BC: 13 03             BEQ     L_Scankey_Input_Set_Mode_Usally_High_Bit_Countine_Special_12_Hour
   239 00:C3BE: 11 20             BCS     L_Scankey_Input_Set_Mode_Usally_High_Bit_Countine_12_Hour;当按键输入值的前四位大于最大值时推出
   240                        
   241                        L_Scankey_Input_Set_Mode_Usally_High_Bit_RTS_12_Hour:
   242 00:C3C0: 09                RTS
   243                        L_Scankey_Input_Set_Mode_Usally_High_Bit_Countine_Special_12_Hour:
   244 00:C3C1: 73 F2             LDA     P_Temp+3
   245 00:C3C3: 51 0F             AND     #0FH
   246 00:C3C5: 7F F5             STA     P_Temp+6
   247 00:C3C7: 73 F3             LDA     P_Temp+4
   248 00:C3C9: 51 0F             AND     #0FH
   249 00:C3CB: 76 F5             CMP     P_Temp+6;将最大值的低四位和对应内存的低四位相比较，小于或等于跳转，否则清零低四位
   250 00:C3CD: 13 0D             BEQ     L_Scankey_Input_Set_Mode_Usally_High_Bit_Countine_Special_12_Hour_1
   251 00:C3CF: 11 0F             BCS     L_Scankey_Input_Set_Mode_Usally_High_Bit_Countine_12_Hour
   252 00:C3D1: 73 F4             LDA     P_Temp+5
   253 00:C3D3: 15 A5 CE          JSR     L_A_HexDToHex
   254 00:C3D6: 15 4A C8          JSR     L_12_Hour_24_Hour_Prog
   255 00:C3D9: 6F 28 18          STA		Time_Addr,X
   256                        L_Scankey_Input_Set_Mode_Usally_High_Bit_Countine_Special_12_Hour_1
   257 00:C3DC: 15 68 C2          JSR     L_Scankey_Set_Mode_Mode_First_Press_Prog
   258 00:C3DF: 09                RTS
   259                        
   260                        L_Scankey_Input_Set_Mode_Usally_High_Bit_Countine_12_Hour:
   261 00:C3E0: 73 F2             LDA     P_Temp+3;当小于时，直接将按键读取的值给到对应的内存
   262 00:C3E2: 51 0F             AND     #0FH
   263 00:C3E4: 70 F4             ORA     P_Temp+5
   264 00:C3E6: 12 02             BNE     L_Scankey_Input_Set_Mode_Usally_High_Bit_Countine_12_Hour_1
   265 00:C3E8: 53 01             LDA     #1
   266                        L_Scankey_Input_Set_Mode_Usally_High_Bit_Countine_12_Hour_1:
   267 00:C3EA: 15 A5 CE          JSR     L_A_HexDToHex
   268 00:C3ED: 15 4A C8          JSR     L_12_Hour_24_Hour_Prog
   269 00:C3F0: 6F 28 18          STA		Time_Addr,X
   270 00:C3F3: 15 68 C2          JSR     L_Scankey_Set_Mode_Mode_First_Press_Prog
   271 00:C3F6: 09                RTS
   272                        
   273                        
   274                        
   275                        
   276                        
   277                        
   278                        
   279                        
   280                        
   281                        
   282                        
   283                        
   284                        
   285                        
   286                        
   287                        
   288                        
   289                        
   290                        
   291                        
   292                        
   293                        
   294                        
   295                        
   296                        
   297                        
   298                        
   299                        
   300                        
   301                        
   302                        
   303                        
   304                        
   305                        
   306                        
   307                        
   308                        
   309                        
   310                        
   311                        
   312                        
   313                        
   314                        
   315                        
   316                        L_Scankey_Input_Press:
   317 00:C3F7: 22 A1             RMB2    Sys_Flag_C
   318 00:C3F9: 73 A6             LDA     P_Scankey_value
   319 00:C3FB: 56 0C             CMP     #D_NUM0_Press
   320 00:C3FD: 13 27             BEQ     L_Input_Prog_Time_Mode_NUM0_Press
   321 00:C3FF: 56 01             CMP     #D_NUM1_Press
   322 00:C401: 13 26             BEQ     L_Input_Prog_Time_Mode_NUM1_Press
   323 00:C403: 56 02             CMP     #D_NUM2_Press
   324 00:C405: 13 25             BEQ     L_Input_Prog_Time_Mode_NUM2_Press
   325 00:C407: 56 03             CMP     #D_NUM3_Press
   326 00:C409: 13 24             BEQ     L_Input_Prog_Time_Mode_NUM3_Press
   327 00:C40B: 56 04             CMP     #D_NUM4_Press
   328 00:C40D: 13 23             BEQ     L_Input_Prog_Time_Mode_NUM4_Press
   329 00:C40F: 56 05             CMP     #D_NUM5_Press
   330 00:C411: 13 22             BEQ     L_Input_Prog_Time_Mode_NUM5_Press
   331 00:C413: 56 08             CMP     #D_NUM6_Press
   332 00:C415: 13 21             BEQ     L_Input_Prog_Time_Mode_NUM6_Press
   333 00:C417: 56 09             CMP     #D_NUM7_Press
   334 00:C419: 13 20             BEQ     L_Input_Prog_Time_Mode_NUM7_Press
   335 00:C41B: 56 0A             CMP     #D_NUM8_Press
   336 00:C41D: 13 1F             BEQ     L_Input_Prog_Time_Mode_NUM8_Press
   337 00:C41F: 56 0B             CMP     #D_NUM9_Press
   338 00:C421: 13 1E             BEQ     L_Input_Prog_Time_Mode_NUM9_Press
   339 00:C423: 2A A1             SMB2    Sys_Flag_C
   340 00:C425: 09                RTS
   341                        L_Input_Prog_Time_Mode_NUM0_Press:
   342 00:C426: 53 00             LDA     #0
   343 00:C428: 09                RTS
   344                        L_Input_Prog_Time_Mode_NUM1_Press:
   345 00:C429: 53 01             LDA     #1
   346 00:C42B: 09                RTS
   347                        L_Input_Prog_Time_Mode_NUM2_Press:
   348 00:C42C: 53 02             LDA     #2
   349 00:C42E: 09                RTS
   350                        L_Input_Prog_Time_Mode_NUM3_Press:
   351 00:C42F: 53 03             LDA     #3
   352 00:C431: 09                RTS
   353                        L_Input_Prog_Time_Mode_NUM4_Press:
   354 00:C432: 53 04             LDA     #4
   355 00:C434: 09                RTS
   356                        L_Input_Prog_Time_Mode_NUM5_Press:
   357 00:C435: 53 05             LDA     #5
   358 00:C437: 09                RTS
   359                        L_Input_Prog_Time_Mode_NUM6_Press:
   360 00:C438: 53 06             LDA     #6
   361 00:C43A: 09                RTS
   362                        L_Input_Prog_Time_Mode_NUM7_Press:
   363 00:C43B: 53 07             LDA     #7
   364 00:C43D: 09                RTS
   365                        L_Input_Prog_Time_Mode_NUM8_Press:
   366 00:C43E: 53 08             LDA     #8
   367 00:C440: 09                RTS
   368                        L_Input_Prog_Time_Mode_NUM9_Press:
   369 00:C441: 53 09             LDA     #9
   370 00:C443: 09                RTS
   371                        
   371                        
   158                        .INCLUDE	Key\Scankey_First_Press_Judgment.asm
     1                        L_Scankey_Prog_First:
     2 00:C444: 73 A5         	LDA		P_Scankey_value_T_1;清空无效标志位
     3 00:C446: 56 01         	CMP		#1
     4 00:C448: 11 08         	BCS		L_Scankey_Prog_First_1
     5                        	; JSR		L_Scankey_usually_Prog
     6                        	; LDA		P_Scankey_value_Temporary
     7                        	; STA		P_Scankey_value
     8 00:C44A: 78 A5         	INC		P_Scankey_value_T_1
     9                        L_Scankey_Prog_First_RTS:
    10 00:C44C: 09            	RTS
    11                        L_ScanKey_Null_Prog_To:
    12 00:C44D: 2D 9F         	SMB5	Sys_Flag_A
    13 00:C44F: 16 62 C1      	JMP		L_Scankey_Prog_Ineffective
    14                        
    15                        
    16                        
    17                        
    18                        
    19                        L_Scankey_Prog_First_1:
    20 00:C452: 21 9F         	RMB1	Sys_Flag_A
    21 00:C454: 53 00         	LDA		#0
    22 00:C456: 7F A5         	STA		P_Scankey_value_T_1
    23 00:C458: 4F 95 18      	STA		R_Voice_Unit
    24                        
    25 00:C45B: 15 95 DF      	JSR		L_Close_Beep_Prog
    26                        
    27 00:C45E: 15 F5 C4      	JSR		L_Scankey_usually_Prog
    28 00:C461: 73 A7         	LDA		P_Scankey_value_Temporary
    29 00:C463: 7F A6         	STA		P_Scankey_value
    30 00:C465: 13 E6         	BEQ		L_ScanKey_Null_Prog_To
    31 00:C467: 3D 9F E3      	BBS5	Sys_Flag_A,L_ScanKey_Null_Prog_To
    32 00:C46A: 53 00         	LDA		#0
    33 00:C46C: 4F 94 18      	STA		R_Close_Beep_Time
    34 00:C46F: 4F 95 18      	STA		R_Voice_Unit
    35 00:C472: 4F 92 18      	STA		R_Set_Mode_Exit_Time
    36 00:C475: 4F 93 18      	STA		R_Alarm_Clock_Open_Beep_Time
    37 00:C478: 7F EE         	STA		Time_To_Clock_Mode
    38 00:C47A: 7F A4         	STA		R_Scankey_Time
    39                        
    40 00:C47C: 2D 9F         	SMB5	Sys_Flag_A
    41 00:C47E: 3C A1 2B      	BBS4	Sys_Flag_C,L_Scankey_Short_ST_SP_Press_Prog_Alarm_TO;闹铃判断
    42 00:C481: 2A 9F         	SMB2	Sys_Flag_A
    43                        ;=======================
    44                        ;-----按键无效键和按下触发的事件判定
    45 00:C483: 3B 9F 23      	BBS3	Sys_Flag_A,L_Scankey_Set_Mode_First_Press_Prog_TO
    46 00:C486: 73 A6         	LDA		P_Scankey_value
    47 00:C488: 56 16         	CMP		#D_Mode_Press
    48 00:C48A: 13 1A         	BEQ		L_Scankey_Mode_Press_Prog_TO
    49 00:C48C: 2F 9F         	SMB7	Sys_Flag_A
    50 00:C48E: 56 15         	CMP		#D_Set_Press
    51 00:C490: 13 1D         	BEQ		L_Scankey_Set_Press_Prog
    52 00:C492: 43 91 18      	LDA		R_Mode
    53 00:C495: 56 05         	CMP		#5
    54 00:C497: 11 38         	BCS		L_Scankey_Prog_First_1_OUT
    55 00:C499: 06            	CLD
    56 00:C49A: 04            	CLC
    57 00:C49B: 18            	ROL
    58 00:C49C: 1B            	TAX
    59 00:C49D: 63 EC C4      	LDA		Table_Mode+1,X
    60 00:C4A0: 0A            	PHA
    61 00:C4A1: 63 EB C4      	LDA		Table_Mode,X
    62 00:C4A4: 0A            	PHA
    63 00:C4A5: 09            	RTS
    64                        L_Scankey_Mode_Press_Prog_TO:
    65 00:C4A6: 16 D0 C1      	JMP		L_Scankey_Mode_Press_Prog
    66                        L_Scankey_Set_Mode_First_Press_Prog_TO:
    67 00:C4A9: 16 3B C2      	JMP		L_Scankey_Set_Mode_First_Press_Prog
    68                        L_Scankey_Short_ST_SP_Press_Prog_Alarm_TO:
    69 00:C4AC: 16 B3 DF      	JMP		L_Scankey_Short_ST_SP_Press_Prog_Alarm
    70                        L_Scankey_Set_Press_Prog:
    71 00:C4AF: 2D 9F         	SMB5	Sys_Flag_A
    72 00:C4B1: 43 91 18      	LDA		R_Mode
    73 00:C4B4: 56 01         	CMP		#1
    74 00:C4B6: 13 27         	BEQ		L_control_Beep_Prog_ALL
    75 00:C4B8: 56 04         	CMP		#4
    76 00:C4BA: 13 20         	BEQ		L_Scankey_Prog_First_OUT
    77 00:C4BC: 15 87 C7      	JSR		L_Control_SNZ_Close_Prog
    78 00:C4BF: 53 00         	LDA		#0
    79 00:C4C1: 7F BA         	STA		R_Mode_Set
    80 00:C4C3: 2B 9F         	SMB3	Sys_Flag_A
    81 00:C4C5: 15 99 CA      	JSR		L_Display_Set_Mode_Prog
    82 00:C4C8: 43 91 18      	LDA		R_Mode
    83 00:C4CB: 13 01         	BEQ		L_Clr_Time_Week_Prog_TO
    84 00:C4CD: 09            	RTS
    85                        L_Clr_Time_Week_Prog_TO:
    86 00:C4CE: 16 8F CD      	JMP		L_Clr_Time_Week_Prog
    87                        
    88                        L_Scankey_Prog_First_1_OUT:
    89 00:C4D1: 53 00         	LDA		#0
    90 00:C4D3: 4F 91 18      	STA		R_Mode
    91 00:C4D6: 15 F5 C0      	JSR		L_Clr_All_DisRam_Prog
    92 00:C4D9: 15 BD CA      	JSR		L_Display_Prog
    93                        
    94                        L_Scankey_Prog_First_OUT:
    95 00:C4DC: 2D 9F         	SMB5	Sys_Flag_A
    96 00:C4DE: 09            	RTS
    97                        
    98                        L_control_Beep_Prog_ALL:;控制声音
    99 00:C4DF: 3D A0 06      	BBS5	Sys_Flag_B,L_control_Beep_Prog_ALL_1
   100 00:C4E2: 2D A0         	SMB5	Sys_Flag_B
   101 00:C4E4: 15 FD DF      	JSR		L_Beep_1s
   102 00:C4E7: 09            	RTS
   103                        L_control_Beep_Prog_ALL_1:
   104 00:C4E8: 25 A0         	RMB5	Sys_Flag_B
   105 00:C4EA: 09            	RTS
   106                        
   107                        Table_Mode:
   108 00:C4EB: 1F C6         	DW		L_Clock_First_Press_Prog-1
   109 00:C4ED: 27 D7         	DW		L_Calculator_Frist_Press_Prog-1
   110 00:C4EF: 9C C7         	DW		L_Alarm_First_Press_Prog-1
   111 00:C4F1: 49 C7         	DW		L_Clock_Twice_First_Press_Prog-1
   112 00:C4F3: 67 C8         	DW		L_Positive_Timer_First_Press_Prog-1
   113                        
   113                        
   159                        .INCLUDE	Key\Scankey_Normal.asm
     1                        L_Scankey_usually_Prog:
     2 00:C4F5: 15 0C C1      	JSR		L_Judgement_Scankey_Prog;调整按键输入输出模式
     3 00:C4F8: 15 F2 DF      	JSR		L_ScanKey_Delay_Prog
     4 00:C4FB: 53 00         	LDA		#0
     5 00:C4FD: 7F A7         	STA		P_Scankey_value_Temporary
     6 00:C4FF: 73 01         	LDA		P_PA
     7 00:C501: 51 7C         	AND		#D_PA_Press
     8 00:C503: 56 70         	CMP		#D_PA_Value
     9 00:C505: 12 08         	BNE		L_Scankey_usually_Prog_Countine;不相等跳转
    10                        L_Scankey_usually_Prog_RTS:
    11 00:C507: 09            	RTS
    12                        L_Scankey_Effictive_Prog:
    13 00:C508: 2D 9F         	SMB5	Sys_Flag_A
    14 00:C50A: 53 5A         	LDA		#90
    15 00:C50C: 7F A7         	STA		P_Scankey_value_Temporary
    16 00:C50E: 09            	RTS
    17                        L_Scankey_usually_Prog_Countine:
    18 00:C50F: 7F F0         	STA		P_Temp+1;将读取的按键值存储起来
    19 00:C511: 56 74         	CMP		#D_PA2_Press
    20 00:C513: 13 1D         	BEQ		L_Scankey_usually_Prog_Countine_PA2
    21 00:C515: 56 78         	CMP		#D_PA3_Press
    22 00:C517: 13 1E         	BEQ		L_Scankey_usually_Prog_Countine_PA3
    23 00:C519: 56 10         	CMP		#D_PA5_PA6_Press
    24 00:C51B: 13 1F         	BEQ		L_Scankey_usually_Prog_Countine_PA5_PA6;先扫描单键单独口的键和多键
    25 00:C51D: 15 70 C5      	JSR		L_PC_Output_High_Prog
    26 00:C520: 3D 9F E5      	BBS5	Sys_Flag_A,L_Scankey_Effictive_Prog
    27 00:C523: 73 F0         	LDA		P_Temp+1
    28 00:C525: 56 60         	CMP		#D_PA4_Press
    29 00:C527: 13 2F         	BEQ		L_Scankey_usually_Prog_Countine_PA4
    30 00:C529: 56 50         	CMP		#D_PA5_Press
    31 00:C52B: 13 33         	BEQ		L_Scankey_usually_Prog_Countine_PA5
    32 00:C52D: 56 30         	CMP		#D_PA6_Press
    33 00:C52F: 13 37         	BEQ		L_Scankey_usually_Prog_Countine_PA6
    34                        
    35 00:C531: 09            	RTS
    36                        
    37                        L_Scankey_usually_Prog_Countine_PA2:
    38 00:C532: 53 15         	LDA		#D_B_Press
    39 00:C534: 7F A7         	STA		P_Scankey_value_Temporary
    40 00:C536: 09            	RTS
    41                        
    42                        L_Scankey_usually_Prog_Countine_PA3:
    43 00:C537: 53 16         	LDA		#D_C_Press
    44 00:C539: 7F A7         	STA		P_Scankey_value_Temporary
    45 00:C53B: 09            	RTS
    46                        L_Scankey_usually_Prog_Countine_PA5_PA6:;
    47 00:C53C: 15 70 C5      	JSR		L_PC_Output_High_Prog
    48 00:C53F: 73 F2         	LDA		P_Temp+3
    49 00:C541: 70 F4         	ORA		P_Temp+5
    50 00:C543: 70 F5         	ORA		P_Temp+6
    51 00:C545: 70 F7         	ORA		P_Temp+8
    52 00:C547: 12 BF         	BNE		L_Scankey_Effictive_Prog
    53 00:C549: 73 F3         	LDA		P_Temp+4
    54 00:C54B: 13 BB         	BEQ		L_Scankey_Effictive_Prog
    55 00:C54D: 73 F6         	LDA		P_Temp+7
    56 00:C54F: 13 B7         	BEQ		L_Scankey_Effictive_Prog
    57 00:C551: 53 17         	LDA		#D_Beep_Test_Press
    58 00:C553: 7F A7         	STA		P_Scankey_value_Temporary
    59 00:C555: 25 9F         	RMB5	Sys_Flag_A
    60 00:C557: 09            	RTS
    61                        
    62                        L_Scankey_usually_Prog_Countine_PA4:
    63 00:C558: 04            	CLC
    64 00:C559: 53 00         	LDA		#0
    65 00:C55B: 74 F1         	ADC		P_Temp+2
    66 00:C55D: 7F A7         	STA		P_Scankey_value_Temporary
    67 00:C55F: 09            	RTS
    68                        
    69                        L_Scankey_usually_Prog_Countine_PA5:
    70 00:C560: 04            	CLC
    71 00:C561: 53 07         	LDA		#7
    72 00:C563: 74 F1         	ADC		P_Temp+2
    73 00:C565: 7F A7         	STA		P_Scankey_value_Temporary
    74 00:C567: 09            	RTS
    75                        
    76                        L_Scankey_usually_Prog_Countine_PA6:
    77 00:C568: 04            	CLC
    78 00:C569: 53 0E         	LDA		#14
    79 00:C56B: 74 F1         	ADC		P_Temp+2
    80 00:C56D: 7F A7         	STA		P_Scankey_value_Temporary
    81 00:C56F: 09            	RTS
    82                        
    83                        
    84                        L_PC_Output_High_Prog:;按键扫描程序
    85 00:C570: 15 15 C1      	JSR		L_PA_Intput_Low_Prog
    86 00:C573: 15 1A C1      	JSR		L_PC0_Output_High_Prog
    87 00:C576: 15 F2 DF      	JSR		L_ScanKey_Delay_Prog
    88                        
    89 00:C579: 73 01         	LDA		P_PA
    90 00:C57B: 51 7C         	AND		#D_PA_Press
    91 00:C57D: 7F F2         	STA		P_Temp+3
    92                        
    93 00:C57F: 15 1F C1      	JSR		L_PC1_Output_High_Prog
    94 00:C582: 15 F2 DF      	JSR		L_ScanKey_Delay_Prog
    95                        
    96 00:C585: 73 01         	LDA		P_PA
    97 00:C587: 51 7C         	AND		#D_PA_Press
    98 00:C589: 7F F3         	STA		P_Temp+4
    99                        
   100 00:C58B: 15 24 C1      	JSR		L_PC2_Output_High_Prog
   101 00:C58E: 15 F2 DF      	JSR		L_ScanKey_Delay_Prog
   102                        
   103 00:C591: 73 01         	LDA		P_PA
   104 00:C593: 51 7C         	AND		#D_PA_Press
   105 00:C595: 7F F4         	STA		P_Temp+5
   106                        
   107 00:C597: 15 29 C1      	JSR		L_PC3_Output_High_Prog
   108 00:C59A: 15 F2 DF      	JSR		L_ScanKey_Delay_Prog
   109                        
   110 00:C59D: 73 01         	LDA		P_PA
   111 00:C59F: 51 7C         	AND		#D_PA_Press
   112 00:C5A1: 7F F5         	STA		P_Temp+6
   113                        
   114 00:C5A3: 15 2E C1      	JSR		L_PC4_Output_High_Prog
   115 00:C5A6: 15 F2 DF      	JSR		L_ScanKey_Delay_Prog
   116                        
   117 00:C5A9: 73 01         	LDA		P_PA
   118 00:C5AB: 51 7C         	AND		#D_PA_Press
   119 00:C5AD: 7F F6         	STA		P_Temp+7
   120                        
   121 00:C5AF: 15 33 C1      	JSR		L_PC5_Output_High_Prog
   122 00:C5B2: 15 F2 DF      	JSR		L_ScanKey_Delay_Prog
   123                        
   124 00:C5B5: 73 01         	LDA		P_PA
   125 00:C5B7: 51 7C         	AND		#D_PA_Press
   126 00:C5B9: 7F F7         	STA		P_Temp+8
   127                        
   128                        
   129                        
   130 00:C5BB: 15 38 C1      	JSR		L_Scankey_Effictive_Init
   131                        
   132 00:C5BE: 73 F2         	LDA		P_Temp+3
   133 00:C5C0: 12 15         	BNE		L_PC_Output_High_Prog_PC0
   134 00:C5C2: 73 F3         	LDA		P_Temp+4
   135 00:C5C4: 12 22         	BNE		L_PC_Output_High_Prog_PC1
   136 00:C5C6: 73 F4         	LDA		P_Temp+5
   137 00:C5C8: 12 2D         	BNE		L_PC_Output_High_Prog_PC2
   138 00:C5CA: 73 F5         	LDA		P_Temp+6
   139 00:C5CC: 12 36         	BNE		L_PC_Output_High_Prog_PC3
   140 00:C5CE: 73 F6         	LDA		P_Temp+7
   141 00:C5D0: 12 3D         	BNE		L_PC_Output_High_Prog_PC4
   142 00:C5D2: 73 F7         	LDA		P_Temp+8
   143 00:C5D4: 12 42         	BNE		L_PC_Output_High_Prog_PC5
   144 00:C5D6: 09            	RTS
   145                        
   146                        L_PC_Output_High_Prog_PC0:
   147 00:C5D7: 73 F3         	LDA		P_Temp+4
   148 00:C5D9: 70 F4         	ORA		P_Temp+5
   149 00:C5DB: 70 F5         	ORA		P_Temp+6
   150 00:C5DD: 70 F6         	ORA		P_Temp+7
   151 00:C5DF: 70 F7         	ORA		P_Temp+8
   152 00:C5E1: 12 3A         	BNE		L_Scankey_Effictive_Prog_To
   153 00:C5E3: 53 01         	LDA		#1
   154 00:C5E5: 7F F1         	STA		P_Temp+2
   155 00:C5E7: 09            	RTS
   156                        L_PC_Output_High_Prog_PC1:
   157 00:C5E8: 73 F4         	LDA		P_Temp+5
   158 00:C5EA: 70 F5         	ORA		P_Temp+6
   159 00:C5EC: 70 F6         	ORA		P_Temp+7
   160 00:C5EE: 70 F7         	ORA		P_Temp+8
   161 00:C5F0: 12 2B         	BNE		L_Scankey_Effictive_Prog_To
   162 00:C5F2: 53 02         	LDA		#2
   163 00:C5F4: 7F F1         	STA		P_Temp+2
   164 00:C5F6: 09            	RTS
   165                        L_PC_Output_High_Prog_PC2:
   166 00:C5F7: 73 F5         	LDA		P_Temp+6
   167 00:C5F9: 70 F6         	ORA		P_Temp+7
   168 00:C5FB: 70 F7         	ORA		P_Temp+8
   169 00:C5FD: 12 1E         	BNE		L_Scankey_Effictive_Prog_To
   170 00:C5FF: 53 03         	LDA		#3
   171 00:C601: 7F F1         	STA		P_Temp+2
   172 00:C603: 09            	RTS
   173                        
   174                        L_PC_Output_High_Prog_PC3:
   175 00:C604: 73 F6         	LDA		P_Temp+7
   176 00:C606: 70 F7         	ORA		P_Temp+8
   177 00:C608: 12 13         	BNE		L_Scankey_Effictive_Prog_To
   178 00:C60A: 53 04         	LDA		#4
   179 00:C60C: 7F F1         	STA		P_Temp+2
   180 00:C60E: 09            	RTS
   181                        L_PC_Output_High_Prog_PC4:
   182 00:C60F: 73 F7         	LDA		P_Temp+8
   183 00:C611: 12 0A         	BNE		L_Scankey_Effictive_Prog_To
   184 00:C613: 53 05         	LDA		#5
   185 00:C615: 7F F1         	STA		P_Temp+2
   186 00:C617: 09            	RTS
   187                        L_PC_Output_High_Prog_PC5:
   188 00:C618: 53 06         	LDA		#6
   189 00:C61A: 7F F1         	STA		P_Temp+2
   190 00:C61C: 09            	RTS
   191                        L_Scankey_Effictive_Prog_To:
   192 00:C61D: 16 08 C5      	JMP		L_Scankey_Effictive_Prog
   192                        
   160                        .INCLUDE	Key\ScanKey_Function_Time.ASM
     1                        ;======================================================================
     2                        ;非设置模式下吗,时钟模式按下/号键，显示日期
     3                        ;======================================================================
     4                        L_Clock_First_Press_Prog:
     5 00:C620: 73 A6         	LDA		P_Scankey_value
     6 00:C622: 56 13         	CMP		#D_Date_Press
     7 00:C624: 12 0A         	BNE		L_Clock_First_Press_Prog_OUT
     8 00:C626: 15 19 CE          JSR		L_Clr_All_8Bit_Prog
     9 00:C629: 15 42 CB      	JSR		L_Display_Time_Date_Prog
    10 00:C62C: 2E 9F         	SMB6	Sys_Flag_A
    11 00:C62E: 25 9F         	RMB5	Sys_Flag_A
    12                        L_Clock_First_Press_Prog_OUT:
    13 00:C630: 09            	RTS
    14                        ;==================================
    15                        ;时间模式下，设置模式下按键处理问题
    16                        ;==================================
    17                        L_Scankey_Set_Mode_Prog_Clock:
    18 00:C631: 73 A6             LDA     P_Scankey_value
    19 00:C633: 56 10             CMP     #D_ST_SP_Press
    20 00:C635: 13 16             BEQ     L_Change_12_Clock_24_Clock_Prog_TO;按下加键，改变24小时——12小时制
    21 00:C637: 56 0F             CMP     #D_NUM_Point_Press
    22 00:C639: 13 0F             BEQ     L_Change_12_24_Prog_PM_AM_TO
    23 00:C63B: 73 BA             LDA     R_Mode_Set
    24 00:C63D: 06                CLD
    25 00:C63E: 04                CLC
    26 00:C63F: 18                ROL
    27 00:C640: 1B                TAX
    28 00:C641: 63 51 C6          LDA     Table_Time_Plus+1,X
    29 00:C644: 0A                PHA
    30 00:C645: 63 50 C6          LDA     Table_Time_Plus,X
    31 00:C648: 0A                PHA
    32 00:C649: 09                RTS
    33                        L_Change_12_24_Prog_PM_AM_TO:
    34 00:C64A: 16 75 C6          JMP     L_Change_12_24_Prog_PM_AM
    35                        L_Change_12_Clock_24_Clock_Prog_TO:;按下按键改变12小时制和24小时制
    36 00:C64D: 16 66 C6          JMP     L_Change_12_Clock_24_Clock_Prog
    37                        
    38                        Table_Time_Plus:
    39 00:C650: 7D C6             DW      L_Control_Set_Mode_Clock_Prog_Sec-1
    40 00:C652: 9D C6             DW      L_Control_Set_Mode_Clock_Prog_Hr-1
    41 00:C654: 9D C6             DW      L_Control_Set_Mode_Clock_Prog_Hr-1
    42 00:C656: 96 C6             DW      L_Control_Set_Mode_Clock_Prog_Min-1
    43 00:C658: 96 C6             DW      L_Control_Set_Mode_Clock_Prog_Min-1
    44 00:C65A: BF C6             DW      L_Control_Set_Mode_Clock_Prog_Year-1
    45 00:C65C: BF C6             DW      L_Control_Set_Mode_Clock_Prog_Year-1
    46 00:C65E: B7 C6             DW      L_Control_Set_Mode_Clock_Prog_Month-1
    47 00:C660: B7 C6             DW      L_Control_Set_Mode_Clock_Prog_Month-1
    48 00:C662: AC C6             DW      L_Control_Set_Mode_Clock_Prog_Day-1
    49 00:C664: AC C6             DW      L_Control_Set_Mode_Clock_Prog_Day-1
    50                        
    51                        ;========================================
    52                        ;在时间设置模式下按下+键，改变24小时12小时制
    53                        ;========================================
    54                        L_Change_12_Clock_24_Clock_Prog:
    55 00:C666: 3A A0 06          BBS2    Sys_Flag_B,L_Change_12_24_Prog_12;当前是24小时制是跳转
    56 00:C669: 2A A0             SMB2    Sys_Flag_B
    57 00:C66B: 15 66 CB          JSR     L_Display_Time_Hr_Prog
    58 00:C66E: 09                RTS
    59                        L_Change_12_24_Prog_12:
    60 00:C66F: 22 A0             RMB2    Sys_Flag_B
    61 00:C671: 15 66 CB          JSR     L_Display_Time_Hr_Prog
    62 00:C674: 09                RTS
    63                        ;========================================
    64                        ;在时间设置模式下按下.键，改变12小时的AM_PM
    65                        ;========================================
    66                        L_Change_12_24_Prog_PM_AM:
    67 00:C675: 5E 02             LDX     #(R_Time_Hr-Time_Str_Addr)
    68 00:C677: 15 1B C8          JSR     L_Change_12_14_Prog_AM_PM_ususally_Prog
    69 00:C67A: 15 66 CB          JSR     L_Display_Time_Hr_Prog
    70 00:C67D: 09                RTS
    71                        ;=============================================
    72                        ;---------------------------------------------
    73                        ;=============================================
    74                        
    75                        L_Control_Set_Mode_Clock_Prog_Sec:;30秒及以上清零并分钟加1，不到30秒清零
    76 00:C67E: 73 A7             LDA     P_Scankey_value_Temporary
    77 00:C680: 56 0C             CMP     #D_NUM0_Press
    78 00:C682: 12 12             BNE     L_Control_Set_Mode_Clock_Prog_Sec_RTS
    79 00:C684: 73 A8             LDA     R_Time_Sec
    80 00:C686: 7F EF             STA     P_Temp
    81 00:C688: 53 00             LDA     #0
    82 00:C68A: 7F A8             STA     R_Time_Sec
    83 00:C68C: 73 EF             LDA     P_Temp
    84 00:C68E: 56 1E             CMP     #30
    85 00:C690: 11 01             BCS     L_Control_Set_Mode_Clock_Prog_Sec_1
    86 00:C692: 09                RTS
    87                        L_Control_Set_Mode_Clock_Prog_Sec_1:
    88 00:C693: 15 14 DC          JSR     L_Update_Time_Min_Prog
    89                        L_Control_Set_Mode_Clock_Prog_Sec_RTS:
    90 00:C696: 09                RTS
    91                        ;=============================================
    92                        ;---------------------------------------------
    93                        ;=============================================
    94                        L_Control_Set_Mode_Clock_Prog_Min:
    95 00:C697: 5E 01             LDX     #(R_Time_Min-Time_Str_Addr)
    96 00:C699: 53 59             LDA     #59H
    97 00:C69B: 16 C8 C6          JMP     L_Scankey_Input_Set_Mode_Usally_Time
    98                        ;=============================================
    99                        ;---------------------------------------------
   100                        ;=============================================
   101                        L_Control_Set_Mode_Clock_Prog_Hr:
   102 00:C69E: 5E 02             LDX     #(R_Time_Hr-Time_Str_Addr)
   103 00:C6A0: 32 A0 05          BBR2    Sys_Flag_B,L_Control_Set_Mode_Clock_Prog_Hr_1
   104 00:C6A3: 53 23             LDA     #23H
   105 00:C6A5: 16 C8 C6          JMP     L_Scankey_Input_Set_Mode_Usally_Time
   106                        L_Control_Set_Mode_Clock_Prog_Hr_1:
   107 00:C6A8: 53 12             LDA     #12H
   108 00:C6AA: 16 29 C7          JMP     L_Scankey_Input_Set_Mode_Hr_Time
   109                        
   110                        ;=============================================
   111                        ;---------------------------------------------
   112                        ;=============================================
   113                        L_Control_Set_Mode_Clock_Prog_Day:
   114                            ; JSR     L_Check_MaxDay_Prog
   115                            ; JSR     L_A_HexToHexD.
   116 00:C6AD: 53 31             LDA     #31H
   117 00:C6AF: 5E 03             LDX     #(R_Time_Day-Time_Str_Addr)
   118 00:C6B1: 15 E3 C6          JSR     L_Scankey_Input_Set_Mode_Usally_Time_Date
   119 00:C6B4: 15 AD DC          JSR     L_Check_MaxDay_Prog
   120 00:C6B7: 09                RTS
   121                        ;=============================================
   122                        ;---------------------------------------------
   123                        ;=============================================
   124                        L_Control_Set_Mode_Clock_Prog_Month
   125 00:C6B8: 5E 04             LDX     #(R_Time_Month-Time_Str_Addr)
   126 00:C6BA: 53 12             LDA     #12H
   127 00:C6BC: 15 E3 C6          JSR     L_Scankey_Input_Set_Mode_Usally_Time_Date
   128 00:C6BF: 09                RTS
   129                        ;=============================================
   130                        ;---------------------------------------------
   131                        ;=============================================
   132                        L_Control_Set_Mode_Clock_Prog_Year
   133 00:C6C0: 5E 05             LDX     #(R_Time_Year-Time_Str_Addr)
   134 00:C6C2: 53 99             LDA     #99H
   135 00:C6C4: 15 C8 C6          JSR     L_Scankey_Input_Set_Mode_Usally_Time
   136 00:C6C7: 09                RTS
   137                        
   138                        ;==========================================
   139                        ;按键按下后输入的通用函数
   140                        ;==========================================
   141                        L_Scankey_Input_Set_Mode_Usally_Time:
   142 00:C6C8: 7F F3             STA     P_Temp+4
   143 00:C6CA: 63 28 18          LDA     Time_Addr,X
   144 00:C6CD: 15 7F CE          JSR     L_A_HexToHexD
   145 00:C6D0: 7F F2             STA     P_Temp+3
   146 00:C6D2: 15 F7 C3          JSR     L_Scankey_Input_Press
   147 00:C6D5: 3A A1 43          BBS2    Sys_Flag_C,L_Scankey_Input_Set_Mode_Usally_Time_Date_Low_BIT_RTS
   148 00:C6D8: 7F F4             STA     P_Temp+5
   149 00:C6DA: 38 BA 03          BBS0    R_Mode_Set,L_Scankey_Input_Set_Mode_Usally_High_Bit_TO;根据R_Mode_Set判断是否为高位
   150 00:C6DD: 16 ED C2          JMP     L_Scankey_Input_Set_Mode_Usally_Low_Bit
   151                        L_Scankey_Input_Set_Mode_Usally_High_Bit_TO:
   152 00:C6E0: 16 1F C3          JMP     L_Scankey_Input_Set_Mode_Usally_High_Bit
   153                        ;==========================================
   154                        ;==========================================
   155                        ;==========================================
   156                        L_Scankey_Input_Set_Mode_Usally_Time_Date:
   157 00:C6E3: 7F F3             STA     P_Temp+4
   158 00:C6E5: 63 28 18          LDA     Time_Addr,X
   159 00:C6E8: 15 7F CE          JSR     L_A_HexToHexD
   160 00:C6EB: 7F F2             STA     P_Temp+3
   161 00:C6ED: 15 F7 C3          JSR     L_Scankey_Input_Press
   162 00:C6F0: 3A A1 28          BBS2    Sys_Flag_C,L_Scankey_Input_Set_Mode_Usally_Time_Date_Low_BIT_RTS
   163 00:C6F3: 7F F4             STA     P_Temp+5
   164 00:C6F5: 38 BA E8          BBS0    R_Mode_Set,L_Scankey_Input_Set_Mode_Usally_High_Bit_TO;根据R_Mode_Set判断是否为高位
   165                        L_Scankey_Input_Set_Mode_Usally_Time_Date_Low_BIT:
   166 00:C6F8: 73 F2             LDA     P_Temp+3
   167 00:C6FA: 51 F0             AND     #F0H
   168 00:C6FC: 7F F5             STA     P_Temp+6
   169 00:C6FE: 73 F3             LDA     P_Temp+4
   170 00:C700: 51 F0             AND     #F0H
   171 00:C702: 76 F5             CMP     P_Temp+6;判断当前内存的高四位和最大值的高四位，当小于时，直接将输入的值给到低四位
   172 00:C704: 11 16             BCS     L_Scankey_Input_Set_Mode_Usally_Time_Date_Low_BIT_Conutine
   173 00:C706: 73 F3             LDA     P_Temp+4
   174 00:C708: 51 0F             AND     #0FH
   175 00:C70A: 76 F4             CMP     P_Temp+5;判断当前内存的低四位和最大值的低四位，当小于时，直接将输入的值给到低四位
   176 00:C70C: 10 0D             BCC     L_Scankey_Input_Set_Mode_Usally_Time_Date_Low_BIT_RTS
   177 00:C70E: 73 F5             LDA     P_Temp+6
   178 00:C710: 70 F4             ORA     P_Temp+5
   179 00:C712: 15 A5 CE          JSR     L_A_HexDToHex
   180 00:C715: 6F 28 18          STA		Time_Addr,X
   181 00:C718: 15 68 C2          JSR     L_Scankey_Set_Mode_Mode_First_Press_Prog
   182                        L_Scankey_Input_Set_Mode_Usally_Time_Date_Low_BIT_RTS:
   183 00:C71B: 09                RTS
   184                        L_Scankey_Input_Set_Mode_Usally_Time_Date_Low_BIT_Conutine:
   185 00:C71C: 73 F2             LDA     P_Temp+3
   186 00:C71E: 51 F0             AND     #F0H
   187 00:C720: 12 04             BNE     L_Scankey_Input_Set_Mode_Usally_Time_Date_Low_BIT_Conutine_1
   188 00:C722: 73 F4             LDA     P_Temp+5
   189 00:C724: 13 F5             BEQ     L_Scankey_Input_Set_Mode_Usally_Time_Date_Low_BIT_RTS
   190                        L_Scankey_Input_Set_Mode_Usally_Time_Date_Low_BIT_Conutine_1:
   191 00:C726: 16 11 C3          JMP     L_Scankey_Input_Set_Mode_Usally_Low_Bit_Conutine
   192                        ;================================================================
   193                        ;================================================================
   194                        ;================================================================
   195                        ;================================================================
   196                        
   197                        
   198                        ;P_Temp+3存储读取到的时间，P_Temp+4
   199                        ;
   200                        L_Scankey_Input_Set_Mode_Hr_Time:
   201 00:C729: 7C F6             STX     P_Temp+7
   202 00:C72B: 7F F3             STA     P_Temp+4
   203 00:C72D: 15 F7 C3          JSR     L_Scankey_Input_Press
   204 00:C730: 3A A1 13          BBS2    Sys_Flag_C,L_Scankey_Input_Set_Mode_Hr_Time_RTS
   205 00:C733: 7F F4             STA     P_Temp+5
   206 00:C735: 63 28 18          LDA     Time_Addr,X
   207 00:C738: 15 39 C8          JSR     L_24_Hour_12_Hour_Prog
   208 00:C73B: 15 7F CE          JSR     L_A_HexToHexD
   209 00:C73E: 7F F2             STA     P_Temp+3
   210 00:C740: 38 BA 04          BBS0    R_Mode_Set,L_Scankey_Input_Set_Mode_High_Bit_12_Hour_TO
   211 00:C743: 16 73 C3          JMP     L_Scankey_Input_Set_Mode_Low_Bit_12_Hour
   212                        L_Scankey_Input_Set_Mode_Hr_Time_RTS:
   213                        
   214 00:C746: 09                RTS
   215                        
   216                        L_Scankey_Input_Set_Mode_High_Bit_12_Hour_TO:
   217 00:C747: 16 AF C3          JMP     L_Scankey_Input_Set_Mode_High_Bit_12_Hour
   217                        
   161                        .INCLUDE	Key\Scankey_Function_Another_Time.asm
     1                        ;======================================================================
     2                        ;非设置模式下吗,第二时间模式，长按RESET，进入设置模式
     3                        ;======================================================================
     4                        L_Clock_Twice_First_Press_Prog:
     5 00:C74A: 09            	RTS
     6                        
     7                        
     8                        
     9                        
    10                        
    11                        ;======================================================================
    12                        ;======================================================================
    13                        ;======================================================================
    14                        ;======================================================================
    15                        ;======================================================================
    16                        L_Scankey_Set_Mode_Prog_Another_Time:
    17 00:C74B: 73 A6            LDA      P_Scankey_value
    18 00:C74D: 56 0F            CMP      #D_NUM_Point_Press
    19 00:C74F: 13 17            BEQ      L_Change_12_24_Prog_PM_AM_Another_Time
    20 00:C751: 73 BA            LDA      R_Mode_Set
    21 00:C753: 04               CLC
    22 00:C754: 06               CLD
    23 00:C755: 18               ROL
    24 00:C756: 1B               TAX
    25 00:C757: 63 61 C7         LDA      Table_Another_Time_Plus+1,X
    26 00:C75A: 0A               PHA
    27 00:C75B: 63 60 C7         LDA      Table_Another_Time_Plus,X
    28 00:C75E: 0A               PHA
    29 00:C75F: 09               RTS
    30                        Table_Another_Time_Plus:
    31 00:C760: 77 C7             DW      L_Control_Set_Mode_Another_Clock_Prog_Hr-1
    32 00:C762: 77 C7             DW      L_Control_Set_Mode_Another_Clock_Prog_Hr-1
    33 00:C764: 70 C7             DW      L_Control_Set_Mode_Another_Clock_Prog_Min-1
    34 00:C766: 70 C7             DW      L_Control_Set_Mode_Another_Clock_Prog_Min-1
    35                        
    36                        ;======================================================================
    37                        
    38                        L_Change_12_24_Prog_PM_AM_Another_Time:
    39 00:C768: 5E 08             LDX     #(R_Time_Hr_Another-Time_Str_Addr)
    40 00:C76A: 15 1B C8          JSR     L_Change_12_14_Prog_AM_PM_ususally_Prog
    41 00:C76D: 15 2C CB          JSR     L_Display_Another_Time_Hr_Prog
    42 00:C770: 09                RTS
    43                        ;======================================================================
    44                        
    45                        
    46                        L_Control_Set_Mode_Another_Clock_Prog_Min:
    47 00:C771: 5E 07             LDX     #(R_Time_Min_Another-Time_Str_Addr)
    48 00:C773: 53 59             LDA     #59H
    49 00:C775: 16 D8 C2          JMP     L_Scankey_Input_Set_Mode_Usally
    50                        ;======================================================================
    51                        
    52                        
    53                        L_Control_Set_Mode_Another_Clock_Prog_Hr:
    54 00:C778: 5E 08             LDX     #(R_Time_Hr_Another-Time_Str_Addr)
    55 00:C77A: 32 A0 FA          BBR2    Sys_Flag_B,L_Control_Set_Mode_Another_Clock_Prog_Hr-1
    56 00:C77D: 53 23             LDA     #23H
    57 00:C77F: 16 D8 C2          JMP     L_Scankey_Input_Set_Mode_Usally
    58                        L_Control_Set_Mode_Another_Clock_Prog_Hr_1:
    59 00:C782: 53 12             LDA     #12H
    60 00:C784: 16 59 C3          JMP     L_Scankey_Input_Set_Mode_Hr_usually
    60                        
   162                        .INCLUDE	Key\Scankey_Function_Alarm.asm
     1                        ;清除贪睡功能
     2                        L_Control_SNZ_Close_Prog:
     3 00:C787: 43 91 18      	LDA		R_Mode
     4 00:C78A: 56 01         	CMP		#1
     5 00:C78C: 13 0E         	BEQ		L_Control_SNZ_Close_Prog_RTS
     6 00:C78E: 56 03             CMP		#3
     7 00:C790: 11 0A         	BCS		L_Control_SNZ_Close_Prog_RTS
     8 00:C792: 27 A1         	RMB7	Sys_Flag_C
     9 00:C794: 53 00         	LDA		#0
    10 00:C796: 4F 96 18      	STA		R_Snz_Time
    11 00:C799: 4F 97 18      	STA		R_Snz_Frequency;进入闹钟时间的设置会清除贪睡
    12                        L_Control_SNZ_Close_Prog_RTS:
    13 00:C79C: 09                RTS
    14                        ;======================================================================
    15                        ;非设置模式下吗,闹钟模式，
    16                        ;短按RESET，在整点报时界面，开启或关闭整点报时，按下触发
    17                        ;在闹钟界面,按下触发闹铃模式的切换，关闭，普通和贪睡
    18                        ;======================================================================
    19                        
    20                        L_Alarm_First_Press_Prog:
    21 00:C79D: 73 A6         	LDA		P_Scankey_value
    22 00:C79F: 56 04         	CMP		#D_Alm_Press
    23 00:C7A1: 13 09         	BEQ		L_Alarm_First_Press_Prog_Alm_Press
    24 00:C7A3: 56 12         	CMP		#D_Sig_Press
    25 00:C7A5: 13 1F         	BEQ		L_Alarm_First_Press_Prog_Sig_Press
    26 00:C7A7: 56 17         	CMP		#D_Beep_Test_Press
    27 00:C7A9: 13 28         	BEQ		L_Alarm_First_Press_Prog_Beep_Test_Press
    28 00:C7AB: 09            	RTS
    29                        
    30                        
    31                        
    32                        L_Alarm_First_Press_Prog_Alm_Press:;控制闹钟贪睡的开启关闭
    33 00:C7AC: 15 87 C7      	JSR		L_Control_SNZ_Close_Prog
    34 00:C7AF: 73 B9         	LDA		R_Alarm_Mode
    35 00:C7B1: 56 02         	CMP		#2
    36 00:C7B3: 11 0A         	BCS		L_Alarm_First_Reset_Press_Prog_Alarm_Prog_Clr
    37 00:C7B5: 04            	CLC
    38 00:C7B6: 73 B9         	LDA		R_Alarm_Mode
    39 00:C7B8: 54 01         	ADC		#1
    40 00:C7BA: 7F B9         	STA		R_Alarm_Mode
    41 00:C7BC: 16 4B CC      	JMP		L_Dis_Alm_Snz_Symbol_Prog
    42                        L_Alarm_First_Reset_Press_Prog_Alarm_Prog_Clr:
    43 00:C7BF: 53 00         	LDA		#0
    44 00:C7C1: 7F B9         	STA		R_Alarm_Mode
    45 00:C7C3: 16 37 CC      	JMP		L_Clr_Alm_Snz_Symbol_Prog
    46                        ;======================================================
    47                        L_Alarm_First_Press_Prog_Sig_Press:;控制整点报时的开启和关闭
    48                        
    49 00:C7C6: 39 A1 05      	BBS1	Sys_Flag_C,L_Alarm_First_Reset_Press_Prog_Every_Hour_Mode_Close
    50 00:C7C9: 29 A1         	SMB1	Sys_Flag_C
    51 00:C7CB: 16 8E CC      	JMP		L_Dis_lcd_Sig_Prog
    52                        L_Alarm_First_Reset_Press_Prog_Every_Hour_Mode_Close:
    53 00:C7CE: 21 A1         	RMB1	Sys_Flag_C
    54 00:C7D0: 16 CD CC      	JMP		L_Clr_lcd_Sig_Prog
    55                        ;------------------------------------------
    56                        L_Alarm_First_Press_Prog_Beep_Test_Press:;声音测试
    57 00:C7D3: 2E 9F         	SMB6	Sys_Flag_A;按键持续标志
    58 00:C7D5: 25 9F         	RMB5	Sys_Flag_A
    59                        	EN_LCD_IRQ
+   59 00:C7D7: 2E 0E          SMB6 IER
    60 00:C7D9: 53 02         	LDA		#2
    61 00:C7DB: 4F 95 18      	STA		R_Voice_Unit
    62 00:C7DE: 09            	RTS
    63                        
    64                        
    65                        
    66                        
    67                        
    68                        
    69                        
    70                        
    71                        
    72                        
    73                        
    74                        
    75                        
    76                        ;=====================================
    77                        ;=====================================
    78                        ;=====================================
    79                        ;=====================================
    80                        ;=====================================
    81                        ;=====================================
    82                        ;=====================================
    83                        ;设置模式下闹钟的按键功能
    84                        ;=====================================
    85                        L_Scankey_Set_Mode_Prog_Alarm_Clock:
    86 00:C7DF: 73 A6            LDA      P_Scankey_value
    87 00:C7E1: 56 0F            CMP      #D_NUM_Point_Press
    88 00:C7E3: 13 17            BEQ      L_Change_12_24_Prog_PM_AM_Alarm_Clock
    89 00:C7E5: 73 BA            LDA      R_Mode_Set
    90 00:C7E7: 04               CLC
    91 00:C7E8: 06               CLD
    92 00:C7E9: 18               ROL
    93 00:C7EA: 1B               TAX
    94 00:C7EB: 63 F5 C7         LDA      Table_Alarm_Clock_Plus+1,X
    95 00:C7EE: 0A               PHA
    96 00:C7EF: 63 F4 C7         LDA      Table_Alarm_Clock_Plus,X
    97 00:C7F2: 0A               PHA
    98 00:C7F3: 09               RTS
    99                        Table_Alarm_Clock_Plus:
   100                        
   101 00:C7F4: 0B C8             DW      L_Control_Set_Mode_Alarm_Clock_Prog_Hr-1
   102 00:C7F6: 0B C8             DW      L_Control_Set_Mode_Alarm_Clock_Prog_Hr-1
   103 00:C7F8: 04 C8         	DW      L_Control_Set_Mode_Alarm_Clock_Prog_Min-1
   104 00:C7FA: 04 C8             DW      L_Control_Set_Mode_Alarm_Clock_Prog_Min-1
   105                        ;====================================================
   106                        L_Change_12_24_Prog_PM_AM_Alarm_Clock:
   107 00:C7FC: 5E 10             LDX		#(R_Alarm_Clock_Hr-Time_Str_Addr)
   108 00:C7FE: 15 1B C8      	JSR		L_Change_12_14_Prog_AM_PM_ususally_Prog
   109 00:C801: 15 DF CB          JSR     L_Display_Alarm_Clock_Hr_Prog
   110 00:C804: 09                RTS
   111                        ;====================================================
   112                        
   113                        L_Control_Set_Mode_Alarm_Clock_Prog_Min:
   114 00:C805: 5E 0F             LDX     #(R_Alarm_Clock_Min-Time_Str_Addr)
   115 00:C807: 53 59             LDA     #59H
   116 00:C809: 16 D8 C2          JMP     L_Scankey_Input_Set_Mode_Usally
   117                        ;====================================================
   118                        
   119                        L_Control_Set_Mode_Alarm_Clock_Prog_Hr:
   120 00:C80C: 5E 10             LDX     #(R_Alarm_Clock_Hr-Time_Str_Addr)
   121 00:C80E: 32 A0 05          BBR2    Sys_Flag_B,L_Control_Set_Mode_Alarm_Clock_Prog_Hr_1
   122 00:C811: 53 23             LDA     #23H
   123 00:C813: 16 D8 C2          JMP     L_Scankey_Input_Set_Mode_Usally
   124                        L_Control_Set_Mode_Alarm_Clock_Prog_Hr_1:
   125 00:C816: 53 12             LDA     #12H
   126 00:C818: 16 59 C3          JMP     L_Scankey_Input_Set_Mode_Hr_usually
   127                        
   127                        
   163                        .INCLUDE	Key\ScanKey_Function_usually.asm
     1                        ;=======================================
     2                        ;改变12小时制的AM和PM
     3                        ;=======================================
     4                        L_Change_12_14_Prog_AM_PM_ususally_Prog:
     5 00:C81B: 3A A0 10          BBS2    Sys_Flag_B,L_Change_12_24_Prog_PM_AM_RTS;非12小时制退出
     6 00:C81E: 63 28 18          LDA     Time_Addr,X
     7 00:C821: 56 0C             CMP     #12
     8 00:C823: 10 0A             BCC     L_Change_12_24_Prog_PM_AM_1;比12小跳转，此时有上午变为下午
     9 00:C825: 00                SEC
    10 00:C826: 63 28 18          LDA     Time_Addr,X;自减12
    11 00:C829: 55 0C             SBC     #12
    12 00:C82B: 6F 28 18          STA     Time_Addr,X
    13                        L_Change_12_24_Prog_PM_AM_RTS:
    14 00:C82E: 09                RTS
    15                        L_Change_12_24_Prog_PM_AM_1:
    16 00:C82F: 04                CLC
    17 00:C830: 53 0C             LDA     #12
    18 00:C832: 64 28 18          ADC     Time_Addr,X;自加12
    19 00:C835: 6F 28 18          STA     Time_Addr,X
    20 00:C838: 09                RTS
    21                        ;============================================
    22                        ;12小时到24小时
    23                        ;============================================
    24                        L_24_Hour_12_Hour_Prog:
    25 00:C839: 63 28 18          LDA     Time_Addr,X
    26 00:C83C: 13 09             BEQ     L_12_Hour_24_Hour_Prog_0_Hour
    27 00:C83E: 56 0C             CMP     #12
    28 00:C840: 13 07             BEQ     L_12_Hour_24_Hour_Prog_RTS
    29 00:C842: 10 05             BCC     L_12_Hour_24_Hour_Prog_RTS
    30 00:C844: 55 0C             SBC     #12
    31 00:C846: 09                RTS
    32                        L_12_Hour_24_Hour_Prog_0_Hour:
    33 00:C847: 53 0C             LDA     #12
    34                        L_12_Hour_24_Hour_Prog_RTS:
    35 00:C849: 09                RTS
    36                        ;==============================================
    37                        ;12小时到24小时
    38                        ;==============================================
    39                        L_12_Hour_24_Hour_Prog:
    40 00:C84A: 7F F0             STA     P_Temp+1
    41 00:C84C: 7E F6             LDX     P_Temp+7
    42 00:C84E: 63 28 18          LDA     Time_Addr,X
    43 00:C851: 56 0C             CMP     #12
    44 00:C853: 11 09             BCS     L_24_Hour_12_Hour_Prog_PM
    45 00:C855: 73 F0             LDA     P_Temp+1
    46 00:C857: 56 0C             CMP     #12
    47 00:C859: 12 02             BNE     L_24_Hour_12_Hour_Prog_AM_RTS
    48 00:C85B: 53 00             LDA     #0
    49                        L_24_Hour_12_Hour_Prog_AM_RTS:
    50 00:C85D: 09                RTS
    51                        L_24_Hour_12_Hour_Prog_PM:
    52 00:C85E: 73 F0             LDA     P_Temp+1
    53 00:C860: 56 0C             CMP     #12
    54 00:C862: 12 F9             BNE     L_24_Hour_12_Hour_Prog_AM_RTS
    55 00:C864: 04                CLC
    56 00:C865: 54 0C             ADC     #12
    57                            RTS
    57 00:C867: 09            
   164                        .INCLUDE	Key\Scankey_Function_Positive_Timer.asm
     1                        ;======================================================================
     2                        ;非设置模式下吗,正计时模式，短按ST/SP键，开始或停止计时，存在按键音
     3                        ;短按RESET，在计时途中，中途测量被设置，再次按下被取消
     4                        ;======================================================================
     5                        L_Positive_Timer_First_Press_Prog:
     6 00:C868: 73 A6         	LDA		P_Scankey_value
     7 00:C86A: 56 10         	CMP		#D_ST_SP_Press
     8 00:C86C: 13 1E         	BEQ		L_Positive_Timer_First_ST_SP_Press_Prog
     9 00:C86E: 56 0C         	CMP		#D_Reset_Press
    10 00:C870: 13 33         	BEQ		L_Positive_Timer_First_RESET_Press_Prog
    11 00:C872: 56 13         	CMP		#D_ST_Hour_Press
    12 00:C874: 13 01         	BEQ		L_Positive_Timer_First_Press_Prog_ST_Hour_Press
    13 00:C876: 09            	RTS
    14                        ;--------------------------------------------------
    15                        L_Positive_Timer_First_Press_Prog_ST_Hour_Press:
    16 00:C877: 15 19 CE      	JSR		L_Clr_All_8Bit_Prog
    17 00:C87A: 15 BA CC      	JSR		L_Clr_col_Prog
    18 00:C87D: 2E 9F         	SMB6	Sys_Flag_A
    19 00:C87F: 25 9F             RMB5    Sys_Flag_A
    20                        
    21 00:C881: 35 A2 04          BBR5    Sys_Flag_D,L_Positive_Timer_First_Press_Prog_ST_Hour_Press_1
    22 00:C884: 15 2D CC      	JSR		L_Display_Positive_Timer_Hr_Prog_Measurement
    23 00:C887: 09            	RTS
    24                        L_Positive_Timer_First_Press_Prog_ST_Hour_Press_1:
    25 00:C888: 15 FD CB          JSR     L_Display_Positive_Timer_Hr_Prog
    26 00:C88B: 09                RTS
    27                        L_Positive_Timer_First_ST_SP_Press_Prog:
    28 00:C88C: 38 A2 08      	BBS0	Sys_Flag_D,L_Positive_Timer_First_SP_Press_Prog
    29 00:C88F: 28 A2         	SMB0	Sys_Flag_D
    30                        	EN_LCD_IRQ
+   30 00:C891: 2E 0E          SMB6 IER
    31 00:C893: 15 BD CA      	JSR		L_Display_Prog;消除瞄点问题
    32                        L_Positive_Timer_First_ST_SP_Press_Prog_OUT:
    33 00:C896: 09            	RTS
    34                        L_Positive_Timer_First_SP_Press_Prog:
    35 00:C897: 20 A2         	RMB0	Sys_Flag_D
    36 00:C899: 26 A2         	RMB6	Sys_Flag_D
    37 00:C89B: 3D A2 03      	BBS5	Sys_Flag_D,L_Positive_Timer_First_SP_Press_Prog_OUT
    38 00:C89E: 16 BD CA      	JMP		L_Display_Prog
    39                        L_Positive_Timer_First_SP_Press_Prog_OUT:
    40 00:C8A1: 15 64 CC      	JSR		L_Dis_col_Prog
    41 00:C8A4: 09            	RTS
    42                        ;----------------------------------------------------
    43                        L_Positive_Timer_First_RESET_Press_Prog:
    44 00:C8A5: 2D 9F         	SMB5	Sys_Flag_A
    45 00:C8A7: 38 A2 14      	BBS0	Sys_Flag_D,L_Positive_Timer_Midway_Measurement;判断此时正计时是否运行
    46 00:C8AA: 3D A2 28      	BBS5	Sys_Flag_D,L_Positive_Timer_Midway_Measurement_2
    47 00:C8AD: 53 00         	LDA		#0
    48 00:C8AF: 7F B2         	STA		R_Timer_Sec
    49 00:C8B1: 7F B3         	STA		R_Timer_Min
    50 00:C8B3: 7F B4         	STA		R_Timer_Hr
    51 00:C8B5: 7F B1         	STA		R_Timer_Ms
    52 00:C8B7: 7F B6         	STA		R_Timer_X_1
    53 00:C8B9: 7F A2         	STA		Sys_Flag_D
    54                        L_Positive_Timer_Midway_Measurement_1:
    55 00:C8BB: 16 BD CA      	JMP		L_Display_Prog
    56                        L_Positive_Timer_Midway_Measurement:
    57 00:C8BE: 3D A2 14      	BBS5	Sys_Flag_D,L_Positive_Timer_Midway_Measurement_2
    58 00:C8C1: 2D A2         	SMB5	Sys_Flag_D
    59 00:C8C3: 73 B4             LDA     R_Timer_Hr
    60 00:C8C5: 7F D5             STA     R_Timer_Hr_Measurement
    61 00:C8C7: 73 B3             LDA     R_Timer_Min
    62 00:C8C9: 7F D6             STA     R_Timer_Min_Measurement
    63 00:C8CB: 73 B2             LDA     R_Timer_Sec
    64 00:C8CD: 7F D7             STA     R_Timer_Sec_Measurement
    65 00:C8CF: 73 B1             LDA     R_Timer_Ms
    66 00:C8D1: 7F D8             STA     R_Timer_Ms_Measurement
    67 00:C8D3: 17 E6         	BRA		L_Positive_Timer_Midway_Measurement_1
    68                        L_Positive_Timer_Midway_Measurement_2:
    69 00:C8D5: 25 A2         	RMB5	Sys_Flag_D
    70 00:C8D7: 17 E2         	BRA		L_Positive_Timer_Midway_Measurement_1
    70                        
   165                        
   166                        
   167                        
   168                        .INCLUDE	Display\Disp.asm
     1                        ;===========================================================
     2                        ;程序功能：	显示8BIT字段
     3                        ;程序入口：	A =  显示内容
     4                        ;			X =  ofc
     5                        ;影响资源：P_Temp，P_Temp+1，P_Temp+2，P_Temp+3,X，A
     6                        ;===========================================================
     7                        L_Dis_8Bit_DigitDot_Prog:
     8                        ;	STA		P_Temp
     9                        ;	LDA		Table_Digit_Addr_Offset,X
    10 00:C8D9: 7C F0         	STX		P_Temp+1;显示在那个位置上
    11 00:C8DB: 1B            	TAX
    12 00:C8DC: 63 4A C9      	LDA		Table_Digit_DataDot,X;查要显示的数对应的段码
    13 00:C8DF: 7E F0         	LDX		P_Temp+1
    14                        F_DispPro:
    15 00:C8E1: 7F EF         	STA		P_Temp;保存显示的数对应的段码
    16 00:C8E3: 7C F0         	STX		P_Temp+1;再次保存显示位置
    17 00:C8E5: 53 07         	LDA		#7
    18 00:C8E7: 7F F2         	STA		P_Temp+3	;显示段数
    19                        L_Judge_Dis_8Bit_DigitDot:;显示循环的开始
    20 00:C8E9: 7E F0         	LDX		P_Temp+1	;加载位置索引到x
    21 00:C8EB: 63 BF C9      	LDA		Lcd_bit,X	;加载com线
    22 00:C8EE: 7F F1         	STA		P_Temp+2
    23 00:C8F0: 63 61 C9      	LDA		Lcd_byte,X	;加载SEG线
    24 00:C8F3: 1B            	TAX
    25 00:C8F4: 7B EF         	ROR		P_Temp		;循环右移
    26 00:C8F6: 10 0A         	BCC		L_CLR		;c=0是清除
    27 00:C8F8: 63 00 18      	LDA		LCD_RamAddr,X	;加载LCD RAM地址
    28 00:C8FB: 70 F1         	ORA		P_Temp+2		;将COM和SEG信息与LCD RAM地址进行逻辑或操作
    29 00:C8FD: 6F 00 18      	STA		LCD_RamAddr,X	;将结果写回LCD RAM，更新显示
    30 00:C900: 17 0A         	BRA		L_Inc_Dis_Index_Prog	;跳转到显示索引增加的子程序。
    31                        L_CLR:
    32 00:C902: 63 00 18      	LDA		LCD_RamAddr,X	;加载LCD RAM的地址
    33 00:C905: 70 F1         	ORA		P_Temp+2		;将COM和SEG信息与LCD RAM地址进行逻辑或操作
    34 00:C907: 72 F1         	EOR		P_Temp+2		;进行异或操作，用于清除对应的段。
    35 00:C909: 6F 00 18      	STA		LCD_RamAddr,X	;将结果写回LCD RAM，清除对应位置。
    36                        L_Inc_Dis_Index_Prog:		;增加显示索引，减少显示段数
    37 00:C90C: 78 F0         	INC		P_Temp+1		;增加P_Temp+1（位置索引）
    38 00:C90E: 79 F2         	DEC		P_Temp+3		;减少P_Temp+3（段数
    39 00:C910: 12 D7         	BNE		L_Judge_Dis_8Bit_DigitDot	;如果段数不为0，回到循环开始，否则退出
    40 00:C912: 09            	RTS
    41                        
    42                        F_DispPro_8bit:
    43 00:C913: 7F EF         	STA		P_Temp			;保存段码的值
    44 00:C915: 7C F0         	STX		P_Temp+1
    45 00:C917: 53 08         	LDA		#8
    46 00:C919: 7F F2         	STA		P_Temp+3	;显示段数
    47 00:C91B: 17 CC         	BRA		L_Judge_Dis_8Bit_DigitDot
    48                        ;-----------------------------------------
    49                        F_DispSymbol:		;input Xcc -> ofs
    50 00:C91D: 15 2D C9      	JSR		F_DispSymbol_Com
    51 00:C920: 6F 00 18      	STA		LCD_RamAddr,X	;实现显示
    52 00:C923: 09            	RTS
    53                        
    54                        F_ClrpSymbol:		;input Xcc -> ofs
    55 00:C924: 15 2D C9      	JSR		F_DispSymbol_Com	;清除显示
    56 00:C927: 72 F1         	EOR		P_Temp+2
    57 00:C929: 6F 00 18      	STA		LCD_RamAddr,X
    58 00:C92C: 09            	RTS
    59                        
    60                        F_DispSymbol_Com:
    61 00:C92D: 63 BF C9      	LDA		Lcd_bit,X	;加载X寄存器对应的COM线
    62 00:C930: 7F F1         	STA		P_Temp+2
    63 00:C932: 63 61 C9      	LDA		Lcd_byte,X	;加载X寄存器对应的SEG线
    64 00:C935: 1B            	TAX
    65 00:C936: 63 00 18      	LDA		LCD_RamAddr,X;加载LCD	RAM	地址
    66 00:C939: 70 F1         	ORA		P_Temp+2
    67 00:C93B: 09            	RTS
    68                        ;============================================================
    69                        ;===============================================
    70                        L_ROR_4Bit_Prog:
    71                        L_ROR4Bit_Prog:
    72                        L_LSR4Bit_Prog:
    73                        F_MSBToLSB:
    74 00:C93C: 19            	ROR
    75 00:C93D: 19            	ROR
    76 00:C93E: 19            	ROR
    77 00:C93F: 19            	ROR
    78 00:C940: 51 0F         	AND		#$0F
    79 00:C942: 09            	RTS
    80                        L_ROL_4Bit_Prog:
    81 00:C943: 18            	ROL
    82 00:C944: 18            	ROL
    83 00:C945: 18            	ROL
    84 00:C946: 18            	ROL
    85 00:C947: 51 F0         	AND		#F0H
    86 00:C949: 09            	RTS
    87                        ;================================================
    88                        ;********************************************
    89                        Table_Digit_DataDot:	;显示内容对应显示的段码
    90                                   ;hgfedcba
    91 00:C94A: 3F            	.BYTE 	3fh	;0
    92 00:C94B: 06            	.BYTE	06h	;1
    93 00:C94C: 5B            	.BYTE	5bh	;2
    94 00:C94D: 4F            	.BYTE	4fh	;3
    95 00:C94E: 66            	.BYTE	66h	;4
    96 00:C94F: 6D            	.BYTE	6dh	;5
    97 00:C950: 7D            	.BYTE	7dh	;6
    98 00:C951: 27            	.BYTE	27h	;7
    99 00:C952: 7F            	.BYTE	7fh	;8
   100 00:C953: 6F            	.BYTE	6fh	;9
   101 00:C954: 00            	.BYTE	00h	;清除10
   102 00:C955: 40            	.BYTE	01000000B;负号11
   103 00:C956: 76            	.BYTE	01110110B;H12
   104 00:C957: 50            	.BYTE	01010000B;r13
   105 00:C958: 37            	.BYTE	00110111B;N	14
   106 00:C959: 31            	.BYTE	00110001B;T的左边15
   107 00:C95A: 3E            	.BYTE	00111110B;U.16
   108 00:C95B: 79            	.BYTE	01111001B;E.17
   109 00:C95C: 77            	.BYTE	01110111B;A.18
   110 00:C95D: 71            	.BYTE	01110001B;F	19
   111 00:C95E: 38            	.BYTE	00111000B;L	20
   112 00:C95F: 73            	.BYTE	01110011B;P	21
   113 00:C960: 08            	.BYTE	00001000B;一条横杠22
   114                        
   115                        
   116                        
   116                        
   169                        .INCLUDE	Display\Lcdtab.asm
     1                        ;--------COM------------
     2                        c0	.equ	0
     3                        c1	.equ	1
     4                        c2	.equ	2
     5                        c3	.equ	3
     6                        c4	.equ	4
     7                        ; c5	.equ	5
     8                        ; c6	.equ	6
     9                        ;;--------SEG------------
    10                        ; s47	.equ	47
    11                        ; s46	.equ	46
    12                        ; s45	.equ	45
    13                        ; s44	.equ	44
    14                        s43	.equ	43
    15                        s42	.equ	42
    16                        s41	.equ	41
    17                        s40	.equ	40
    18                        s39	.equ	39
    19                        s38	.equ	38
    20                        s37	.equ	37
    21                        s36	.equ	36
    22                        s35	.equ	35
    23                        s34	.equ	34
    24                        s33	.equ	33
    25                        s32	.equ	32
    26                        ; s31	.equ	31
    27                        ; s30	.equ	30
    28                        ; s29	.equ	29
    29                        ; s28	.equ	28
    30                        ; s27	.equ	27
    31                        ; s26	.equ	26
    32                        ; s25	.equ	25
    33                        ; s24	.equ	24
    34                        ; s23	.equ	23
    35                        ; s22	.equ	22
    36                        ; s21	.equ	21
    37                        ; s20	.equ	20
    38                        ; s19	.equ	19
    39                        ; s18	.equ	18
    40                        ; s17	.equ	17
    41                        ; s16	.equ	16
    42                        s15	.equ	15
    43                        s14	.equ	14
    44                        s13	.equ	13
    45                        s12	.equ	12
    46                        s11	.equ	11
    47                        s10	.equ	10
    48                        s9	.equ	9
    49                        s8	.equ	8
    50                        ; s7	.equ	7
    51                        ; s6	.equ	6
    52                        ; s5	.equ	5
    53                        ; s4	.equ	4
    54                        ; s3	.equ	3
    55                        ; s2	.equ	2
    56                        ; s1	.equ	1
    57                        ; s0	.equ	0
    58                        
    59                        
    60                        .MACRO  db_c_s	com,seg
    61                                  .BYTE com*6+seg/8
    62                        .ENDMACRO
    63                        
    64                        .MACRO  db_c_y	com,seg
    65                        	      .BYTE 1.shl.(seg-seg/8*8)
    66                        .ENDMACRO
    67                        
    68                        Lcd_byte:	;段码
    69                        lcd_table1:
    70                        lcd_d1 .equ	lcd_table1-lcd_table1
    71                        	db_c_s	c2,s41	;;1A
+   71 00:C961: 11             .DB c2*$0006+s41/$0008
    72                        	db_c_s	c2,s40	;;1B
+   72 00:C962: 11             .DB c2*$0006+s40/$0008
    73                        	db_c_s	c4,s41	;;1C
+   73 00:C963: 1D             .DB c4*$0006+s41/$0008
    74                        	db_c_s	c4,s42	;;1D
+   74 00:C964: 1D             .DB c4*$0006+s42/$0008
    75                        	db_c_s	c3,s42	;;1E
+   75 00:C965: 17             .DB c3*$0006+s42/$0008
    76                        	db_c_s	c2,s42	;;1F
+   76 00:C966: 11             .DB c2*$0006+s42/$0008
    77                        	db_c_s	c3,s41	;;1G
+   77 00:C967: 17             .DB c3*$0006+s41/$0008
    78                        
    79                        lcd_d2	.equ lcd_d1+7
    80                        	db_c_s	c2,s38	;;2A
+   80 00:C968: 10             .DB c2*$0006+s38/$0008
    81                        	db_c_s	c3,s38	;;2B
+   81 00:C969: 16             .DB c3*$0006+s38/$0008
    82                        	db_c_s	c4,s38	;;2C
+   82 00:C96A: 1C             .DB c4*$0006+s38/$0008
    83                        	db_c_s	c4,s39	;;2D
+   83 00:C96B: 1C             .DB c4*$0006+s39/$0008
    84                        	db_c_s	c3,s40	;;2E
+   84 00:C96C: 17             .DB c3*$0006+s40/$0008
    85                        	db_c_s	c2,s39	;;2F
+   85 00:C96D: 10             .DB c2*$0006+s39/$0008
    86                        	db_c_s	c3,s39	;;2G
+   86 00:C96E: 16             .DB c3*$0006+s39/$0008
    87                        
    88                        lcd_d3	.equ lcd_d2+7
    89                        
    90                        	db_c_s	c2,s36	;;3A
+   90 00:C96F: 10             .DB c2*$0006+s36/$0008
    91                        	db_c_s	c2,s34	;;3B
+   91 00:C970: 10             .DB c2*$0006+s34/$0008
    92                        	db_c_s	c4,s35	;;3C
+   92 00:C971: 1C             .DB c4*$0006+s35/$0008
    93                        	db_c_s	c4,s36	;;3D
+   93 00:C972: 1C             .DB c4*$0006+s36/$0008
    94                        	db_c_s	c3,s37	;;3E
+   94 00:C973: 16             .DB c3*$0006+s37/$0008
    95                        	db_c_s	c2,s37	;;3F
+   95 00:C974: 10             .DB c2*$0006+s37/$0008
    96                        	db_c_s	c3,s35	;;3G
+   96 00:C975: 16             .DB c3*$0006+s35/$0008
    97                        
    98                        lcd_d4	.equ lcd_d3+7
    99                        
   100                        	db_c_s	c2,s32	;;4A
+  100 00:C976: 10             .DB c2*$0006+s32/$0008
   101                        	db_c_s	c3,s32	;;4B
+  101 00:C977: 16             .DB c3*$0006+s32/$0008
   102                        	db_c_s	c4,s32	;;4C
+  102 00:C978: 1C             .DB c4*$0006+s32/$0008
   103                        	db_c_s	c4,s33	;;4D
+  103 00:C979: 1C             .DB c4*$0006+s33/$0008
   104                        	db_c_s	c3,s34	;;4E
+  104 00:C97A: 16             .DB c3*$0006+s34/$0008
   105                        	db_c_s	c2,s33	;;4F
+  105 00:C97B: 10             .DB c2*$0006+s33/$0008
   106                        	db_c_s	c3,s33	;;4G
+  106 00:C97C: 16             .DB c3*$0006+s33/$0008
   107                        
   108                        
   109                        
   110                        lcd_d5	.equ lcd_d4+7
   111                        
   112                        	db_c_s	c2,s14	;;5A
+  112 00:C97D: 0D             .DB c2*$0006+s14/$0008
   113                        	db_c_s	c2,s13	;;5B
+  113 00:C97E: 0D             .DB c2*$0006+s13/$0008
   114                        	db_c_s	c3,s13	;;5C
+  114 00:C97F: 13             .DB c3*$0006+s13/$0008
   115                        	db_c_s	c4,s14	;;5D
+  115 00:C980: 19             .DB c4*$0006+s14/$0008
   116                        	db_c_s	c3,s15	;;5E
+  116 00:C981: 13             .DB c3*$0006+s15/$0008
   117                        	db_c_s	c2,s15	;;5F
+  117 00:C982: 0D             .DB c2*$0006+s15/$0008
   118                        	db_c_s	c3,s14	;;5G
+  118 00:C983: 13             .DB c3*$0006+s14/$0008
   119                        
   120                        lcd_d6	.equ lcd_d5+7
   121                        
   122                        	db_c_s	c0,s12	;;6A
+  122 00:C984: 01             .DB c0*$0006+s12/$0008
   123                        	db_c_s	c1,s11	;;6B
+  123 00:C985: 07             .DB c1*$0006+s11/$0008
   124                        	db_c_s	c3,s11	;;6C
+  124 00:C986: 13             .DB c3*$0006+s11/$0008
   125                        	db_c_s	c4,s12	;;6D
+  125 00:C987: 19             .DB c4*$0006+s12/$0008
   126                        	db_c_s	c3,s12	;;6E
+  126 00:C988: 13             .DB c3*$0006+s12/$0008
   127                        	db_c_s	c1,s12	;;6F
+  127 00:C989: 07             .DB c1*$0006+s12/$0008
   128                        	db_c_s	c2,s12	;;6G
+  128 00:C98A: 0D             .DB c2*$0006+s12/$0008
   129                        
   130                        lcd_d7	.equ lcd_d6+7
   131                        
   132                        	db_c_s	c0,s10	;;7A
+  132 00:C98B: 01             .DB c0*$0006+s10/$0008
   133                        	db_c_s	c1,s10	;;7B
+  133 00:C98C: 07             .DB c1*$0006+s10/$0008
   134                        	db_c_s	c3,s10	;;7C
+  134 00:C98D: 13             .DB c3*$0006+s10/$0008
   135                        	db_c_s	c4,s10	;;7D
+  135 00:C98E: 19             .DB c4*$0006+s10/$0008
   136                        	db_c_s	c2,s11	;;7E
+  136 00:C98F: 0D             .DB c2*$0006+s11/$0008
   137                        	db_c_s	c0,s11	;;7F
+  137 00:C990: 01             .DB c0*$0006+s11/$0008
   138                        	db_c_s	c2,s10	;;7G
+  138 00:C991: 0D             .DB c2*$0006+s10/$0008
   139                        
   140                        lcd_d8	.equ lcd_d7+7
   141                        
   142                        	db_c_s	c0,s9	;;8A
+  142 00:C992: 01             .DB c0*$0006+s9/$0008
   143                        	db_c_s	c1,s8	;;8B
+  143 00:C993: 07             .DB c1*$0006+s8/$0008
   144                        	db_c_s	c3,s8	;;8C
+  144 00:C994: 13             .DB c3*$0006+s8/$0008
   145                        	db_c_s	c4,s8	;;8D
+  145 00:C995: 19             .DB c4*$0006+s8/$0008
   146                        	db_c_s	c3,s9	;;8E
+  146 00:C996: 13             .DB c3*$0006+s9/$0008
   147                        	db_c_s	c1,s9	;;8F
+  147 00:C997: 07             .DB c1*$0006+s9/$0008
   148                        	db_c_s	c2,s9	;;8G
+  148 00:C998: 0D             .DB c2*$0006+s9/$0008
   149                        lcd_d9	.equ lcd_d8+7
   150                        
   151                        	db_c_s	c0,s35	;;9A
+  151 00:C999: 04             .DB c0*$0006+s35/$0008
   152                        	db_c_s	c1,s35	;;9B
+  152 00:C99A: 0A             .DB c1*$0006+s35/$0008
   153                        	db_c_s	c1,s36	;;9C
+  153 00:C99B: 0A             .DB c1*$0006+s36/$0008
   154                        	db_c_s	c1,s37	;;9D
+  154 00:C99C: 0A             .DB c1*$0006+s37/$0008
   155                        	db_c_s	c0,s37	;;9E
+  155 00:C99D: 04             .DB c0*$0006+s37/$0008
   156                        	db_c_s	c0,s34	;;9F
+  156 00:C99E: 04             .DB c0*$0006+s34/$0008
   157                        	db_c_s	c0,s36	;;9G
+  157 00:C99F: 04             .DB c0*$0006+s36/$0008
   158                        
   159                        lcd_d10	.equ lcd_d9+7
   160                        
   161                        	db_c_s	c0,s15	;;10A
+  161 00:C9A0: 01             .DB c0*$0006+s15/$0008
   162                        	db_c_s	c1,s15	;;10B
+  162 00:C9A1: 07             .DB c1*$0006+s15/$0008
   163                        	db_c_s	c1,s32	;;10C
+  163 00:C9A2: 0A             .DB c1*$0006+s32/$0008
   164                        	db_c_s	c1,s33	;;10D
+  164 00:C9A3: 0A             .DB c1*$0006+s33/$0008
   165                        	db_c_s	c0,s33	;;10E
+  165 00:C9A4: 04             .DB c0*$0006+s33/$0008
   166                        	db_c_s	c0,s14	;;10F
+  166 00:C9A5: 01             .DB c0*$0006+s14/$0008
   167                        	db_c_s	c0,s32	;;10G
+  167 00:C9A6: 04             .DB c0*$0006+s32/$0008
   168                        
   169                        
   170                        
   171                        
   172                        
   173                        Lcd_dot:
   174                        lcd_col .equ Lcd_dot-lcd_table1
   175                        	db_c_s	c2,s35	;;col1
+  175 00:C9A7: 10             .DB c2*$0006+s35/$0008
   176                        	db_c_s	c3,s36	;;col2
+  176 00:C9A8: 16             .DB c3*$0006+s36/$0008
   177                        
   178                        	db_c_s	c1,s34	;;9H
+  178 00:C9A9: 0A             .DB c1*$0006+s34/$0008
   179                        
   180                        	db_c_s	c0,s13	;;10I
+  180 00:C9AA: 01             .DB c0*$0006+s13/$0008
   181                        	db_c_s	c1,s14	;;10H
+  181 00:C9AB: 07             .DB c1*$0006+s14/$0008
   182                        	db_c_s	c1,s13	;;10J
+  182 00:C9AC: 07             .DB c1*$0006+s13/$0008
   183                        
   184                        	db_c_s	c0,s41	;;ALM
+  184 00:C9AD: 05             .DB c0*$0006+s41/$0008
   185                        	db_c_s	c0,s40	;;SNZ
+  185 00:C9AE: 05             .DB c0*$0006+s40/$0008
   186                        	db_c_s	c0,s42	;;SIG
+  186 00:C9AF: 05             .DB c0*$0006+s42/$0008
   187                        
   188                        
   189                        
   190                        	db_c_s	c1,s42	;AM
+  190 00:C9B0: 0B             .DB c1*$0006+s42/$0008
   191                        	db_c_s	c1,s41	;;PM
+  191 00:C9B1: 0B             .DB c1*$0006+s41/$0008
   192                        
   193                        	db_c_s	c1,s40	;;K
+  193 00:C9B2: 0B             .DB c1*$0006+s40/$0008
   194                        	db_c_s	c1,s39	;;+
+  194 00:C9B3: 0A             .DB c1*$0006+s39/$0008
   195                        	db_c_s	c0,s39	;;-
+  195 00:C9B4: 04             .DB c0*$0006+s39/$0008
   196                        	db_c_s	c1,s38	;;*
+  196 00:C9B5: 0A             .DB c1*$0006+s38/$0008
   197                        	db_c_s	c0,s38	;;/
+  197 00:C9B6: 04             .DB c0*$0006+s38/$0008
   198                        
   199                        
   200                        	db_c_s	c4,s40	;;lcd_T1
+  200 00:C9B7: 1D             .DB c4*$0006+s40/$0008
   201                        	db_c_s	c4,s37	;;lcd_T2
+  201 00:C9B8: 1C             .DB c4*$0006+s37/$0008
   202                        	db_c_s	c4,s34	;;lcd_T3
+  202 00:C9B9: 1C             .DB c4*$0006+s34/$0008
   203                        	db_c_s	c4,s15	;;lcd_T4
+  203 00:C9BA: 19             .DB c4*$0006+s15/$0008
   204                        	db_c_s	c4,s13	;;lcd_T5
+  204 00:C9BB: 19             .DB c4*$0006+s13/$0008
   205                        	db_c_s	c4,s11	;;lcd_T6
+  205 00:C9BC: 19             .DB c4*$0006+s11/$0008
   206                        	db_c_s	c4,s9	;;lcd_T7
+  206 00:C9BD: 19             .DB c4*$0006+s9/$0008
   207                        	db_c_s	c2,s8	;;lcd_T8
+  207 00:C9BE: 0D             .DB c2*$0006+s8/$0008
   208                        
   209                        	lcd_col2		.EQU	lcd_col+1
   210                        	lcd_9H			.EQU	lcd_col+2
   211                        	lcd_10I			.EQU	lcd_col+3
   212                        	lcd_10H			.EQU	lcd_col+4
   213                        	lcd_10J			.EQU	lcd_col+5
   214                        	lcd_SIG			.EQU	lcd_col+6
   215                        	lcd_SNZ			.EQU	lcd_col+7
   216                        	lcd_ALM			.EQU	lcd_col+8
   217                        	lcd_AM			.EQU	lcd_col+9
   218                        	lcd_PM			.EQU	lcd_col+10
   219                        	lcd_Involution	.EQU	lcd_col+11
   220                        	lcd_Plus		.EQU	lcd_col+12
   221                        	lcd_SUB			.EQU	lcd_col+13
   222                        	lcd_Mul			.EQU	lcd_col+14
   223                        	lcd_DIV			.EQU	lcd_col+15
   224                        	lcd_T1		.EQU	lcd_col+16
   225                        	lcd_T2		.EQU	lcd_col+17
   226                        	lcd_T3		.EQU	lcd_col+18
   227                        	lcd_T4		.EQU	lcd_col+19
   228                        	lcd_T5		.EQU	lcd_col+20
   229                        	lcd_T6		.EQU	lcd_col+21
   230                        	lcd_T7		.EQU	lcd_col+22
   231                        	lcd_T8		.EQU	lcd_col+23
   232                        
   233                        
   234                        
   235                        
   236                        ;=============.EQU	lcd_=============================================
   237                        ;==========================================================
   238                        Lcd_bit:
   239                        
   240                        	db_c_y	c2,s41	;;1A
+  240 00:C9BF: 02             .DB $0001<<(s41-s41/$0008*$0008)
   241                        	db_c_y	c2,s40	;;1B
+  241 00:C9C0: 01             .DB $0001<<(s40-s40/$0008*$0008)
   242                        	db_c_y	c4,s41	;;1C
+  242 00:C9C1: 02             .DB $0001<<(s41-s41/$0008*$0008)
   243                        	db_c_y	c4,s42	;;1D
+  243 00:C9C2: 04             .DB $0001<<(s42-s42/$0008*$0008)
   244                        	db_c_y	c3,s42	;;1E
+  244 00:C9C3: 04             .DB $0001<<(s42-s42/$0008*$0008)
   245                        	db_c_y	c2,s42	;;1F
+  245 00:C9C4: 04             .DB $0001<<(s42-s42/$0008*$0008)
   246                        	db_c_y	c3,s41	;;1G
+  246 00:C9C5: 02             .DB $0001<<(s41-s41/$0008*$0008)
   247                        
   248                        
   249                        	db_c_y	c2,s38	;;2A
+  249 00:C9C6: 40             .DB $0001<<(s38-s38/$0008*$0008)
   250                        	db_c_y	c3,s38	;;2B
+  250 00:C9C7: 40             .DB $0001<<(s38-s38/$0008*$0008)
   251                        	db_c_y	c4,s38	;;2C
+  251 00:C9C8: 40             .DB $0001<<(s38-s38/$0008*$0008)
   252                        	db_c_y	c4,s39	;;2D
+  252 00:C9C9: 80             .DB $0001<<(s39-s39/$0008*$0008)
   253                        	db_c_y	c3,s40	;;2E
+  253 00:C9CA: 01             .DB $0001<<(s40-s40/$0008*$0008)
   254                        	db_c_y	c2,s39	;;2F
+  254 00:C9CB: 80             .DB $0001<<(s39-s39/$0008*$0008)
   255                        	db_c_y	c3,s39	;;2G
+  255 00:C9CC: 80             .DB $0001<<(s39-s39/$0008*$0008)
   256                        
   257                        
   258                        
   259                        	db_c_y	c2,s36	;;3A
+  259 00:C9CD: 10             .DB $0001<<(s36-s36/$0008*$0008)
   260                        	db_c_y	c2,s34	;;3B
+  260 00:C9CE: 04             .DB $0001<<(s34-s34/$0008*$0008)
   261                        	db_c_y	c4,s35	;;3C
+  261 00:C9CF: 08             .DB $0001<<(s35-s35/$0008*$0008)
   262                        	db_c_y	c4,s36	;;3D
+  262 00:C9D0: 10             .DB $0001<<(s36-s36/$0008*$0008)
   263                        	db_c_y	c3,s37	;;3E
+  263 00:C9D1: 20             .DB $0001<<(s37-s37/$0008*$0008)
   264                        	db_c_y	c2,s37	;;3F
+  264 00:C9D2: 20             .DB $0001<<(s37-s37/$0008*$0008)
   265                        	db_c_y	c3,s35	;;3G
+  265 00:C9D3: 08             .DB $0001<<(s35-s35/$0008*$0008)
   266                        
   267                        
   268                        
   269                        	db_c_y	c2,s32	;;4A
+  269 00:C9D4: 01             .DB $0001<<(s32-s32/$0008*$0008)
   270                        	db_c_y	c3,s32	;;4B
+  270 00:C9D5: 01             .DB $0001<<(s32-s32/$0008*$0008)
   271                        	db_c_y	c4,s32	;;4C
+  271 00:C9D6: 01             .DB $0001<<(s32-s32/$0008*$0008)
   272                        	db_c_y	c4,s33	;;4D
+  272 00:C9D7: 02             .DB $0001<<(s33-s33/$0008*$0008)
   273                        	db_c_y	c3,s34	;;4E
+  273 00:C9D8: 04             .DB $0001<<(s34-s34/$0008*$0008)
   274                        	db_c_y	c2,s33	;;4F
+  274 00:C9D9: 02             .DB $0001<<(s33-s33/$0008*$0008)
   275                        	db_c_y	c3,s33	;;4G
+  275 00:C9DA: 02             .DB $0001<<(s33-s33/$0008*$0008)
   276                        
   277                        
   278                        
   279                        
   280                        
   281                        	db_c_y	c2,s14	;;5A
+  281 00:C9DB: 40             .DB $0001<<(s14-s14/$0008*$0008)
   282                        	db_c_y	c2,s13	;;5B
+  282 00:C9DC: 20             .DB $0001<<(s13-s13/$0008*$0008)
   283                        	db_c_y	c3,s13	;;5C
+  283 00:C9DD: 20             .DB $0001<<(s13-s13/$0008*$0008)
   284                        	db_c_y	c4,s14	;;5D
+  284 00:C9DE: 40             .DB $0001<<(s14-s14/$0008*$0008)
   285                        	db_c_y	c3,s15	;;5E
+  285 00:C9DF: 80             .DB $0001<<(s15-s15/$0008*$0008)
   286                        	db_c_y	c2,s15	;;5F
+  286 00:C9E0: 80             .DB $0001<<(s15-s15/$0008*$0008)
   287                        	db_c_y	c3,s14	;;5G
+  287 00:C9E1: 40             .DB $0001<<(s14-s14/$0008*$0008)
   288                        
   289                        
   290                        
   291                        	db_c_y	c0,s12	;;6A
+  291 00:C9E2: 10             .DB $0001<<(s12-s12/$0008*$0008)
   292                        	db_c_y	c1,s11	;;6B
+  292 00:C9E3: 08             .DB $0001<<(s11-s11/$0008*$0008)
   293                        	db_c_y	c3,s11	;;6C
+  293 00:C9E4: 08             .DB $0001<<(s11-s11/$0008*$0008)
   294                        	db_c_y	c4,s12	;;6D
+  294 00:C9E5: 10             .DB $0001<<(s12-s12/$0008*$0008)
   295                        	db_c_y	c3,s12	;;6E
+  295 00:C9E6: 10             .DB $0001<<(s12-s12/$0008*$0008)
   296                        	db_c_y	c1,s12	;;6F
+  296 00:C9E7: 10             .DB $0001<<(s12-s12/$0008*$0008)
   297                        	db_c_y	c2,s12	;;6G
+  297 00:C9E8: 10             .DB $0001<<(s12-s12/$0008*$0008)
   298                        
   299                        
   300                        
   301                        	db_c_y	c0,s10	;;7A
+  301 00:C9E9: 04             .DB $0001<<(s10-s10/$0008*$0008)
   302                        	db_c_y	c1,s10	;;7B
+  302 00:C9EA: 04             .DB $0001<<(s10-s10/$0008*$0008)
   303                        	db_c_y	c3,s10	;;7C
+  303 00:C9EB: 04             .DB $0001<<(s10-s10/$0008*$0008)
   304                        	db_c_y	c4,s10	;;7D
+  304 00:C9EC: 04             .DB $0001<<(s10-s10/$0008*$0008)
   305                        	db_c_y	c2,s11	;;7E
+  305 00:C9ED: 08             .DB $0001<<(s11-s11/$0008*$0008)
   306                        	db_c_y	c0,s11	;;7F
+  306 00:C9EE: 08             .DB $0001<<(s11-s11/$0008*$0008)
   307                        	db_c_y	c2,s10	;;7G
+  307 00:C9EF: 04             .DB $0001<<(s10-s10/$0008*$0008)
   308                        
   309                        
   310                        	db_c_y	c0,s9	;;8A
+  310 00:C9F0: 02             .DB $0001<<(s9-s9/$0008*$0008)
   311                        	db_c_y	c1,s8	;;8B
+  311 00:C9F1: 01             .DB $0001<<(s8-s8/$0008*$0008)
   312                        	db_c_y	c3,s8	;;8C
+  312 00:C9F2: 01             .DB $0001<<(s8-s8/$0008*$0008)
   313                        	db_c_y	c4,s8	;;8D
+  313 00:C9F3: 01             .DB $0001<<(s8-s8/$0008*$0008)
   314                        	db_c_y	c3,s9	;;8E
+  314 00:C9F4: 02             .DB $0001<<(s9-s9/$0008*$0008)
   315                        	db_c_y	c1,s9	;;8F
+  315 00:C9F5: 02             .DB $0001<<(s9-s9/$0008*$0008)
   316                        	db_c_y	c2,s9	;;8G
+  316 00:C9F6: 02             .DB $0001<<(s9-s9/$0008*$0008)
   317                        
   318                        
   319                        	db_c_y	c0,s35	;;9A
+  319 00:C9F7: 08             .DB $0001<<(s35-s35/$0008*$0008)
   320                        	db_c_y	c1,s35	;;9B
+  320 00:C9F8: 08             .DB $0001<<(s35-s35/$0008*$0008)
   321                        	db_c_y	c1,s36	;;9C
+  321 00:C9F9: 10             .DB $0001<<(s36-s36/$0008*$0008)
   322                        	db_c_y	c1,s37	;;9D
+  322 00:C9FA: 20             .DB $0001<<(s37-s37/$0008*$0008)
   323                        	db_c_y	c0,s37	;;9E
+  323 00:C9FB: 20             .DB $0001<<(s37-s37/$0008*$0008)
   324                        	db_c_y	c0,s34	;;9F
+  324 00:C9FC: 04             .DB $0001<<(s34-s34/$0008*$0008)
   325                        	db_c_y	c0,s36	;;9G
+  325 00:C9FD: 10             .DB $0001<<(s36-s36/$0008*$0008)
   326                        
   327                        
   328                        
   329                        	db_c_y	c0,s15	;;10A
+  329 00:C9FE: 80             .DB $0001<<(s15-s15/$0008*$0008)
   330                        	db_c_y	c1,s15	;;10B
+  330 00:C9FF: 80             .DB $0001<<(s15-s15/$0008*$0008)
   331                        	db_c_y	c1,s32	;;10C
+  331 00:CA00: 01             .DB $0001<<(s32-s32/$0008*$0008)
   332                        	db_c_y	c1,s33	;;10D
+  332 00:CA01: 02             .DB $0001<<(s33-s33/$0008*$0008)
   333                        	db_c_y	c0,s33	;;10E
+  333 00:CA02: 02             .DB $0001<<(s33-s33/$0008*$0008)
   334                        	db_c_y	c0,s14	;;10F
+  334 00:CA03: 40             .DB $0001<<(s14-s14/$0008*$0008)
   335                        	db_c_y	c0,s32	;;10G
+  335 00:CA04: 01             .DB $0001<<(s32-s32/$0008*$0008)
   336                        
   337                        
   338                        
   339                        
   340                        
   341                        	db_c_y	c2,s35	;;col1
+  341 00:CA05: 08             .DB $0001<<(s35-s35/$0008*$0008)
   342                        	db_c_y	c3,s36	;;col2
+  342 00:CA06: 10             .DB $0001<<(s36-s36/$0008*$0008)
   343                        
   344                        	db_c_y	c1,s34	;;9H
+  344 00:CA07: 04             .DB $0001<<(s34-s34/$0008*$0008)
   345                        
   346                        	db_c_y	c0,s13	;;10I
+  346 00:CA08: 20             .DB $0001<<(s13-s13/$0008*$0008)
   347                        	db_c_y	c1,s14	;;10H
+  347 00:CA09: 40             .DB $0001<<(s14-s14/$0008*$0008)
   348                        	db_c_y	c1,s13	;;10J
+  348 00:CA0A: 20             .DB $0001<<(s13-s13/$0008*$0008)
   349                        
   350                        	db_c_y	c0,s41	;;ALM
+  350 00:CA0B: 02             .DB $0001<<(s41-s41/$0008*$0008)
   351                        	db_c_y	c0,s40	;;SNZ
+  351 00:CA0C: 01             .DB $0001<<(s40-s40/$0008*$0008)
   352                        	db_c_y	c0,s42	;;SIG
+  352 00:CA0D: 04             .DB $0001<<(s42-s42/$0008*$0008)
   353                        
   354                        
   355                        
   356                        	db_c_y	c1,s42	;AM
+  356 00:CA0E: 04             .DB $0001<<(s42-s42/$0008*$0008)
   357                        	db_c_y	c1,s41	;;PM
+  357 00:CA0F: 02             .DB $0001<<(s41-s41/$0008*$0008)
   358                        
   359                        	db_c_y	c1,s40	;;K
+  359 00:CA10: 01             .DB $0001<<(s40-s40/$0008*$0008)
   360                        	db_c_y	c1,s39	;;+
+  360 00:CA11: 80             .DB $0001<<(s39-s39/$0008*$0008)
   361                        	db_c_y	c0,s39	;;-
+  361 00:CA12: 80             .DB $0001<<(s39-s39/$0008*$0008)
   362                        	db_c_y	c1,s38	;;*
+  362 00:CA13: 40             .DB $0001<<(s38-s38/$0008*$0008)
   363                        	db_c_y	c0,s38	;;/
+  363 00:CA14: 40             .DB $0001<<(s38-s38/$0008*$0008)
   364                        
   365                        
   366                        	db_c_y	c4,s40	;;lcd_T1
+  366 00:CA15: 01             .DB $0001<<(s40-s40/$0008*$0008)
   367                        	db_c_y	c4,s37	;;lcd_T2
+  367 00:CA16: 20             .DB $0001<<(s37-s37/$0008*$0008)
   368                        	db_c_y	c4,s34	;;lcd_T3
+  368 00:CA17: 04             .DB $0001<<(s34-s34/$0008*$0008)
   369                        	db_c_y	c4,s15	;;lcd_T4
+  369 00:CA18: 80             .DB $0001<<(s15-s15/$0008*$0008)
   370                        	db_c_y	c4,s13	;;lcd_T5
+  370 00:CA19: 20             .DB $0001<<(s13-s13/$0008*$0008)
   371                        	db_c_y	c4,s11	;;lcd_T6
+  371 00:CA1A: 08             .DB $0001<<(s11-s11/$0008*$0008)
   372                        	db_c_y	c4,s9	;;lcd_T7
+  372 00:CA1B: 02             .DB $0001<<(s9-s9/$0008*$0008)
   373                        	db_c_y	c2,s8	;;lcd_T8
+  169 00:CA1C: 01             .DB $0001<<(s8-s8/$0008*$0008)
   373                        
   170                        .INCLUDE	Display\Display.asm
     1                        
     2                        
     3                        L_Display_Set_Mode_Prog_TO:
     4 00:CA1D: 16 99 CA      	JMP		L_Display_Set_Mode_Prog
     5                        L_Display_Normal_Prog:
     6 00:CA20: 3B 9F FA      	BBS3	Sys_Flag_A,L_Display_Set_Mode_Prog_TO
     7 00:CA23: 3E 9F 15      	BBS6	Sys_Flag_A,L_Display_Normal_Prog_RTS
     8                        ; 	LDA		R_Close_All_Dis
     9                        ; 	BNE		L_Display_Alarm_Normal_Prog;当全显时不做要求
    10 00:CA26: 15 48 CC      	JSR		L_Dis_Alm_Snz_Symbol_Noraml_Prog
    11 00:CA29: 15 3E CC      	JSR		L_DIS_SNZ_Normal_Prog
    12 00:CA2C: 06            	CLD
    13 00:CA2D: 43 91 18      	LDA		R_Mode
    14 00:CA30: 04            	CLC
    15 00:CA31: 18            	ROL
    16 00:CA32: 1B            	TAX
    17 00:CA33: 63 3D CA      	LDA		Table_Dis_2+1,X
    18 00:CA36: 0A            	PHA
    19 00:CA37: 63 3C CA      	LDA		Table_Dis_2,X
    20 00:CA3A: 0A            	PHA
    21                        L_Display_Normal_Prog_RTS:
    22 00:CA3B: 09            	RTS
    23                        Table_Dis_2:
    24 00:CA3C: 45 CA         	DW		L_Display_Time_Normal_Prog-1
    25 00:CA3E: 63 CA             DW      L_Display_Calculator_Normal_Prog-1
    26 00:CA40: 63 CA         	DW		L_Display_Alarm_Normal_Prog-1
    27 00:CA42: 64 CA         	DW		L_Display_Another_Time_Normal_Prog-1
    28 00:CA44: 60 CA         	DW		L_Display_Postive_Timer_Set_Mode_Prog-1;正计时的正常计时自动退出
    29                        
    30                        
    31                        
    32                        
    33                        L_Display_Time_Normal_Prog:
    34 00:CA46: 15 5C CB      	JSR		L_Display_Time_Sec_Prog
    35 00:CA49: 73 A8         	LDA		R_Time_Sec
    36 00:CA4B: 12 17         	BNE		L_Display_Alarm_Normal_Prog_OUT
    37 00:CA4D: 15 61 CB      	JSR		L_Display_Time_Min_Prog
    38 00:CA50: 73 A9         	LDA		R_Time_Min
    39 00:CA52: 12 10         	BNE		L_Display_Alarm_Normal_Prog_OUT
    40 00:CA54: 15 66 CB      	JSR		L_Display_Time_Hr_Prog
    41 00:CA57: 73 A9         	LDA		R_Time_Min
    42 00:CA59: 12 09         	BNE		L_Display_Alarm_Normal_Prog_OUT
    43 00:CA5B: 15 8F CD      	JSR		L_Clr_Time_Week_Prog
    44 00:CA5E: 16 7A CB      	JMP		L_Display_Time_Week_Prog
    45                        
    46                        
    47                        
    48                        L_Display_Postive_Timer_Set_Mode_Prog:
    49 00:CA61: 15 64 CC      	JSR		L_Dis_col_Prog
    50                        L_Display_Alarm_Normal_Prog:
    51                        L_Display_Alarm_Normal_Prog_OUT:
    52                        L_Display_Calculator_Normal_Prog:
    53 00:CA64: 09            	RTS
    54                        
    55                        
    56                        
    57                        L_Display_Another_Time_Normal_Prog:
    58 00:CA65: 15 5C CB      	JSR		L_Display_Time_Sec_Prog
    59 00:CA68: 73 A8         	LDA		R_Time_Sec
    60 00:CA6A: 12 F8         	BNE		L_Display_Alarm_Normal_Prog_OUT
    61 00:CA6C: 15 27 CB      	JSR		L_Display_Another_Time_Min_Prog
    62 00:CA6F: 73 AF         	LDA		R_Time_Min_Another
    63 00:CA71: 12 F1         	BNE		L_Display_Alarm_Normal_Prog_OUT
    64 00:CA73: 15 2C CB      	JSR		L_Display_Another_Time_Hr_Prog
    65 00:CA76: 09            	RTS
    66                        
    67                        
    68                        
    69                        
    70                        L_Display_Postive_Timer_Normal_Prog:
    71 00:CA77: 30 A2 EA      	BBR0	Sys_Flag_D,L_Display_Alarm_Normal_Prog;没有开始正计时是不显示
    72 00:CA7A: 3D A2 E7      	BBS5	Sys_Flag_D,L_Display_Alarm_Normal_Prog;若有中途测量，不显示
    73 00:CA7D: 3E 9F E4      	BBS6	Sys_Flag_A,L_Display_Alarm_Normal_Prog
    74 00:CA80: 15 02 CC      	JSR		L_Display_Timer_Ms_Prog
    75 00:CA83: 73 B1         	LDA		R_Timer_Ms
    76 00:CA85: 12 DD         	BNE		L_Display_Alarm_Normal_Prog_OUT
    77 00:CA87: 15 F3 CB      	JSR		L_Display_Positive_Timer_Sec_Prog
    78 00:CA8A: 73 B2         	LDA		R_Timer_Sec
    79 00:CA8C: 12 D6         	BNE		L_Display_Alarm_Normal_Prog_OUT
    80 00:CA8E: 15 F8 CB      	JSR		L_Display_Positive_Timer_Min_Prog
    81 00:CA91: 73 B3         	LDA		R_Timer_Min
    82 00:CA93: 12 CF         	BNE		L_Display_Alarm_Normal_Prog_OUT
    83 00:CA95: 15 FD CB      	JSR		L_Display_Positive_Timer_Hr_Prog
    84 00:CA98: 09                RTS
    85                        
    86                        
    87                        
    88                        L_Display_Set_Mode_Prog:
    89 00:CA99: 43 91 18      	LDA		R_Mode
    90 00:CA9C: 04            	CLC
    91 00:CA9D: 06            	CLD
    92 00:CA9E: 18            	ROL
    93 00:CA9F: 1B            	TAX
    94 00:CAA0: 63 AA CA      	LDA		Table_Display_Set_Mode+1,X
    95 00:CAA3: 0A            	PHA
    96 00:CAA4: 63 A9 CA      	LDA		Table_Display_Set_Mode,X
    97 00:CAA7: 0A            	PHA
    98                        L_Display_Set_Mode_Prog_RTS:
    99 00:CAA8: 09            	RTS
   100                        Table_Display_Set_Mode:
   101 00:CAA9: B2 CA         	DW		L_Dispaly_Time_Prog_Set_Mode-1
   102 00:CAAB: A7 CA         	DW		L_Display_Set_Mode_Prog_RTS-1
   103 00:CAAD: EF CA         	DW		L_Display_Alarm_Clock_Set_Prog-1
   104 00:CAAF: 1C CB         	DW		L_Display_Another_Time_Set_Mode_Prog-1
   105 00:CAB1: A7 CA         	DW		L_Display_Set_Mode_Prog_RTS-1
   106                        
   107                        
   108                        L_Dispaly_Time_Prog_Set_Mode:
   109 00:CAB3: 73 BA         	LDA		R_Mode_Set
   110 00:CAB5: 56 05         	CMP		#5
   111 00:CAB7: 10 2A         	BCC		L_Display_Time_Prog_1
   112 00:CAB9: 15 42 CB      	JSR		L_Display_Time_Date_Prog
   113 00:CABC: 09            	RTS
   114                        
   115                        
   116                        L_Display_Prog:
   117 00:CABD: 15 4B CC      	JSR		L_Dis_Alm_Snz_Symbol_Prog
   118 00:CAC0: 15 5E CC      	JSR		L_Dis_sig_Prog
   119 00:CAC3: 15 64 CC      	JSR		L_Dis_col_Prog
   120 00:CAC6: 06            	CLD
   121 00:CAC7: 43 91 18      	LDA		R_Mode
   122 00:CACA: 04            	CLC
   123 00:CACB: 18            	ROL
   124 00:CACC: 1B            	TAX
   125 00:CACD: 63 D7 CA      	LDA		Table_Dis_1+1,X
   126 00:CAD0: 0A            	PHA
   127 00:CAD1: 63 D6 CA      	LDA		Table_Dis_1,X
   128 00:CAD4: 0A            	PHA
   129                        L_Display_Prog_1:
   130 00:CAD5: 09            	RTS
   131                        Table_Dis_1:
   132 00:CAD6: DF CA         	DW		L_Display_Time_Prog-1
   133 00:CAD8: E3 D4             DW      L_Display_Calculator_Prog-1
   134 00:CADA: EC CA         	DW		L_Display_Alarm_Prog-1
   135 00:CADC: 19 CB         	DW		L_Display_Another_Time_Prog-1
   136 00:CADE: F6 CA         	DW		L_Display_Postive_Timer_Prog-1
   137                        
   138                        L_Display_Time_Prog:
   139 00:CAE0: 15 7A CB      	JSR		L_Display_Time_Week_Prog
   140                        L_Display_Time_Prog_1:
   141 00:CAE3: 15 5C CB      	JSR		L_Display_Time_Sec_Prog
   142 00:CAE6: 15 61 CB      	JSR		L_Display_Time_Min_Prog
   143 00:CAE9: 15 66 CB      	JSR		L_Display_Time_Hr_Prog
   144 00:CAEC: 09            	RTS
   145                        
   146                        L_Display_Alarm_Prog:
   147 00:CAED: 15 E4 CB      	JSR		L_Display_Alarm_Clock_AL_Symbol_Prog
   148                        L_Display_Alarm_Clock_Set_Prog:
   149 00:CAF0: 15 DF CB      	JSR		L_Display_Alarm_Clock_Hr_Prog
   150 00:CAF3: 15 DA CB      	JSR		L_Display_Alarm_Clock_Min_Prog
   151 00:CAF6: 09            	RTS
   152                        
   153                        
   154                        
   155                        
   156                        L_Display_Postive_Timer_Prog:
   157 00:CAF7: 3E 9F DB      	BBS6	Sys_Flag_A,L_Display_Prog_1
   158 00:CAFA: 3D A2 0D      	BBS5	Sys_Flag_D,L_Display_Postive_Timer_Prog_1
   159 00:CAFD: 15 02 CC          JSR     L_Display_Positive_Timer_Ms_Prog
   160 00:CB00: 15 F3 CB      	JSR		L_Display_Positive_Timer_Sec_Prog
   161 00:CB03: 15 F8 CB      	JSR		L_Display_Positive_Timer_Min_Prog
   162 00:CB06: 15 07 CC      	JSR		L_Display_Positive_Timer_ST_Prog
   163 00:CB09: 09                RTS
   164                        L_Display_Postive_Timer_Prog_1:
   165 00:CB0A: 15 8F CD      	JSR		L_Clr_Time_Week_Prog
   166 00:CB0D: 15 15 CC      	JSR		L_Display_Positive_Timer_LR_Prog
   167 00:CB10: 15 32 CC          JSR     L_Display_Positive_Timer_Ms_Prog_Measurement
   168 00:CB13: 15 23 CC      	JSR		L_Display_Positive_Timer_Sec_Prog_Measurement
   169 00:CB16: 15 28 CC      	JSR		L_Display_Positive_Timer_Min_Prog_Measurement
   170 00:CB19: 09                RTS
   171                        
   172                        L_Display_Another_Time_Prog:
   173 00:CB1A: 15 31 CB      	JSR		L_Display_Another_Time_DT_Symbol_Prog
   174                        L_Display_Another_Time_Set_Mode_Prog:
   175 00:CB1D: 15 5C CB      	JSR		L_Display_Time_Sec_Prog
   176 00:CB20: 15 27 CB      	JSR		L_Display_Another_Time_Min_Prog
   177 00:CB23: 15 2C CB      	JSR		L_Display_Another_Time_Hr_Prog
   178                        
   179 00:CB26: 09            	RTS
   180                        
   181                        
   182                        
   183                        
   184                        
   185                        
   185                        
   171                        .INCLUDE	Display\Display_Time.asm
     1                        L_Display_Another_Time_Min_Prog:
     2 00:CB27: 73 AF         	LDA		R_Time_Min_Another
     3 00:CB29: 16 0A CE      	JMP		L_Display_lcd_Prog_Normal_Min
     4                        L_Display_Another_Time_Hr_Prog:
     5 00:CB2C: 73 B0         	LDA		R_Time_Hr_Another
     6 00:CB2E: 16 AE CD      	JMP		L_Display_lcd_Prog_Normal_Hr
     7                        L_Display_Another_Time_DT_Symbol_Prog:
     8 00:CB31: 53 00         	LDA		#0
     9 00:CB33: 15 83 CD      	JSR		L_Display_lcd_d10_Prog_Normal
    10 00:CB36: 53 0F         	LDA		#15
    11 00:CB38: 15 89 CD      	JSR		L_Display_lcd_d9_Prog_Normal
    12 00:CB3B: 15 7E CC      	JSR		L_Dis_lcd_10H_Prog
    13 00:CB3E: 15 76 CC      	JSR		L_Dis_lcd_9H_Prog
    14 00:CB41: 09            	RTS
    15                        
    16                        
    17                        L_Display_Time_Date_Prog:
    18 00:CB42: 15 D1 CC      	JSR		L_Clr_lcd_AM_Prog
    19 00:CB45: 15 D5 CC      	JSR		L_Clr_lcd_PM_Prog
    20 00:CB48: 15 BA CC      	JSR		L_Clr_col_Prog
    21 00:CB4B: 15 6B CB      	JSR		L_Display_Time_Day_Prog
    22 00:CB4E: 15 70 CB      	JSR		L_Display_Time_Month_Prog
    23 00:CB51: 15 75 CB      	JSR		L_Display_Time_Year_Prog
    24 00:CB54: 5E 23         	LDX		#lcd_d6
    25 00:CB56: 53 0B         	LDA		#11
    26 00:CB58: 15 D9 C8      	JSR		L_Dis_8Bit_DigitDot_Prog
    27 00:CB5B: 09            	RTS
    28                        
    29                        
    30                        
    31                        ;===============================================
    32                        
    33                        L_Display_Time_Sec_Prog:
    34 00:CB5C: 73 A8         	LDA		R_Time_Sec
    35 00:CB5E: 16 F5 CD      	JMP		L_Display_lcd_Prog_Normal_Sec
    36                        ;======================================
    37                        L_Display_Time_Min_Prog:
    38 00:CB61: 73 A9         	LDA		R_Time_Min
    39 00:CB63: 16 0A CE      	JMP		L_Display_lcd_Prog_Normal_Min
    40                        ;=====================================
    41                        L_Display_Time_Hr_Prog:
    42 00:CB66: 73 AA         	LDA		R_Time_Hr
    43 00:CB68: 16 AE CD      	JMP		L_Display_lcd_Prog_Normal_Hr
    44                        ;=====================================
    45                        L_Display_Time_Day_Prog:
    46 00:CB6B: 73 AB         	LDA		R_Time_Day
    47 00:CB6D: 16 D1 CD      	JMP		L_Display_lcd_Prog_Normal_Day
    48                        ;=====================================
    49                        L_Display_Time_Month_Prog:
    50 00:CB70: 73 AC         	LDA		R_Time_Month
    51 00:CB72: 16 E3 CD      	JMP		L_Display_lcd_Prog_Normal_Month
    52                        ;========================================
    53                        L_Display_Time_Year_Prog:
    54 00:CB75: 73 AD         	LDA		R_Time_Year
    55 00:CB77: 16 6A CE      	JMP		L_Display_lcd_Prog_Normal_Timer
    56                        
    57                        ;============================================
    58                        L_Display_Time_Week_Prog:;两位显示数字的
    59 00:CB7A: 15 B4 CB      	JSR		L_Dis_week_Usually
    60 00:CB7D: 06            	CLD
    61 00:CB7E: 73 AE             LDA     R_Time_Week
    62 00:CB80: 04                CLC
    63 00:CB81: 18                ROL
    64 00:CB82: 1B                TAX
    65 00:CB83: 63 8D CB          LDA     Table_Dis_Week+1,X
    66 00:CB86: 0A                PHA
    67 00:CB87: 63 8C CB          LDA     Table_Dis_Week,X
    68 00:CB8A: 0A                PHA
    69 00:CB8B: 09                RTS
    70                        Table_Dis_Week:
    71 00:CB8C: B2 CB         	DW		L_Display_Time_Sunday_Prog-1
    72 00:CB8E: 99 CB         	DW		L_Display_Time_Monday_Prog-1
    73 00:CB90: A0 CB         	DW		L_Display_Time_Tuesday_Prog-1
    74 00:CB92: A4 CB         	DW		L_Display_Time_WednesDay_Prog-1
    75 00:CB94: AB CB         	DW		L_Display_Time_Thursday_Prog-1
    76 00:CB96: AF CB         	DW		L_Display_Time_Friday_Prog-1
    77 00:CB98: B2 CB         	DW		L_Display_Time_Saturday_Prog-1
    78                        
    79                        
    80                        
    81                        L_Display_Time_Monday_Prog:
    82 00:CB9A: 15 82 CC      	JSR		L_Dis_lcd_10J_Prog
    83 00:CB9D: 15 7E CC      	JSR		L_Dis_lcd_10H_Prog
    84 00:CBA0: 09                RTS
    85                        
    86                        L_Display_Time_Tuesday_Prog:
    87 00:CBA1: 15 7E CC      	JSR		L_Dis_lcd_10H_Prog
    88 00:CBA4: 09            	RTS
    89                        L_Display_Time_WednesDay_Prog:
    90 00:CBA5: 15 7A CC      	JSR		L_Dis_lcd_10I_Prog
    91 00:CBA8: 15 82 CC      	JSR		L_Dis_lcd_10J_Prog
    92 00:CBAB: 09            	RTS
    93                        L_Display_Time_Thursday_Prog:
    94 00:CBAC: 15 7E CC      	JSR		L_Dis_lcd_10H_Prog
    95 00:CBAF: 09            	RTS
    96                        L_Display_Time_Friday_Prog:
    97 00:CBB0: 15 76 CC      	JSR		L_Dis_lcd_9H_Prog
    98                        
    99                        L_Display_Time_Saturday_Prog:
   100                        L_Display_Time_Sunday_Prog:
   101 00:CBB3: 09            	RTS
   102                        
   103                        L_Dis_week_Usually:
   104 00:CBB4: 73 AE         	LDA		R_Time_Week
   105 00:CBB6: 04            	CLC
   106 00:CBB7: 18            	ROL
   107 00:CBB8: 7F F3         	STA		P_Temp+4
   108 00:CBBA: 1B            	TAX
   109 00:CBBB: 63 CC CB      	LDA		Table_week,X
   110 00:CBBE: 15 89 CD      	JSR		L_Display_lcd_d9_Prog_Normal
   111 00:CBC1: 73 F3         	LDA		P_Temp+4
   112 00:CBC3: 03            	INC
   113 00:CBC4: 1B            	TAX
   114 00:CBC5: 63 CC CB      	LDA		Table_week,X
   115 00:CBC8: 15 83 CD      	JSR		L_Display_lcd_d10_Prog_Normal
   116 00:CBCB: 09            	RTS
   117                        
   118                        Table_week:
   119                        
   120 00:CBCC: 10            	.byte	16
   121 00:CBCD: 05            	.byte	5
   122                        
   123                        
   124 00:CBCE: 00            	.byte	0
   125 00:CBCF: 0E            	.byte	14
   126                        
   127                        
   128 00:CBD0: 10            	.byte	16
   129 00:CBD1: 0F            	.byte	15
   130                        
   131                        
   132 00:CBD2: 11            	.byte	17
   133 00:CBD3: 10            	.byte	16
   134                        
   135                        
   136 00:CBD4: 0C            	.byte	12
   137 00:CBD5: 0F            	.byte	15
   138                        
   139                        
   140 00:CBD6: 12            	.byte	18
   141 00:CBD7: 13            	.byte	19
   142                        
   143                        
   144 00:CBD8: 12            	.byte	18
   145 00:CBD9: 05            	.byte	5
   146                        
   147                        
   148                        
   149                        ; L_Display_Time_Week_Prog:;三位显示数字的
   150                        ; 	CLD
   151                        ;     LDA     R_Time_Week
   152                        ;     CLC
   153                        ;     ROL
   154                        ;     TAX
   155                        ;     LDA     Table_Dis_Week+1,X
   156                        ;     PHA
   157                        ;     LDA     Table_Dis_Week,X
   158                        ;     PHA
   159                        ;     RTS
   160                        ; Table_Dis_Week:
   161                        ; 	DW		L_Display_Time_Sunday_Prog-1
   162                        ; 	DW		L_Display_Time_Monday_Prog-1
   163                        ; 	DW		L_Display_Time_Tuesday_Prog-1
   164                        ; 	DW		L_Display_Time_WednesDay_Prog-1
   165                        ; 	DW		L_Display_Time_Thursday_Prog-1
   166                        ; 	DW		L_Display_Time_Friday_Prog-1
   167                        ; 	DW		L_Display_Time_Saturday_Prog-1
   168                        
   169                        
   170                        
   171                        ; L_Display_Time_Monday_Prog:
   172                        ; 	JSR		L_Dis_lcd_13J_Prog
   173                        ; 	JSR		L_Dis_lcd_13H_Prog
   174                        ; 	JSR		L_Dis_lcd_11H_Prog
   175                        ; 	BRA		L_Dis_week_Usually
   176                        ; L_Display_Time_Tuesday_Prog:
   177                        ; 	JSR		L_Dis_lcd_13H_Prog
   178                        ; 	BRA		L_Dis_week_Usually
   179                        ; L_Display_Time_WednesDay_Prog:
   180                        ; 	JSR		L_Dis_lcd_13I_Prog
   181                        ; 	JSR		L_Dis_lcd_13J_Prog
   182                        ; 	JSR		L_Dis_lcd_11H_Prog
   183                        ; 	JSR		L_Dis_lcd_11I_Prog
   184                        ; 	BRA		L_Dis_week_Usually
   185                        ; L_Display_Time_Thursday_Prog:
   186                        ; 	JSR		L_Dis_lcd_13H_Prog
   187                        ; 	BRA		L_Dis_week_Usually
   188                        ; L_Display_Time_Friday_Prog:
   189                        ; 	JSR		L_Dis_lcd_12H_Prog
   190                        ; 	BRA		L_Dis_week_Usually
   191                        ; L_Display_Time_Saturday_Prog:
   192                        ; 	JSR		L_Dis_lcd_11H_Prog
   193                        ; 	BRA		L_Dis_week_Usually
   194                        ; L_Display_Time_Sunday_Prog:
   195                        ; 	JSR		L_Dis_lcd_11H_Prog
   196                        ; L_Dis_week_Usually:
   197                        ; 	LDA		R_Time_Week
   198                        ; 	CLC
   199                        ; 	ROL
   200                        ; 	ADC		R_Time_Week
   201                        ; 	STA		P_Temp+4
   202                        ; 	TAX
   203                        ; 	LDA		Table_week,X
   204                        ; 	JSR		L_Display_lcd_d11_Prog_Normal
   205                        ; 	LDA		P_Temp+4
   206                        ; 	INC
   207                        ; 	TAX
   208                        ; 	LDA		Table_week,X
   209                        ; 	JSR		L_Display_lcd_d12_Prog_Normal
   210                        ; 	LDA		P_Temp+4
   211                        ; 	INC
   212                        ; 	INC
   213                        ; 	TAX
   214                        ; 	LDA		Table_week,X
   215                        ; 	JSR		L_Display_lcd_d13_Prog_Normal
   216                        ; 	RTS
   217                        
   218                        ; Table_week:
   219                        ; 	.byte	14
   220                        ; 	.byte	16
   221                        ; 	.byte	5
   222                        
   223                        ; 	.byte	14
   224                        ; 	.byte	0
   225                        ; 	.byte	14
   226                        
   227                        ; 	.byte	17
   228                        ; 	.byte	16
   229                        ; 	.byte	15
   230                        
   231                        ; 	.byte	0
   232                        ; 	.byte	17
   233                        ; 	.byte	16
   234                        
   235                        ; 	.byte	16
   236                        ; 	.byte	12
   237                        ; 	.byte	15
   238                        
   239                        ; 	.byte	1
   240                        ; 	.byte	18
   241                        ; 	.byte	19
   242                        
   243                        ; 	.byte	15
   244                        ; 	.byte	18
   245                        ; 	.byte	5
   245                        
   172                        .INCLUDE	Display\Display_Alarm.asm
     1                        
     2                        ;======================================
     3                        L_Display_Alarm_Clock_Min_Prog:
     4 00:CBDA: 73 B7         	LDA		R_Alarm_Clock_Min
     5 00:CBDC: 16 0A CE      	JMP		L_Display_lcd_Prog_Normal_Min
     6                        ;=====================================
     7                        L_Display_Alarm_Clock_Hr_Prog:
     8 00:CBDF: 73 B8         	LDA		R_Alarm_Clock_Hr
     9 00:CBE1: 16 AE CD      	JMP		L_Display_lcd_Prog_Normal_Hr
    10                        ;=====================================
    11                        ; L_Display_Alarm_Clock_Day_Prog:
    12                        ; 	LDA		R_Alarm_Clock_Day
    13                        ;     BEQ     L_Dis_Minus_Prog_Day
    14                        ; 	JMP		L_Display_lcd_Prog_Normal_Day
    15                        ; ;=====================================
    16                        ; L_Display_Alarm_Clock_Month_Prog:
    17                        ; 	LDA		R_Alarm_Clock_Month
    18                        ;     BEQ     L_Dis_Minus_Prog_Month
    19                        ; 	JMP		L_Display_lcd_Prog_Normal_Month
    20                        ;===================================
    21                        ; L_Display_Alarm_Hourly_Prog:
    22                        ;     LDA     #0
    23                        ;     JSR     L_Display_lcd_Prog_Normal_Min
    24                        ;     JSR     L_Clr_Hr_Prog
    25                        ;     RTS
    26                        ;====================================
    27                        L_Display_Alarm_Clock_AL_Symbol_Prog:
    28 00:CBE4: 53 12             LDA     #18
    29 00:CBE6: 5E 3F             LDX     #lcd_d10
    30 00:CBE8: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
    31 00:CBEB: 53 14             LDA     #20
    32 00:CBED: 5E 38             LDX     #lcd_d9
    33 00:CBEF: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
    34 00:CBF2: 09                RTS
    35                        
    36                        
    37                        ; L_Dis_Minus_Prog_Day:
    38                        ;     LDA     #11
    39                        ;     LDX     #lcd_d7
    40                        ;     JSR     L_Dis_8Bit_DigitDot_Prog
    41                        ;     LDA     #11
    42                        ;     LDX     #lcd_d8
    43                        ;     JMP     L_Dis_8Bit_DigitDot_Prog
    44                        
    45                        ; L_Dis_Minus_Prog_Month:
    46                        ;     LDA     #11
    47                        ;     LDX     #lcd_d9
    48                        ;     JSR     L_Dis_8Bit_DigitDot_Prog
    49                        ;     LDA     #10
    50                        ;     LDX     #lcd_d10
    51                        ;     JMP     L_Dis_8Bit_DigitDot_Prog
    51                        
   173                        .INCLUDE	Display\Display_Timer.asm
     1                        L_Display_Positive_Timer_Sec_Prog:
     2 00:CBF3: 73 B2         	LDA		R_Timer_Sec
     3 00:CBF5: 16 0A CE      	JMP		L_Display_lcd_Prog_Normal_Min
     4                        ;======================================
     5                        L_Display_Positive_Timer_Min_Prog:
     6 00:CBF8: 73 B3         	LDA		R_Timer_Min
     7 00:CBFA: 16 6A CE      	JMP		L_Display_lcd_Prog_Normal_Timer
     8                        ;=====================================
     9                        L_Display_Positive_Timer_Hr_Prog:
    10 00:CBFD: 73 B4         	LDA		R_Timer_Hr
    11 00:CBFF: 16 6A CE      	JMP		L_Display_lcd_Prog_Normal_Timer
    12                        ;=====================================
    13                        L_Display_Timer_Ms_Prog:
    14                        L_Display_Positive_Timer_Ms_Prog:
    15 00:CC02: 73 B1         	LDA		R_Timer_Ms
    16 00:CC04: 16 F5 CD      	JMP		L_Display_lcd_Prog_Normal_Sec
    17                        
    18                        L_Display_Positive_Timer_ST_Prog:
    19 00:CC07: 53 05             LDA     #5
    20 00:CC09: 15 83 CD          JSR     L_Display_lcd_d10_Prog_Normal
    21 00:CC0C: 53 0F             LDA     #15
    22 00:CC0E: 15 89 CD          JSR     L_Display_lcd_d9_Prog_Normal
    23 00:CC11: 15 76 CC          JSR     L_Dis_lcd_9H_Prog
    24 00:CC14: 09            	RTS
    25                        L_Display_Positive_Timer_LR_Prog:
    26 00:CC15: 53 14             LDA     #20
    27 00:CC17: 15 83 CD          JSR     L_Display_lcd_d10_Prog_Normal
    28 00:CC1A: 53 12             LDA     #18
    29 00:CC1C: 15 89 CD          JSR     L_Display_lcd_d9_Prog_Normal
    30 00:CC1F: 15 76 CC          JSR     L_Dis_lcd_9H_Prog
    31 00:CC22: 09            	RTS
    32                        
    33                        
    34                        L_Display_Positive_Timer_Sec_Prog_Measurement:
    35 00:CC23: 73 D7         	LDA		R_Timer_Sec_Measurement
    36 00:CC25: 16 0A CE      	JMP		L_Display_lcd_Prog_Normal_Min
    37                        ;======================================
    38                        L_Display_Positive_Timer_Min_Prog_Measurement:
    39 00:CC28: 73 D6         	LDA		R_Timer_Min_Measurement
    40 00:CC2A: 16 6A CE      	JMP		L_Display_lcd_Prog_Normal_Timer
    41                        ;=====================================
    42                        L_Display_Positive_Timer_Hr_Prog_Measurement:
    43 00:CC2D: 73 D5         	LDA		R_Timer_Hr_Measurement
    44 00:CC2F: 16 6A CE      	JMP		L_Display_lcd_Prog_Normal_Timer
    45                        ;=====================================
    46                        L_Display_Timer_Ms_Prog_Measurement:
    47                        L_Display_Positive_Timer_Ms_Prog_Measurement:
    48 00:CC32: 73 D8         	LDA		R_Timer_Ms_Measurement
    49 00:CC34: 16 F5 CD      	JMP		L_Display_lcd_Prog_Normal_Sec
    50                        ; ;上面是正计时显示函数
    51                        ; ;==========================================
    52                        ; L_Display_Destive_Timer_Sec_Prog:
    53                        ; 	LDA		R_Timer_Sec_Countdown
    54                        ; 	JMP		L_Display_lcd_Prog_Normal_Sec
    55                        ; ;======================================
    56                        ; L_Display_Destive_Timer_Min_Prog:
    57                        ; 	LDA		R_Timer_Min_Countdown
    58                        ; 	JMP		L_Display_lcd_Prog_Normal_Min
    59                        ; ;=====================================
    60                        ; L_Display_Destive_Timer_Hr_Prog:
    61                        ; 	LDA		R_Timer_Hr_Countdown
    62                        ; 	JMP		L_Display_lcd_Prog_Normal_Timer
    63                        
    64                        ; L_Display_Destive_Timer_TR_Symbol_Prog:
    65                        ;     LDA     #15
    66                        ;     JSR     L_Display_lcd_d10_Prog_Normal
    67                        ;     LDA     #18
    68                        ;     JSR     L_Display_lcd_d9_Prog_Normal
    69                        ; 	JSR		L_Dis_lcd_10H_Prog
    70                        ;     JSR     L_Dis_lcd_9H_Prog
    71                        ; 	RTS
    71                        
   174                        .INCLUDE	Display\Display_Symbol.asm
     1                        ;显示闹钟标志，贪睡标志的清除
     2                        L_Clr_Alm_Snz_Symbol_Prog:
     3 00:CC37: 15 C5 CC          JSR     L_Clr_lcd_Alm_Prog
     4                        L_Clr_Alm_Snz_Symbol_Prog_1:
     5 00:CC3A: 16 C9 CC          JMP     L_Clr_lcd_Snz_Prog
     6                        RTS_1:
     7 00:CC3D: 09                RTS
     8                        
     9                        L_DIS_SNZ_Normal_Prog:
    10 00:CC3E: 37 A1 FC          BBR7    Sys_Flag_C,RTS_1
    11 00:CC41: 15 8A CC          JSR     L_Dis_lcd_Snz_Prog
    12 00:CC44: 15 86 CC          JSR     L_Dis_lcd_Alm_Prog
    13 00:CC47: 09                RTS
    14                        L_Dis_Alm_Snz_Symbol_Noraml_Prog:
    15 00:CC48: 34 A1 F2          BBR4    Sys_Flag_C,RTS_1;闹铃没有响是，不做显示
    16                        L_Dis_Alm_Snz_Symbol_Prog:
    17 00:CC4B: 73 B9             LDA     R_Alarm_Mode
    18 00:CC4D: 13 E8             BEQ     L_Clr_Alm_Snz_Symbol_Prog
    19 00:CC4F: 15 86 CC          JSR     L_Dis_lcd_Alm_Prog
    20 00:CC52: 73 B9             LDA     R_Alarm_Mode
    21 00:CC54: 56 02             CMP     #2
    22 00:CC56: 12 E2             BNE     L_Clr_Alm_Snz_Symbol_Prog_1
    23 00:CC58: 16 8A CC          JMP     L_Dis_lcd_Snz_Prog
    24 00:CC5B: 15 1D C9          JSR     F_DispSymbol
    25                        ;========================================
    26                        L_Dis_sig_Prog:
    27 00:CC5E: 39 A1 2D          BBS1    Sys_Flag_C,L_Dis_lcd_Sig_Prog
    28 00:CC61: 16 CD CC          JMP     L_Clr_lcd_Sig_Prog
    29                        
    30                        L_Dis_col_Prog:
    31 00:CC64: 43 91 18          LDA     R_Mode
    32 00:CC67: 56 01             CMP     #1
    33 00:CC69: 13 D2             BEQ     RTS_1
    34 00:CC6B: 5E 46             LDX     #lcd_col
    35 00:CC6D: 15 1D C9          JSR     F_DispSymbol
    36 00:CC70: 5E 47             LDX     #lcd_col2
    37                        L_Dis_Symbol_Prog:
    38 00:CC72: 15 1D C9          JSR     F_DispSymbol
    39 00:CC75: 09                RTS
    40                        L_Dis_lcd_9H_Prog:
    41 00:CC76: 5E 48         	LDX     #lcd_9H
    42 00:CC78: 17 F8             BRA		L_Dis_Symbol_Prog
    43                        L_Dis_lcd_10I_Prog:
    44 00:CC7A: 5E 49             LDX     #lcd_10I
    45 00:CC7C: 17 F4             BRA		L_Dis_Symbol_Prog
    46                        L_Dis_lcd_10H_Prog:
    47 00:CC7E: 5E 4A         	LDX     #lcd_10H
    48 00:CC80: 17 F0             BRA		L_Dis_Symbol_Prog
    49                        L_Dis_lcd_10J_Prog:
    50 00:CC82: 5E 4B             LDX     #lcd_10J
    51 00:CC84: 17 EC             BRA		L_Dis_Symbol_Prog
    52                        L_Dis_lcd_Alm_Prog:
    53 00:CC86: 5E 4E             LDX     #lcd_ALM
    54 00:CC88: 17 E8             BRA		L_Dis_Symbol_Prog
    55                        L_Dis_lcd_Snz_Prog:
    56 00:CC8A: 5E 4D             LDX     #lcd_SNZ
    57 00:CC8C: 17 E4             BRA		L_Dis_Symbol_Prog
    58                        L_Dis_lcd_Sig_Prog:
    59 00:CC8E: 5E 4C             LDX     #lcd_SIG
    60 00:CC90: 17 E0             BRA		L_Dis_Symbol_Prog
    61                        L_Dis_lcd_AM_Prog:
    62 00:CC92: 5E 4F             LDX     #lcd_AM
    63 00:CC94: 17 DC             BRA		L_Dis_Symbol_Prog
    64                        L_Dis_lcd_PM_Prog:
    65 00:CC96: 5E 50             LDX     #lcd_PM
    66 00:CC98: 17 D8             BRA		L_Dis_Symbol_Prog
    67                        
    68                        L_Dis_lcd_T1_Prog:
    69 00:CC9A: 5E 56             LDX     #lcd_T1
    70 00:CC9C: 17 D4             BRA		L_Dis_Symbol_Prog
    71                        L_Dis_lcd_T2_Prog:
    72 00:CC9E: 5E 57             LDX     #lcd_T2
    73 00:CCA0: 17 D0             BRA		L_Dis_Symbol_Prog
    74                        L_Dis_lcd_T3_Prog:
    75 00:CCA2: 5E 58             LDX     #lcd_T3
    76 00:CCA4: 17 CC             BRA		L_Dis_Symbol_Prog
    77                        
    78                        L_Dis_lcd_T4_Prog:
    79 00:CCA6: 5E 59             LDX     #lcd_T4
    80 00:CCA8: 17 C8             BRA		L_Dis_Symbol_Prog
    81                        
    82                        L_Dis_lcd_T5_Prog:
    83 00:CCAA: 5E 5A             LDX     #lcd_T5
    84 00:CCAC: 17 C4             BRA		L_Dis_Symbol_Prog
    85                        
    86                        L_Dis_lcd_T6_Prog:
    87 00:CCAE: 5E 5B             LDX     #lcd_T6
    88 00:CCB0: 17 C0             BRA		L_Dis_Symbol_Prog
    89                        
    90                        L_Dis_lcd_T7_Prog:
    91 00:CCB2: 5E 5C             LDX     #lcd_T7
    92 00:CCB4: 17 BC             BRA		L_Dis_Symbol_Prog
    93                        
    94                        L_Dis_lcd_T8_Prog:
    95 00:CCB6: 5E 5D             LDX     #lcd_T8
    96 00:CCB8: 17 B8             BRA		L_Dis_Symbol_Prog
    97                        
    98                        
    99                        
   100                        ;================================
   101                        
   102                        
   103                        
   104                        L_Clr_col_Prog:
   105 00:CCBA: 5E 46             LDX     #lcd_col
   106 00:CCBC: 15 24 C9          JSR     F_ClrpSymbol
   107 00:CCBF: 5E 47             LDX     #lcd_col2
   108                        L_Clr_Symbol_Prog:
   109 00:CCC1: 15 24 C9          JSR     F_ClrpSymbol
   110 00:CCC4: 09                RTS
   111                        
   112                        L_Clr_lcd_Alm_Prog:
   113 00:CCC5: 5E 4E             LDX     #lcd_ALM
   114 00:CCC7: 17 F8             BRA		L_Clr_Symbol_Prog
   115                        L_Clr_lcd_Snz_Prog:
   116 00:CCC9: 5E 4D             LDX     #lcd_SNZ
   117 00:CCCB: 17 F4             BRA		L_Clr_Symbol_Prog
   118                        L_Clr_lcd_Sig_Prog:
   119 00:CCCD: 5E 4C             LDX     #lcd_SIG
   120 00:CCCF: 17 F0             BRA		L_Clr_Symbol_Prog
   121                        L_Clr_lcd_AM_Prog:
   122 00:CCD1: 5E 4F             LDX     #lcd_AM
   123 00:CCD3: 17 EC             BRA		L_Clr_Symbol_Prog
   124                        L_Clr_lcd_PM_Prog:
   125 00:CCD5: 5E 50             LDX     #lcd_PM
   126 00:CCD7: 17 E8             BRA		L_Clr_Symbol_Prog
   127                        
   128                        L_Clr_lcd_T1_Prog:
   129 00:CCD9: 5E 56             LDX     #lcd_T1
   130 00:CCDB: 17 E4             BRA		L_Clr_Symbol_Prog
   131                        L_Clr_lcd_T2_Prog:
   132 00:CCDD: 5E 57             LDX     #lcd_T2
   133 00:CCDF: 17 E0             BRA		L_Clr_Symbol_Prog
   134                        L_Clr_lcd_T3_Prog:
   135 00:CCE1: 5E 58             LDX     #lcd_T3
   136 00:CCE3: 17 DC             BRA		L_Clr_Symbol_Prog
   137                        
   138                        L_Clr_lcd_T4_Prog:
   139 00:CCE5: 5E 59             LDX     #lcd_T4
   140 00:CCE7: 17 D8             BRA		L_Clr_Symbol_Prog
   141                        
   142                        L_Clr_lcd_T5_Prog:
   143 00:CCE9: 5E 5A             LDX     #lcd_T5
   144 00:CCEB: 17 D4             BRA		L_Clr_Symbol_Prog
   145                        
   146                        L_Clr_lcd_T6_Prog:
   147 00:CCED: 5E 5B             LDX     #lcd_T6
   148 00:CCEF: 17 D0             BRA		L_Clr_Symbol_Prog
   149                        
   150                        L_Clr_lcd_T7_Prog:
   151 00:CCF1: 5E 5C             LDX     #lcd_T7
   152 00:CCF3: 17 CC             BRA		L_Clr_Symbol_Prog
   153                        
   154                        L_Clr_lcd_T8_Prog:
   155 00:CCF5: 5E 5D             LDX     #lcd_T8
   156 00:CCF7: 17 C8             BRA		L_Clr_Symbol_Prog
   157                        
   158                        
   159                        ;==================================
   160                        L_Clr_lcd_d1_Prog:
   161 00:CCF9: 5E 00             LDX     #lcd_d1
   162                        L_Clr_lcd_usually_Prog:
   163 00:CCFB: 53 16             LDA     #22
   164 00:CCFD: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   165 00:CD00: 09                RTS
   166                        L_Clr_lcd_d2_Prog:
   167 00:CD01: 5E 07             LDX     #lcd_d2
   168 00:CD03: 17 F6             BRA     L_Clr_lcd_usually_Prog
   169                        L_Clr_lcd_d3_Prog:
   170 00:CD05: 5E 0E             LDX     #lcd_d3
   171 00:CD07: 17 F2             BRA     L_Clr_lcd_usually_Prog
   172                        L_Clr_lcd_d4_Prog:
   173 00:CD09: 5E 15             LDX     #lcd_d4
   174 00:CD0B: 17 EE             BRA     L_Clr_lcd_usually_Prog
   175                        L_Clr_lcd_d5_Prog:
   176 00:CD0D: 5E 1C             LDX     #lcd_d5
   177 00:CD0F: 17 EA             BRA     L_Clr_lcd_usually_Prog
   178                        L_Clr_lcd_d6_Prog:
   179 00:CD11: 5E 23             LDX     #lcd_d6
   180 00:CD13: 17 E6             BRA     L_Clr_lcd_usually_Prog
   181                        L_Clr_lcd_d7_Prog:
   182 00:CD15: 5E 2A             LDX     #lcd_d7
   183 00:CD17: 17 E2             BRA     L_Clr_lcd_usually_Prog
   184                        L_Clr_lcd_d8_Prog:
   185 00:CD19: 5E 31             LDX     #lcd_d8
   186 00:CD1B: 17 DE             BRA     L_Clr_lcd_usually_Prog
   187                        
   188                        L_Display_lcd_Involution_Prog_Normal:
   189 00:CD1D: 43 9C 18          LDA     R_Involution
   190 00:CD20: 13 05             BEQ     L_Display_lcd_Involution_Prog_RTS
   191                        L_Display_lcd_Involution_Prog:
   192 00:CD22: 5E 51             LDX     #lcd_Involution
   193 00:CD24: 15 1D C9          JSR     F_DispSymbol
   194                            ; LDX     #lcd_Mul
   195                            ; JSR     F_DispSymbol
   196                        L_Display_lcd_Involution_Prog_RTS:
   197 00:CD27: 09                RTS
   198                        L_Display_lcd_Plus_Prog:
   199 00:CD28: 5E 52             LDX     #lcd_Plus
   200 00:CD2A: 15 1D C9          JSR     F_DispSymbol
   201 00:CD2D: 09                RTS
   202                        L_Display_lcd_SUB_Prog:
   203 00:CD2E: 5E 53             LDX     #lcd_SUB
   204 00:CD30: 15 1D C9          JSR     F_DispSymbol
   205 00:CD33: 09                RTS
   206                        L_Display_lcd_Mul_Prog:
   207 00:CD34: 5E 54             LDX     #lcd_Mul
   208 00:CD36: 15 1D C9          JSR     F_DispSymbol
   209 00:CD39: 09                RTS
   210                        L_Display_lcd_DIV_Prog:
   211 00:CD3A: 5E 55             LDX     #lcd_DIV
   212 00:CD3C: 15 1D C9          JSR     F_DispSymbol
   213 00:CD3F: 09                RTS
   214                        L_Clr_Calculator_Symbol_Prog:
   215 00:CD40: 5E 51             LDX     #lcd_Involution
   216 00:CD42: 15 24 C9          JSR     F_ClrpSymbol
   217                        L_Clr_Calculator_Symbol_Prog_1:
   218 00:CD45: 5E 52             LDX     #lcd_Plus
   219 00:CD47: 15 24 C9          JSR     F_ClrpSymbol
   220 00:CD4A: 5E 53             LDX     #lcd_SUB
   221 00:CD4C: 15 24 C9          JSR     F_ClrpSymbol
   222 00:CD4F: 5E 54             LDX     #lcd_Mul
   223 00:CD51: 15 24 C9          JSR     F_ClrpSymbol
   224 00:CD54: 5E 55             LDX     #lcd_DIV
   225 00:CD56: 15 24 C9          JSR     F_ClrpSymbol
   226                        
   227 00:CD59: 09                RTS
   228                        
   229                        
   230                        L_Dis_Calculator_Symbol_Prog:
   231 00:CD5A: 15 40 CD          JSR     L_Clr_Calculator_Symbol_Prog
   232 00:CD5D: 15 1D CD          JSR     L_Display_lcd_Involution_Prog_Normal
   233 00:CD60: 04                CLC
   234 00:CD61: 06                CLD
   235 00:CD62: 43 99 18          LDA     Calculator_Symbol_State
   236 00:CD65: 18                ROL
   237 00:CD66: 1B                TAX
   238 00:CD67: 63 71 CD          LDA     Table_Calc_Symbol+1,X
   239 00:CD6A: 0A                PHA
   240 00:CD6B: 63 70 CD          LDA     Table_Calc_Symbol,X
   241 00:CD6E: 0A                PHA
   242 00:CD6F: 09                RTS
   243                        Table_Calc_Symbol:
   244 00:CD70: AB DA             DW      RET-1
   245 00:CD72: 27 CD             DW      L_Display_lcd_Plus_Prog-1
   246 00:CD74: 2D CD             DW      L_Display_lcd_SUB_Prog-1
   247 00:CD76: 33 CD             DW      L_Display_lcd_Mul_Prog-1
   248 00:CD78: 39 CD             DW      L_Display_lcd_DIV_Prog-1
   249                        
   250                        L_Dis_Calculator_Symbol_Prog_Equal:
   251 00:CD7A: 43 9C 18          LDA     R_Involution
   252 00:CD7D: 12 03             BNE     L_Dis_Calculator_Symbol_Prog_Equal_RTS
   253 00:CD7F: 15 40 CD          JSR     L_Clr_Calculator_Symbol_Prog
   254                        L_Dis_Calculator_Symbol_Prog_Equal_RTS:
   255 00:CD82: 09                RTS
   255                        
   175                        .INCLUDE	Display\Display_Normal.asm
     1                        ;=================================
     2                        L_Display_lcd_d10_Prog_Normal:
     3 00:CD83: 5E 3F         	LDX		#lcd_d10
     4 00:CD85: 15 D9 C8      	JSR		L_Dis_8Bit_DigitDot_Prog
     5 00:CD88: 09            	RTS
     6                        L_Display_lcd_d9_Prog_Normal:
     7 00:CD89: 5E 38         	LDX		#lcd_d9
     8 00:CD8B: 15 D9 C8      	JSR		L_Dis_8Bit_DigitDot_Prog
     9 00:CD8E: 09            	RTS
    10                        L_Clr_Time_Week_Prog:
    11 00:CD8F: 53 0A         	LDA     #10
    12 00:CD91: 15 89 CD          JSR		L_Display_lcd_d9_Prog_Normal
    13 00:CD94: 53 0A         	LDA     #10
    14 00:CD96: 15 83 CD          JSR		L_Display_lcd_d10_Prog_Normal
    15 00:CD99: 5E 48         	LDX     #lcd_9H
    16 00:CD9B: 15 24 C9          JSR		F_ClrpSymbol
    17 00:CD9E: 5E 49             LDX     #lcd_10I
    18 00:CDA0: 15 24 C9          JSR		F_ClrpSymbol
    19 00:CDA3: 5E 4A         	LDX     #lcd_10H
    20 00:CDA5: 15 24 C9          JSR		F_ClrpSymbol
    21 00:CDA8: 5E 4B             LDX     #lcd_10J
    22 00:CDAA: 15 24 C9          JSR		F_ClrpSymbol
    23 00:CDAD: 09            	RTS
    24                        ;===============================
    25                        L_Display_lcd_Prog_Normal_Hr:;显示闹钟时钟小时的lcd_5，lcd6
    26 00:CDAE: 15 CE CE          JSR		L_12_24_Prog
    27 00:CDB1: 15 7F CE          JSR		L_A_HexToHexD
    28 00:CDB4: 0A            	PHA
    29 00:CDB5: 51 0F         	AND		#$0F
    30 00:CDB7: 5E 07             LDX     #lcd_d2
    31 00:CDB9: 15 D9 C8          JSR		L_Dis_8Bit_DigitDot_Prog
    32 00:CDBC: 5E 00         	LDX		#lcd_d1
    33 00:CDBE: 3B 9F 41      	BBS3	Sys_Flag_A,L_Display_lcd_Prog_Normal
    34                        L_Display_lcd_Prog_Normal_1:
    35 00:CDC1: 0C            	PLA
    36 00:CDC2: 15 3C C9      	JSR		L_ROR_4Bit_Prog
    37 00:CDC5: 13 04         	BEQ		L_Display_lcd_Prog_Normal_Hr_1
    38 00:CDC7: 15 D9 C8      	JSR		L_Dis_8Bit_DigitDot_Prog
    39 00:CDCA: 09            	RTS
    40                        L_Display_lcd_Prog_Normal_Hr_1:
    41 00:CDCB: 53 0A         	LDA		#10
    42 00:CDCD: 15 D9 C8      	JSR		L_Dis_8Bit_DigitDot_Prog
    43 00:CDD0: 09            	RTS
    44                        
    45                        
    46                        L_Display_lcd_Prog_Normal_Day:
    47 00:CDD1: 15 7F CE      	JSR		L_A_HexToHexD
    48 00:CDD4: 0A            	PHA
    49 00:CDD5: 51 0F         	AND		#$0F
    50 00:CDD7: 5E 31             LDX     #lcd_d8
    51 00:CDD9: 15 D9 C8          JSR		L_Dis_8Bit_DigitDot_Prog
    52 00:CDDC: 5E 2A         	LDX		#lcd_d7
    53 00:CDDE: 3B 9F 21      	BBS3	Sys_Flag_A,L_Display_lcd_Prog_Normal
    54 00:CDE1: 17 DE         	BRA		L_Display_lcd_Prog_Normal_1
    55                        L_Display_lcd_Prog_Normal_Month:
    56 00:CDE3: 15 7F CE      	JSR		L_A_HexToHexD
    57 00:CDE6: 0A            	PHA
    58 00:CDE7: 51 0F         	AND		#$0F
    59 00:CDE9: 5E 1C             LDX     #lcd_d5
    60 00:CDEB: 15 D9 C8          JSR		L_Dis_8Bit_DigitDot_Prog
    61 00:CDEE: 5E 15         	LDX		#lcd_d4
    62 00:CDF0: 3B 9F 0F      	BBS3	Sys_Flag_A,L_Display_lcd_Prog_Normal
    63 00:CDF3: 17 CC         	BRA		L_Display_lcd_Prog_Normal_1
    64                        ;====================================
    65                        L_Display_lcd_Prog_Normal_Sec:;显示秒数的lcd_1，lcd2
    66 00:CDF5: 15 7F CE          JSR		L_A_HexToHexD
    67 00:CDF8: 0A            	PHA
    68 00:CDF9: 51 0F         	AND		#$0F
    69 00:CDFB: 5E 31             LDX     #lcd_d8
    70 00:CDFD: 15 D9 C8          JSR		L_Dis_8Bit_DigitDot_Prog
    71 00:CE00: 5E 2A         	LDX		#lcd_d7
    72                        L_Display_lcd_Prog_Normal:
    73 00:CE02: 0C            	PLA
    74 00:CE03: 15 3C C9      	JSR		L_ROR_4Bit_Prog
    75 00:CE06: 15 D9 C8      	JSR		L_Dis_8Bit_DigitDot_Prog
    76 00:CE09: 09            	RTS
    77                        
    78                        ;=======================================
    79                        L_Display_lcd_Prog_Normal_Min:;显示秒数的lcd_3，lcd4
    80 00:CE0A: 15 7F CE          JSR		L_A_HexToHexD
    81 00:CE0D: 0A            	PHA
    82 00:CE0E: 51 0F         	AND		#$0F
    83 00:CE10: 5E 1C             LDX     #lcd_d5
    84 00:CE12: 15 D9 C8          JSR		L_Dis_8Bit_DigitDot_Prog
    85 00:CE15: 5E 15         	LDX		#lcd_d4
    86 00:CE17: 17 E9         	BRA		L_Display_lcd_Prog_Normal
    87                        
    88                        ;=============================================
    89                        L_Clr_All_8Bit_Prog:
    90 00:CE19: 53 0A         	LDA		#10
    91 00:CE1B: 5E 00         	LDX		#lcd_d1
    92 00:CE1D: 15 D9 C8      	JSR     L_Dis_8Bit_DigitDot_Prog
    93 00:CE20: 53 0A         	LDA		#10
    94 00:CE22: 5E 07         	LDX		#lcd_d2
    95 00:CE24: 15 D9 C8      	JSR     L_Dis_8Bit_DigitDot_Prog
    96 00:CE27: 53 0A         	LDA		#10
    97 00:CE29: 5E 0E         	LDX		#lcd_d3
    98 00:CE2B: 15 D9 C8      	JSR     L_Dis_8Bit_DigitDot_Prog
    99 00:CE2E: 53 0A         	LDA		#10
   100 00:CE30: 5E 15         	LDX		#lcd_d4
   101 00:CE32: 15 D9 C8      	JSR     L_Dis_8Bit_DigitDot_Prog
   102 00:CE35: 53 0A         	LDA		#10
   103 00:CE37: 5E 1C         	LDX		#lcd_d5
   104 00:CE39: 15 D9 C8      	JSR     L_Dis_8Bit_DigitDot_Prog
   105 00:CE3C: 53 0A         	LDA		#10
   106 00:CE3E: 5E 23         	LDX		#lcd_d6
   107 00:CE40: 15 D9 C8      	JSR     L_Dis_8Bit_DigitDot_Prog
   108 00:CE43: 53 0A         	LDA		#10
   109 00:CE45: 5E 2A         	LDX		#lcd_d7
   110 00:CE47: 15 D9 C8      	JSR     L_Dis_8Bit_DigitDot_Prog
   111 00:CE4A: 53 0A         	LDA		#10
   112 00:CE4C: 5E 31         	LDX		#lcd_d8
   113 00:CE4E: 15 D9 C8      	JSR     L_Dis_8Bit_DigitDot_Prog
   114 00:CE51: 15 D9 CC      	JSR		L_Clr_lcd_T1_Prog
   115 00:CE54: 15 DD CC      	JSR		L_Clr_lcd_T2_Prog
   116 00:CE57: 15 E1 CC      	JSR		L_Clr_lcd_T3_Prog
   117 00:CE5A: 15 E5 CC      	JSR		L_Clr_lcd_T4_Prog
   118 00:CE5D: 15 E9 CC      	JSR		L_Clr_lcd_T5_Prog
   119 00:CE60: 15 ED CC      	JSR		L_Clr_lcd_T6_Prog
   120 00:CE63: 15 F1 CC      	JSR		L_Clr_lcd_T7_Prog
   121 00:CE66: 15 F5 CC      	JSR		L_Clr_lcd_T8_Prog
   122 00:CE69: 09            	RTS
   123                        L_Display_lcd_Prog_Normal_Timer:;显示定时器小时的显示函数
   124 00:CE6A: 15 7F CE          JSR		L_A_HexToHexD
   125 00:CE6D: 0A            	PHA
   126 00:CE6E: 51 0F         	AND		#$0F
   127 00:CE70: 5E 07             LDX     #lcd_d2
   128 00:CE72: 15 D9 C8          JSR		L_Dis_8Bit_DigitDot_Prog
   129 00:CE75: 5E 00         	LDX		#lcd_d1
   130 00:CE77: 0C            	PLA
   131 00:CE78: 15 3C C9      	JSR		L_ROR_4Bit_Prog
   132 00:CE7B: 15 D9 C8      	JSR		L_Dis_8Bit_DigitDot_Prog
   133                        	RTS
   133 00:CE7E: 09            
   176                        .INCLUDE	Display\Tool.asm
     1                        L_A_HexToHexD:
     2 00:CE7F: 7F EF         	STA		P_Temp								; 将十进制输入保存到 P_Temp
     3 00:CE81: 53 00         	LDA		#0									; 初始化高位寄存器
     4 00:CE83: 7F F0         	STA		P_Temp+1							; 高位清零
     5 00:CE85: 7F F1         	STA		P_Temp+2							; 低位清零
     6                        
     7                        L_DecToHex_Loop:
     8 00:CE87: 73 EF         	LDA		P_Temp								; 读取当前十进制值
     9 00:CE89: 56 0A         	CMP		#10
    10 00:CE8B: 10 09         	BCC		L_DecToHex_End						; 如果小于16，则跳到结束
    11                        
    12 00:CE8D: 00            	SEC											; 启用借位
    13 00:CE8E: 55 0A         	SBC		#10									; 减去16
    14 00:CE90: 7F EF         	STA		P_Temp								; 更新十进制值
    15 00:CE92: 78 F0         	INC		P_Temp+1							; 高位+1，累加十六进制的十位
    16                        
    17 00:CE94: 17 F1         	BRA		L_DecToHex_Loop						; 重复循环
    18                        
    19                        L_DecToHex_End:
    20 00:CE96: 73 EF         	LDA		P_Temp								; 最后剩余的值是低位
    21 00:CE98: 7F F1         	STA		P_Temp+2							; 存入低位
    22                        
    23 00:CE9A: 73 F0         	LDA		P_Temp+1							; 将高位放入A寄存器准备结果组合
    24 00:CE9C: 04            	CLC
    25 00:CE9D: 18            	ROL
    26 00:CE9E: 18            	ROL
    27 00:CE9F: 18            	ROL
    28 00:CEA0: 18            	ROL											; 左移4次，完成乘16
    29 00:CEA1: 04            	CLC
    30 00:CEA2: 74 F1         	ADC		P_Temp+2							; 加上低位值
    31                        
    32 00:CEA4: 09            	RTS
    33                        
    34                        ;======================================================================
    35                        L_A_HexDToHex:
    36 00:CEA5: 7F EF         	STA		P_Temp								; 将十六进制输入保存到 P_Temp
    37 00:CEA7: 53 00         	LDA		#0									; 初始化高位寄存器
    38 00:CEA9: 7F F0         	STA		P_Temp+1							; 高位清零
    39 00:CEAB: 7F F1         	STA		P_Temp+2							; 低位清零
    40                        
    41 00:CEAD: 73 EF         	LDA		P_Temp
    42 00:CEAF: 51 0F         	AND		#0FH
    43 00:CEB1: 7F F1         	STA		P_Temp+2
    44 00:CEB3: 73 EF         	LDA		P_Temp
    45 00:CEB5: 51 F0         	AND		#F0H
    46 00:CEB7: 04            	CLC
    47 00:CEB8: 19            	ROR
    48 00:CEB9: 19            	ROR
    49 00:CEBA: 19            	ROR
    50 00:CEBB: 19            	ROR
    51 00:CEBC: 7F EF         	STA		P_Temp
    52                        L_A_HexDToHex_Loop:
    53 00:CEBE: 04            	CLC
    54 00:CEBF: 53 0A         	LDA		#10
    55 00:CEC1: 74 F1         	ADC		P_Temp+2
    56 00:CEC3: 7F F1         	STA		P_Temp+2
    57 00:CEC5: 79 EF         	DEC		P_Temp
    58 00:CEC7: 73 EF         	LDA		P_Temp
    59 00:CEC9: 12 F3         	BNE		L_A_HexDToHex_Loop
    60 00:CECB: 73 F1         	LDA		P_Temp+2
    61 00:CECD: 09            	RTS
    62                        ;===========================================
    63                        
    64                        L_12_24_Prog:;12小时和24小时切换
    65 00:CECE: 7F EF         	STA		P_Temp
    66 00:CED0: 3A A0 2C      	BBS2	Sys_Flag_B,L_12_24_Prog_5;判断是24小时制跳转退出
    67 00:CED3: 73 EF         	LDA		P_Temp
    68 00:CED5: 13 0F         	BEQ		L_12_24_Prog_1;为0是跳转
    69 00:CED7: 56 0B         	CMP		#11
    70 00:CED9: 13 02         	BEQ		L_12_24_Prog_4
    71 00:CEDB: 11 12         	BCS		L_12_24_Prog_3;比12大时跳转
    72                        L_12_24_Prog_4:
    73 00:CEDD: 15 92 CC      	JSR		L_Dis_lcd_AM_Prog
    74 00:CEE0: 15 D5 CC      	JSR		L_Clr_lcd_PM_Prog
    75 00:CEE3: 73 EF         	LDA		P_Temp
    76                        L_12_24_Prog_OUT:
    77 00:CEE5: 09            	RTS
    78                        L_12_24_Prog_1:;0点
    79 00:CEE6: 15 92 CC      	JSR		L_Dis_lcd_AM_Prog
    80 00:CEE9: 15 D5 CC      	JSR		L_Clr_lcd_PM_Prog
    81 00:CEEC: 53 0C         	LDA		#12
    82 00:CEEE: 09            	RTS
    83                        L_12_24_Prog_3:
    84 00:CEEF: 15 D1 CC      	JSR		L_Clr_lcd_AM_Prog
    85 00:CEF2: 15 96 CC      	JSR		L_Dis_lcd_PM_Prog
    86 00:CEF5: 73 EF         	LDA		P_Temp
    87 00:CEF7: 56 0C         	CMP		#12
    88 00:CEF9: 13 EA         	BEQ		L_12_24_Prog_OUT
    89 00:CEFB: 00            	SEC
    90 00:CEFC: 55 0C         	SBC		#12
    91 00:CEFE: 09            	RTS
    92                        L_12_24_Prog_5:
    93 00:CEFF: 15 D1 CC      	JSR		L_Clr_lcd_AM_Prog
    94 00:CF02: 15 D5 CC      	JSR		L_Clr_lcd_PM_Prog
    95 00:CF05: 73 EF         	LDA		P_Temp
    96 00:CF07: 09            	RTS
    97                        
    98                        
    99                        ;==================================
   100                        L_12_To_24_Prog:
   101 00:CF08: 73 F2         	LDA		P_Temp+3
   102 00:CF0A: 56 0C         	CMP		#12
   103 00:CF0C: 10 0B         	BCC		L_AM_TO_24_Prog
   104                        L_PM_TO_24_Prog:;入口P_Temp+5(按键给的值)，P_Temp+3原值
   105 00:CF0E: 73 F4         	LDA		P_Temp+5
   106 00:CF10: 56 0C         	CMP		#12
   107 00:CF12: 13 04         	BEQ		 L_PM_TO_24_Prog_RTS
   108 00:CF14: 04            	CLC
   109 00:CF15: 54 0C         	ADC		#12
   110 00:CF17: 09            	RTS
   111                        
   112                        L_PM_TO_24_Prog_RTS:
   113 00:CF18: 09            	RTS
   114                        
   115                        L_AM_TO_24_Prog:
   116 00:CF19: 73 F4         	LDA		P_Temp+5
   117 00:CF1B: 56 0C         	CMP		#12
   118 00:CF1D: 12 F9         	BNE		L_PM_TO_24_Prog_RTS
   119 00:CF1F: 53 00         	LDA		#0
   120                        	RTS
   120 00:CF21: 09            
   177                        
   178                        
   179                        .Include	Calculator\Calculator_Base.asm
     1                        ;=====================================
     2                        ;计算器基础库2025/3/25（易码）
     3                        ;=====================================
     4                        ;8位计算器只用+3，具体加几根据MAX_DIG决定，可用去判断除数是否为0
     5                        ;，平方根运算中被开方数是否为0,以及加减法中需不需要操作数
     6                        L_Judge_BUF1_Prog:
     7                            ; LDA     #MAX_BYTE
     8                            ; STA     P_Temp
     9 00:CF22: 73 BB             LDA		BUF1
    10 00:CF24: 70 BC         	ORA		BUF1+1
    11 00:CF26: 70 BD         	ORA		BUF1+2
    12 00:CF28: 70 BE         	ORA		BUF1+3
    13                        	; ORA		BUF1+4
    14                        	; ORA		BUF1+5
    15 00:CF2A: 09            	RTS
    16                        ;=====================================
    17                        L_Judge_BUF2_Prog:
    18 00:CF2B: 73 C4         	LDA		BUF2
    19 00:CF2D: 70 C5         	ORA		BUF2+1
    20 00:CF2F: 70 C6         	ORA		BUF2+2
    21 00:CF31: 70 C7         	ORA		BUF2+3
    22                        	; ORA		BUF2+4
    23                        	; ORA		BUF2+5
    24 00:CF33: 09            	RTS
    25                        L_Judge_BUF1_BUF2_IBUF_Prog
    26 00:CF34: 73 BB         	LDA		BUF1
    27 00:CF36: 70 BC         	ORA		BUF1+1
    28 00:CF38: 70 BD         	ORA		BUF1+2
    29 00:CF3A: 70 BE         	ORA		BUF1+3
    30 00:CF3C: 70 C4         	ORA		BUF2
    31 00:CF3E: 70 C5         	ORA		BUF2+1
    32 00:CF40: 70 C6         	ORA		BUF2+2
    33 00:CF42: 70 C7         	ORA		BUF2+3
    34 00:CF44: 70 E9         	ORA		IBUF
    35 00:CF46: 70 EA         	ORA		IBUF+1
    36 00:CF48: 70 EB         	ORA		IBUF+2
    37 00:CF4A: 70 EC         	ORA		IBUF+3
    38 00:CF4C: 09            	RTS
    39                        ;=====================================
    40                        L_Adjust_FD_DEC_Prog:;小数点右移FD减少
    41 00:CF4D: 63 80 00      	LDA		RAM,X
    42 00:CF50: 51 7F         	AND		#07FH
    43 00:CF52: 13 0A         	BEQ		L_Adjust_FD_DEC_Prog_RTS
    44 00:CF54: 06            	CLD
    45 00:CF55: 00            	SEC
    46 00:CF56: 63 80 00      	LDA		RAM,X
    47 00:CF59: 55 01         	SBC		#1
    48 00:CF5B: 6F 80 00      	STA		RAM,X
    49                        L_Adjust_FD_DEC_Prog_RTS:
    50 00:CF5E: 09            	RTS
    51                        ;=====================================
    52                        L_Adjust_FD_INC_Prog:;小数点左移FD增加
    53 00:CF5F: 63 80 00      	LDA		RAM,X
    54 00:CF62: 51 7F         	AND		#07FH
    55 00:CF64: 12 0A         	BNE		L_Adjust_FD_INC_Prog_RTS
    56 00:CF66: 06            	CLD
    57 00:CF67: 04            	CLC
    58 00:CF68: 53 01         	LDA		#1
    59 00:CF6A: 64 80 00      	ADC		RAM,X
    60 00:CF6D: 6F 80 00      	STA		RAM,X
    61                        L_Adjust_FD_INC_Prog_RTS:
    62 00:CF70: 09            	RTS
    63                        ;=====================================
    64                        ;=====================================
    65                        ;具体加几根据MAX_DIG决定,
    66                        ;
    67                        L_Move_Left_One_Bit_Prog:
    68 00:CF71: 04                CLC
    69                        L_Move_Left_One_Bit_Prog_C:
    70 00:CF72: 6A 80 00      	ROL		RAM, X
    71 00:CF75: 6A 81 00      	ROL		RAM+1, X
    72 00:CF78: 6A 82 00      	ROL		RAM+2, X
    73 00:CF7B: 6A 83 00      	ROL		RAM+3, X
    74 00:CF7E: 6A 84 00      	ROL		RAM+4, X
    75 00:CF81: 6A 85 00      	ROL		RAM+5, X
    76 00:CF84: 6A 86 00      	ROL		RAM+6, X
    77 00:CF87: 6A 87 00      	ROL		RAM+7, X
    78 00:CF8A: 09                RTS
    79                        ;=====================================
    80                        L_Move_Left_One_DIG_Prog:;；向左平移了1个DIG位数
    81 00:CF8B: 15 71 CF          JSR     L_Move_Left_One_Bit_Prog
    82 00:CF8E: 15 71 CF          JSR     L_Move_Left_One_Bit_Prog
    83 00:CF91: 15 71 CF          JSR     L_Move_Left_One_Bit_Prog
    84 00:CF94: 15 71 CF          JSR     L_Move_Left_One_Bit_Prog
    85 00:CF97: 09                RTS
    86                        ;=====================================
    87                        L_Move_Left_Two_DIG_Prog:;向左平移了2个DIG位数
    88 00:CF98: 63 86 00      	LDA		RAM+6,X
    89 00:CF9B: 6F 87 00      	STA		RAM+7,X
    90 00:CF9E: 63 85 00      	LDA		RAM+5,X
    91 00:CFA1: 6F 86 00      	STA		RAM+6,X
    92 00:CFA4: 63 84 00      	LDA		RAM+4,X
    93 00:CFA7: 6F 85 00      	STA		RAM+5,X
    94 00:CFAA: 63 83 00      	LDA		RAM+3,X
    95 00:CFAD: 6F 84 00      	STA		RAM+4,X
    96 00:CFB0: 63 82 00      	LDA		RAM+2,X
    97 00:CFB3: 6F 83 00      	STA		RAM+3,X
    98 00:CFB6: 63 81 00      	LDA		RAM+1,X
    99 00:CFB9: 6F 82 00      	STA		RAM+2,X
   100 00:CFBC: 63 80 00      	LDA		RAM,X
   101 00:CFBF: 6F 81 00      	STA		RAM+1,X
   102 00:CFC2: 53 00         	LDA		#0
   103 00:CFC4: 6F 80 00      	STA		RAM,X
   104 00:CFC7: 09            	RTS
   105                        
   106                        ;=====================================
   107                        L_Move_Max_DIG_Prog:;可能用于数值转换
   108 00:CFC8: 15 98 CF          JSR     L_Move_Left_Two_DIG_Prog
   109 00:CFCB: 15 98 CF          JSR     L_Move_Left_Two_DIG_Prog
   110 00:CFCE: 15 98 CF          JSR     L_Move_Left_Two_DIG_Prog
   111 00:CFD1: 15 98 CF          JSR     L_Move_Left_Two_DIG_Prog
   112 00:CFD4: 09                RTS
   113                        ;=====================================
   114                        ;具体加几根据MAX_DIG决定,
   115                        ;
   116                        L_Move_Right_One_Bit_Prog:
   117 00:CFD5: 04                CLC
   118                        L_Move_Right_One_Bit_Prog_C:
   119 00:CFD6: 6B 87 00          ROR		RAM+7,X
   120 00:CFD9: 6B 86 00      	ROR		RAM+6,X
   121 00:CFDC: 6B 85 00      	ROR		RAM+5,X
   122 00:CFDF: 6B 84 00      	ROR		RAM+4,X
   123 00:CFE2: 6B 83 00      	ROR		RAM+3,X
   124 00:CFE5: 6B 82 00      	ROR		RAM+2,X
   125 00:CFE8: 6B 81 00      	ROR		RAM+1,X
   126 00:CFEB: 6B 80 00      	ROR		RAM,X
   127 00:CFEE: 09                RTS
   128                        ;=====================================
   129                        L_Move_Right_One_DIG_Prog:;；向右平移了1个DIG位数
   130 00:CFEF: 15 D5 CF          JSR     L_Move_Right_One_Bit_Prog
   131 00:CFF2: 15 D5 CF          JSR     L_Move_Right_One_Bit_Prog
   132 00:CFF5: 15 D5 CF          JSR     L_Move_Right_One_Bit_Prog
   133 00:CFF8: 15 D5 CF          JSR     L_Move_Right_One_Bit_Prog
   134 00:CFFB: 09                RTS
   135                        ;=====================================
   136                        L_Clear_BUF_Prog:
   137 00:CFFC: 53 00             LDA		#0
   138 00:CFFE: 6F 80 00      	STA		RAM, X
   139 00:D001: 6F 81 00      	STA		RAM+1, X
   140 00:D004: 6F 82 00      	STA		RAM+2, X
   141 00:D007: 6F 83 00      	STA		RAM+3, X
   142 00:D00A: 6F 84 00      	STA		RAM+4, X
   143 00:D00D: 6F 85 00      	STA		RAM+5, X
   144 00:D010: 6F 86 00      	STA		RAM+6, X
   145 00:D013: 6F 87 00      	STA		RAM+7, X
   146 00:D016: 09                RTS
   147                        ;=====================================
   148                        ;buf2 = bufx + buf2
   149                        ;具体加几根据MAX_DIG决定,
   150                        L_BUFX_Add_BUF2_TO_BUF2_Prog:
   151 00:D017: 04            	CLC
   152 00:D018: 63 80 00      	LDA		RAM,X
   153 00:D01B: 74 C4         	ADC		BUF2
   154 00:D01D: 7F C4         	STA		BUF2
   155 00:D01F: 63 81 00      	LDA		RAM+1, X
   156 00:D022: 74 C5         	ADC		BUF2+1
   157 00:D024: 7F C5         	STA		BUF2+1
   158 00:D026: 63 82 00      	LDA		RAM+2, X
   159 00:D029: 74 C6         	ADC		BUF2+2
   160 00:D02B: 7F C6         	STA		BUF2+2
   161 00:D02D: 63 83 00      	LDA		RAM+3, X
   162 00:D030: 74 C7         	ADC		BUF2+3
   163 00:D032: 7F C7         	STA		BUF2+3
   164 00:D034: 63 84 00      	LDA		RAM+4, X
   165 00:D037: 74 C8         	ADC		BUF2+4
   166 00:D039: 7F C8         	STA		BUF2+4
   167 00:D03B: 63 85 00      	LDA		RAM+5, X
   168 00:D03E: 74 C9         	ADC		BUF2+5
   169 00:D040: 7F C9         	STA		BUF2+5
   170 00:D042: 63 86 00      	LDA		RAM+6, X
   171 00:D045: 74 CA         	ADC		BUF2+6
   172 00:D047: 7F CA         	STA		BUF2+6
   173 00:D049: 63 87 00      	LDA		RAM+7, X
   174 00:D04C: 74 CB         	ADC		BUF2+7
   175 00:D04E: 7F CB         	STA		BUF2+7
   176 00:D050: 09            	RTS
   177                        ;=====================================
   178                        ;---------------------------------------
   179                        ;buf3 = bufx + buf3
   180                        ;具体加几根据MAX_DIG决定,
   181                        L_BUFX_Add_BUF3_TO_BUF3_Prog:
   182 00:D051: 04            	CLC
   183 00:D052: 63 80 00      	LDA		RAM, X
   184 00:D055: 74 CD         	ADC		BUF3
   185 00:D057: 7F CD         	STA		BUF3
   186 00:D059: 63 81 00      	LDA		RAM+1, X
   187 00:D05C: 74 CE         	ADC		BUF3+1
   188 00:D05E: 7F CE         	STA		BUF3+1
   189 00:D060: 63 82 00      	LDA		RAM+2, X
   190 00:D063: 74 CF         	ADC		BUF3+2
   191 00:D065: 7F CF         	STA		BUF3+2
   192 00:D067: 63 83 00      	LDA		RAM+3, X
   193 00:D06A: 74 D0         	ADC		BUF3+3
   194 00:D06C: 7F D0         	STA		BUF3+3
   195 00:D06E: 63 84 00      	LDA		RAM+4, X
   196 00:D071: 74 D1         	ADC		BUF3+4
   197 00:D073: 7F D1         	STA		BUF3+4
   198 00:D075: 63 85 00      	LDA		RAM+5, X
   199 00:D078: 74 D2         	ADC		BUF3+5
   200 00:D07A: 7F D2         	STA		BUF3+5
   201 00:D07C: 63 86 00      	LDA		RAM+6, X
   202 00:D07F: 74 D3         	ADC		BUF3+6
   203 00:D081: 7F D3         	STA		BUF3+6
   204 00:D083: 63 87 00      	LDA		RAM+7, X
   205 00:D086: 74 D4         	ADC		BUF3+7
   206 00:D088: 7F D4         	STA		BUF3+7
   207 00:D08A: 09            	RTS
   208                        ;=====================================
   209                        L_BUFX_SUB_BUF5_Prog:;比较BUFX和BUF5
   210 00:D08B: 00            	SEC
   211 00:D08C: 63 80 00      	LDA		RAM, X
   212 00:D08F: 75 DD         	SBC		BUF5
   213 00:D091: 63 81 00      	LDA		RAM+1, X
   214 00:D094: 75 DE         	SBC		BUF5+1
   215 00:D096: 63 82 00      	LDA		RAM+2, X
   216 00:D099: 75 DF         	SBC		BUF5+2
   217 00:D09B: 63 83 00      	LDA		RAM+3, X
   218 00:D09E: 75 E0         	SBC		BUF5+3
   219 00:D0A0: 63 84 00      	LDA		RAM+4, X
   220 00:D0A3: 75 E1         	SBC		BUF5+4
   221 00:D0A5: 63 85 00      	LDA		RAM+5, X
   222 00:D0A8: 75 E2         	SBC		BUF5+5
   223 00:D0AA: 63 86 00      	LDA		RAM+6, X
   224 00:D0AD: 75 E3         	SBC		BUF5+6
   225 00:D0AF: 63 87 00      	LDA		RAM+7, X
   226 00:D0B2: 75 E4         	SBC		BUF5+7
   227 00:D0B4: 09            	RTS
   228                        L_BUFX_SUB_BUF2_Prog:
   229 00:D0B5: 00            	SEC
   230 00:D0B6: 63 80 00      	LDA		RAM, X
   231 00:D0B9: 75 C4         	SBC		BUF2
   232 00:D0BB: 63 81 00      	LDA		RAM+1, X
   233 00:D0BE: 75 C5         	SBC		BUF2+1
   234 00:D0C0: 63 82 00      	LDA		RAM+2, X
   235 00:D0C3: 75 C6         	SBC		BUF2+2
   236 00:D0C5: 63 83 00      	LDA		RAM+3, X
   237 00:D0C8: 75 C7         	SBC		BUF2+3
   238 00:D0CA: 63 84 00      	LDA		RAM+4, X
   239 00:D0CD: 75 C8         	SBC		BUF2+4
   240 00:D0CF: 63 85 00      	LDA		RAM+5, X
   241 00:D0D2: 75 C9         	SBC		BUF2+5
   242 00:D0D4: 63 86 00      	LDA		RAM+6, X
   243 00:D0D7: 75 CA         	SBC		BUF2+6
   244 00:D0D9: 63 87 00      	LDA		RAM+7, X
   245 00:D0DC: 75 CB         	SBC		BUF2+7
   246 00:D0DE: 09            	RTS
   247                        ;=====================================
   248                        ;bufx = bufx - buf5
   249                        L_BUFX_SUB_BUF5_TO_BUFX_Prog:
   250 00:D0DF: 00            	SEC
   251 00:D0E0: 63 80 00      	LDA		RAM, X
   252 00:D0E3: 75 DD         	SBC		BUF5
   253 00:D0E5: 6F 80 00      	STA		RAM, X
   254                        
   255 00:D0E8: 63 81 00      	LDA		RAM+1, X
   256 00:D0EB: 75 DE         	SBC		BUF5+1
   257 00:D0ED: 6F 81 00      	STA		RAM+1, X
   258                        
   259 00:D0F0: 63 82 00      	LDA		RAM+2, X
   260 00:D0F3: 75 DF         	SBC		BUF5+2
   261 00:D0F5: 6F 82 00      	STA		RAM+2, X
   262                        
   263 00:D0F8: 63 83 00      	LDA		RAM+3, X
   264 00:D0FB: 75 E0         	SBC		BUF5+3
   265 00:D0FD: 6F 83 00      	STA		RAM+3, X
   266                        
   267 00:D100: 63 84 00      	LDA		RAM+4, X
   268 00:D103: 75 E1         	SBC		BUF5+4
   269 00:D105: 6F 84 00      	STA		RAM+4, X
   270                        
   271 00:D108: 63 85 00      	LDA		RAM+5, X
   272 00:D10B: 75 E2         	SBC		BUF5+5
   273 00:D10D: 6F 85 00      	STA		RAM+5, X
   274                        
   275 00:D110: 63 86 00      	LDA		RAM+6, X
   276 00:D113: 75 E3         	SBC		BUF5+6
   277 00:D115: 6F 86 00      	STA		RAM+6, X
   278                        
   279 00:D118: 63 87 00      	LDA		RAM+7, X
   280 00:D11B: 75 E4         	SBC		BUF5+7
   281 00:D11D: 6F 87 00      	STA		RAM+7, X
   282 00:D120: 09            	RTS
   283                        L_BUFX_SUB_BUF2_TO_BUFX_Prog:
   284 00:D121: 00            	SEC
   285 00:D122: 63 80 00      	LDA		RAM, X
   286 00:D125: 75 C4         	SBC		BUF2
   287 00:D127: 6F 80 00      	STA		RAM, X
   288 00:D12A: 63 81 00      	LDA		RAM+1, X
   289 00:D12D: 75 C5         	SBC		BUF2+1
   290 00:D12F: 6F 81 00      	STA		RAM+1, X
   291 00:D132: 63 82 00      	LDA		RAM+2, X
   292 00:D135: 75 C6         	SBC		BUF2+2
   293 00:D137: 6F 82 00      	STA		RAM+2, X
   294 00:D13A: 63 83 00      	LDA		RAM+3, X
   295 00:D13D: 75 C7         	SBC		BUF2+3
   296 00:D13F: 6F 83 00      	STA		RAM+3, X
   297 00:D142: 63 84 00      	LDA		RAM+4, X
   298 00:D145: 75 C8         	SBC		BUF2+4
   299 00:D147: 6F 84 00      	STA		RAM+4, X
   300 00:D14A: 63 85 00      	LDA		RAM+5, X
   301 00:D14D: 75 C9         	SBC		BUF2+5
   302 00:D14F: 6F 85 00      	STA		RAM+5, X
   303 00:D152: 63 86 00      	LDA		RAM+6, X
   304 00:D155: 75 CA         	SBC		BUF2+6
   305 00:D157: 6F 86 00      	STA		RAM+6, X
   306 00:D15A: 63 87 00      	LDA		RAM+7, X
   307 00:D15D: 75 CB         	SBC		BUF2+7
   308 00:D15F: 6F 87 00      	STA		RAM+7, X
   309 00:D162: 09            	RTS
   310                        ;=====================================
   311                        ;将内存存储到对应BUF1上
   312                        L_Copy_To_BUF1:
   313 00:D163: 63 80 00      	LDA		RAM, X
   314 00:D166: 7F BB         	STA		BUF1
   315 00:D168: 63 81 00      	LDA		RAM+1, X
   316 00:D16B: 7F BC         	STA		BUF1+1
   317 00:D16D: 63 82 00      	LDA		RAM+2, X
   318 00:D170: 7F BD         	STA		BUF1+2
   319 00:D172: 63 83 00      	LDA		RAM+3, X
   320 00:D175: 7F BE         	STA		BUF1+3
   321 00:D177: 63 84 00      	LDA		RAM+4, X
   322 00:D17A: 7F BF         	STA		BUF1+4
   323 00:D17C: 63 85 00      	LDA		RAM+5, X
   324 00:D17F: 7F C0         	STA		BUF1+5
   325 00:D181: 63 86 00      	LDA		RAM+6, X
   326 00:D184: 7F C1         	STA		BUF1+6
   327 00:D186: 63 87 00      	LDA		RAM+7, X
   328 00:D189: 7F C2         	STA		BUF1+7
   329 00:D18B: 09            	RTS
   330                        ;=====================================
   331                        ;将内存存储到对应BUF2上
   332                        L_Copy_To_BUF2:
   333 00:D18C: 63 80 00      	LDA		RAM, X
   334 00:D18F: 7F C4         	STA		BUF2
   335 00:D191: 63 81 00      	LDA		RAM+1, X
   336 00:D194: 7F C5         	STA		BUF2+1
   337 00:D196: 63 82 00      	LDA		RAM+2, X
   338 00:D199: 7F C6         	STA		BUF2+2
   339 00:D19B: 63 83 00      	LDA		RAM+3, X
   340 00:D19E: 7F C7         	STA		BUF2+3
   341 00:D1A0: 63 84 00      	LDA		RAM+4, X
   342 00:D1A3: 7F C8         	STA		BUF2+4
   343 00:D1A5: 63 85 00      	LDA		RAM+5, X
   344 00:D1A8: 7F C9         	STA		BUF2+5
   345 00:D1AA: 63 86 00      	LDA		RAM+6, X
   346 00:D1AD: 7F CA         	STA		BUF2+6
   347 00:D1AF: 63 87 00      	LDA		RAM+7, X
   348 00:D1B2: 7F CB         	STA		BUF2+7
   349 00:D1B4: 09            	RTS
   350                        ;=====================================
   351                        ;将内存存储到对应BUF3上
   352                        L_Copy_To_BUF3:
   353 00:D1B5: 63 80 00      	LDA		RAM, X
   354 00:D1B8: 7F CD         	STA		BUF3
   355 00:D1BA: 63 81 00      	LDA		RAM+1, X
   356 00:D1BD: 7F CE         	STA		BUF3+1
   357 00:D1BF: 63 82 00      	LDA		RAM+2, X
   358 00:D1C2: 7F CF         	STA		BUF3+2
   359 00:D1C4: 63 83 00      	LDA		RAM+3, X
   360 00:D1C7: 7F D0         	STA		BUF3+3
   361 00:D1C9: 63 84 00      	LDA		RAM+4, X
   362 00:D1CC: 7F D1         	STA		BUF3+4
   363 00:D1CE: 63 85 00      	LDA		RAM+5, X
   364 00:D1D1: 7F D2         	STA		BUF3+5
   365 00:D1D3: 63 86 00      	LDA		RAM+6, X
   366 00:D1D6: 7F D3         	STA		BUF3+6
   367 00:D1D8: 63 87 00      	LDA		RAM+7, X
   368 00:D1DB: 7F D4         	STA		BUF3+7
   369 00:D1DD: 09            	RTS
   370                        ;=====================================
   371                        ;将内存存储到对应BUF4上
   372                        L_Copy_To_BUF4:
   373 00:D1DE: 63 80 00      	LDA		RAM, X
   374 00:D1E1: 7F D5         	STA		BUF4
   375 00:D1E3: 63 81 00      	LDA		RAM+1, X
   376 00:D1E6: 7F D6         	STA		BUF4+1
   377 00:D1E8: 63 82 00      	LDA		RAM+2, X
   378 00:D1EB: 7F D7         	STA		BUF4+2
   379 00:D1ED: 63 83 00      	LDA		RAM+3, X
   380 00:D1F0: 7F D8         	STA		BUF4+3
   381 00:D1F2: 63 84 00      	LDA		RAM+4, X
   382 00:D1F5: 7F D9         	STA		BUF4+4
   383 00:D1F7: 63 85 00      	LDA		RAM+5, X
   384 00:D1FA: 7F DA         	STA		BUF4+5
   385 00:D1FC: 63 86 00      	LDA		RAM+6, X
   386 00:D1FF: 7F DB         	STA		BUF4+6
   387 00:D201: 63 87 00      	LDA		RAM+7, X
   388 00:D204: 7F DC         	STA		BUF4+7
   389 00:D206: 09            	RTS
   390                        ;=====================================
   391                        ;将内存存储到对应BUF1上
   392                        L_Copy_To_BUF5:
   393 00:D207: 63 80 00      	LDA		RAM, X
   394 00:D20A: 7F DD         	STA		BUF5
   395 00:D20C: 63 81 00      	LDA		RAM+1, X
   396 00:D20F: 7F DE         	STA		BUF5+1
   397 00:D211: 63 82 00      	LDA		RAM+2, X
   398 00:D214: 7F DF         	STA		BUF5+2
   399 00:D216: 63 83 00      	LDA		RAM+3, X
   400 00:D219: 7F E0         	STA		BUF5+3
   401 00:D21B: 63 84 00      	LDA		RAM+4, X
   402 00:D21E: 7F E1         	STA		BUF5+4
   403 00:D220: 63 85 00      	LDA		RAM+5, X
   404 00:D223: 7F E2         	STA		BUF5+5
   405 00:D225: 63 86 00      	LDA		RAM+6, X
   406 00:D228: 7F E3         	STA		BUF5+6
   407 00:D22A: 63 87 00      	LDA		RAM+7, X
   408 00:D22D: 7F E4         	STA		BUF5+7
   409 00:D22F: 09            	RTS
   410                        
   411                        
   412                        ;=====================================
   413                        ;	最大十进制999999999999999999999999
   414                        ;	最大十六进制d3c21bcecceda0ffffff
   415                        ;	buf1.16 -> buf2.10 buf3,buf6
   416                        ;将BUF1的16进制数，转换为10进制数存储到BUF2中，BUF3存储每个1对应的权重
   417                        L_Hex_To_Dec_Prog:
   418 00:D230: 5E 44         	LDX		#(BUF2-RAM)
   419 00:D232: 15 FC CF      	JSR		L_Clear_BUF_Prog
   420 00:D235: 5E 4D         	LDX		#(BUF3-RAM)
   421 00:D237: 15 FC CF      	JSR		L_Clear_BUF_Prog
   422 00:D23A: 53 01         	LDA		#1
   423 00:D23C: 7F CD         	STA		BUF3;给权重计数器初始值
   424 00:D23E: 02            	SED
   425 00:D23F: 53 41         	LDA		#(MAX_DIG*8+1)
   426 00:D241: 7F E5         	STA		BUF6;计算循环次数
   427                        
   428                        L_Hex_To_Dec_Prog_Loop:
   429 00:D243: 79 E5         	DEC		BUF6
   430 00:D245: 13 13         	BEQ		L_Hex_To_Dec_Prog_RTS
   431 00:D247: 5E 3B         	LDX		#(BUF1-RAM)
   432 00:D249: 15 D5 CF      	JSR		L_Move_Right_One_Bit_Prog
   433 00:D24C: 10 05         	BCC		L_Hex_To_Dec_Prog_Loop_1;右移出C标志位，如果为1则说明此时需要在BUF2中加上权重，
   434                        ;否则跳转改变权重
   435 00:D24E: 5E 4D         	LDX		#(BUF3-RAM)
   436 00:D250: 15 17 D0      	JSR		L_BUFX_Add_BUF2_TO_BUF2_Prog
   437                        L_Hex_To_Dec_Prog_Loop_1:
   438 00:D253: 5E 4D         	LDX		#(BUF3-RAM)
   439 00:D255: 15 51 D0      	JSR		L_BUFX_Add_BUF3_TO_BUF3_Prog
   440 00:D258: 17 E9         	BRA		L_Hex_To_Dec_Prog_Loop
   441                        L_Hex_To_Dec_Prog_RTS:
   442 00:D25A: 09            	RTS
   443                        
   444                        
   445                        ;=====================================
   446                        ;10进制转16进制，将BUF1的10进制数转换为16进制并存储到
   447                        L_Dec_To_Hex_Prog:
   448 00:D25B: 5E 44         	LDX		#(BUF2-RAM)
   449 00:D25D: 15 FC CF      	JSR		L_Clear_BUF_Prog
   450 00:D260: 5E 4D         	LDX		#(BUF3-RAM)
   451 00:D262: 15 FC CF      	JSR		L_Clear_BUF_Prog
   452 00:D265: 5E 55         	LDX		#(BUF4-RAM)
   453 00:D267: 15 FC CF      	JSR		L_Clear_BUF_Prog
   454 00:D26A: 53 01         	LDA		#1
   455 00:D26C: 7F CD         	STA		BUF3;给权重初始值
   456 00:D26E: 06            	CLD
   457 00:D26F: 53 00         	LDA		#0
   458 00:D271: 7F E6         	STA		BUF6+1
   459 00:D273: 53 41         	LDA		#(MAX_DIG*8+1);循环次数
   460 00:D275: 7F E5         	STA		BUF6
   461                        L_Dec_To_Hex_Prog_Loop:
   462 00:D277: 79 E5         	DEC		BUF6
   463 00:D279: 13 35         	BEQ		L_Dec_To_Hex_Prog_RTS
   464 00:D27B: 5E 3B         	LDX		#(BUF1-RAM)
   465 00:D27D: 15 D5 CF      	JSR		L_Move_Right_One_Bit_Prog
   466 00:D280: 10 05         	BCC		L_Dec_To_Hex_Prog_Loop_Add;右移BUF1，1个BIT判断
   467 00:D282: 5E 4D         	LDX		#(BUF3-RAM);当C标志位为1时，将当前权重加到BUF2上
   468 00:D284: 15 17 D0      	JSR		L_BUFX_Add_BUF2_TO_BUF2_Prog
   469                        ;-----------------------------------------------------------
   470                        ;BUF6+1是指是制移位4次，每移位4次权重就要乘以10
   471                        ;第一次进入权重自身乘以2，第二次进入相将此时的权重存到BUF4后，在乘以二
   472                        ;第三次权重自身乘以二，第四次此时BUF4的数加到BUF3中
   473                        ;
   474                        L_Dec_To_Hex_Prog_Loop_Add:;
   475 00:D287: 78 E6         	INC		BUF6+1
   476 00:D289: 73 E6         	LDA		BUF6+1
   477 00:D28B: 56 04         	CMP		#4
   478 00:D28D: 12 04         	BNE		L_Dec_To_Hex_Prog_Loop_1
   479 00:D28F: 53 00         	LDA		#0
   480 00:D291: 7F E6         	STA		BUF6+1
   481                        L_Dec_To_Hex_Prog_Loop_1:
   482 00:D293: 73 E6         	LDA		BUF6+1
   483 00:D295: 13 06         	BEQ		L_Dec_To_Hex_Prog_BUFX_Add_BUF4_To_BUF3
   484 00:D297: 56 02         	CMP		#2
   485 00:D299: 13 09         	BEQ		L_Dec_To_Hex_Prog_SAVE
   486 00:D29B: 17 0C         	BRA		L_Dec_To_HEX_Prog_BUF3_To_BUF3_Prog
   487                        L_Dec_To_Hex_Prog_BUFX_Add_BUF4_To_BUF3:
   488 00:D29D: 5E 55         	LDX		#(BUF4-RAM)
   489 00:D29F: 15 51 D0      	JSR		L_BUFX_Add_BUF3_TO_BUF3_Prog
   490 00:D2A2: 17 D3         	BRA		L_Dec_To_Hex_Prog_Loop
   491                        L_Dec_To_Hex_Prog_SAVE:
   492 00:D2A4: 5E 4D         	LDX		#(BUF3-RAM)
   493 00:D2A6: 15 DE D1      	JSR		L_Copy_To_BUF4
   494                        L_Dec_To_HEX_Prog_BUF3_To_BUF3_Prog:
   495 00:D2A9: 5E 4D         	LDX		#(BUF3-RAM)
   496 00:D2AB: 15 51 D0      	JSR		L_BUFX_Add_BUF3_TO_BUF3_Prog
   497 00:D2AE: 17 C7         	BRA		L_Dec_To_Hex_Prog_Loop
   498                        L_Dec_To_Hex_Prog_RTS:
   499 00:D2B0: 09            	RTS
   500                        
   501                        
   502                        ;=====================================
   503                        ;=====================================
   504                        ;=====================================
   505                        ;=====================================
   506                        ;=====================================
   507                        ;=====================================
   508                        ;=====================================
   509                        ;=====================================
   510                        ;=====================================
   511                        ;=====================================
   512                        ;=====================================
   513                        ;=====================================
   514                        ;=====================================
   515                        ;=====================================
   516                        ;=====================================
   517                        ;=====================================
   518                        ;=====================================
   519                        ;=====================================
   520                        ;=====================================
   521                        ;=====================================
   522                        ;=====================================
   523                        ;=====================================
   524                        ;=====================================
   525                        ;=====================================
   526                        ;=====================================
   527                        ;=====================================
   528                        ;=====================================
   529                        ;=====================================
   530                        ;=====================================
   531                        ;=====================================
   532                        ;=====================================
   533                        ;=====================================
   534                        ;=====================================
   535                        ;=====================================
   536                        ;=====================================
   537                        ;=====================================
   538                        ;=====================================
   539                        ;=====================================
   540                        ;=====================================
   541                        ;=====================================
   542                        ;=====================================
   543                        ;=====================================
   544                        ;=====================================
   545                        ;=====================================
   546                        ;=====================================
   547                        ;=====================================
   548                        ;=====================================
   549                        ;=====================================
   550                        ;=====================================
   551                        ;=====================================
   552                        
   552                        
   180                        .Include	Calculator\Calculator_Base_Math.asm
     1                        
     2                        ;========================================================
     3                        ;加法
     4                        ;========================================================
     5                        L_Control_Add_Prog:
     6 00:D2B1: 5E 43             LDX     #(BUF1+FD-RAM)
     7 00:D2B3: 15 5F CF          JSR     L_Adjust_FD_INC_Prog
     8 00:D2B6: 5E 4C             LDX     #(BUF2+FD-RAM)
     9 00:D2B8: 15 5F CF          JSR     L_Adjust_FD_INC_Prog
    10                        L_Control_Add_Prog_Loop:
    11 00:D2BB: 73 C3             LDA		BUF1+FD
    12 00:D2BD: 51 7F         	AND		#07FH
    13 00:D2BF: 7F E5         	STA		BUF6
    14 00:D2C1: 73 CC         	LDA		BUF2+FD
    15 00:D2C3: 51 7F         	AND		#07FH
    16 00:D2C5: 76 E5         	CMP		BUF6
    17 00:D2C7: 13 14             BEQ     L_Control_Add_Prog_CALC
    18 00:D2C9: 11 09             BCS     L_Control_Add_Prog_BUF1_LEFT
    19                        L_Control_Add_Prog_BUF2_LEFT:
    20 00:D2CB: 5E 44         	LDX		#(BUF2-RAM)
    21 00:D2CD: 15 8B CF      	JSR		L_Move_Left_One_DIG_Prog
    22 00:D2D0: 78 CC         	INC		BUF2+FD
    23 00:D2D2: 17 E7         	BRA		L_Control_Add_Prog_Loop
    24                        L_Control_Add_Prog_BUF1_LEFT:
    25 00:D2D4: 5E 3B         	LDX		#(BUF1-RAM)
    26 00:D2D6: 15 8B CF      	JSR		L_Move_Left_One_DIG_Prog
    27 00:D2D9: 78 C3         	INC		BUF1+FD
    28 00:D2DB: 17 DE         	BRA		L_Control_Add_Prog_Loop
    29                        L_Control_Add_Prog_CALC:
    30 00:D2DD: 73 C3         	LDA		BUF1+FD
    31 00:D2DF: 72 CC         	EOR		BUF2+FD
    32 00:D2E1: 51 80         	AND		#080H
    33 00:D2E3: 13 2B         	BEQ		L_Control_Add_Prog_CALC_Add
    34                        L_Control_Add_Prog_CALC_SUB:
    35 00:D2E5: 02            	SED
    36 00:D2E6: 5E 44         	LDX		#(BUF2-RAM)			;2->5
    37 00:D2E8: 15 07 D2      	JSR		L_Copy_To_BUF5
    38 00:D2EB: 5E 3B         	LDX		#(BUF1-RAM)			;1-5?
    39 00:D2ED: 15 8B D0      	JSR		L_BUFX_SUB_BUF5_Prog
    40 00:D2F0: 11 0D         	BCS		L_Control_Add_Prog_CALC_SUB_1
    41 00:D2F2: 02            	SED
    42 00:D2F3: 5E 3B         	LDX		#(BUF1-RAM)			;1->5
    43 00:D2F5: 15 07 D2      	JSR		L_Copy_To_BUF5
    44 00:D2F8: 5E 44         	LDX		#(BUF2-RAM)			;2=2-5
    45 00:D2FA: 15 DF D0      	JSR		L_BUFX_SUB_BUF5_TO_BUFX_Prog
    46 00:D2FD: 17 17         	BRA		L_Control_Add_Prog_CALC_END
    47                        L_Control_Add_Prog_CALC_SUB_1:
    48 00:D2FF: 02            	SED
    49 00:D300: 5E 3B         	LDX		#(BUF1-RAM)			;1->2
    50 00:D302: 15 8C D1      	JSR		L_Copy_To_BUF2
    51 00:D305: 5E 44         	LDX		#(BUF2-RAM)			;2=2-5
    52 00:D307: 15 DF D0      	JSR		L_BUFX_SUB_BUF5_TO_BUFX_Prog
    53 00:D30A: 73 C3         	LDA		BUF1+FD
    54 00:D30C: 7F CC         	STA		BUF2+FD
    55 00:D30E: 17 06         	BRA		L_Control_Add_Prog_CALC_END
    56                        L_Control_Add_Prog_CALC_Add:
    57 00:D310: 02            	SED
    58 00:D311: 5E 3B         	LDX		#(BUF1-RAM)
    59 00:D313: 15 17 D0      	JSR		L_BUFX_Add_BUF2_TO_BUF2_Prog
    60                        L_Control_Add_Prog_CALC_END:
    61 00:D316: 16 54 D4      	JMP		L_Control_BUF2_Adjust_Result
    62                        
    63                        ;========================================================
    64                        L_Control_SUB_Prog:
    65 00:D319: 73 C3         	LDA		BUF1+FD
    66 00:D31B: 52 80         	EOR		#080H
    67 00:D31D: 7F C3         	STA		BUF1+FD
    68 00:D31F: 16 B1 D2      	JMP		L_Control_Add_Prog
    69                        
    70                        
    71                        
    72                        
    73                        ;========================================================
    74                        ;乘法
    75                        ;========================================================
    76                        L_Mul_Prog:
    77 00:D322: 06                CLD
    78 00:D323: 5E 4D             LDX     #(BUF3-RAM)
    79 00:D325: 15 FC CF          JSR     L_Clear_BUF_Prog
    80 00:D328: 53 21             LDA     #(MAX_DIG*4+1)
    81 00:D32A: 7F E5             STA     BUF6
    82                        L_Mul_Prog_Loop:
    83 00:D32C: 79 E5             DEC     BUF6
    84 00:D32E: 13 13             BEQ     L_Mul_Prog_RTS
    85 00:D330: 5E 3B             LDX     #(BUF1-RAM)
    86 00:D332: 15 D5 CF          JSR     L_Move_Right_One_Bit_Prog
    87 00:D335: 10 05             BCC     L_Mul_Prog_Loop_1
    88 00:D337: 5E 44             LDX     #(BUF2-RAM)
    89 00:D339: 15 51 D0          JSR     L_BUFX_Add_BUF3_TO_BUF3_Prog
    90                        L_Mul_Prog_Loop_1:
    91 00:D33C: 5E 44             LDX     #(BUF2-RAM)
    92 00:D33E: 15 71 CF          JSR     L_Move_Left_One_Bit_Prog
    93 00:D341: 17 E9             BRA     L_Mul_Prog_Loop
    94                        
    95                        L_Mul_Prog_RTS:
    96 00:D343: 09                RTS
    97                        
    98                        L_Control_Mul_Prog:;
    99 00:D344: 5E 44             LDX     #(BUF2-RAM)
   100 00:D346: 15 07 D2          JSR     L_Copy_To_BUF5
   101 00:D349: 15 5B D2          JSR     L_Dec_To_Hex_Prog;这个函数将BUF1中的10进制数，转换为BUF2中的2进制数
   102                        
   103 00:D34C: 5E 5D             LDX     #(BUF5-RAM)
   104 00:D34E: 15 63 D1          JSR     L_Copy_To_BUF1
   105                        
   106 00:D351: 5E 44             LDX     #(BUF2-RAM)
   107 00:D353: 15 07 D2          JSR     L_Copy_To_BUF5
   108 00:D356: 15 5B D2          JSR     L_Dec_To_Hex_Prog
   109                        
   110 00:D359: 5E 5D             LDX     #(BUF5-RAM)
   111 00:D35B: 15 63 D1          JSR     L_Copy_To_BUF1;以上函数将十进制的两个输入数，转换为16进制的两个输入数，但小数点的值不变
   112                        
   113 00:D35E: 15 22 D3          JSR     L_Mul_Prog
   114                        
   115 00:D361: 5E 4D             LDX     #(BUF3-RAM)
   116 00:D363: 15 63 D1          JSR     L_Copy_To_BUF1
   117 00:D366: 15 30 D2          JSR     L_Hex_To_Dec_Prog
   118                        
   119 00:D369: 5E 43             LDX     #(BUF1+FD-RAM)
   120 00:D36B: 15 4D CF          JSR     L_Adjust_FD_DEC_Prog
   121                        
   122 00:D36E: 5E 4C             LDX     #(BUF2+FD-RAM)
   123 00:D370: 15 4D CF          JSR     L_Adjust_FD_DEC_Prog
   124                        
   125 00:D373: 06                CLD
   126 00:D374: 04                CLC
   127 00:D375: 73 C3             LDA     BUF1+FD
   128 00:D377: 74 CC             ADC     BUF2+FD
   129 00:D379: 7F CC             STA     BUF2+FD
   130 00:D37B: 78 CC             INC     BUF2+FD
   131 00:D37D: 16 54 D4          JMP     L_Control_BUF2_Adjust_Result
   132                        
   133                        ;========================================================
   134                        ;除法
   135                        ;========================================================
   136                        L_DIV_Prog:;此时BUF2储存着十六进制的被除数，BUF5储存着十六进制的除数
   137 00:D380: 06                CLD
   138 00:D381: 5E 3B             LDX     #(BUF1-RAM)
   139 00:D383: 15 FC CF          JSR     L_Clear_BUF_Prog
   140 00:D386: 53 00             LDA     #0
   141 00:D388: 7F E6             STA     BUF6+1
   142 00:D38A: 53 02             LDA     #2
   143 00:D38C: 7F E5             STA     BUF6
   144                        L_DIV_Prog_Loop:;调整除数到与被除数对齐
   145 00:D38E: 73 E4             LDA     BUF5+MAX_DIG-1
   146 00:D390: 51 80             AND     #080H
   147 00:D392: 12 09             BNE     L_DIV_Prog_LOOP_1
   148 00:D394: 78 E5             INC     BUF6
   149 00:D396: 5E 5D             LDX     #(BUF5-RAM)
   150 00:D398: 15 71 CF          JSR     L_Move_Left_One_Bit_Prog
   151 00:D39B: 17 F1             BRA     L_DIV_Prog_Loop
   152                        L_DIV_Prog_LOOP_1:
   153 00:D39D: 79 E5             DEC     BUF6
   154 00:D39F: 13 26             BEQ     L_DIV_Prog_RTS
   155 00:D3A1: 5E 3B             LDX     #(BUF1-RAM)
   156 00:D3A3: 15 71 CF          JSR     L_Move_Left_One_Bit_Prog
   157 00:D3A6: 5E 44             LDX     #(BUF2-RAM)
   158 00:D3A8: 15 8B D0          JSR     L_BUFX_SUB_BUF5_Prog
   159 00:D3AB: 73 E6             LDA     BUF6+1
   160 00:D3AD: 55 00             SBC     #0
   161 00:D3AF: 10 0D             BCC     L_DIV_Prog_LOOP_2
   162 00:D3B1: 5E 44             LDX     #(BUF2-RAM)
   163 00:D3B3: 15 DF D0          JSR     L_BUFX_SUB_BUF5_TO_BUFX_Prog
   164 00:D3B6: 73 E6             LDA     BUF6+1
   165 00:D3B8: 55 00             SBC     #0
   166 00:D3BA: 7F E6             STA     BUF6+1
   167 00:D3BC: 78 BB             INC     BUF1
   168                        L_DIV_Prog_LOOP_2:
   169 00:D3BE: 5E 44             LDX     #(BUF2-RAM)
   170 00:D3C0: 15 71 CF          JSR     L_Move_Left_One_Bit_Prog
   171 00:D3C3: 7A E6             ROL     BUF6+1
   172 00:D3C5: 17 D6             BRA     L_DIV_Prog_LOOP_1
   173                        L_DIV_Prog_RTS:
   174 00:D3C7: 09                RTS
   175                        
   176                        
   177                        ;=========================================================
   178                        L_Control_DIV_Prog:
   179 00:D3C8: 15 22 CF          JSR     L_Judge_BUF1_Prog
   180 00:D3CB: 13 07             BEQ     L_Control_DIV_Prog_ERR
   181 00:D3CD: 15 2B CF          JSR     L_Judge_BUF2_Prog
   182 00:D3D0: 13 07             BEQ     L_Control_DIV_Prog_0
   183 00:D3D2: 17 0F             BRA		L_Control_DIV_Prog_DIV_INIT
   184                        L_Control_DIV_Prog_ERR:
   185 00:D3D4: 53 01             LDA     #ERR_DIV0
   186 00:D3D6: 4F 90 18          STA     ERR
   187                        L_Control_DIV_Prog_0:
   188 00:D3D9: 5E 44             LDX     #(BUF2-RAM)
   189 00:D3DB: 15 FC CF          JSR     L_Clear_BUF_Prog
   190 00:D3DE: 53 00             LDA     #0
   191 00:D3E0: 7F CC             STA     BUF2+FD
   192 00:D3E2: 09                RTS
   193                        ;---------------------------------------------------------
   194                        L_Control_DIV_Prog_DIV_INIT:
   195 00:D3E3: 5E 43             LDX     #(BUF1+FD-RAM)
   196 00:D3E5: 15 5F CF          JSR     L_Adjust_FD_INC_Prog
   197 00:D3E8: 5E 4C             LDX     #(BUF2+FD-RAM)
   198 00:D3EA: 15 5F CF          JSR     L_Adjust_FD_INC_Prog
   199                        
   200                        L_Control_DIV_Prog_DIV_Loop:
   201 00:D3ED: 73 C7             LDA     BUF2+MAX_BYTE-1;(原先是BUF2+5)
   202 00:D3EF: 51 F0             AND     #0F0H
   203 00:D3F1: 12 09             BNE     L_Control_DIV_Prog_DIV;将
   204 00:D3F3: 5E 44             LDX     #(BUF2-RAM)
   205 00:D3F5: 15 8B CF          JSR     L_Move_Left_One_DIG_Prog
   206 00:D3F8: 78 CC             INC     BUF2+FD
   207 00:D3FA: 17 F1             BRA     L_Control_DIV_Prog_DIV_Loop
   208                        
   209                        L_Control_DIV_Prog_DIV:
   210 00:D3FC: 5E 44             LDX     #(BUF2-RAM)
   211 00:D3FE: 15 C8 CF          JSR     L_Move_Max_DIG_Prog;将前几位移动到后几位
   212                        
   213 00:D401: 5E 44             LDX     #(BUF2-RAM)
   214 00:D403: 15 07 D2          JSR     L_Copy_To_BUF5
   215 00:D406: 15 5B D2          JSR     L_Dec_To_Hex_Prog;储存BUF2
   216                        
   217 00:D409: 5E 5D             LDX     #(BUF5-RAM)
   218 00:D40B: 15 63 D1          JSR     L_Copy_To_BUF1
   219                        
   220 00:D40E: 5E 44             LDX     #(BUF2-RAM)
   221 00:D410: 15 07 D2          JSR     L_Copy_To_BUF5
   222 00:D413: 15 5B D2          JSR     L_Dec_To_Hex_Prog
   223                        
   224 00:D416: 15 80 D3          JSR     L_DIV_Prog
   225 00:D419: 15 30 D2          JSR     L_Hex_To_Dec_Prog
   226                        ;-------------------------------------------
   227 00:D41C: 73 CC             LDA     BUF2+FD
   228 00:D41E: 51 7F             AND     #07FH
   229 00:D420: 7F E5             STA     BUF6
   230 00:D422: 73 CC             LDA     BUF2+FD
   231 00:D424: 51 80             AND     #080H
   232 00:D426: 7F E6             STA     BUF6+1
   233 00:D428: 73 C3             LDA     BUF1+FD
   234 00:D42A: 51 7F             AND     #07FH
   235 00:D42C: 7F E7             STA     BUF6+2
   236 00:D42E: 73 C3             LDA     BUF1+FD
   237 00:D430: 51 80             AND     #080H
   238 00:D432: 7F E8             STA     BUF6+3
   239                        ;------------------------------------------
   240 00:D434: 06                CLD
   241 00:D435: 04                CLC
   242 00:D436: 53 09             LDA     #MAX_DIG+1
   243 00:D438: 74 E5             ADC     BUF6
   244 00:D43A: 00                SEC
   245 00:D43B: 75 E7             SBC     BUF6+2
   246 00:D43D: 7F CC             STA     BUF2+FD
   247 00:D43F: 73 E6             LDA		BUF6+1
   248 00:D441: 72 E8         	EOR		BUF6+3
   249 00:D443: 70 CC         	ORA		BUF2+FD
   250 00:D445: 7F CC         	STA		BUF2+FD
   251                        
   252 00:D447: 16 54 D4      	JMP		L_Control_BUF2_Adjust_Result
   253                        
   254                        
   255                        ;=========================================================
   256                        L_Control_BUF1_Adjust_Result:
   257 00:D44A: 53 43         	LDA		#(BUF1+FD-RAM)
   258 00:D44C: 7F E5         	STA		BUF6
   259 00:D44E: 53 3B         	LDA		#(BUF1-RAM)
   260 00:D450: 7F E6         	STA		BUF6+1
   261 00:D452: 17 08         	BRA		L_Adjust_Result_Prog
   262                        L_Control_BUF2_Adjust_Result:
   263 00:D454: 53 4C         	LDA		#(BUF2+FD-RAM)
   264 00:D456: 7F E5         	STA		BUF6
   265 00:D458: 53 44         	LDA		#(BUF2-RAM)
   266 00:D45A: 7F E6         	STA		BUF6+1
   267                        L_Adjust_Result_Prog:
   268 00:D45C: 7E E5         	LDX		BUF6
   269 00:D45E: 15 5F CF      	JSR		L_Adjust_FD_INC_Prog
   270                        
   271                        L_Adjust_Result_Prog_Loop:
   272 00:D461: 7E E5         	LDX		BUF6
   273 00:D463: 63 80 00      	LDA		RAM,X
   274 00:D466: 51 7F         	AND		#07FH
   275 00:D468: 06            	CLD
   276 00:D469: 00            	SEC
   277 00:D46A: 55 09         	SBC		#MAX_DIG+1
   278 00:D46C: 11 2B         	BCS		L_Adjust_Result_Move_Right_Prog
   279 00:D46E: 43 90 18      	LDA		ERR
   280 00:D471: 12 14         	BNE		L_Adjust_Result_Prog_Loop1
   281 00:D473: 7E E6             LDX		BUF6+1						;LDA BUF
   282 00:D475: 63 80 00      	LDA		RAM, X
   283 00:D478: 51 0F         	AND		#0FH
   284 00:D47A: 12 0B         	BNE		L_Adjust_Result_Prog_Loop1
   285 00:D47C: 7E E5         	LDX		BUF6
   286 00:D47E: 63 80 00      	LDA		RAM,X
   287 00:D481: 51 7F         	AND		#07FH
   288 00:D483: 56 01         	CMP		#1
   289 00:D485: 12 12         	BNE		L_Adjust_Result_Move_Right_Prog
   290                        L_Adjust_Result_Prog_Loop1:
   291 00:D487: 7E E6         	LDX		BUF6+1
   292 00:D489: 63 84 00      	LDA		RAM+4,X
   293 00:D48C: 60 85 00      	ORA		RAM+5,X
   294 00:D48F: 60 86 00      	ORA		RAM+6,X
   295 00:D492: 60 87 00      	ORA		RAM+7,X
   296 00:D495: 12 02         	BNE		L_Adjust_Result_Move_Right_Prog
   297 00:D497: 17 33         	BRA		L_Adjust_Result_Prog_Zero
   298                        
   299                        L_Adjust_Result_Move_Right_Prog:
   300 00:D499: 7E E6         	LDX		BUF6+1
   301 00:D49B: 15 EF CF      	JSR		L_Move_Right_One_DIG_Prog
   302 00:D49E: 7E E5         	LDX		BUF6
   303 00:D4A0: 63 80 00      	LDA		RAM,X
   304 00:D4A3: 51 7F         	AND		#07FH
   305 00:D4A5: 56 01         	CMP		#1
   306 00:D4A7: 13 10         	BEQ		L_Adjust_Result_Prog_Error
   307 00:D4A9: 7E E5         	LDX		BUF6
   308 00:D4AB: 63 80 00      	LDA		RAM,X
   309 00:D4AE: 7F E7         	STA		BUF6+2
   310 00:D4B0: 79 E7         	DEC		BUF6+2
   311 00:D4B2: 73 E7         	LDA		BUF6+2
   312 00:D4B4: 6F 80 00      	STA		RAM,X
   313 00:D4B7: 17 A8         	BRA		L_Adjust_Result_Prog_Loop
   314                        L_Adjust_Result_Prog_Error:
   315 00:D4B9: 7E E5         	LDX		BUF6
   316 00:D4BB: 63 80 00      	LDA		RAM,X
   317 00:D4BE: 51 80         	AND		#080H
   318 00:D4C0: 50 08         	ORA		#MAX_DIG
   319 00:D4C2: 6F 80 00      	STA		RAM,X
   320 00:D4C5: 53 02         	LDA		#Err_FUll
   321 00:D4C7: 4F 90 18      	STA		ERR
   322 00:D4CA: 17 95         	BRA		L_Adjust_Result_Prog_Loop
   323                        L_Adjust_Result_Prog_Zero:
   324 00:D4CC: 7E E6         	LDX		BUF6+1
   325 00:D4CE: 63 80 00      	LDA		RAM,X
   326 00:D4D1: 60 81 00      	ORA		RAM+1,X
   327 00:D4D4: 60 82 00      	ORA		RAM+2,X
   328 00:D4D7: 60 83 00      	ORA		RAM+3,X
   329 00:D4DA: 12 07         	BNE		L_Adjust_Result_Prog_Zero_RTS
   330 00:D4DC: 53 00         	LDA		#0
   331 00:D4DE: 7E E5         	LDX		BUF6
   332 00:D4E0: 6F 80 00      	STA		RAM,X
   333                        L_Adjust_Result_Prog_Zero_RTS:
   334 00:D4E3: 09            	RTS
   334                        
   181                        .Include	Calculator\Calculator_Display.asm
     1                        L_Display_Calculator_Prog:
     2 00:D4E4: 53 00             LDA     #0
     3 00:D4E6: 5E 31             LDX     #lcd_d8
     4 00:D4E8: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
     5 00:D4EB: 15 B6 CC      	JSR		L_Dis_lcd_T8_Prog
     6 00:D4EE: 09                RTS
     7                        ;=======================================================
     8                        
     9                        L_Clr_0_Prog:
    10 00:D4EF: 5E 03         	LDX		#3
    11 00:D4F1: 53 08         	LDA     #8
    12 00:D4F3: 7F F5             STA     DINX
    13                        DISP_GET_INX_LOOP:
    14 00:D4F5: 63 80 18      	LDA		DBUF, X
    15 00:D4F8: 51 F0         	AND		#0F0H
    16                        	LJNZ	RET;等于0继续，不等于退出
+   16 00:D4FA: 13 03          BEQ MACRO_SYMBOL_0000
+   16 00:D4FC: 16 AC DA       JMP RET
+   16                         MACRO_SYMBOL_0000:
    17 00:D4FF: 43 84 18      	LDA		DBUF+DFD
    18 00:D502: 51 7F         	AND		#07FH
    19 00:D504: 76 F5         	CMP		DINX;检查小数点位数是否大于最大值
    20                        	LJZ		RET;相等退出，不相等继续
+   20 00:D506: 12 03          BNE MACRO_SYMBOL_0001
+   20 00:D508: 16 AC DA       JMP RET
+   20                         MACRO_SYMBOL_0001:
    21 00:D50B: 63 80 18      	LDA		DBUF, X
    22 00:D50E: 51 0F         	AND		#00FH
    23 00:D510: 50 A0         	ORA		#0A0H;清除高四位，保留低四位
    24 00:D512: 6F 80 18      	STA		DBUF, X
    25 00:D515: 79 F5         	DEC		DINX
    26                        	LJE		DINX, 1, RET;比较Dinx的值和1，相等退出
+   26                         .if(())
+   26 00:D517: 73 F5          LDA DINX
+   26 00:D519: 56 01          CMP #$0001
+   26 00:D51B: 12 03          BNE MACRO_SYMBOL_0002
+   26 00:D51D: 16 AC DA       JMP RET
+   26                         .else LDA CMP BNE JMP .endif
+   26                         MACRO_SYMBOL_0002:
    27 00:D520: 63 80 18      	LDA		DBUF, X
    28 00:D523: 51 0F         	AND		#0FH
    29                        	LJNZ	RET;低四位不等于0退出
+   29 00:D525: 13 03          BEQ MACRO_SYMBOL_0003
+   29 00:D527: 16 AC DA       JMP RET
+   29                         MACRO_SYMBOL_0003:
    30 00:D52A: 43 84 18      	LDA		DBUF+DFD
    31 00:D52D: 51 7F         	AND		#07FH;检查小数点位数是否大于最大值
    32 00:D52F: 76 F5         	CMP		DINX
    33                        	LJZ		RET;相等退出，不相等继续
+   33 00:D531: 12 03          BNE MACRO_SYMBOL_0004
+   33 00:D533: 16 AC DA       JMP RET
+   33                         MACRO_SYMBOL_0004:
    34 00:D536: 63 80 18      	LDA		DBUF, X
    35 00:D539: 51 F0         	AND		#0F0H
    36 00:D53B: 50 0A         	ORA		#00AH
    37 00:D53D: 6F 80 18      	STA		DBUF, X
    38 00:D540: 79 F5         	DEC		DINX
    39 00:D542: 0F            	DEX
    40 00:D543: 17 B0         	BRA		DISP_GET_INX_LOOP
    41                        ;======================================================================
    42                        L_Display_FD_Prog:
    43 00:D545: 15 6C D5      	JSR		L_Clr_FD_Prog
    44 00:D548: 43 84 18          LDA     DBUF+DFD
    45 00:D54B: 51 7F             AND     #07FH
    46 00:D54D: 04                CLC
    47 00:D54E: 06                CLD
    48 00:D54F: 18                ROL
    49 00:D550: 1B                TAX
    50 00:D551: 63 5B D5          LDA     Table_FD+1,X
    51 00:D554: 0A                PHA
    52 00:D555: 63 5A D5          LDA     Table_FD,X
    53 00:D558: 0A                PHA
    54 00:D559: 09                RTS
    55                        Table_FD:
    56 00:D55A: B5 CC         	DW      L_Dis_lcd_T8_Prog-1
    57 00:D55C: B5 CC             DW      L_Dis_lcd_T8_Prog-1
    58 00:D55E: B1 CC             DW      L_Dis_lcd_T7_Prog-1
    59 00:D560: AD CC             DW      L_Dis_lcd_T6_Prog-1
    60 00:D562: A9 CC             DW      L_Dis_lcd_T5_Prog-1
    61 00:D564: A5 CC             DW      L_Dis_lcd_T4_Prog-1
    62 00:D566: A1 CC             DW      L_Dis_lcd_T3_Prog-1
    63 00:D568: 9D CC             DW      L_Dis_lcd_T2_Prog-1
    64 00:D56A: 99 CC             DW      L_Dis_lcd_T1_Prog-1
    65                        
    66                        L_Clr_FD_Prog:
    67 00:D56C: 15 D9 CC      	JSR		L_Clr_lcd_T1_Prog
    68 00:D56F: 15 DD CC      	JSR		L_Clr_lcd_T2_Prog
    69 00:D572: 15 E1 CC      	JSR		L_Clr_lcd_T3_Prog
    70 00:D575: 15 E5 CC      	JSR		L_Clr_lcd_T4_Prog
    71 00:D578: 15 E9 CC      	JSR		L_Clr_lcd_T5_Prog
    72 00:D57B: 15 ED CC      	JSR		L_Clr_lcd_T6_Prog
    73 00:D57E: 15 F1 CC      	JSR		L_Clr_lcd_T7_Prog
    74 00:D581: 15 F5 CC      	JSR		L_Clr_lcd_T8_Prog
    75 00:D584: 09            	RTS
    76                        ;======================================================================
    77                        L_Display_NEG_Prog:
    78 00:D585: 43 84 18      	LDA		DBUF+DFD
    79 00:D588: 51 80         	AND		#080H
    80                        	LJZ		L_Display_NEG_Prog_RTS
+   80 00:D58A: 12 03          BNE MACRO_SYMBOL_0005
+   80 00:D58C: 16 B3 D5       JMP L_Display_NEG_Prog_RTS
+   80                         MACRO_SYMBOL_0005:
    81                        	JE		DINX, 12, L_Display_NEG_Prog_RTS;相等跳转，不相等继续执行
+   81                         .if(())
+   81 00:D58F: 73 F5          LDA DINX
+   81 00:D591: 56 0C          CMP #$000C
+   81 00:D593: 13 1E          BEQ L_Display_NEG_Prog_RTS
+   81                         .else LDA CMP BEQ .endif
    82 00:D595: 73 F5         	LDA		DINX
    83 00:D597: 04            	CLC
    84 00:D598: 19            	ROR
    85 00:D599: 1B            	TAX
    86                        	JNC		DISP_NEG_L;判断是低四位还是高四位，若为偶数处理低四位，否则处理高四位
+   86 00:D59A: 10 0D          BCC DISP_NEG_L
    87 00:D59C: 06            	CLD
    88 00:D59D: 04            	CLC
    89 00:D59E: 63 80 18      	LDA		DBUF,X
    90 00:D5A1: 51 0F         	AND		#00FH
    91 00:D5A3: 50 B0         	ORA		#0B0H
    92 00:D5A5: 6F 80 18      	STA		DBUF,X
    93 00:D5A8: 09            	RTS
    94                        DISP_NEG_L:
    95 00:D5A9: 63 80 18      	LDA		DBUF,X
    96 00:D5AC: 51 F0         	AND		#0F0H
    97 00:D5AE: 50 0B         	ORA		#00BH
    98 00:D5B0: 6F 80 18      	STA		DBUF,X
    99                        L_Display_NEG_Prog_RTS:
   100 00:D5B3: 09                RTS
   101                        ;==============================================================
   102                        ; L_Symbol_Prog:
   103                        ;     RTS
   104                        ; =====================================================================
   105                        L_Copy_DBUF_TO_D1BUF_FD_Prog:
   106 00:D5B4: 43 84 18      	LDA		DBUF+DFD
   107 00:D5B7: 4F 89 18      	STA		D1BUF+D1FD
   108 00:D5BA: 43 80 18      	LDA		DBUF
   109 00:D5BD: 4F 85 18      	STA		D1BUF
   110 00:D5C0: 43 81 18      	LDA		DBUF+1
   111 00:D5C3: 4F 86 18      	STA		D1BUF+1
   112 00:D5C6: 43 82 18      	LDA		DBUF+2
   113 00:D5C9: 4F 87 18      	STA		D1BUF+2
   114 00:D5CC: 43 83 18      	LDA		DBUF+3
   115 00:D5CF: 4F 88 18      	STA		D1BUF+3
   116 00:D5D2: 09            	RTS
   117                        	;-----------------------------------
   118                        L_Copy_D1BUF_TO_DBUF_FD_Prog:
   119 00:D5D3: 43 89 18      	LDA		D1BUF+D1FD
   120 00:D5D6: 7F ED         	STA		IBUF+IFD
   121 00:D5D8: 43 85 18      	LDA		D1BUF
   122 00:D5DB: 7F E9         	STA		IBUF
   123 00:D5DD: 43 86 18      	LDA		D1BUF+1
   124 00:D5E0: 7F EA         	STA		IBUF+1
   125 00:D5E2: 43 87 18      	LDA		D1BUF+2
   126 00:D5E5: 7F EB         	STA		IBUF+2
   127 00:D5E7: 43 88 18      	LDA		D1BUF+3
   128 00:D5EA: 7F EC         	STA		IBUF+3
   129 00:D5EC: 09            	RTS
   130                        ;=====================================================================
   131                        L_Display_Number_IBUF_Prog:
   132 00:D5ED: 15 FB D5      	JSR		L_Copy_IBUF_TO_DBUF_FD_Prog
   133 00:D5F0: 16 24 D6      	JMP		L_Display_Number_Prog
   134                        	;-----------------------------------
   135                        L_Display_Number_BUF1_Prog:
   136 00:D5F3: 5E 3B         	LDX		#(BUF1-RAM)
   137 00:D5F5: 15 02 D6      	JSR		L_Save_DBUF_Prog
   138 00:D5F8: 16 24 D6      	JMP		L_Display_Number_Prog
   139                        ;=====================================================================
   140                        L_Copy_IBUF_TO_DBUF_FD_Prog:
   141 00:D5FB: 5E 69         	LDX		#(IBUF-RAM)
   142 00:D5FD: 63 84 00      	LDA		RAM+IFD,X
   143 00:D600: 17 03         	BRA		L_Save_DBUF_Prog_X
   144                        L_Save_DBUF_Prog:
   145 00:D602: 63 88 00      	LDA		RAM+FD,X
   146                        L_Save_DBUF_Prog_X:
   147 00:D605: 4F 84 18      	STA		DBUF+DFD
   148 00:D608: 63 80 00      	LDA		RAM,X
   149 00:D60B: 4F 80 18      	STA		DBUF
   150 00:D60E: 63 81 00      	LDA		RAM+1,X
   151 00:D611: 4F 81 18      	STA		DBUF+1
   152 00:D614: 63 82 00      	LDA		RAM+2,X
   153 00:D617: 4F 82 18      	STA		DBUF+2
   154 00:D61A: 63 83 00      	LDA		RAM+3,X
   155 00:D61D: 4F 83 18      	STA		DBUF+3
   156 00:D620: 09            	RTS
   157                        L_Err_Prog_Display_TO:
   158 00:D621: 16 92 D6      	JMP		L_Err_Prog_Display
   159                        ;=====================================================================
   160                        L_Display_Number_Prog:
   161 00:D624: 15 B4 D5      	JSR		L_Copy_DBUF_TO_D1BUF_FD_Prog
   162                        	;----------------------------------
   163 00:D627: 15 EF D4          JSR     L_Clr_0_Prog
   164 00:D62A: 15 45 D5          JSR     L_Display_FD_Prog
   165 00:D62D: 15 85 D5          JSR     L_Display_NEG_Prog
   166 00:D630: 43 90 18      	LDA		ERR
   167 00:D633: 12 EC         	BNE		L_Err_Prog_Display_TO
   168                        	;----------------------------------
   169                        L_Display_Number_Prog_DBUF:;DBUF+3存储的是高位数字
   170 00:D635: 43 83 18      	LDA		DBUF+3
   171 00:D638: 51 F0         	AND     #F0H
   172 00:D63A: 15 3C C9      	JSR		L_ROR_4Bit_Prog
   173 00:D63D: 5E 00             LDX     #lcd_d1
   174 00:D63F: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   175 00:D642: 43 83 18          LDA		DBUF+3
   176 00:D645: 51 0F         	AND     #0FH
   177 00:D647: 5E 07             LDX     #lcd_d2
   178 00:D649: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   179                        
   180                        
   181 00:D64C: 43 82 18          LDA		DBUF+2
   182 00:D64F: 51 F0         	AND     #F0H
   183 00:D651: 15 3C C9      	JSR		L_ROR_4Bit_Prog
   184 00:D654: 5E 0E             LDX     #lcd_d3
   185 00:D656: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   186 00:D659: 43 82 18          LDA		DBUF+2
   187 00:D65C: 51 0F         	AND     #0FH
   188 00:D65E: 5E 15             LDX     #lcd_d4
   189 00:D660: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   190                        
   191                        
   192 00:D663: 43 81 18          LDA		DBUF+1
   193 00:D666: 51 F0         	AND     #F0H
   194 00:D668: 15 3C C9      	JSR		L_ROR_4Bit_Prog
   195 00:D66B: 5E 1C             LDX     #lcd_d5
   196 00:D66D: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   197 00:D670: 43 81 18          LDA		DBUF+1
   198 00:D673: 51 0F         	AND     #0FH
   199 00:D675: 5E 23             LDX     #lcd_d6
   200 00:D677: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   201                        
   202                        
   203 00:D67A: 43 80 18          LDA		DBUF
   204 00:D67D: 51 F0         	AND     #F0H
   205 00:D67F: 15 3C C9      	JSR		L_ROR_4Bit_Prog
   206 00:D682: 5E 2A             LDX     #lcd_d7
   207 00:D684: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   208 00:D687: 43 80 18          LDA		DBUF
   209 00:D68A: 51 0F         	AND     #0FH
   210 00:D68C: 5E 31             LDX     #lcd_d8
   211 00:D68E: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   212 00:D691: 09            	RTS
   213                        
   214                        
   215                        L_Err_Prog_Display:
   216 00:D692: 43 90 18      	LDA		ERR
   217 00:D695: 56 01         	CMP		#ERR_DIV0
   218 00:D697: 13 05         	BEQ		L_Err_Prog_Display_DIV0
   219 00:D699: 56 02         	CMP		#Err_FUll
   220 00:D69B: 13 1A         	BEQ		L_Err_Prog_Display_Full
   221 00:D69D: 09            	RTS
   222                        
   223                        
   224                        L_Err_Prog_Display_DIV0:
   225 00:D69E: 53 AA         	LDA		#AAH
   226 00:D6A0: 4F 81 18      	STA		DBUF+1
   227 00:D6A3: 4F 82 18      	STA		DBUF+2
   228 00:D6A6: 4F 83 18      	STA		DBUF+3
   229 00:D6A9: 4F 80 18      	STA		DBUF
   230 00:D6AC: 15 35 D6      	JSR		L_Display_Number_Prog_DBUF
   231 00:D6AF: 53 11         	LDA		#17
   232 00:D6B1: 5E 31         	LDX		#lcd_d8
   233 00:D6B3: 15 D9 C8      	JSR		L_Dis_8Bit_DigitDot_Prog
   234 00:D6B6: 09            	RTS
   235                        L_Err_Prog_Display_Full:
   236 00:D6B7: 43 8A 18      	LDA		BBUF
   237 00:D6BA: 51 F0         	AND		#F0H
   238 00:D6BC: 50 0A         	ORA		#0AH
   239 00:D6BE: 15 35 D6      	JSR		L_Display_Number_Prog_DBUF
   240 00:D6C1: 53 11         	LDA		#17
   241 00:D6C3: 5E 31         	LDX		#lcd_d8
   242 00:D6C5: 15 D9 C8      	JSR		L_Dis_8Bit_DigitDot_Prog
   243 00:D6C8: 09            	RTS
   244                        
   245                        L_Display_Number_Prog_DBUF3:;DBUF+3存储的是高位数字
   246 00:D6C9: 43 83 18      	LDA		DBUF+3
   247 00:D6CC: 51 F0         	AND     #F0H
   248 00:D6CE: 15 3C C9      	JSR		L_ROR_4Bit_Prog
   249 00:D6D1: 5E 00             LDX     #lcd_d1
   250 00:D6D3: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   251 00:D6D6: 43 83 18          LDA		DBUF+3
   252 00:D6D9: 51 0F         	AND     #0FH
   253 00:D6DB: 5E 07             LDX     #lcd_d2
   254 00:D6DD: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   255 00:D6E0: 09            	RTS
   256                        L_Display_Number_Prog_DBUF2:
   257 00:D6E1: 43 82 18          LDA		DBUF+2
   258 00:D6E4: 51 F0         	AND     #F0H
   259 00:D6E6: 15 3C C9      	JSR		L_ROR_4Bit_Prog
   260 00:D6E9: 5E 0E             LDX     #lcd_d3
   261 00:D6EB: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   262 00:D6EE: 43 82 18          LDA		DBUF+2
   263 00:D6F1: 51 0F         	AND     #0FH
   264 00:D6F3: 5E 15             LDX     #lcd_d4
   265 00:D6F5: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   266 00:D6F8: 09            	RTS
   267                        L_Display_Number_Prog_DBUF1:
   268 00:D6F9: 43 81 18          LDA		DBUF+1
   269 00:D6FC: 51 F0         	AND     #F0H
   270 00:D6FE: 15 3C C9      	JSR		L_ROR_4Bit_Prog
   271 00:D701: 5E 1C             LDX     #lcd_d5
   272 00:D703: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   273 00:D706: 43 81 18          LDA		DBUF+1
   274 00:D709: 51 0F         	AND     #0FH
   275 00:D70B: 5E 23             LDX     #lcd_d6
   276 00:D70D: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   277                        
   278                        L_Display_Number_Prog_DBUF0:
   279 00:D710: 43 80 18          LDA		DBUF
   280 00:D713: 51 F0         	AND     #F0H
   281 00:D715: 15 3C C9      	JSR		L_ROR_4Bit_Prog
   282 00:D718: 5E 2A             LDX     #lcd_d7
   283 00:D71A: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   284 00:D71D: 43 80 18          LDA		DBUF
   285 00:D720: 51 0F         	AND     #0FH
   286 00:D722: 5E 31             LDX     #lcd_d8
   287 00:D724: 15 D9 C8          JSR     L_Dis_8Bit_DigitDot_Prog
   288 00:D727: 09            	RTS
   289                        
   290                        
   291                        
   291                        
   182                        .Include	Calculator\Calculator_Scankey.asm
     1                        ;按键状态机，存在计算器流程图中
     2                        ;===========================================
     3                        L_Calculator_Frist_Press_Prog:
     4 00:D728: 15 FD DF          JSR     L_Beep_1s
     5 00:D72B: 15 32 D7          JSR     L_Calculator_Scankey_Prog
     6 00:D72E: 15 EA DA          JSR     L_Calculator_Calc_Prog_State_Mechine
     7 00:D731: 09                RTS
     8                        
     9                        L_Calculator_Scankey_Prog:
    10 00:D732: 43 98 18          LDA     Calculator_State
    11 00:D735: 04                CLC
    12 00:D736: 06                CLD
    13 00:D737: 18                ROL
    14 00:D738: 1B                TAX
    15 00:D739: 63 43 D7          LDA     Table_Calculator_State+1,X
    16 00:D73C: 0A                PHA
    17 00:D73D: 63 42 D7          LDA     Table_Calculator_State,X
    18 00:D740: 0A                PHA
    19 00:D741: 09                RTS
    20                        Table_Calculator_State:
    21 00:D742: 4F D7             DW      L_Calculator_Init_Prog-1
    22 00:D744: 6D D7             DW      L_Calculator_State_Symbol_First_Press_Prog-1
    23 00:D746: BF D7             DW      L_Calculator_State_Input_Prog-1
    24 00:D748: DE D7             DW      L_Calculator_State_Equal_Press_Prog-1
    25 00:D74A: 0D D8             DW      L_Calculator_State_Involution-1
    26 00:D74C: 45 D8             DW      L_Calculator_State_Involution_Number_Input_Prog-1
    27 00:D74E: 87 D8             DW      L_Calculator_State_Involution_Symbol-1;在乘方模式下输入符号键
    28                        ;======================================================================
    29                        L_Calculator_Init_Prog:
    30 00:D750: 15 93 D9          JSR     Calculator_Input
    31 00:D753: 73 A6             LDA     P_Scankey_value
    32 00:D755: 56 10             CMP     #MAX_Number_Input
    33 00:D757: 10 14             BCC     L_Calculator_Init_Prog_RTS
    34 00:D759: 56 14             CMP     #D_NUM_Equal_Press
    35 00:D75B: 13 10             BEQ     L_Calculator_Init_Prog_RTS          ;数字输入和等号输入退出
    36 00:D75D: 53 01             LDA     #Calculator_State_Symbol_First_Press;一旦符号键按下，将IBUF的内容传送到，BUF1中
    37 00:D75F: 4F 98 18          STA     Calculator_State                    ;并改变计算器当前状态
    38 00:D762: 53 01             LDA     #Calc_First_Output
    39 00:D764: 4F 9A 18          STA     Calculator_State_Mechine            ;输出状态机
    40 00:D767: 43 99 18          LDA     Calculator_Symbol_State
    41 00:D76A: 4F 9B 18          STA     OP
    42                        L_Calculator_Init_Prog_RTS:
    43 00:D76D: 09                RTS
    44                        ;====================================================================
    45                        L_Calculator_State_Symbol_First_Press_Prog:
    46 00:D76E: 43 90 18          LDA     ERR
    47 00:D771: 12 2C             BNE     Calculator_State_Involution_Judgement_RTS;存在错误退出
    48 00:D773: 73 A6             LDA     P_Scankey_value
    49 00:D775: 56 10             CMP     #MAX_Number_Input
    50 00:D777: 10 27             BCC     Calculator_State_Number_Input  ;小于16说明按下的是数字键
    51                        
    52 00:D779: 73 A6             LDA     P_Scankey_value
    53 00:D77B: 56 14             CMP     #D_NUM_Equal_Press
    54 00:D77D: 13 2D             BEQ     L_Calculator_State_Symbol_No_Number;按下等于号自己与自己乘法或除法
    55 00:D77F: 43 99 18          LDA     Calculator_Symbol_State
    56 00:D782: 7F F5             STA     P_Temp+6
    57 00:D784: 15 93 D9          JSR     Calculator_Input
    58                           ;判断是不是再次按下了乘法键如果是则判断为乘方模式
    59 00:D787: 43 99 18          LDA     Calculator_Symbol_State
    60 00:D78A: 4F 9B 18          STA     OP
    61 00:D78D: 76 F5             CMP     P_Temp+6
    62 00:D78F: 12 0E             BNE     Calculator_State_Involution_Judgement_RTS;判断是否再次按下乘号
    63                        
    64 00:D791: 15 22 CD          JSR     L_Display_lcd_Involution_Prog
    65 00:D794: 15 10 D9          JSR     L_Copy_BUF1_TO_BBUF_Prog
    66 00:D797: 53 04             LDA     #Calculator_State_Involution
    67 00:D799: 4F 9C 18          STA     R_Involution
    68 00:D79C: 4F 98 18          STA     Calculator_State
    69                        Calculator_State_Involution_Judgement_RTS:
    70 00:D79F: 09                RTS
    71                        ;----------------------------------------------------------------------
    72                        Calculator_State_Number_Input:;存在按键输入数字跳转计算器输入状态
    73 00:D7A0: 15 63 D9          JSR     L_Clear_IBUF_FD_Prog;清除IBUF的值
    74 00:D7A3: 15 93 D9          JSR     Calculator_Input
    75 00:D7A6: 53 02             LDA     #Calculator_State_Input;设置
    76 00:D7A8: 4F 98 18          STA     Calculator_State
    77 00:D7AB: 09                RTS
    78                        ;----------------------------------------------------------------------
    79                        L_Calculator_State_Symbol_No_Number:;当没有数字键按下并按下等号时，进行自加，
    80 00:D7AC: 53 02             LDA     #Calc_First_Output_
    81 00:D7AE: 4F 9A 18          STA     Calculator_State_Mechine
    82 00:D7B1: 53 03             LDA     #Calculator_State_Equal_Press;没有
    83 00:D7B3: 4F 98 18          STA     Calculator_State
    84 00:D7B6: 43 99 18          LDA     Calculator_Symbol_State
    85 00:D7B9: 4F 9B 18          STA     OP
    86 00:D7BC: 15 93 D9          JSR     Calculator_Input
    87 00:D7BF: 09                RTS
    88                        ;=====================================================================
    89                        L_Calculator_State_Input_Prog:
    90 00:D7C0: 15 93 D9          JSR     Calculator_Input
    91 00:D7C3: 73 A6             LDA     P_Scankey_value
    92 00:D7C5: 56 10             CMP     #MAX_Number_Input
    93 00:D7C7: 10 15             BCC     L_Calculator_State_Input_Prog_RTS;判断当前输入的是否为数字键，如果是退出，不是继续判断
    94 00:D7C9: 53 03             LDA     #Calc_First_Output_In
    95 00:D7CB: 4F 9A 18          STA     Calculator_State_Mechine;给输出状态机值
    96 00:D7CE: 53 03             LDA     #Calculator_State_Equal_Press
    97 00:D7D0: 4F 98 18          STA     Calculator_State
    98 00:D7D3: 73 A6             LDA     P_Scankey_value
    99 00:D7D5: 56 14             CMP     #D_NUM_Equal_Press
   100 00:D7D7: 13 05             BEQ     L_Calculator_State_Input_Prog_RTS;判断是否按下等于号键，如果是退出不是则
   101 00:D7D9: 53 01             LDA     #Calculator_State_Symbol_First_Press
   102 00:D7DB: 4F 98 18          STA     Calculator_State
   103                        L_Calculator_State_Input_Prog_RTS:
   104 00:D7DE: 09                RTS
   105                        ;==================================================
   106                        L_Calculator_State_Equal_Press_Prog:
   107 00:D7DF: 43 90 18          LDA     ERR
   108 00:D7E2: 12 23             BNE     L_Calculator_State_Equal_Press_Prog_RTS;判断是否存在错误，如果不存在错误的话继续
   109 00:D7E4: 73 A6             LDA     P_Scankey_value
   110 00:D7E6: 56 10             CMP     #MAX_Number_Input
   111 00:D7E8: 10 1E             BCC     L_Calculator_State_Equal_Press_Prog_Number_Press
   112 00:D7EA: 56 14             CMP     #D_NUM_Equal_Press
   113 00:D7EC: 13 19             BEQ     L_Calculator_State_Equal_Press_Prog_RTS;按下等号无意义
   114 00:D7EE: 53 00             LDA     #0
   115 00:D7F0: 4F 99 18          STA     Calculator_Symbol_State
   116 00:D7F3: 4F 9B 18          STA     OP
   117                        
   118 00:D7F6: 53 01             LDA     #Calculator_State_Symbol_First_Press
   119 00:D7F8: 4F 98 18          STA     Calculator_State
   120 00:D7FB: 15 44 D9          JSR     L_COPY_BUF1_TO_IBUF_FD_Prog
   121 00:D7FE: 15 93 D9          JSR     Calculator_Input
   122 00:D801: 43 99 18          LDA     Calculator_Symbol_State
   123 00:D804: 4F 9B 18          STA     OP
   124                        L_Calculator_State_Equal_Press_Prog_RTS:
   125 00:D807: 09                RTS
   126                        
   127                        L_Calculator_State_Equal_Press_Prog_Number_Press:;当按下等号在按下数字键时相当于一切清零
   128 00:D808: 15 C9 DA          JSR     L_Clear_Calculator_Prog
   129 00:D80B: 16 50 D7          JMP     L_Calculator_Init_Prog
   130                        ;=======================================================
   131                        L_Calculator_State_Involution:
   132 00:D80E: 43 90 18          LDA     ERR
   133 00:D811: 12 1D             BNE     L_Calculator_State_Involution_RTS;当出现错误时
   134                        
   135 00:D813: 73 A6             LDA     P_Scankey_value
   136 00:D815: 56 14             CMP     #D_NUM_Equal_Press
   137 00:D817: 13 18             BEQ     L_Calculator_State_Involution_Equal_Press;当按下等号后
   138 00:D819: 56 10             CMP     #MAX_Number_Input
   139 00:D81B: 10 1D             BCC     L_Calculator_State_Involution_Input_Number
   140 00:D81D: 53 06             LDA     #Calculator_State_Involution_Input_Symbol;此时按下加减乘除键
   141 00:D81F: 4F 98 18          STA     Calculator_State;此时BUF1,BUF2已将运算值存储
   142                            ; JSR     L_COPY_BUF1_TO_IBUF_FD_Prog
   143 00:D822: 15 FE D8          JSR     L_Clear_BBUF_Prog
   144                            ; JSR     L_Clear_BUF1_FD_Prog
   145 00:D825: 15 63 D9          JSR     L_Clear_IBUF_FD_Prog
   146 00:D828: 53 00             LDA     #0
   147 00:D82A: 4F 9C 18          STA     R_Involution
   148 00:D82D: 15 93 D9          JSR     Calculator_Input
   149                        L_Calculator_State_Involution_RTS:
   150 00:D830: 09                RTS
   151                        L_Calculator_State_Involution_Equal_Press:;无数字自乘
   152 00:D831: 53 04             LDA     #Calc_First_Output_Involution
   153 00:D833: 4F 9A 18          STA     Calculator_State_Mechine
   154 00:D836: 15 93 D9          JSR     Calculator_Input
   155 00:D839: 09                RTS
   156                        
   157                        L_Calculator_State_Involution_Input_Number:
   158 00:D83A: 15 63 D9          JSR     L_Clear_IBUF_FD_Prog
   159                        L_Calculator_State_Involution_Number_Input_Prog_Input_Number:
   160 00:D83D: 15 93 D9          JSR     Calculator_Input
   161 00:D840: 53 05             LDA     #Calculator_State_Involution_Input
   162 00:D842: 4F 98 18          STA     Calculator_State
   163 00:D845: 09                RTS
   164                        
   165                        ;===============================================
   166                        L_Calculator_State_Involution_Number_Input_Prog:
   167 00:D846: 43 90 18          LDA     ERR
   168 00:D849: 12 2C             BNE     L_Calculator_State_Involution_Number_Input_Prog_RTS
   169 00:D84B: 73 A6             LDA     P_Scankey_value
   170 00:D84D: 56 10             CMP     #MAX_Number_Input
   171 00:D84F: 10 EC             BCC     L_Calculator_State_Involution_Number_Input_Prog_Input_Number
   172 00:D851: 56 14             CMP     #D_NUM_Equal_Press
   173 00:D853: 13 23             BEQ     L_Calculator_State_Involution_Number_Input_Prog_Equal_Press
   174                        
   175 00:D855: 15 93 D9          JSR     Calculator_Input
   176 00:D858: 15 3F DB          JSR     L_Output_Prog_Involution_IN
   177 00:D85B: 53 01             LDA     #Calculator_State_Symbol_First_Press;此时按下加减乘除键
   178 00:D85D: 4F 98 18          STA     Calculator_State;此时BUF1,BUF2已将运算值存储
   179                        
   180 00:D860: 43 99 18          LDA     Calculator_Symbol_State
   181 00:D863: 4F 9B 18          STA     OP
   182 00:D866: 53 00             LDA     #0
   183 00:D868: 4F 9C 18          STA     R_Involution
   184 00:D86B: 15 93 D9          JSR     Calculator_Input
   185 00:D86E: 15 FE D8          JSR     L_Clear_BBUF_Prog
   186 00:D871: 15 88 D9          JSR     L_Clear_BUF2_FD_Prog
   187 00:D874: 15 63 D9          JSR     L_Clear_IBUF_FD_Prog
   188                        L_Calculator_State_Involution_Number_Input_Prog_RTS:
   189 00:D877: 09                RTS
   190                        L_Calculator_State_Involution_Number_Input_Prog_Equal_Press:
   191 00:D878: 53 04             LDA     #Calculator_State_Involution
   192 00:D87A: 4F 98 18          STA     Calculator_State
   193 00:D87D: 53 05             LDA     #Calc_First_Output_Involution_IN
   194 00:D87F: 4F 9A 18          STA     Calculator_State_Mechine
   195 00:D882: 53 06             LDA     #State_Equal
   196 00:D884: 4F 99 18          STA     Calculator_Symbol_State
   197 00:D887: 09                RTS
   198                        ;========================================
   199                        L_Calculator_State_Involution_Symbol:
   200 00:D888: 15 93 D9          JSR     Calculator_Input
   201 00:D88B: 73 A6             LDA     P_Scankey_value
   202 00:D88D: 56 14             CMP     #D_NUM_Equal_Press
   203 00:D88F: 13 10             BEQ     L_Calculator_State_Involution_Symbol_Equal
   204 00:D891: 56 10             CMP     #MAX_Number_Input
   205 00:D893: 10 1A             BCC     L_Calculator_State_Involution_Symbol_Number
   206 00:D895: 43 99 18          LDA     Calculator_Symbol_State
   207 00:D898: 4F 9B 18          STA     OP
   208                            ; JSR     L_COPY_BUF1_TO_BUF2_FD
   209 00:D89B: 53 01             LDA     #Calculator_State_Symbol_First_Press;一旦符号键按下，将IBUF的内容传送到，BUF1中
   210 00:D89D: 4F 98 18          STA     Calculator_State
   211 00:D8A0: 09                RTS
   212                        L_Calculator_State_Involution_Symbol_Equal:
   213 00:D8A1: 53 00             LDA     #0
   214 00:D8A3: 4F 9B 18          STA     OP
   215 00:D8A6: 53 03             LDA     #Calculator_State_Equal_Press
   216 00:D8A8: 4F 98 18          STA     Calculator_State
   217 00:D8AB: 15 40 CD          JSR     L_Clr_Calculator_Symbol_Prog
   218 00:D8AE: 09                RTS
   219                        L_Calculator_State_Involution_Symbol_Number:
   220 00:D8AF: 53 02             LDA     #Calculator_State_Input;设置
   221 00:D8B1: 4F 98 18          STA     Calculator_State
   222 00:D8B4: 43 99 18          LDA     Calculator_Symbol_State
   223 00:D8B7: 4F 9B 18          STA     OP
   224                            RTS
   224 00:D8BA: 09            
   183                        .Include	Calculator\Calculator_Base_1.asm
     1                        L_Judge_IBUF_Prog:
     2 00:D8BB: 73 E9         	LDA		IBUF
     3 00:D8BD: 70 EA         	ORA		IBUF+1
     4 00:D8BF: 70 EB         	ORA		IBUF+2
     5 00:D8C1: 70 EC         	ORA		IBUF+3
     6 00:D8C3: 09            	RTS
     7                        ;---------------------------------
     8                        L_Move_Left_One_Bit_Prog_IBUF:
     9 00:D8C4: 04            	CLC
    10 00:D8C5: 7A E9         	ROL		IBUF
    11 00:D8C7: 7A EA         	ROL		IBUF+1
    12 00:D8C9: 7A EB         	ROL		IBUF+2
    13 00:D8CB: 7A EC         	ROL		IBUF+3
    14 00:D8CD: 09            	RTS
    15                        ;---------------------------------
    16                        L_Move_Right_One_Bit_Prog_IBUF:
    17 00:D8CE: 04            	CLC
    18 00:D8CF: 7B EC         	ROR		IBUF+3
    19 00:D8D1: 7B EB         	ROR		IBUF+2
    20 00:D8D3: 7B EA         	ROR		IBUF+1
    21 00:D8D5: 7B E9         	ROR		IBUF
    22 00:D8D7: 09            	RTS
    23                        ;--------------------------------
    24                        L_COPY_IBUF_TO_BUF1_FD_Prog:
    25 00:D8D8: 5E 3B         	LDX		#(BUF1-RAM)
    26 00:D8DA: 73 E9         	LDA		IBUF
    27 00:D8DC: 6F 80 00      	STA		RAM, X
    28 00:D8DF: 73 EA         	LDA		IBUF+1
    29 00:D8E1: 6F 81 00      	STA		RAM+1, X
    30 00:D8E4: 73 EB         	LDA		IBUF+2
    31 00:D8E6: 6F 82 00      	STA		RAM+2, X
    32 00:D8E9: 73 EC         	LDA		IBUF+3
    33 00:D8EB: 6F 83 00      	STA		RAM+3, X
    34 00:D8EE: 73 ED         	LDA		IBUF+IFD
    35 00:D8F0: 6F 88 00      	STA		RAM+FD, X
    36 00:D8F3: 09            	RTS
    37                        ;----------------------------------
    38                        L_COPY_BUF1_TO_BUF2_FD:
    39 00:D8F4: 5E 3B         	LDX		#(BUF1-RAM)
    40 00:D8F6: 15 8C D1      	JSR		L_Copy_To_BUF2
    41 00:D8F9: 73 C3         	LDA		BUF1+FD
    42 00:D8FB: 7F CC         	STA		BUF2+FD
    43 00:D8FD: 09            	RTS
    44                        L_Clear_BBUF_Prog:
    45 00:D8FE: 53 00         	LDA		#0
    46 00:D900: 4F 8A 18      	STA		BBUF
    47 00:D903: 4F 8B 18      	STA		BBUF+1
    48 00:D906: 4F 8C 18      	STA		BBUF+2
    49 00:D909: 4F 8D 18      	STA		BBUF+3
    50 00:D90C: 4F 8E 18      	STA		BBUF+BFD
    51 00:D90F: 09            	RTS
    52                        L_Copy_BUF1_TO_BBUF_Prog:
    53 00:D910: 73 BB         	LDA		BUF1
    54 00:D912: 4F 8A 18      	STA		BBUF
    55 00:D915: 73 BC         	LDA		BUF1+1
    56 00:D917: 4F 8B 18      	STA		BBUF+1
    57 00:D91A: 73 BD         	LDA		BUF1+2
    58 00:D91C: 4F 8C 18      	STA		BBUF+2
    59 00:D91F: 73 BE         	LDA		BUF1+3
    60 00:D921: 4F 8D 18      	STA		BBUF+3
    61 00:D924: 73 C3         	LDA		BUF1+FD
    62 00:D926: 4F 8E 18      	STA		BBUF+BFD
    63 00:D929: 09            	RTS
    64                        
    65                        L_COPY_BBUF_TO_BUF1_Prog:
    66 00:D92A: 43 8A 18      	LDA		BBUF
    67 00:D92D: 7F BB         	STA		BUF1
    68 00:D92F: 43 8B 18      	LDA		BBUF+1
    69 00:D932: 7F BC         	STA		BUF1+1
    70 00:D934: 43 8C 18      	LDA		BBUF+2
    71 00:D937: 7F BD         	STA		BUF1+2
    72 00:D939: 43 8D 18      	LDA		BBUF+3
    73 00:D93C: 7F BE         	STA		BUF1+3
    74 00:D93E: 43 8E 18      	LDA		BBUF+BFD
    75 00:D941: 7F C3         	STA		BUF1+FD
    76 00:D943: 09            	RTS
    77                        L_COPY_BUF1_TO_IBUF_FD_Prog:
    78 00:D944: 73 BB         	LDA		BUF1
    79 00:D946: 7F E9         	STA		IBUF
    80 00:D948: 73 BC         	LDA		BUF1+1
    81 00:D94A: 7F EA         	STA		IBUF+1
    82 00:D94C: 73 BD         	LDA		BUF1+2
    83 00:D94E: 7F EB         	STA		IBUF+2
    84 00:D950: 73 BE         	LDA		BUF1+3
    85 00:D952: 7F EC         	STA		IBUF+3
    86 00:D954: 73 BF         	LDA		BUF1+IFD
    87 00:D956: 7F ED         	STA		IBUF+BFD
    88 00:D958: 09            	RTS
    89                        ;===========================================
    90                        L_COPY_BUF2_TO_BUF1_FD:
    91 00:D959: 5E 44         	LDX		#(BUF2-RAM)
    92 00:D95B: 15 63 D1      	JSR		L_Copy_To_BUF1
    93 00:D95E: 73 CC         	LDA		BUF2+FD
    94 00:D960: 7F C3         	STA		BUF1+FD
    95 00:D962: 09            	RTS
    96                        L_Clear_IBUF_FD_Prog:
    97 00:D963: 5E 69         	LDX		#(IBUF-RAM)
    98 00:D965: 15 FC CF      	JSR		L_Clear_BUF_Prog
    99 00:D968: 53 00         	LDA		#0
   100 00:D96A: 6F 84 00      	STA		RAM+IFD,X
   101 00:D96D: 09            	RTS
   102                        L_Clear_BUF_Prog_1:
   103 00:D96E: 53 00         	LDA		#0
   104 00:D970: 6F 80 00      	STA		RAM, X
   105 00:D973: 6F 81 00      	STA		RAM+1, X
   106 00:D976: 6F 82 00      	STA		RAM+2, X
   107 00:D979: 6F 83 00      	STA		RAM+3, X
   108 00:D97C: 09            	RTS
   109                        
   110                        L_Clear_BUF1_FD_Prog:
   111 00:D97D: 5E 3B         	LDX		#(BUF1-RAM)
   112 00:D97F: 15 FC CF      	JSR		L_Clear_BUF_Prog
   113 00:D982: 53 00         	LDA		#0
   114 00:D984: 6F 88 00      	STA		RAM+FD,X
   115 00:D987: 09            	RTS
   116                        L_Clear_BUF2_FD_Prog
   117 00:D988: 5E 44         	LDX		#(BUF2-RAM)
   118 00:D98A: 15 FC CF      	JSR		L_Clear_BUF_Prog
   119 00:D98D: 53 00         	LDA		#0
   120 00:D98F: 6F 88 00      	STA		RAM+FD,X
   121 00:D992: 09            	RTS
   122                        ;=====================================
   123                        Calculator_Input:
   124 00:D993: 73 A6             LDA     P_Scankey_value
   125 00:D995: 56 10             CMP     #MAX_Number_Input
   126 00:D997: 10 07             BCC     Calculator_Input_Number_Prog_TO
   127 00:D999: 56 14             CMP     #D_NUM_Equal_Press
   128 00:D99B: 10 06             BCC     Calculator_Input_Symbol_Prog_TO
   129 00:D99D: 13 04         	BEQ		Calculator_Input_Symbol_Prog_TO
   130 00:D99F: 09                RTS
   131                        
   132                        Calculator_Input_Number_Prog_TO:
   133 00:D9A0: 16 03 DA          JMP     Calculator_Input_Number_Prog
   134                        
   135                        Calculator_Input_Symbol_Prog_TO:
   136 00:D9A3: 16 66 DA          JMP     Calculator_Input_Symbol_Prog
   137                        
   138                        
   139                        
   140                        
   141                        
   142                        
   143                        
   144                        
   145                        ; ;============================================
   146                        L_Input_Full_Prog:
   147 00:D9A6: 73 EC             LDA     IBUF+MAX_BYTE-1
   148 00:D9A8: 51 F0             AND     #0F0H
   149                            LJNZ    L_Input_Full_Error
+  149 00:D9AA: 13 03          BEQ MACRO_SYMBOL_0006
+  149 00:D9AC: 16 BD D9       JMP L_Input_Full_Error
+  149                         MACRO_SYMBOL_0006:
   150 00:D9AF: 73 ED             LDA     IBUF+IFD
   151 00:D9B1: 51 7F             AND     #07FH
   152 00:D9B3: 56 08             CMP     #MAX_DIG
   153                            LJZ     RET1
+  153 00:D9B5: 12 03          BNE MACRO_SYMBOL_0007
+  153 00:D9B7: 16 A6 DA       JMP RET1
+  153                         MACRO_SYMBOL_0007:
   154 00:D9BA: 16 A9 DA          JMP     RET0
   155                        
   156                        ; ;=========================================
   157                        
   158                        L_Input_Full_Error:
   159                        	; LDA		IBUF+IFD;读取输入的小数位
   160                        	; LJNZ	RET1
   161                        	; LDA     #ERR_IN
   162                            ; STA     ERR
   163 00:D9BD: 16 A6 DA      	JMP		RET1
   164 00:D9C0: 09                RTS
   165                        
   166                        Input_FD_Inc:
   167 00:D9C1: 73 ED         	LDA		IBUF+IFD
   168 00:D9C3: 51 7F         	AND		#07FH
   169                        	LJZ		RET
+  169 00:D9C5: 12 03          BNE MACRO_SYMBOL_0008
+  169 00:D9C7: 16 AC DA       JMP RET
+  169                         MACRO_SYMBOL_0008:
   170 00:D9CA: 04                CLC
   171 00:D9CB: 73 ED         	LDA     IBUF+IFD
   172 00:D9CD: 54 01             ADC     #1
   173 00:D9CF: 7F ED             STA     IBUF+IFD
   174 00:D9D1: 09            	RTS
   175                        
   176                        Input_FD:
   177 00:D9D2: 73 ED         	LDA		IBUF+IFD
   178 00:D9D4: 51 7F         	AND		#07FH
   179                        	LJNZ	RET
+  179 00:D9D6: 13 03          BEQ MACRO_SYMBOL_0009
+  179 00:D9D8: 16 AC DA       JMP RET
+  179                         MACRO_SYMBOL_0009:
   180 00:D9DB: 04                CLC
   181 00:D9DC: 73 ED             LDA     IBUF+IFD
   182 00:D9DE: 54 01             ADC     #1
   183 00:D9E0: 7F ED             STA     IBUF+IFD
   184 00:D9E2: 09            	RTS
   185                        
   186                        
   187                        
   188                        
   189                        ; ;============================================
   190                        
   191                        Calculator_Input_Number:
   192 00:D9E3: 7F EF             STA     ACC
   193 00:D9E5: 15 A6 D9          JSR     L_Input_Full_Prog
   194                            LJNZ    RET
+  194 00:D9E8: 13 03          BEQ MACRO_SYMBOL_000A
+  194 00:D9EA: 16 AC DA       JMP RET
+  194                         MACRO_SYMBOL_000A:
   195 00:D9ED: 15 C1 D9          JSR     Input_FD_Inc
   196                        
   197 00:D9F0: 15 C4 D8          JSR     L_Move_Left_One_Bit_Prog_IBUF
   198 00:D9F3: 15 C4 D8          JSR     L_Move_Left_One_Bit_Prog_IBUF
   199 00:D9F6: 15 C4 D8          JSR     L_Move_Left_One_Bit_Prog_IBUF
   200 00:D9F9: 15 C4 D8          JSR     L_Move_Left_One_Bit_Prog_IBUF
   201 00:D9FC: 73 E9             LDA     IBUF
   202 00:D9FE: 70 EF             ORA     ACC
   203 00:DA00: 7F E9             STA     IBUF
   204 00:DA02: 09                RTS
   205                        ;============================================
   206                        
   207                        
   208                        Calculator_Input_Number_Prog:
   209 00:DA03: 73 A6             LDA     P_Scankey_value
   210 00:DA05: 56 0C             CMP     #D_NUM0_Press
   211 00:DA07: 13 29             BEQ     Calculator_Input_Number0
   212 00:DA09: 56 01             CMP     #D_NUM1_Press
   213 00:DA0B: 13 29             BEQ     Calculator_Input_Number1
   214 00:DA0D: 56 02             CMP     #D_NUM2_Press
   215 00:DA0F: 13 29             BEQ     Calculator_Input_Number2
   216 00:DA11: 56 03             CMP     #D_NUM3_Press
   217 00:DA13: 13 29             BEQ     Calculator_Input_Number3
   218 00:DA15: 56 04             CMP     #D_NUM4_Press
   219 00:DA17: 13 29             BEQ     Calculator_Input_Number4
   220 00:DA19: 56 05             CMP     #D_NUM5_Press
   221 00:DA1B: 13 29             BEQ     Calculator_Input_Number5
   222 00:DA1D: 56 08             CMP     #D_NUM6_Press
   223 00:DA1F: 13 29             BEQ     Calculator_Input_Number6
   224 00:DA21: 56 09             CMP     #D_NUM7_Press
   225 00:DA23: 13 29             BEQ     Calculator_Input_Number7
   226 00:DA25: 56 0A             CMP     #D_NUM8_Press
   227 00:DA27: 13 29             BEQ     Calculator_Input_Number8
   228 00:DA29: 56 0B             CMP     #D_NUM9_Press
   229 00:DA2B: 13 29             BEQ     Calculator_Input_Number9
   230 00:DA2D: 56 0F             CMP     #D_NUM_Point_Press
   231 00:DA2F: 13 2E             BEQ     Input_Dot
   232 00:DA31: 09                RTS
   233                        Calculator_Input_Number0:
   234 00:DA32: 53 00             LDA     #0
   235 00:DA34: 17 22             BRA     Calculator_Input_NumberX
   236                        Calculator_Input_Number1:
   237 00:DA36: 53 01             LDA     #1
   238 00:DA38: 17 1E             BRA     Calculator_Input_NumberX
   239                        Calculator_Input_Number2:
   240 00:DA3A: 53 02             LDA     #2
   241 00:DA3C: 17 1A             BRA     Calculator_Input_NumberX
   242                        Calculator_Input_Number3:
   243 00:DA3E: 53 03             LDA     #3
   244 00:DA40: 17 16             BRA     Calculator_Input_NumberX
   245                        Calculator_Input_Number4:
   246 00:DA42: 53 04             LDA     #4
   247 00:DA44: 17 12             BRA     Calculator_Input_NumberX
   248                        Calculator_Input_Number5:
   249 00:DA46: 53 05             LDA     #5
   250 00:DA48: 17 0E             BRA     Calculator_Input_NumberX
   251                        Calculator_Input_Number6:
   252 00:DA4A: 53 06             LDA     #6
   253 00:DA4C: 17 0A             BRA     Calculator_Input_NumberX
   254                        Calculator_Input_Number7:
   255 00:DA4E: 53 07             LDA     #7
   256 00:DA50: 17 06             BRA     Calculator_Input_NumberX
   257                        Calculator_Input_Number8:
   258 00:DA52: 53 08             LDA     #8
   259 00:DA54: 17 02             BRA     Calculator_Input_NumberX
   260                        Calculator_Input_Number9:
   261 00:DA56: 53 09             LDA     #9
   262                        Calculator_Input_NumberX
   263 00:DA58: 15 E3 D9          JSR		Calculator_Input_Number
   264 00:DA5B: 15 ED D5          JSR     L_Display_Number_IBUF_Prog
   265 00:DA5E: 09                RTS
   266                        
   267                        Input_Dot:
   268 00:DA5F: 15 D2 D9      	JSR		Input_FD
   269 00:DA62: 15 ED D5      	JSR     L_Display_Number_IBUF_Prog
   270 00:DA65: 09                RTS
   271                        
   272                        
   273                        Calculator_Input_Symbol_Prog:
   274 00:DA66: 73 A6             LDA     P_Scankey_value
   275 00:DA68: 56 14             CMP     #D_NUM_Equal_Press
   276 00:DA6A: 13 11             BEQ		Input_Equal
   277 00:DA6C: 56 10             CMP     #D_NUM_Add_Press
   278 00:DA6E: 13 16         	BEQ		Input_Add
   279 00:DA70: 56 11             CMP     #D_NUM_Minus_Press
   280 00:DA72: 13 19         	BEQ		Input_Sub_Prog
   281 00:DA74: 56 12             CMP     #D_NUM_Multiply_Press
   282 00:DA76: 13 1C         	BEQ		Input_Mul_Prog
   283 00:DA78: 56 13             CMP     #D_NUM_Divid_Press
   284 00:DA7A: 13 1F         	BEQ		Input_DIV
   285 00:DA7C: 09            	RTS
   286                        Input_Equal:
   287 00:DA7D: 53 06         	LDA		#State_Equal
   288 00:DA7F: 4F 99 18      	STA		Calculator_Symbol_State
   289 00:DA82: 15 7A CD      	JSR		L_Dis_Calculator_Symbol_Prog_Equal
   290 00:DA85: 09            	RTS
   291                        Input_Add:
   292 00:DA86: 53 01         	LDA		#State_Add
   293 00:DA88: 4F 99 18      	STA		Calculator_Symbol_State
   294 00:DA8B: 17 15         	BRA		Input_Symbol
   295                        Input_Sub_Prog:
   296 00:DA8D: 53 02         	LDA		#State_SUB
   297 00:DA8F: 4F 99 18      	STA		Calculator_Symbol_State
   298 00:DA92: 17 0E         	BRA		Input_Symbol
   299                        Input_Mul_Prog:
   300 00:DA94: 53 03         	LDA		#State_Mul
   301 00:DA96: 4F 99 18      	STA		Calculator_Symbol_State
   302 00:DA99: 17 07         	BRA		Input_Symbol
   303                        Input_DIV:
   304 00:DA9B: 53 04         	LDA		#State_DIV
   305 00:DA9D: 4F 99 18      	STA		Calculator_Symbol_State
   306 00:DAA0: 17 00         	BRA		Input_Symbol
   307                        Input_Symbol:
   308 00:DAA2: 15 5A CD      	JSR		L_Dis_Calculator_Symbol_Prog
   309 00:DAA5: 09            	RTS
   310                        ; Input_Symbol_Equal:
   311                        ; 	JSR		L_Dis_Calculator_Symbol_Prog_Equal
   312                        ; 	RTS
   313                        ;===================================
   314                        RET1:
   315 00:DAA6: 53 01             LDA     #1
   316 00:DAA8: 09                RTS
   317                        RET0:
   318 00:DAA9: 53 00             LDA     #0
   319 00:DAAB: 09                RTS
   320                        RET:
   321 00:DAAC: 09                RTS
   322                        
   323                        ;=====================================
   324                        L_Calculator_Calc_Prog:
   325 00:DAAD: 04            	CLC
   326 00:DAAE: 06            	CLD
   327 00:DAAF: 43 9B 18      	LDA		OP
   328 00:DAB2: 18            	ROL
   329 00:DAB3: 1B            	TAX
   330 00:DAB4: 63 BE DA      	LDA		Table_Calc+1,X
   331 00:DAB7: 0A            	PHA
   332 00:DAB8: 63 BD DA      	LDA		Table_Calc,X
   333 00:DABB: 0A            	PHA
   334 00:DABC: 09            	RTS
   335                        Table_Calc:
   336 00:DABD: AB DA         	DW		RET-1
   337 00:DABF: B0 D2         	DW		L_Control_Add_Prog-1
   338 00:DAC1: 18 D3         	DW		L_Control_SUB_Prog-1
   339 00:DAC3: 43 D3         	DW		L_Control_Mul_Prog-1
   340 00:DAC5: C7 D3         	DW		L_Control_DIV_Prog-1
   341                        	; DW		L_Control_Mul_Prog-1
   342                        
   343                        
   344                        
   345                        ;==========================================
   346                        L_OutPut_Result_IN_:;存在按键输入数字的函数
   347                        
   348 00:DAC7: 09            	RTS
   349                        L_OutPut_Result_:;不存在按键输入数字的函数
   350                        
   351 00:DAC8: 09            	RTS
   352                        
   353                        
   354                        
   355                        L_Clear_Calculator_Prog:
   356 00:DAC9: 15 7D D9      	JSR		L_Clear_BUF1_FD_Prog
   357                        L_Clear_Calculator_Prog_ERR:
   358 00:DACC: 15 19 CE      	JSR		L_Clr_All_8Bit_Prog
   359 00:DACF: 15 40 CD      	JSR		L_Clr_Calculator_Symbol_Prog
   360 00:DAD2: 53 00         	LDA		#0
   361 00:DAD4: 4F 98 18      	STA		Calculator_State
   362 00:DAD7: 4F 99 18      	STA		Calculator_Symbol_State
   363 00:DADA: 4F 9A 18      	STA		Calculator_State_Mechine
   364 00:DADD: 4F 9B 18      	STA		OP
   365 00:DAE0: 4F 9C 18      	STA		R_Involution
   366                        
   367 00:DAE3: 15 88 D9      	JSR		L_Clear_BUF2_FD_Prog
   368 00:DAE6: 15 63 D9      	JSR		L_Clear_IBUF_FD_Prog
   369                        	RTS
   369 00:DAE9: 09            
   184                        .Include	Calculator\Calculator_Mechine.asm
     1                        L_Calculator_Calc_Prog_State_Mechine:
     2 00:DAEA: 43 9A 18          LDA     Calculator_State_Mechine
     3 00:DAED: 04                CLC
     4 00:DAEE: 06                CLD
     5 00:DAEF: 18                ROL
     6 00:DAF0: 1B                TAX
     7 00:DAF1: 63 FB DA          LDA     Table_Calc_OutPut+1,X
     8 00:DAF4: 0A                PHA
     9 00:DAF5: 63 FA DA          LDA     Table_Calc_OutPut,X
    10 00:DAF8: 0A                PHA
    11 00:DAF9: 09                RTS
    12                        
    13                        Table_Calc_OutPut:
    14 00:DAFA: 05 DB             DW      L_OutPut_Prog_Init-1
    15 00:DAFC: 06 DB             DW      L_Output_Prog_First_Output-1
    16 00:DAFE: 12 DB             DW      L_Output_Prog_First_Output_-1
    17 00:DB00: 26 DB             DW      L_Output_Prog_First_Output_IN-1
    18 00:DB02: 32 DB             DW      L_Output_Prog_Involution_-1
    19 00:DB04: 3E DB             DW      L_Output_Prog_Involution_IN-1
    20                        L_OutPut_Prog_Init:
    21 00:DB06: 09                RTS
    22                        ;===============================================================
    23                        L_Output_Prog_First_Output:;按键第一次按下加减乘除符号键所造成的影响
    24 00:DB07: 15 D8 D8          JSR     L_COPY_IBUF_TO_BUF1_FD_Prog
    25 00:DB0A: 15 F4 D8          JSR     L_COPY_BUF1_TO_BUF2_FD
    26 00:DB0D: 53 00             LDA     #Calc_Init
    27 00:DB0F: 4F 9A 18          STA     Calculator_State_Mechine
    28 00:DB12: 09                RTS
    29                        ;===============================================================
    30                        L_Output_Prog_First_Output_:;没有数字按下时按下等号键
    31 00:DB13: 15 D8 D8          JSR     L_COPY_IBUF_TO_BUF1_FD_Prog
    32 00:DB16: 43 9B 18          LDA     OP
    33 00:DB19: 56 02             CMP     #State_SUB
    34 00:DB1B: 13 07             BEQ     L_Output_Prog_First_Output_1
    35 00:DB1D: 56 01             CMP     #State_Add
    36 00:DB1F: 13 03             BEQ     L_Output_Prog_First_Output_1
    37 00:DB21: 15 AD DA          JSR     L_Calculator_Calc_Prog
    38                        L_Output_Prog_First_Output_1:
    39 00:DB24: 16 4E DB          JMP     L_Display_Calculator_Output
    40                        ;===============================================================
    41                        L_Output_Prog_First_Output_IN:;有数字按下时的输出
    42 00:DB27: 15 F4 D8          JSR     L_COPY_BUF1_TO_BUF2_FD
    43 00:DB2A: 15 D8 D8          JSR     L_COPY_IBUF_TO_BUF1_FD_Prog
    44                        
    45 00:DB2D: 15 AD DA          JSR     L_Calculator_Calc_Prog
    46 00:DB30: 16 4E DB          JMP     L_Display_Calculator_Output
    47                        ;===============================================================
    48                        L_Output_Prog_Involution_:;当没有数字输入时，将BUF1送到BUF2，读取存储的BBUF,相乘
    49 00:DB33: 15 F4 D8          JSR     L_COPY_BUF1_TO_BUF2_FD
    50 00:DB36: 15 2A D9          JSR     L_COPY_BBUF_TO_BUF1_Prog
    51 00:DB39: 15 AD DA          JSR     L_Calculator_Calc_Prog
    52 00:DB3C: 16 4E DB          JMP     L_Display_Calculator_Output
    53                        ;===============================================================
    54                        L_Output_Prog_Involution_IN:
    55 00:DB3F: 15 D8 D8          JSR     L_COPY_IBUF_TO_BUF1_FD_Prog
    56 00:DB42: 15 F4 D8          JSR     L_COPY_BUF1_TO_BUF2_FD
    57 00:DB45: 15 2A D9          JSR     L_COPY_BBUF_TO_BUF1_Prog
    58 00:DB48: 15 AD DA          JSR     L_Calculator_Calc_Prog
    59 00:DB4B: 16 4E DB          JMP     L_Display_Calculator_Output
    60                        ;===============================================================
    61                        ;===============================================================
    62                        ;===============================================================
    63                        ;===============================================================
    64                        ;===============================================================
    65                        ;===============================================================
    66                        ;===============================================================
    67                        ;===============================================================
    68                        ;===============================================================
    69                        ;===============================================================
    70                        
    71                        L_Display_Calculator_Output:
    72 00:DB4E: 53 00             LDA     #Calc_Init
    73 00:DB50: 4F 9A 18          STA     Calculator_State_Mechine
    74 00:DB53: 15 59 D9          JSR     L_COPY_BUF2_TO_BUF1_FD
    75 00:DB56: 15 F3 D5          JSR     L_Display_Number_BUF1_Prog
    76 00:DB59: 43 9C 18          LDA     R_Involution
    77 00:DB5C: 12 1D             BNE     L_Display_Calculator_Involution_State
    78                        
    79                        
    80                        
    81                        
    82 00:DB5E: 43 99 18          LDA     Calculator_Symbol_State
    83 00:DB61: 56 06             CMP     #State_Equal
    84 00:DB63: 12 0C             BNE     L_Display_Calculator_Output_1
    85 00:DB65: 15 40 CD          JSR     L_Clr_Calculator_Symbol_Prog
    86 00:DB68: 53 00             LDA     #0
    87 00:DB6A: 4F 9B 18          STA     OP
    88 00:DB6D: 4F 99 18          STA     Calculator_Symbol_State
    89                        L_Display_Calculator_Output_RTS:
    90 00:DB70: 09                RTS
    91                        L_Display_Calculator_Output_1:
    92 00:DB71: 15 5A CD          JSR		L_Dis_Calculator_Symbol_Prog
    93 00:DB74: 43 99 18          LDA     Calculator_Symbol_State
    94 00:DB77: 4F 9B 18          STA     OP
    95 00:DB7A: 09                RTS
    96                        
    97                        
    98                        
    99                        L_Display_Calculator_Involution_State:
   100 00:DB7B: 73 06             LDA     State_Equal
   101 00:DB7D: 13 F1             BEQ     L_Display_Calculator_Output_RTS
   102                            RTS
   102 00:DB7F: 09            
   185                        
   186                        
   187                        
   188                        .INCLUDE	Half_s\Half.asm
     1                        L_Half_Second_Prog:
     2 00:DB80: 30 A0 0E      	BBR0 	Sys_Flag_B,L_END_Half_Second_Prog	;判断半秒标志
     3 00:DB83: 20 A0         	RMB0 	Sys_Flag_B							;清楚半秒标志
     4 00:DB85: 73 A3         	LDA		R_Reset_Time
     5 00:DB87: 12 1B         	BNE		L_Reset_2s_Prog
     6 00:DB89: 39 A0 06      	BBS1	Sys_Flag_B,L_1Second_Prog			;判断一秒标志
     7 00:DB8C: 29 A0         	SMB1	Sys_Flag_B							;设置1秒标志
     8 00:DB8E: 15 CD DE      	JSR		L_SysFlash_Prog						;闪烁程序
     9                        L_END_Half_Second_Prog:
    10 00:DB91: 09                RTS
    11                        ;=================================================================
    12                        L_1Second_Prog:
    13 00:DB92: 21 A0             RMB1    Sys_Flag_B;清除1秒标志
    14                        
    15 00:DB94: 15 D6 DF      	JSR		L_Control_Beep_prog_Auto_Exit
    16 00:DB97: 15 B8 DB      	JSR     L_Update_Time_Prog
    17 00:DB9A: 15 3A DC      	JSR		L_Update_Another_Time_Prog
    18 00:DB9D: 15 95 DD      	JSR		L_Alarm_Prog
    19                            ; JSR		L_Control_Positive_Timer_Prog
    20 00:DBA0: 15 20 CA      	JSR		L_Display_Normal_Prog
    21 00:DBA3: 09            	RTS
    22                        ;==============================================================
    23                        L_Reset_2s_Prog:;全显
    24 00:DBA4: 79 A3         	DEC		R_Reset_Time
    25 00:DBA6: 73 A3         	LDA		R_Reset_Time
    26 00:DBA8: 12 0D         	BNE		L_End_Reset_2s_Prog
    27 00:DBAA: 15 F5 C0      	JSR		L_Clr_All_DisRam_Prog
    28 00:DBAD: 15 BD CA      	JSR		L_Display_Prog
    29 00:DBB0: 15 00 E0      	JSR		L_Beep_1s_Usually
    30 00:DBB3: 15 8C C8      	JSR		L_Positive_Timer_First_ST_SP_Press_Prog
    31 00:DBB6: 09            	RTS
    32                        L_End_Reset_2s_Prog:
    33 00:DBB7: 09            	RTS
    33                        
   189                        .INCLUDE	Half_s\Clock.asm
     1                        ;=========================
     2                        L_Update_Time_Prog:
     3                        	; JSR		L_Update_Time_Ms_Prog
     4 00:DBB8: 15 BE C1      	JSR		L_Control_Beep_Test_Prog
     5 00:DBBB: 15 0F DC      	JSR		L_Update_Time_Sec_Prog
     6                        
     7                        
     8 00:DBBE: 10 23         	BCC		L_End_Update_Time_Prog
     9                        
    10 00:DBC0: 15 8F DE      	JSR		L_Auto_To_Clock_Mode_Prog
    11                        
    12 00:DBC3: 15 EF DB      	JSR		L_Control_Snz_Prog
    13 00:DBC6: 15 14 DC      	JSR		L_Update_Time_Min_Prog
    14                        
    15                        
    16 00:DBC9: 10 18         	BCC		L_End_Update_Time_Prog
    17                        
    18                        
    19 00:DBCB: 15 E4 DB      	JSR		L_Control_Beep_Time_On_Alarm_Prog
    20 00:DBCE: 15 19 DC      	JSR		L_Update_Time_Hr_Prog
    21                        
    22                        
    23 00:DBD1: 10 10         	BCC		L_End_Update_Time_Prog
    24                        
    25 00:DBD3: 15 20 DC      	JSR		L_Update_Time_Day_Prog
    26                        
    27                        
    28 00:DBD6: 10 08         	BCC		L_End_Update_Date_Prog
    29                        
    30 00:DBD8: 15 28 DC      	JSR		L_Update_Time_Month_Prog
    31                        
    32                        
    33 00:DBDB: 10 03         	BCC		L_End_Update_Date_Prog
    34                        
    35 00:DBDD: 15 2F DC      	JSR		L_Update_Time_Year_Prog
    36                        
    37                        
    38                        L_End_Update_Date_Prog:
    39 00:DBE0: 15 F2 DC      	JSR		L_Auto_Counter_Week
    40                        L_End_Update_Time_Prog:
    41 00:DBE3: 09            	RTS
    42                        ;================================================
    43                        L_Control_Beep_Time_On_Alarm_Prog:;控制整点报时
    44 00:DBE4: 31 A1 FC      	BBR1	Sys_Flag_C,L_End_Update_Time_Prog;判断整点报时是否开启
    45 00:DBE7: 53 02         	LDA		#2
    46 00:DBE9: 4F 95 18      	STA		R_Voice_Unit
    47                        	EN_LCD_IRQ
+   47 00:DBEC: 2E 0E          SMB6 IER
    48 00:DBEE: 09            	RTS
    49                        ;==================================================
    50                        ;控制贪睡闹钟
    51                        L_Control_Snz_Prog:
    52 00:DBEF: 37 A1 F1      	BBR7	Sys_Flag_C,L_End_Update_Time_Prog
    53 00:DBF2: 00            	SEC
    54 00:DBF3: 43 96 18      	LDA		R_Snz_Time
    55 00:DBF6: 55 01         	SBC		#1
    56 00:DBF8: 4F 96 18      	STA		R_Snz_Time
    57 00:DBFB: 12 E6         	BNE		L_End_Update_Time_Prog
    58 00:DBFD: 53 05         	LDA		#D_Snz_Time
    59 00:DBFF: 4F 96 18      	STA		R_Snz_Time
    60 00:DC02: 15 BE DD      	JSR		L_Alarm_Control_Prog_2
    61 00:DC05: 43 97 18      	LDA		R_Snz_Frequency
    62 00:DC08: 00            	SEC
    63 00:DC09: 55 01         	SBC		#1
    64 00:DC0B: 4F 97 18      	STA		R_Snz_Frequency
    65 00:DC0E: 09            	RTS
    66                        ;===================================
    67                        ;-----时间的增加---------------------
    68                        ;===================================
    69                        ;----------------------------------
    70                        L_Update_Time_Sec_Prog:
    71 00:DC0F: 5E 00         	LDX 	#(R_Time_Sec-Time_Str_Addr)
    72 00:DC11: 16 53 DC      	JMP		L_Inc_To_60_Prog
    73                        L_Update_Time_Min_Prog:;时间分钟更新加
    74 00:DC14: 5E 01         	LDX		#(R_Time_Min-Time_Str_Addr)
    75 00:DC16: 16 53 DC      	JMP		L_Inc_To_60_Prog
    76                        ;---------------------------
    77                        L_Update_Time_Hr_Prog:;时间小时更新加
    78 00:DC19: 5E 02         	LDX		#(R_Time_Hr-Time_Str_Addr)
    79 00:DC1B: 53 17         	LDA		#23
    80 00:DC1D: 16 55 DC      	JMP		L_Inc_To_Any_Count_Prog
    81                        ;----------------------------------
    82                        L_Update_Time_Day_Prog:;时间天数更新加
    83 00:DC20: 15 AD DC      	JSR		L_Check_MaxDay_Prog
    84 00:DC23: 5E 03         	LDX		#(R_Time_Day-Time_Str_Addr)
    85 00:DC25: 16 6F DC      	JMP		L_Inc_To_Any_Count_Prog_To_1
    86                        ;-------------------------------------
    87                        L_Update_Time_Month_Prog:;时间月更新加
    88 00:DC28: 5E 04         	LDX		#(R_Time_Month-Time_Str_Addr)
    89 00:DC2A: 53 0C         	LDA		#12
    90 00:DC2C: 16 6F DC      	JMP		L_Inc_To_Any_Count_Prog_To_1
    91                        
    92                        ;----------------------------------
    93                        L_Update_Time_Year_Prog:;时间年更新加
    94 00:DC2F: 5E 05         	LDX		#(R_Time_Year-Time_Str_Addr)
    95 00:DC31: 53 63         	LDA		#99
    96 00:DC33: 15 55 DC      	JSR		L_Inc_To_Any_Count_Prog
    97 00:DC36: 15 BC DC      	JSR		L_Judge_MaxDay_Prog
    98 00:DC39: 09            	RTS
    99                        ;======================================
   100                        ;---------第二时间更新------------------
   101                        ;======================================
   102                        L_Update_Another_Time_Prog:
   103 00:DC3A: 73 A8         	LDA		R_Time_Sec
   104 00:DC3C: 12 08         	BNE		L_Update_Another_Time_Prog_OUT
   105 00:DC3E: 15 47 DC      	JSR		L_Update_Another_Time_Min_Prog
   106 00:DC41: 10 03         	BCC		L_Update_Another_Time_Prog_OUT
   107 00:DC43: 15 4C DC      	JSR		L_Update_Another_Time_Hr_Prog
   108                        L_Update_Another_Time_Prog_OUT:
   109 00:DC46: 09            	RTS
   110                        
   111                        L_Update_Another_Time_Min_Prog:;时间分钟更新加
   112 00:DC47: 5E 07         	LDX		#(R_Time_Min_Another-Time_Str_Addr)
   113 00:DC49: 16 53 DC      	JMP		L_Inc_To_60_Prog
   114                        ;---------------------------
   115                        L_Update_Another_Time_Hr_Prog:;时间小时更新加
   116 00:DC4C: 5E 08         	LDX		#(R_Time_Hr_Another-Time_Str_Addr)
   117 00:DC4E: 53 17         	LDA		#23
   118 00:DC50: 16 55 DC      	JMP		L_Inc_To_Any_Count_Prog
   119                        
   120                        
   121                        ;================================
   122                        L_Inc_To_60_Prog:;将数从0加到59
   123 00:DC53: 53 3B         	LDA		#59
   124                        L_Inc_To_Any_Count_Prog:
   125 00:DC55: 00            	SEC
   126 00:DC56: 65 28 18      	SBC		Time_Addr,X
   127 00:DC59: 13 0D         	BEQ		L_Inc_Over_Prog
   128 00:DC5B: 10 0B         	BCC		L_Inc_Over_Prog
   129 00:DC5D: 04            	CLC
   130 00:DC5E: 63 28 18      	LDA		Time_Addr,X
   131 00:DC61: 54 01         	ADC		#1
   132 00:DC63: 6F 28 18      	STA		Time_Addr,X
   133 00:DC66: 04            	CLC
   134 00:DC67: 09            	RTS
   135                        L_Inc_Over_Prog:
   136 00:DC68: 53 00         	LDA		#0
   137 00:DC6A: 6F 28 18      	STA		Time_Addr,X
   138 00:DC6D: 00            	SEC
   139                        L_End_Inc_To_60_Prog:
   140 00:DC6E: 09            	RTS
   141                        
   142                        L_Inc_To_Any_Count_Prog_To_1:;将数从1加到59
   143 00:DC6F: 00            	SEC
   144 00:DC70: 65 28 18      	SBC		Time_Addr,X
   145 00:DC73: 13 0C         	BEQ		L_Inc_Over_Prog_To_1
   146 00:DC75: 10 0A         	BCC		L_Inc_Over_Prog_To_1
   147 00:DC77: 04            	CLC
   148 00:DC78: 63 28 18      	LDA		Time_Addr,X
   149 00:DC7B: 54 01         	ADC		#1
   150 00:DC7D: 6F 28 18      	STA		Time_Addr,X
   151 00:DC80: 09            	RTS
   152                        L_Inc_Over_Prog_To_1:
   153 00:DC81: 53 01         	LDA		#1
   154 00:DC83: 6F 28 18      	STA		Time_Addr,X
   155 00:DC86: 09            	RTS
   156                        ;=======================================================
   157                        L_Dec_To_60_Prog:
   158 00:DC87: 53 3B         	LDA		#59
   159                        L_Dec_To_0_Prog:
   160 00:DC89: 7F EF         	STA		P_Temp
   161 00:DC8B: 53 00         	LDA		#0
   162                        L_Dec_To_Anycount_Prog:
   163 00:DC8D: 00            	SEC
   164 00:DC8E: 65 28 18          SBC     Time_Addr,X
   165 00:DC91: 13 0D         	BEQ		L_Dec_Over_Prog
   166 00:DC93: 11 0B         	BCS		L_Dec_Over_Prog
   167                        
   168 00:DC95: 00            	SEC
   169 00:DC96: 63 28 18      	LDA		Time_Addr,X
   170 00:DC99: 55 01         	SBC		#1
   171 00:DC9B: 6F 28 18      	STA		Time_Addr,X
   172 00:DC9E: 00            	SEC
   173 00:DC9F: 09            	RTS
   174                        L_Dec_Over_Prog:
   175 00:DCA0: 73 EF         	LDA		P_Temp
   176 00:DCA2: 6F 28 18      	STA		Time_Addr,X
   177 00:DCA5: 04            	CLC
   178 00:DCA6: 09            	RTS
   179                        L_Dec_To_1_Prog:
   180 00:DCA7: 7F EF             STA     P_Temp
   181 00:DCA9: 53 01             LDA     #1
   182 00:DCAB: 17 E0             BRA     L_Dec_To_Anycount_Prog
   183                        ;===============================================
   184                        ;=====================================
   185                        ;-------------------------------------
   186                        ;=====================================
   187                        L_Check_MaxDay_Prog:;检查每月的最大天数
   188 00:DCAD: 73 AC         	LDA		R_Time_Month
   189 00:DCAF: 07            	DEC
   190 00:DCB0: 1B            	TAX
   191                        L_Check_MaxDay_Prog_Alarm_clock_Prog:
   192 00:DCB1: 3B A0 04      	BBS3	Sys_Flag_B,L_Check_LeapYear_MaxDay_Prog
   193 00:DCB4: 63 4A DD      	LDA		T_NoLeapYear_Month,X
   194 00:DCB7: 09            	RTS
   195                        L_Check_LeapYear_MaxDay_Prog:
   196 00:DCB8: 63 3E DD      	LDA		T_LeapYear_Month,X
   197 00:DCBB: 09            	RTS
   198                        ;==============================
   199                        ;------------------------------
   200                        ;==============================
   201                        L_Judge_MaxDay_Prog:;如果最大天数最大超界限，则给予月份的最大天数
   202 00:DCBC: 15 AD DC      	JSR		L_Check_MaxDay_Prog
   203 00:DCBF: 7F F4         	STA		P_Temp+5
   204 00:DCC1: 76 AB         	CMP		R_Time_Day
   205 00:DCC3: 11 04         	BCS		L_Judge_MaxDay_Prog_RTS
   206 00:DCC5: 73 F4         	LDA		P_Temp+5
   207 00:DCC7: 7F AB         	STA		R_Time_Day
   208                        L_Judge_MaxDay_Prog_RTS:
   209 00:DCC9: 09            	RTS
   210                        ;==================================
   211                        L_Check_LeapYear_Prog:;检查是否是闰年
   212 00:DCCA: 73 AD         	LDA		R_Time_Year
   213 00:DCCC: 7F EF         	STA		P_Temp
   214 00:DCCE: 04            	CLC
   215 00:DCCF: 7B EF         	ROR		P_Temp
   216 00:DCD1: 7E EF         	LDX		P_Temp
   217 00:DCD3: 63 56 DD      	LDA		T_LeapYear_Week,X
   218 00:DCD6: 7F EF         	STA		P_Temp
   219 00:DCD8: 30 AD 0C      	BBR0	R_Time_Year,L_Counter_LeapYear;建表从2000年开始处于低四位，高四位，需要右移四位
   220 00:DCDB: 04            	CLC
   221 00:DCDC: 7B EF         	ROR		P_Temp
   222 00:DCDE: 04            	CLC
   223 00:DCDF: 7B EF         	ROR		P_Temp
   224 00:DCE1: 04            	CLC
   225 00:DCE2: 7B EF         	ROR		P_Temp
   226 00:DCE4: 04            	CLC
   227 00:DCE5: 7B EF         	ROR		P_Temp
   228                        L_Counter_LeapYear:
   229 00:DCE7: 23 A0         	RMB3	Sys_Flag_B
   230 00:DCE9: 53 08         	LDA		#08H
   231 00:DCEB: 71 EF         	AND		P_Temp
   232 00:DCED: 70 A0         	ORA		Sys_Flag_B
   233 00:DCEF: 7F A0         	STA		Sys_Flag_B;第四位为1则为闰年，否则·为平年
   234 00:DCF1: 09            	RTS
   235                        ;===========================================
   236                        ;P_Temp,0-3bit存储对应年分的1月1日星期几，4bit存储平闰年
   237                        ;P_Temp+1存储前几个月的天数除以7的余数
   238                        L_Auto_Counter_Week:
   239 00:DCF2: 15 CA DC      	JSR		L_Check_LeapYear_Prog
   240 00:DCF5: 15 BC DC      	JSR		L_Judge_MaxDay_Prog
   241 00:DCF8: 73 AC         	LDA		R_Time_Month
   242 00:DCFA: 1B            	TAX
   243 00:DCFB: 63 88 DD      	LDA		T_Month_Week,X
   244 00:DCFE: 7F F0         	STA		P_Temp+1
   245 00:DD00: 33 A0 0C      	BBR3	Sys_Flag_B,L_Counter_Week_2;非闰年跳转，非闰年需要将右移四位
   246 00:DD03: 04            	CLC
   247 00:DD04: 7B F0         	ROR		P_Temp+1
   248 00:DD06: 04            	CLC
   249 00:DD07: 7B F0         	ROR		P_Temp+1
   250 00:DD09: 04            	CLC
   251 00:DD0A: 7B F0         	ROR		P_Temp+1
   252 00:DD0C: 04            	CLC
   253 00:DD0D: 7B F0         	ROR		P_Temp+1
   254                        L_Counter_Week_2:;十六进制运算
   255 00:DD0F: 53 0F         	LDA		#$0F
   256 00:DD11: 71 F0         	AND		P_Temp+1;保留低四位多余的天数
   257 00:DD13: 7F F0         	STA		P_Temp+1
   258 00:DD15: 53 07         	LDA		#7
   259 00:DD17: 71 EF         	AND		P_Temp;保留低三位位每年一月一号星期几
   260 00:DD19: 04            	CLC
   261 00:DD1A: 74 F0         	ADC		P_Temp+1;每年一月一日星期几加上日期再加上多余的天数
   262 00:DD1C: 74 AB         	ADC		R_Time_Day
   263 00:DD1E: 7F EF         	STA		P_Temp
   264                        L_Loop_WeekSub_7:
   265 00:DD20: 00            	SEC
   266 00:DD21: 73 EF         	LDA		P_Temp
   267 00:DD23: 55 07         	SBC		#7
   268 00:DD25: 10 05         	BCC		L_End_Counter_Week
   269 00:DD27: 7F EF         	STA		P_Temp
   270 00:DD29: 16 20 DD      	JMP		L_Loop_WeekSub_7
   271                        L_End_Counter_Week:
   272 00:DD2C: 73 EF         	LDA		P_Temp
   273 00:DD2E: 13 05         	BEQ		L_SetWeek_Sat
   274 00:DD30: 79 EF         	DEC		P_Temp
   275 00:DD32: 16 39 DD      	JMP		L_Exit_Counter_Week
   276                        L_SetWeek_Sat:
   277 00:DD35: 53 06         	LDA		#6
   278 00:DD37: 7F EF         	STA		P_Temp
   279                        L_Exit_Counter_Week:
   280 00:DD39: 73 EF         	LDA		P_Temp
   281 00:DD3B: 7F AE         	STA		R_Time_Week
   282 00:DD3D: 09            	RTS
   283                        ;===============================================
   284                        ;-------------------------------------------
   285                        T_LeapYear_Month:
   286 00:DD3E: 1F            	DB		31
   287 00:DD3F: 1D            	DB		29
   288 00:DD40: 1F            	DB		31
   289 00:DD41: 1E            	DB		30
   290 00:DD42: 1F            	DB		31
   291 00:DD43: 1E            	DB		30
   292 00:DD44: 1F            	DB		31
   293 00:DD45: 1F            	DB		31
   294 00:DD46: 1E            	DB		30
   295 00:DD47: 1F            	DB		31
   296 00:DD48: 1E            	DB		30
   297 00:DD49: 1F            	DB		31
   298                        T_NoLeapYear_Month:
   299 00:DD4A: 1F            	DB		31
   300 00:DD4B: 1C            	DB		28
   301 00:DD4C: 1F            	DB		31
   302 00:DD4D: 1E            	DB		30
   303 00:DD4E: 1F            	DB		31
   304 00:DD4F: 1E            	DB		30
   305 00:DD50: 1F            	DB		31
   306 00:DD51: 1F            	DB		31
   307 00:DD52: 1E            	DB		30
   308 00:DD53: 1F            	DB		31
   309 00:DD54: 1E            	DB		30
   310 00:DD55: 1F            	DB		31
   311                        T_LeapYear_Week:
   312 00:DD56: 1E            	DB		1EH   ;2001,2000 ;E="1110"代表2000年1月1日是星期六(110),是闰年(1),
   313 00:DD57: 32            	DB		32H   ;2003,2002	;000星期天
   314 00:DD58: 6C            	DB		6CH   ;2005,2004	;001星期一
   315 00:DD59: 10            	DB		10H   ;2007,2006	;010星期二
   316 00:DD5A: 4A            	DB		4AH   ;2009,2008	;011星期三
   317 00:DD5B: 65            	DB		65H   ;2011,2010	;100星期四
   318 00:DD5C: 28            	DB		28H   ;2013,2012	;101星期五
   319 00:DD5D: 43            	DB		43H   ;2015,2014	;110星期六
   320 00:DD5E: 0D            	DB		0DH   ;2017,2016
   321 00:DD5F: 21            	DB		21H   ;2019,2018
   322 00:DD60: 5B            	DB		5BH   ;2021,2020
   323 00:DD61: 06            	DB		06H   ;2023,2022
   324 00:DD62: 39            	DB		39H   ;2025,2024
   325 00:DD63: 54            	DB		54H   ;2027,2026
   326 00:DD64: 1E            	DB		1EH   ;2029,2028
   327 00:DD65: 32            	DB		32H   ;2031,2030
   328 00:DD66: 6C            	DB		6CH   ;2033,2032
   329 00:DD67: 10            	DB		10H   ;2035,2034
   330 00:DD68: 4A            	DB		4AH   ;2037,2036
   331 00:DD69: 65            	DB		65H   ;2039,2038
   332 00:DD6A: 28            	DB		28H   ;2041,2040
   333 00:DD6B: 43            	DB		43H   ;2043,2042
   334 00:DD6C: 0D            	DB		0DH   ;2045,2044
   335 00:DD6D: 21            	DB		21H   ;2047,2046
   336 00:DD6E: 5B            	DB		5BH   ;2049,2048
   337 00:DD6F: 06            	DB		06H   ;2051,2050
   338 00:DD70: 39            	DB		39H   ;2053,2052
   339 00:DD71: 54            	DB		54H   ;2055,2054
   340 00:DD72: 1E            	DB		1EH   ;2057,2056
   341 00:DD73: 32            	DB		32H   ;2059,2058
   342 00:DD74: 6C            	DB		6CH   ;2061,2060
   343 00:DD75: 10            	DB		10H   ;2063,2062
   344 00:DD76: 4A            	DB		4AH   ;2065,2064
   345 00:DD77: 65            	DB		65H   ;2067,2066
   346 00:DD78: 28            	DB		28H   ;2069,2068
   347 00:DD79: 43            	DB		43H   ;2071,2070
   348 00:DD7A: 0D            	DB		0DH   ;2073,2072
   349 00:DD7B: 21            	DB		21H   ;2075,2074
   350 00:DD7C: 5B            	DB		5BH   ;2077,2076
   351 00:DD7D: 06            	DB		06H   ;2079,2078
   352 00:DD7E: 39            	DB		39H   ;2081,2080
   353 00:DD7F: 54            	DB		54H   ;2083,2082
   354 00:DD80: 1E            	DB		1EH   ;2085,2084
   355 00:DD81: 32            	DB		32H   ;2087,2086
   356 00:DD82: 6C            	DB		6CH   ;2089,2088
   357 00:DD83: 10            	DB		10H   ;2091,2090
   358 00:DD84: 4A            	DB		4AH   ;2093,2092
   359 00:DD85: 65            	DB		65H   ;2095,2094
   360 00:DD86: 28            	DB		28H   ;2097,2096
   361 00:DD87: 43            	DB		43H   ;2099,2098
   362                        ;--------------------------------
   363                        T_Month_Week:
   364 00:DD88: 00            	DB		00H
   365 00:DD89: 00            	DB		00H   ;JANUARY		从1月1日开始，所以1月为0
   366 00:DD8A: 33            	DB		33H   ;FABRUARY 	低4Bit为非闰年，高4Bit为闰年,
   367 00:DD8B: 43            	DB		43H   ;MARCH		每4bit数字是前几个月全部的天数减去7的倍数的剩余天数
   368 00:DD8C: 76            	DB		76H   ;APRIL
   369 00:DD8D: 21            	DB		21H   ;MAY
   370 00:DD8E: 54            	DB		54H   ;JUNE
   371 00:DD8F: 76            	DB		76H   ;JULY
   372 00:DD90: 32            	DB		32H   ;AUGUST
   373 00:DD91: 65            	DB		65H   ;SEPTEMBER
   374 00:DD92: 10            	DB		10H   ;OCTOBER
   375 00:DD93: 43            	DB		43H   ;NOVEMBER
   376 00:DD94: 65            	DB		65H   ;DECEMBER
   376                        
   190                        .INCLUDE	Half_s\Alarm_Clock.asm
     1                        L_Alarm_Prog:;闹钟判断的时间是贪睡闹钟时间，而正常闹钟时间作为显示闹钟时间
     2 00:DD95: 73 B9         	LDA		R_Alarm_Mode
     3 00:DD97: 13 2F         	BEQ		L_Alarm_Prog_OUT
     4 00:DD99: 3C A1 2C      	BBS4	Sys_Flag_C,L_Alarm_Prog_OUT
     5                        
     6 00:DD9C: 73 A8         	LDA		R_Time_Sec
     7 00:DD9E: 12 28         	BNE		L_Alarm_Prog_OUT
     8 00:DDA0: 73 AA         	LDA		R_Time_Hr
     9 00:DDA2: 76 B8         	CMP		R_Alarm_Clock_Hr
    10 00:DDA4: 12 22         	BNE		L_Alarm_Prog_OUT
    11 00:DDA6: 73 A9         	LDA		R_Time_Min
    12 00:DDA8: 76 B7         	CMP		R_Alarm_Clock_Min
    13 00:DDAA: 12 1C         	BNE		L_Alarm_Prog_OUT
    14                        
    15                        L_Alarm_Control_Prog:
    16 00:DDAC: 73 B9         	LDA		R_Alarm_Mode
    17 00:DDAE: 56 02         	CMP		#2
    18 00:DDB0: 12 0C         	BNE		L_Alarm_Control_Prog_2;判断是否为贪睡
    19 00:DDB2: 2F A1         	SMB7	Sys_Flag_C
    20 00:DDB4: 53 06         	LDA		#D_Snz_Frequency
    21 00:DDB6: 4F 97 18      	STA		R_Snz_Frequency
    22 00:DDB9: 53 05         	LDA		#D_Snz_Time
    23 00:DDBB: 4F 96 18      	STA		R_Snz_Time
    24                        L_Alarm_Control_Prog_2:
    25                        
    26                        
    27                        
    28                        L_Alarm_Prog_1:
    29 00:DDBE: 2C A1         	SMB4	Sys_Flag_C
    30 00:DDC0: 53 15         	LDA		#D_Beep_Open_Last_Time_Alarm
    31 00:DDC2: 4F 94 18      	STA		R_Close_Beep_Time
    32 00:DDC5: 15 D6 DF      	JSR		L_Control_Beep_prog_Auto_Exit
    33                        L_Alarm_Prog_OUT:
    34 00:DDC8: 09            	RTS
    35                        
    36                        
    37                        
    38                        
    39                        
    40                        
    41                        
    42                        
    42                        
   191                        .INCLUDE	Half_s\Timer.asm
     1                        ; L_Timer_Prog:
     2                            ; BBS4    Sys_Flag_D,L_Timer_Prog_OUT
     3                            ; BBR2    Sys_Flag_D,L_Timer_Prog_OUT;是否开始计时,根据标志位判断定时器是否开启
     4                            ; BBR0	Sys_Flag_D,L_Positive_Timer		;判断正计时,根据标志位判断正计时还是倒计时
     5                        	; BRA     L_Desitive_Timer		;判断倒计时
     6                        L_Update_Timer_Sec_Prog:
     7 00:DDC9: 5E 0A             LDX     #(R_Timer_Sec-Time_Str_Addr)
     8 00:DDCB: 16 53 DC          JMP     L_Inc_To_60_Prog
     9                        ;----------------------------------------------------
    10                        L_Update_Timer_Min_Prog:
    11 00:DDCE: 5E 0B             LDX     #(R_Timer_Min-Time_Str_Addr)
    12 00:DDD0: 16 53 DC          JMP     L_Inc_To_60_Prog
    13                        ; ;----------------------------------------------------
    14                        L_Update_Timer_Hr_Prog:
    15 00:DDD3: 5E 0C             LDX     #(R_Timer_Hr-Time_Str_Addr)
    16 00:DDD5: 53 17             LDA     #23
    17 00:DDD7: 16 55 DC          JMP     L_Inc_To_Any_Count_Prog
    18                        ;----------------------------------------------------
    19                        
    20                        L_Positive_Timer:
    21 00:DDDA: 15 C9 DD          JSR     L_Update_Timer_Sec_Prog
    22 00:DDDD: 10 19             BCC     L_Timer_Prog_OUT
    23                        
    24 00:DDDF: 15 5D DE          JSR     L_Control_Timer_Beep_Prog
    25 00:DDE2: 15 CE DD          JSR     L_Update_Timer_Min_Prog
    26 00:DDE5: 10 11             BCC     L_Timer_Prog_OUT
    27 00:DDE7: 15 D3 DD          JSR     L_Update_Timer_Hr_Prog
    28 00:DDEA: 10 0C             BCC     L_Timer_Prog_OUT
    29 00:DDEC: 53 00             LDA     #0
    30 00:DDEE: 7F B4             STA     R_Timer_Hr
    31 00:DDF0: 7F B3             STA     R_Timer_Min
    32 00:DDF2: 7F B2             STA     R_Timer_Sec;记满重启计时
    33 00:DDF4: 7F B1             STA     R_Timer_Ms
    34 00:DDF6: 7F B5             STA     R_Timer_X
    35                        L_Timer_Prog_OUT:
    36 00:DDF8: 09                RTS
    37                        
    38                        
    39                        
    40                        L_Update_Timer_Ms_Prog_Countine_Prog:
    41 00:DDF9: 1B                TAX
    42 00:DDFA: 63 6C DE          LDA     Table_Timer_Ms,X
    43 00:DDFD: 7F B1             STA     R_Timer_Ms
    44 00:DDFF: 43 91 18          LDA     R_Mode
    45 00:DE02: 56 04             CMP     #4
    46 00:DE04: 12 F2             BNE     L_Timer_Prog_OUT
    47 00:DE06: 15 77 CA          JSR     L_Display_Postive_Timer_Normal_Prog
    48 00:DE09: 09                RTS
    49                        
    50                        L_Update_Timer_Ms_Prog:
    51 00:DE0A: 30 A2 EB          BBR0    Sys_Flag_D,L_Timer_Prog_OUT
    52 00:DE0D: 78 B5             INC     R_Timer_X
    53 00:DE0F: 73 B5             LDA     R_Timer_X
    54 00:DE11: 56 22             CMP     #34
    55 00:DE13: 10 E4             BCC     L_Update_Timer_Ms_Prog_Countine_Prog
    56 00:DE15: 43 91 18          LDA     R_Mode
    57 00:DE18: 56 04             CMP     #4
    58 00:DE1A: 12 DC             BNE     L_Timer_Prog_OUT
    59 00:DE1C: 53 00             LDA     #0
    60 00:DE1E: 7F B5             STA     R_Timer_X
    61 00:DE20: 7F B1             STA     R_Timer_Ms
    62 00:DE22: 15 77 CA          JSR     L_Display_Postive_Timer_Normal_Prog
    63 00:DE25: 15 DA DD          JSR     L_Positive_Timer
    64                        
    65 00:DE28: 15 77 CA          JSR     L_Display_Postive_Timer_Normal_Prog
    66 00:DE2B: 09                RTS
    67                        L_Control_Positive_Timer_Prog:
    68 00:DE2C: 30 A2 C9      	BBR0	Sys_Flag_D,L_Timer_Prog_OUT;正计时未开始
    69 00:DE2F: 3E A2 0A      	BBS6	Sys_Flag_D,L_Control_Positive_Timer_Prog_RTS
    70 00:DE32: 2E A2         	SMB6	Sys_Flag_D
    71 00:DE34: 73 B5         	LDA		R_Timer_X
    72 00:DE36: 7F B6         	STA		R_Timer_X_1
    73 00:DE38: 15 77 CA      	JSR		L_Display_Postive_Timer_Normal_Prog
    74 00:DE3B: 09            	RTS
    75                        L_Control_Positive_Timer_Prog_RTS:
    76 00:DE3C: 73 B6         	LDA		R_Timer_X_1
    77 00:DE3E: 76 B5             CMP     R_Timer_X
    78 00:DE40: 11 0C             BCS     L_Control_Positive_Timer_Prog_RTS_1
    79 00:DE42: 7F B5         	STA		R_Timer_X
    80 00:DE44: 1B                TAX
    81 00:DE45: 63 6C DE          LDA     Table_Timer_Ms,X
    82 00:DE48: 7F B1             STA     R_Timer_Ms
    83 00:DE4A: 15 77 CA      	JSR		L_Display_Postive_Timer_Normal_Prog
    84 00:DE4D: 09            	RTS
    85                        L_Control_Positive_Timer_Prog_RTS_1:
    86 00:DE4E: 7F B5             STA     R_Timer_X
    87 00:DE50: 1B                TAX
    88 00:DE51: 63 6C DE          LDA     Table_Timer_Ms,X
    89 00:DE54: 7F B1             STA     R_Timer_Ms
    90 00:DE56: 15 DA DD          JSR     L_Positive_Timer
    91 00:DE59: 15 F7 CA          JSR     L_Display_Postive_Timer_Prog
    92 00:DE5C: 09                RTS
    93                        
    94                        
    95                        
    96                        
    97                        L_Control_Timer_Beep_Prog:
    98 00:DE5D: 73 B3             LDA     R_Timer_Min
    99 00:DE5F: 15 A5 CE          JSR     L_A_HexDToHex
   100 00:DE62: 51 0F             AND     #0FH
   101 00:DE64: 56 09             CMP     #9
   102 00:DE66: 12 03             BNE     L_Control_Timer_Beep_Prog_RTS
   103 00:DE68: 15 00 E0          JSR     L_Beep_1s_Usually
   104                        L_Control_Timer_Beep_Prog_RTS:
   105 00:DE6B: 09                RTS
   106                        
   107                        Table_Timer_Ms:
   108 00:DE6C: 00                .DB     0
   109 00:DE6D: 03                .DB     3
   110 00:DE6E: 06                .DB     6
   111 00:DE6F: 09                .DB     9
   112 00:DE70: 0C                .DB     12
   113 00:DE71: 0F                .DB     15
   114 00:DE72: 12                .DB     18
   115 00:DE73: 15                .DB     21
   116 00:DE74: 18                .DB     24
   117 00:DE75: 1B                .DB     27
   118 00:DE76: 1E                .DB     30
   119 00:DE77: 21                .DB     33
   120 00:DE78: 24                .DB     36
   121 00:DE79: 27                .DB     39
   122 00:DE7A: 2A                .DB     42
   123 00:DE7B: 2D                .DB     45
   124 00:DE7C: 30                .DB     48
   125 00:DE7D: 33                .DB     51
   126 00:DE7E: 36                .DB     54
   127 00:DE7F: 39                .DB     57
   128 00:DE80: 3C                .DB     60
   129 00:DE81: 3F                .DB     63
   130 00:DE82: 42                .DB     66
   131 00:DE83: 45                .DB     69
   132 00:DE84: 48                .DB     72
   133 00:DE85: 4B                .DB     75
   134 00:DE86: 4E                .DB     78
   135 00:DE87: 51                .DB     81
   136 00:DE88: 54                .DB     84
   137 00:DE89: 57                .DB     87
   138 00:DE8A: 5A                .DB     90
   139 00:DE8B: 5D                .DB     93
   140 00:DE8C: 60                .DB     96
   141 00:DE8D: 63                .DB     99
   142                        
   143                        
   144                        
   145                        
   146                        
   147                        
   148                        
   149                        
   149                        
   192                        .INCLUDE	Half_s\Common.asm
     1                        ; L_Set_Mode_Auto_Exit:
     2                        ; 	BBR3	Sys_Flag_A,L_Set_Mode_Auto_Exit_OUT
     3                        ; 	LDA		Sys_Flag_A
     4                        ; 	AND		#14H
     5                        ; 	BNE		L_Set_Mode_Auto_Exit_OUT;长按和快加时不进行设置
     6                        ; 	CLC
     7                        ; 	LDA		R_Set_Mode_Exit_Time
     8                        ; 	ADC		#1
     9                        ; 	STA		R_Set_Mode_Exit_Time
    10                        ; 	CMP		#D_Set_Mode_Exit_Time
    11                        ; 	BCS		L_Set_Mode_Auto_Exit_1
    12                        ; 	BEQ		L_Set_Mode_Auto_Exit_1
    13                        ; 	RTS
    14                        ; L_Set_Mode_Auto_Exit_1:
    15                        ; 	RMB3	Sys_Flag_A
    16                        ; 	LDA		#0
    17                        ; 	STA		R_Set_Mode_Exit_Time
    18                        ; 	STA		R_Mode_Set
    19                        ; 	JSR		L_Display_Prog
    20                        L_Set_Mode_Auto_Exit_OUT:
    21 00:DE8E: 09            	RTS
    22                        ;===========================================
    23                        L_Auto_To_Clock_Mode_Prog:
    24 00:DE8F: 43 91 18      	LDA		R_Mode
    25 00:DE92: 13 1F         	BEQ		L_Auto_To_Clock_Mode_Prog_Time
    26 00:DE94: 56 04         	CMP		#4
    27 00:DE96: 12 01         	BNE		L_Auto_To_Clock_Mode_Prog_1
    28 00:DE98: 09            	RTS
    29                        L_Auto_To_Clock_Mode_Prog_1:
    30 00:DE99: 73 EE         	LDA		Time_To_Clock_Mode
    31 00:DE9B: 54 01         	ADC		#1
    32 00:DE9D: 7F EE         	STA		Time_To_Clock_Mode
    33 00:DE9F: 56 06         	CMP		#D_Time_To_Clock_Mode
    34 00:DEA1: 10 EB         	BCC		L_Set_Mode_Auto_Exit_OUT
    35 00:DEA3: 53 00         	LDA		#0
    36 00:DEA5: 7F EE         	STA		Time_To_Clock_Mode
    37 00:DEA7: 4F 91 18      	STA		R_Mode
    38 00:DEAA: 23 9F         	RMB3	Sys_Flag_A
    39 00:DEAC: 15 F5 C0      	JSR		L_Clr_All_DisRam_Prog
    40 00:DEAF: 15 BD CA      	JSR		L_Display_Prog
    41 00:DEB2: 09            	RTS
    42                        L_Auto_To_Clock_Mode_Prog_Time:
    43 00:DEB3: 33 9F D8      	BBR3	Sys_Flag_A,L_Set_Mode_Auto_Exit_OUT
    44 00:DEB6: 43 92 18      	LDA		R_Set_Mode_Exit_Time
    45 00:DEB9: 56 06         	CMP		#6
    46 00:DEBB: 10 09         	BCC		L_Auto_To_Clock_Mode_Prog_Time_RTS
    47 00:DEBD: 23 9F         	RMB3	Sys_Flag_A
    48 00:DEBF: 15 F5 C0      	JSR		L_Clr_All_DisRam_Prog
    49 00:DEC2: 15 BD CA      	JSR		L_Display_Prog
    50 00:DEC5: 09            	RTS
    51                        L_Auto_To_Clock_Mode_Prog_Time_RTS:
    52 00:DEC6: 04            	CLC
    53 00:DEC7: 54 01         	ADC		#1
    54 00:DEC9: 4F 92 18      	STA		R_Set_Mode_Exit_Time
    55                        	RTS
    55 00:DECC: 09            
   193                        .INCLUDE	Half_s\Flash.asm
     1                        L_SysFlash_Prog:
     2 00:DECD: 15 F5 DE      	JSR		L_SysFlash_Set_Mode_Prog
     3 00:DED0: 15 E7 DE      	JSR		L_SysFlash_Prog_Positive_Timer
     4 00:DED3: 15 DA DE      	JSR		L_SysFlash_Alm_Symbol_Prog
     5 00:DED6: 15 E0 DE      	JSR		L_SysFlash_Snz_Symbol_Prog
     6                        L_SysFlash_Prog_RTS:
     7 00:DED9: 09            	RTS
     8                        
     9                        L_SysFlash_Alm_Symbol_Prog:
    10 00:DEDA: 34 A1 FC      	BBR4	Sys_Flag_C,L_SysFlash_Prog_RTS
    11 00:DEDD: 15 C5 CC      	JSR		L_Clr_lcd_Alm_Prog
    12                        L_SysFlash_Snz_Symbol_Prog:
    13 00:DEE0: 37 A1 F6      	BBR7	Sys_Flag_C,L_SysFlash_Prog_RTS
    14 00:DEE3: 15 C9 CC      	JSR		L_Clr_lcd_Snz_Prog
    15 00:DEE6: 09            	RTS
    16                        
    17                        L_SysFlash_Prog_Positive_Timer:
    18 00:DEE7: 30 A2 0A      	BBR0	Sys_Flag_D,L_SysFlash_Prog_Positive_Timer_RTS
    19 00:DEEA: 43 91 18      	LDA		R_Mode
    20 00:DEED: 56 04         	CMP		#4
    21 00:DEEF: 12 03         	BNE		L_SysFlash_Prog_Positive_Timer_RTS
    22 00:DEF1: 15 BA CC      	JSR		L_Clr_col_Prog
    23                        L_SysFlash_Prog_Positive_Timer_RTS:
    24 00:DEF4: 09            	RTS
    25                        
    26                        L_SysFlash_Set_Mode_Prog:
    27 00:DEF5: 33 9F FC      	BBR3	Sys_Flag_A,L_SysFlash_Prog_Positive_Timer_RTS
    28 00:DEF8: 15 50 DF      	JSR		L_CLR_AM_PM_Prog
    29 00:DEFB: 43 91 18      	LDA		R_Mode
    30 00:DEFE: 04            	CLC
    31 00:DEFF: 06            	CLD
    32 00:DF00: 18            	ROL
    33 00:DF01: 1B            	TAX
    34 00:DF02: 63 0C DF      	LDA		Table_SysFlash+1,X
    35 00:DF05: 0A            	PHA
    36 00:DF06: 63 0B DF      	LDA		Table_SysFlash,X
    37 00:DF09: 0A            	PHA
    38 00:DF0A: 09            	RTS
    39                        Table_SysFlash:
    40 00:DF0B: 14 DF         	DW		L_SysFlash_Set_Mode_Prog_Time-1
    41 00:DF0D: F3 DE         	DW		L_SysFlash_Prog_Positive_Timer_RTS-1
    42 00:DF0F: 40 DF         	DW		L_SysFlash_Set_Mode_Prog_usually-1
    43 00:DF11: 40 DF         	DW		L_SysFlash_Set_Mode_Prog_usually-1
    44 00:DF13: F3 DE         	DW		L_SysFlash_Prog_Positive_Timer_RTS-1
    45                        
    46                        
    47                        
    48                        L_SysFlash_Set_Mode_Prog_Time:
    49 00:DF15: 04            	CLC
    50 00:DF16: 06            	CLD
    51 00:DF17: 73 BA         	LDA		R_Mode_Set
    52 00:DF19: 18            	ROL
    53 00:DF1A: 1B            	TAX
    54 00:DF1B: 63 25 DF      	LDA		Table_SysFlash_Time+1,X
    55 00:DF1E: 0A            	PHA
    56 00:DF1F: 63 24 DF      	LDA		Table_SysFlash_Time,X
    57 00:DF22: 0A            	PHA
    58 00:DF23: 09            	RTS
    59                        Table_SysFlash_Time:
    60 00:DF24: 39 DF         	DW		L_SysFlash_Set_Mode_Prog_Time_Sec-1
    61                        Table_Usually:
    62 00:DF26: F8 CC         	DW		L_Clr_lcd_d1_Prog-1
    63 00:DF28: 00 CD         	DW		L_Clr_lcd_d2_Prog-1
    64 00:DF2A: 08 CD         	DW		L_Clr_lcd_d4_Prog-1
    65 00:DF2C: 0C CD         	DW		L_Clr_lcd_d5_Prog-1
    66 00:DF2E: F8 CC         	DW		L_Clr_lcd_d1_Prog-1
    67 00:DF30: 00 CD         	DW		L_Clr_lcd_d2_Prog-1
    68 00:DF32: 08 CD         	DW		L_Clr_lcd_d4_Prog-1
    69 00:DF34: 0C CD         	DW		L_Clr_lcd_d5_Prog-1
    70 00:DF36: 14 CD         	DW		L_Clr_lcd_d7_Prog-1
    71 00:DF38: 18 CD         	DW		L_Clr_lcd_d8_Prog-1
    72                        L_SysFlash_Set_Mode_Prog_Time_Sec:
    73 00:DF3A: 15 19 CD      	JSR		L_Clr_lcd_d8_Prog
    74 00:DF3D: 15 15 CD      	JSR		L_Clr_lcd_d7_Prog
    75 00:DF40: 09            	RTS
    76                        L_SysFlash_Set_Mode_Prog_usually:
    77 00:DF41: 04            	CLC
    78 00:DF42: 06            	CLD
    79 00:DF43: 73 BA         	LDA		R_Mode_Set
    80 00:DF45: 18            	ROL
    81 00:DF46: 1B            	TAX
    82 00:DF47: 63 27 DF      	LDA		Table_Usually+1,X
    83 00:DF4A: 0A            	PHA
    84 00:DF4B: 63 26 DF      	LDA		Table_Usually,X
    85 00:DF4E: 0A            	PHA
    86 00:DF4F: 09            	RTS
    87                        
    88                        L_CLR_AM_PM_Prog:
    89 00:DF50: 43 91 18      	LDA		R_Mode
    90 00:DF53: 13 0D         	BEQ		L_CLR_AM_PM_Prog_Time
    91 00:DF55: 73 BA         	LDA		R_Mode_Set
    92 00:DF57: 56 04         	CMP		#4
    93 00:DF59: 11 06         	BCS		L_CLR_AM_PM_Prog_RTS
    94 00:DF5B: 15 D1 CC      	JSR		L_Clr_lcd_AM_Prog
    95 00:DF5E: 15 D5 CC      	JSR		L_Clr_lcd_PM_Prog
    96                        L_CLR_AM_PM_Prog_RTS:
    97 00:DF61: 09            	RTS
    98                        L_CLR_AM_PM_Prog_Time:
    99 00:DF62: 73 BA         	LDA		R_Mode_Set
   100 00:DF64: 13 FB         	BEQ		L_CLR_AM_PM_Prog_RTS
   101 00:DF66: 56 04         	CMP		#4
   102 00:DF68: 11 F7         	BCS		L_CLR_AM_PM_Prog_RTS
   103 00:DF6A: 15 D1 CC      	JSR		L_Clr_lcd_AM_Prog
   104 00:DF6D: 15 D5 CC      	JSR		L_Clr_lcd_PM_Prog
   105 00:DF70: 09            	RTS
   105                        
   194                        
   195                        .INCLUDE	Sound\Beep.asm
     1                        ;============================================================
     2                        L_control_Beep_prog:
     3 00:DF71: 43 95 18      	LDA		R_Voice_Unit;闹铃持续的次数时间
     4 00:DF74: 13 0D         	BEQ		L_control_Beep_prog_out
     5 00:DF76: 04            	CLC
     6 00:DF77: 43 93 18      	LDA		R_Alarm_Clock_Open_Beep_Time
     7 00:DF7A: 54 01         	ADC		#1
     8 00:DF7C: 4F 93 18      	STA		R_Alarm_Clock_Open_Beep_Time
     9 00:DF7F: 56 02         	CMP		#2
    10 00:DF81: 11 01         	BCS		L_Open_Beep_Prog
    11                        L_control_Beep_prog_out:
    12 00:DF83: 09            	RTS
    13                        
    14                        
    15                        ; ;---------------------------------------------------------------------
    16                        L_Open_Beep_Prog:
    17 00:DF84: 53 00         	LDA		#0
    18 00:DF86: 4F 93 18      	STA		R_Alarm_Clock_Open_Beep_Time
    19 00:DF89: 37 16 16      	BBR7	P_TMRCTRL,L_Open_Beep_Prog_1
    20 00:DF8C: 00            	SEC
    21 00:DF8D: 43 95 18      	LDA		R_Voice_Unit
    22 00:DF90: 55 01         	SBC		#1
    23 00:DF92: 4F 95 18      	STA		R_Voice_Unit
    24                        
    25                        L_Close_Beep_Prog:
    26 00:DF95: 53 00         	LDA		#$00
    27 00:DF97: 7F 1F         	STA		P_AUD
    28 00:DF99: 27 16         	RMB7	P_TMRCTRL	;关闭声音输出
    29 00:DF9B: 20 1D         	RMB0	P_SYSCLK ;Weak
    30                        	PB3_PB3_NOMS
+   30 00:DF9D: 21 0C          RMB1 PADF0
+   30 00:DF9F: 23 06          RMB3 PBTYPE
    31                        	; LDA		#0
    32                        	; STA		P_PB
    33 00:DFA1: 09            	RTS
    34                        ;--------------------------------------
    35                        L_Open_Beep_Prog_1:
    36                        	PB3_PWM
+   36 00:DFA2: 29 0C          SMB1 PADF0
+   36 00:DFA4: 2B 06          SMB3 PBTYPE
    37 00:DFA6: 53 80         	LDA		#$80
    38 00:DFA8: 7F 18         	STA		P_DIVC
    39 00:DFAA: 28 1D         	SMB0	P_SYSCLK ;STRONG
    40 00:DFAC: 53 FF         	LDA		#$FF
    41 00:DFAE: 7F 1F         	STA		P_AUD
    42 00:DFB0: 2F 16         	SMB7	P_TMRCTRL	;打开声音输出
    43 00:DFB2: 09            	RTS
    44                        ;==========================================
    45                        L_Scankey_Short_ST_SP_Press_Prog_Alarm:
    46                        ;====================================================
    47                        L_Scankey_Close_Alarm_Beep:
    48 00:DFB3: 73 A1         	LDA		Sys_Flag_C
    49 00:DFB5: 51 10         	AND		#10h
    50 00:DFB7: 13 1C         	BEQ		L_Scankey_Close_Alarm_Beep_OUT
    51 00:DFB9: 15 95 DF      	JSR		L_Close_Beep_Prog
    52 00:DFBC: 53 00         	LDA		#0
    53 00:DFBE: 4F 95 18      	STA		R_Voice_Unit
    54 00:DFC1: 4F 94 18      	STA		R_Close_Beep_Time
    55 00:DFC4: 24 A1         	RMB4	Sys_Flag_C
    56 00:DFC6: 43 97 18      	LDA		R_Snz_Frequency
    57 00:DFC9: 12 07         	BNE		L_Scankey_Close_Alarm_Beep_2
    58 00:DFCB: 53 00         	LDA		#0
    59 00:DFCD: 4F 96 18      	STA		R_Snz_Time
    60 00:DFD0: 27 A1         	RMB7	Sys_Flag_C
    61                        L_Scankey_Close_Alarm_Beep_2:
    62                        	; JSR		L_Display_Normal_Prog
    63 00:DFD2: 3B 9F 00      	BBS3	Sys_Flag_A,L_Scankey_Close_Alarm_Beep_OUT
    64                        	; JSR		L_Display_Set_Mode_Prog
    65                        L_Scankey_Close_Alarm_Beep_OUT:
    66 00:DFD5: 09            	RTS
    67                        
    68                        
    69                        
    70                        
    71                        
    72                        
    73                        
    74                        
    75                        L_Control_Beep_prog_Auto_Exit:;多久自动退出响闹,如果没有则按每秒给值
    76 00:DFD6: 73 A1         	LDA		Sys_Flag_C
    77 00:DFD8: 51 10         	AND		#10H
    78 00:DFDA: 13 F9         	BEQ		L_Scankey_Close_Alarm_Beep_OUT
    79 00:DFDC: 00            	SEC
    80 00:DFDD: 43 94 18      	LDA		R_Close_Beep_Time
    81 00:DFE0: 55 01         	SBC		#1
    82 00:DFE2: 4F 94 18      	STA		R_Close_Beep_Time;定时器
    83 00:DFE5: 13 CC         	BEQ		L_Scankey_Short_ST_SP_Press_Prog_Alarm
    84                        	EN_LCD_IRQ
+   84 00:DFE7: 2E 0E          SMB6 IER
    85 00:DFE9: 53 02         	LDA		#2
    86 00:DFEB: 4F 95 18      	STA		R_Voice_Unit
    87 00:DFEE: 3C A2 E4      	BBS4	Sys_Flag_D,L_Scankey_Close_Alarm_Beep_OUT
    88 00:DFF1: 09                RTS
    88                        
   196                        
   197                        .INCLUDE	Delay.asm
     1                        ;============================================================
     2                        L_ScanKey_Delay_Prog:    ;延时功能
     3 00:DFF2: 53 E0         	LDA		#$E0
     4 00:DFF4: 7F EF         	STA		P_Temp
     5                        L_Loop_ScanKey_Delay:
     6 00:DFF6: 78 EF         	INC		P_Temp
     7 00:DFF8: 73 EF         	LDA		P_Temp
     8 00:DFFA: 12 FA         	BNE		L_Loop_ScanKey_Delay
     9 00:DFFC: 09            	RTS
    10                        L_Beep_1s:    ;响一声
    11 00:DFFD: 35 A0 07      	BBR5	Sys_Flag_B,L_Beep_1s_RTS
    12                        L_Beep_1s_Usually:
    13 00:E000: 53 01         	LDA		#1
    14 00:E002: 4F 95 18      	STA		R_Voice_Unit
    15                        	EN_LCD_IRQ
+   15 00:E005: 2E 0E          SMB6 IER
    16                        L_Beep_1s_RTS
    17 00:E007: 09            	RTS
    17                        
   198                        
   199                        ;--------------------------------------------------------
   200                        ;***********************************************************************
   201 00:E008: FF FF FF FF   	.BLKB	$FFFF-$,$FF
   201 00:E008: FF FF FF FF   
   201 00:E008: FF FF FF FF   
   202                        
   203                        	.ORG	0FFF8H
   204                        
   205 00:FFF8: D5            	DB		11010101B	;
   206                        ; bit0 	=0
   207                        ; bit1	=0
   208                        ; bit2 	=0当PA7做复位时，只能写1低电平有效，高电平有效烧录会报错
   209                        ; bit3	=0PA口做输入下拉和输入上拉，1PA口做输入下拉和三态
   210                        ; bit4 	=0
   211                        ; bit5 	=0
   212                        ; bit6	=0VDD=1.5V,1 VDD=3V
   213                        ; bit7	=0做复位，1做PA7口
   214 00:FFF9: FF            	DB		11111111B	;
   215                        
   216                        ;***********************************************************************
   217                        	.ORG	0FFFCH
   218 00:FFFC: 00 C0         	DW		V_RESET
   219 00:FFFE: 90 C0         	DW		V_IRQ
   220                        
   221                        	.ENDS
   222                        	.END

 --------------------
      Warnings:0
      Errors  :0
